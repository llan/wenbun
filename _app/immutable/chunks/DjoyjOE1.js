var r_=Object.defineProperty;var i_=(d,i,r)=>i in d?r_(d,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):d[i]=r;var P=(d,i,r)=>i_(d,typeof i!="symbol"?i+"":i,r);import{e as s_,f as a_,j as u_,k as xr,D as o_,l as l_,m as Qi,s as f_}from"./B6yibNKD.js";import{a as c_,b as h_}from"./BsDyH6UM.js";import{p as d_}from"./RNIj8l95.js";var G=(d=>(d[d.New=0]="New",d[d.Learning=1]="Learning",d[d.Review=2]="Review",d[d.Relearning=3]="Relearning",d))(G||{}),R=(d=>(d[d.Manual=0]="Manual",d[d.Again=1]="Again",d[d.Hard=2]="Hard",d[d.Good=3]="Good",d[d.Easy=4]="Easy",d))(R||{});class U{static card(i){return{...i,state:U.state(i.state),due:U.time(i.due),last_review:i.last_review?U.time(i.last_review):void 0}}static rating(i){if(typeof i=="string"){const r=i.charAt(0).toUpperCase(),u=i.slice(1).toLowerCase(),f=R[`${r}${u}`];if(f===void 0)throw new Error(`Invalid rating:[${i}]`);return f}else if(typeof i=="number")return i;throw new Error(`Invalid rating:[${i}]`)}static state(i){if(typeof i=="string"){const r=i.charAt(0).toUpperCase(),u=i.slice(1).toLowerCase(),f=G[`${r}${u}`];if(f===void 0)throw new Error(`Invalid state:[${i}]`);return f}else if(typeof i=="number")return i;throw new Error(`Invalid state:[${i}]`)}static time(i){if(typeof i=="object"&&i instanceof Date)return i;if(typeof i=="string"){const r=Date.parse(i);if(isNaN(r))throw new Error(`Invalid date:[${i}]`);return new Date(r)}else if(typeof i=="number")return new Date(i);throw new Error(`Invalid date:[${i}]`)}static review_log(i){return{...i,due:U.time(i.due),rating:U.rating(i.rating),state:U.state(i.state),review:U.time(i.review)}}}Date.prototype.scheduler=function(d,i){return Yt(this,d,i)},Date.prototype.diff=function(d,i){return Xe(this,d,i)},Date.prototype.format=function(){return g_(this)},Date.prototype.dueFormat=function(d,i,r){return p_(this,d,i,r)};function Yt(d,i,r){return new Date(r?U.time(d).getTime()+i*24*60*60*1e3:U.time(d).getTime()+i*60*1e3)}function Xe(d,i,r){if(!d||!i)throw new Error("Invalid date");const u=U.time(d).getTime()-U.time(i).getTime();let f=0;switch(r){case"days":f=Math.floor(u/(24*60*60*1e3));break;case"minutes":f=Math.floor(u/(60*1e3));break}return f}function g_(d){const i=U.time(d),r=i.getFullYear(),u=i.getMonth()+1,f=i.getDate(),c=i.getHours(),g=i.getMinutes(),v=i.getSeconds();return`${r}-${Cn(u)}-${Cn(f)} ${Cn(c)}:${Cn(g)}:${Cn(v)}`}function Cn(d){return d<10?`0${d}`:`${d}`}const Vi=[60,60,24,31,12],ji=["second","min","hour","day","month","year"];function p_(d,i,r,u=ji){d=U.time(d),i=U.time(i),u.length!==ji.length&&(u=ji);let f=d.getTime()-i.getTime(),c;for(f/=1e3,c=0;c<Vi.length&&!(f<Vi[c]);c++)f/=Vi[c];return`${Math.floor(f)}${r?u[c]:""}`}const __=Object.freeze([R.Again,R.Hard,R.Good,R.Easy]),w_=[{start:2.5,end:7,factor:.15},{start:7,end:20,factor:.1},{start:20,end:1/0,factor:.05}];function v_(d,i,r){let u=1;for(const g of w_)u+=g.factor*Math.max(Math.min(d,g.end)-g.start,0);d=Math.min(d,r);let f=Math.max(2,Math.round(d-u));const c=Math.min(Math.round(d+u),r);return d>i&&(f=Math.max(f,i+1)),f=Math.min(f,c),{min_ivl:f,max_ivl:c}}function wt(d,i,r){return Math.min(Math.max(d,i),r)}function y_(d,i){const r=Date.UTC(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()),u=Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate());return Math.floor((u-r)/864e5)}const m_=.9,S_=36500,x_=!1,C_=!0,D_=Object.freeze(["1m","10m"]),R_=Object.freeze(["10m"]),Kt=.001,Cr=100,Hu=.5,A_=.1542,zu=Object.freeze([.212,1.2931,2.3065,8.2956,6.4133,.8334,3.0194,.001,1.8722,.1666,.796,1.4835,.0614,.2629,1.6483,.6014,1.8729,.5425,.0912,.0658,A_]),L_=2,b_=d=>[[Kt,Cr],[Kt,Cr],[Kt,Cr],[Kt,Cr],[1,10],[.001,4],[.001,4],[.001,.75],[0,4.5],[0,.8],[.001,3.5],[.001,5],[.001,.25],[.001,.9],[0,4],[0,1],[1,6],[0,d],[0,d],[0,.8],[.1,.8]],os=(d,i)=>{let r=L_;if(Math.max(0,i)>1){const u=-(Math.log(d[11])+Math.log(Math.pow(2,d[13])-1)+d[14]*.3)/i;r=wt(+u.toFixed(8),.01,2)}return b_(r).map(([u,f],c)=>wt(d[c],u,f))},ls=d=>{if(d===void 0)return[...zu];switch(d.length){case 21:return[...d];case 19:return console.debug("[FSRS-6]auto fill w from 19 to 21 length"),[...d,0,Hu];case 17:{const i=[...d];return i[4]=+(i[5]*2+i[4]).toFixed(8),i[5]=+(Math.log(i[5]*3+1)/3).toFixed(8),i[6]=+(i[6]+.5).toFixed(8),console.debug("[FSRS-6]auto fill w from 17 to 21 length"),i.concat([0,0,0,Hu])}default:return console.warn("[FSRS]Invalid parameters length, using default parameters"),[...zu]}},Ar=d=>{const i=Array.isArray(d==null?void 0:d.learning_steps)?d.learning_steps:D_,r=Array.isArray(d==null?void 0:d.relearning_steps)?d.relearning_steps:R_,u=os(ls(d==null?void 0:d.w),r.length);return{request_retention:(d==null?void 0:d.request_retention)||m_,maximum_interval:(d==null?void 0:d.maximum_interval)||S_,w:u,enable_fuzz:(d==null?void 0:d.enable_fuzz)??x_,enable_short_term:(d==null?void 0:d.enable_short_term)??C_,learning_steps:i,relearning_steps:r}};function bn(d,i){const r={due:d?U.time(d):new Date,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:0,lapses:0,learning_steps:0,state:G.New,last_review:void 0};return i&&typeof i=="function"?i(r):r}class E_{constructor(i){P(this,"c");P(this,"s0");P(this,"s1");P(this,"s2");const r=T_();this.c=1,this.s0=r(" "),this.s1=r(" "),this.s2=r(" "),i==null&&(i=+new Date),this.s0-=r(i),this.s0<0&&(this.s0+=1),this.s1-=r(i),this.s1<0&&(this.s1+=1),this.s2-=r(i),this.s2<0&&(this.s2+=1)}next(){const i=2091639*this.s0+this.c*23283064365386963e-26;return this.s0=this.s1,this.s1=this.s2,this.s2=i-(this.c=i|0),this.s2}set state(i){this.c=i.c,this.s0=i.s0,this.s1=i.s1,this.s2=i.s2}get state(){return{c:this.c,s0:this.s0,s1:this.s1,s2:this.s2}}}function T_(){let d=4022871197;return function(i){i=String(i);for(let r=0;r<i.length;r++){d+=i.charCodeAt(r);let u=.02519603282416938*d;d=u>>>0,u-=d,u*=d,d=u>>>0,u-=d,d+=u*4294967296}return(d>>>0)*23283064365386963e-26}}function I_(d){const i=new E_(d),r=()=>i.next();return r.int32=()=>i.next()*4294967296|0,r.double=()=>r()+(r()*2097152|0)*11102230246251565e-32,r.state=()=>i.state,r.importState=u=>(i.state=u,r),r}const ro=d=>{const i=typeof d=="number"?-d:-d[20],r=Math.exp(Math.pow(i,-1)*Math.log(.9))-1;return{decay:i,factor:+r.toFixed(8)}};function us(d,i,r){const{decay:u,factor:f}=ro(d);return+Math.pow(1+f*i/r,u).toFixed(8)}class O_{constructor(i){P(this,"param");P(this,"intervalModifier");P(this,"_seed");P(this,"forgetting_curve");this.param=new Proxy(Ar(i),this.params_handler_proxy()),this.intervalModifier=this.calculate_interval_modifier(this.param.request_retention),this.forgetting_curve=us.bind(this,this.param.w)}get interval_modifier(){return this.intervalModifier}set seed(i){this._seed=i}calculate_interval_modifier(i){if(i<=0||i>1)throw new Error("Requested retention rate should be in the range (0,1]");const{decay:r,factor:u}=ro(this.param.w);return+((Math.pow(i,1/r)-1)/u).toFixed(8)}get parameters(){return this.param}set parameters(i){this.update_parameters(i)}params_handler_proxy(){const i=this;return{set:function(r,u,f){return u==="request_retention"&&Number.isFinite(f)?i.intervalModifier=i.calculate_interval_modifier(Number(f)):u==="w"&&(f=os(ls(f),r.relearning_steps.length),i.forgetting_curve=us.bind(this,f),i.intervalModifier=i.calculate_interval_modifier(Number(r.request_retention))),Reflect.set(r,u,f),!0}}}update_parameters(i){const r=Ar(i);for(const u in r)if(u in this.param){const f=u;this.param[f]=r[f]}}init_stability(i){return Math.max(this.param.w[i-1],.1)}init_difficulty(i){return+(this.param.w[4]-Math.exp((i-1)*this.param.w[5])+1).toFixed(8)}apply_fuzz(i,r){if(!this.param.enable_fuzz||i<2.5)return Math.round(i);const u=I_(this._seed)(),{min_ivl:f,max_ivl:c}=v_(i,r,this.param.maximum_interval);return Math.floor(u*(c-f+1)+f)}next_interval(i,r){const u=Math.min(Math.max(1,Math.round(i*this.intervalModifier)),this.param.maximum_interval);return this.apply_fuzz(u,r)}linear_damping(i,r){return+(i*(10-r)/9).toFixed(8)}next_difficulty(i,r){const u=-this.param.w[6]*(r-3),f=i+this.linear_damping(u,i);return wt(this.mean_reversion(this.init_difficulty(R.Easy),f),1,10)}mean_reversion(i,r){return+(this.param.w[7]*i+(1-this.param.w[7])*r).toFixed(8)}next_recall_stability(i,r,u,f){const c=R.Hard===f?this.param.w[15]:1,g=R.Easy===f?this.param.w[16]:1;return+wt(r*(1+Math.exp(this.param.w[8])*(11-i)*Math.pow(r,-this.param.w[9])*(Math.exp((1-u)*this.param.w[10])-1)*c*g),Kt,36500).toFixed(8)}next_forget_stability(i,r,u){return+wt(this.param.w[11]*Math.pow(i,-this.param.w[12])*(Math.pow(r+1,this.param.w[13])-1)*Math.exp((1-u)*this.param.w[14]),Kt,36500).toFixed(8)}next_short_term_stability(i,r){const u=Math.pow(i,-this.param.w[19])*Math.exp(this.param.w[17]*(r-3+this.param.w[18])),f=r>=3?Math.max(u,1):u;return+wt(i*f,Kt,36500).toFixed(8)}next_state(i,r,u){const{difficulty:f,stability:c}=i??{difficulty:0,stability:0};if(r<0)throw new Error(`Invalid delta_t "${r}"`);if(u<0||u>4)throw new Error(`Invalid grade "${u}"`);if(f===0&&c===0)return{difficulty:wt(this.init_difficulty(u),1,10),stability:this.init_stability(u)};if(u===0)return{difficulty:f,stability:c};if(f<1||c<Kt)throw new Error(`Invalid memory state { difficulty: ${f}, stability: ${c} }`);const g=this.forgetting_curve(r,c),v=this.next_recall_stability(f,c,g,u),D=this.next_forget_stability(f,c,g),L=this.next_short_term_stability(c,u);let T=v;if(u===1){let[N,ut]=[0,0];this.param.enable_short_term&&(N=this.param.w[17],ut=this.param.w[18]);const V=c/Math.exp(N*ut);T=wt(+V.toFixed(8),Kt,D)}return r===0&&this.param.enable_short_term&&(T=L),{difficulty:this.next_difficulty(f,u),stability:T}}}function M_(){const d=this.review_time.getTime(),i=this.current.reps,r=this.current.difficulty*this.current.stability;return`${d}_${i}_${r}`}const P_=d=>{const i=d.slice(-1),r=parseInt(d.slice(0,-1),10);if(isNaN(r)||!Number.isFinite(r)||r<0)throw new Error(`Invalid step value: ${d}`);switch(i){case"m":return r;case"h":return r*60;case"d":return r*1440;default:throw new Error(`Invalid step unit: ${d}, expected m/h/d`)}},U_=(d,i,r)=>{const u=i===G.Relearning||i===G.Review?d.relearning_steps:d.learning_steps,f=u.length;if(f===0||r>=f)return{};const c=u[0],g=P_,v=()=>g(c),D=()=>{if(f===1)return Math.round(g(c)*1.5);const V=u[1];return Math.round((g(c)+g(V))/2)},L=V=>V<0||V>=f?null:u[V],T=V=>g(V),N={},ut=L(Math.max(0,r));if(i===G.Review)return N[R.Again]={scheduled_minutes:g(ut),next_step:0},N;{N[R.Again]={scheduled_minutes:v(),next_step:0},N[R.Hard]={scheduled_minutes:D(),next_step:r};const V=L(r+1);if(V){const nt=T(V);nt&&(N[R.Good]={scheduled_minutes:Math.round(nt),next_step:r+1})}}return N};var br=(d=>(d.SCHEDULER="Scheduler",d.LEARNING_STEPS="LearningSteps",d.SEED="Seed",d))(br||{});class io{constructor(i,r,u,f){P(this,"last");P(this,"current");P(this,"review_time");P(this,"next",new Map);P(this,"algorithm");P(this,"strategies");P(this,"elapsed_days",0);this.algorithm=u,this.last=U.card(i),this.current=U.card(i),this.review_time=U.time(r),this.strategies=f,this.init()}checkGrade(i){if(!Number.isFinite(i)||i<0||i>4)throw new Error(`Invalid grade "${i}",expected 1-4`)}init(){const{state:i,last_review:r}=this.current;let u=0;i!==G.New&&r&&(u=y_(r,this.review_time)),this.current.last_review=this.review_time,this.elapsed_days=u,this.current.elapsed_days=u,this.current.reps+=1;let f=M_;if(this.strategies){const c=this.strategies.get(br.SEED);c&&(f=c)}this.algorithm.seed=f.call(this)}preview(){return{[R.Again]:this.review(R.Again),[R.Hard]:this.review(R.Hard),[R.Good]:this.review(R.Good),[R.Easy]:this.review(R.Easy),[Symbol.iterator]:this.previewIterator.bind(this)}}*previewIterator(){for(const i of __)yield this.review(i)}review(i){const{state:r}=this.last;let u;switch(this.checkGrade(i),r){case G.New:u=this.newState(i);break;case G.Learning:case G.Relearning:u=this.learningState(i);break;case G.Review:u=this.reviewState(i);break}return u}buildLog(i){const{last_review:r,due:u,elapsed_days:f}=this.last;return{rating:i,state:this.current.state,due:r||u,stability:this.current.stability,difficulty:this.current.difficulty,elapsed_days:this.elapsed_days,last_elapsed_days:f,scheduled_days:this.current.scheduled_days,learning_steps:this.current.learning_steps,review:this.review_time}}}class qu extends io{constructor(r,u,f,c){super(r,u,f,c);P(this,"learningStepsStrategy");let g=U_;if(this.strategies){const v=this.strategies.get(br.LEARNING_STEPS);v&&(g=v)}this.learningStepsStrategy=g}getLearningInfo(r,u){var D,L;const f=this.algorithm.parameters;r.learning_steps=r.learning_steps||0;const c=this.learningStepsStrategy(f,r.state,this.current.state===G.Learning?r.learning_steps+1:r.learning_steps),g=Math.max(0,((D=c[u])==null?void 0:D.scheduled_minutes)??0),v=Math.max(0,((L=c[u])==null?void 0:L.next_step)??0);return{scheduled_minutes:g,next_steps:v}}applyLearningSteps(r,u,f){const{scheduled_minutes:c,next_steps:g}=this.getLearningInfo(this.current,u);if(c>0&&c<1440)r.learning_steps=g,r.scheduled_days=0,r.state=f,r.due=Yt(this.review_time,Math.round(c),!1);else if(r.state=G.Review,c>=1440)r.learning_steps=g,r.due=Yt(this.review_time,Math.round(c),!1),r.scheduled_days=Math.floor(c/1440);else{r.learning_steps=0;const v=this.algorithm.next_interval(r.stability,this.elapsed_days);r.scheduled_days=v,r.due=Yt(this.review_time,v,!0)}}newState(r){const u=this.next.get(r);if(u)return u;const f=U.card(this.current);f.difficulty=wt(this.algorithm.init_difficulty(r),1,10),f.stability=this.algorithm.init_stability(r),this.applyLearningSteps(f,r,G.Learning);const c={card:f,log:this.buildLog(r)};return this.next.set(r,c),c}learningState(r){const u=this.next.get(r);if(u)return u;const{state:f,difficulty:c,stability:g}=this.last,v=U.card(this.current);v.difficulty=this.algorithm.next_difficulty(c,r),v.stability=this.algorithm.next_short_term_stability(g,r),this.applyLearningSteps(v,r,f);const D={card:v,log:this.buildLog(r)};return this.next.set(r,D),D}reviewState(r){const u=this.next.get(r);if(u)return u;const f=this.elapsed_days,{difficulty:c,stability:g}=this.last,v=this.algorithm.forgetting_curve(f,g),D=U.card(this.current),L=U.card(this.current),T=U.card(this.current),N=U.card(this.current);this.next_ds(D,L,T,N,c,g,v),this.next_interval(L,T,N,f),this.next_state(L,T,N),this.applyLearningSteps(D,R.Again,G.Relearning),D.lapses+=1;const ut={card:D,log:this.buildLog(R.Again)},V={card:L,log:super.buildLog(R.Hard)},nt={card:T,log:super.buildLog(R.Good)},Zt={card:N,log:super.buildLog(R.Easy)};return this.next.set(R.Again,ut),this.next.set(R.Hard,V),this.next.set(R.Good,nt),this.next.set(R.Easy,Zt),this.next.get(r)}next_ds(r,u,f,c,g,v,D){r.difficulty=this.algorithm.next_difficulty(g,R.Again);const L=v/Math.exp(this.algorithm.parameters.w[17]*this.algorithm.parameters.w[18]),T=this.algorithm.next_forget_stability(g,v,D);r.stability=wt(+L.toFixed(8),Kt,T),u.difficulty=this.algorithm.next_difficulty(g,R.Hard),u.stability=this.algorithm.next_recall_stability(g,v,D,R.Hard),f.difficulty=this.algorithm.next_difficulty(g,R.Good),f.stability=this.algorithm.next_recall_stability(g,v,D,R.Good),c.difficulty=this.algorithm.next_difficulty(g,R.Easy),c.stability=this.algorithm.next_recall_stability(g,v,D,R.Easy)}next_interval(r,u,f,c){let g,v;g=this.algorithm.next_interval(r.stability,c),v=this.algorithm.next_interval(u.stability,c),g=Math.min(g,v),v=Math.max(v,g+1);const D=Math.max(this.algorithm.next_interval(f.stability,c),v+1);r.scheduled_days=g,r.due=Yt(this.review_time,g,!0),u.scheduled_days=v,u.due=Yt(this.review_time,v,!0),f.scheduled_days=D,f.due=Yt(this.review_time,D,!0)}next_state(r,u,f){r.state=G.Review,r.learning_steps=0,u.state=G.Review,u.learning_steps=0,f.state=G.Review,f.learning_steps=0}}class Yu extends io{newState(i){const r=this.next.get(i);if(r)return r;this.current.scheduled_days=0,this.current.elapsed_days=0;const u=U.card(this.current),f=U.card(this.current),c=U.card(this.current),g=U.card(this.current);return this.init_ds(u,f,c,g),this.next_interval(u,f,c,g,0),this.next_state(u,f,c,g),this.update_next(u,f,c,g),this.next.get(i)}init_ds(i,r,u,f){i.difficulty=wt(this.algorithm.init_difficulty(R.Again),1,10),i.stability=this.algorithm.init_stability(R.Again),r.difficulty=wt(this.algorithm.init_difficulty(R.Hard),1,10),r.stability=this.algorithm.init_stability(R.Hard),u.difficulty=wt(this.algorithm.init_difficulty(R.Good),1,10),u.stability=this.algorithm.init_stability(R.Good),f.difficulty=wt(this.algorithm.init_difficulty(R.Easy),1,10),f.stability=this.algorithm.init_stability(R.Easy)}learningState(i){return this.reviewState(i)}reviewState(i){const r=this.next.get(i);if(r)return r;const u=this.elapsed_days,{difficulty:f,stability:c}=this.last,g=this.algorithm.forgetting_curve(u,c),v=U.card(this.current),D=U.card(this.current),L=U.card(this.current),T=U.card(this.current);return this.next_ds(v,D,L,T,f,c,g),this.next_interval(v,D,L,T,u),this.next_state(v,D,L,T),v.lapses+=1,this.update_next(v,D,L,T),this.next.get(i)}next_ds(i,r,u,f,c,g,v){i.difficulty=this.algorithm.next_difficulty(c,R.Again);const D=this.algorithm.next_forget_stability(c,g,v);i.stability=wt(g,Kt,D),r.difficulty=this.algorithm.next_difficulty(c,R.Hard),r.stability=this.algorithm.next_recall_stability(c,g,v,R.Hard),u.difficulty=this.algorithm.next_difficulty(c,R.Good),u.stability=this.algorithm.next_recall_stability(c,g,v,R.Good),f.difficulty=this.algorithm.next_difficulty(c,R.Easy),f.stability=this.algorithm.next_recall_stability(c,g,v,R.Easy)}next_interval(i,r,u,f,c){let g,v,D,L;g=this.algorithm.next_interval(i.stability,c),v=this.algorithm.next_interval(r.stability,c),D=this.algorithm.next_interval(u.stability,c),L=this.algorithm.next_interval(f.stability,c),g=Math.min(g,v),v=Math.max(v,g+1),D=Math.max(D,v+1),L=Math.max(L,D+1),i.scheduled_days=g,i.due=Yt(this.review_time,g,!0),r.scheduled_days=v,r.due=Yt(this.review_time,v,!0),u.scheduled_days=D,u.due=Yt(this.review_time,D,!0),f.scheduled_days=L,f.due=Yt(this.review_time,L,!0)}next_state(i,r,u,f){i.state=G.Review,i.learning_steps=0,r.state=G.Review,r.learning_steps=0,u.state=G.Review,u.learning_steps=0,f.state=G.Review,f.learning_steps=0}update_next(i,r,u,f){const c={card:i,log:this.buildLog(R.Again)},g={card:r,log:super.buildLog(R.Hard)},v={card:u,log:super.buildLog(R.Good)},D={card:f,log:super.buildLog(R.Easy)};this.next.set(R.Again,c),this.next.set(R.Hard,g),this.next.set(R.Good,v),this.next.set(R.Easy,D)}}class N_{constructor(i){P(this,"fsrs");this.fsrs=i}replay(i,r,u){return this.fsrs.next(i,r,u)}handleManualRating(i,r,u,f,c,g,v){if(typeof r>"u")throw new Error("reschedule: state is required for manual rating");let D,L;if(r===G.New)D={rating:R.Manual,state:r,due:v??u,stability:i.stability,difficulty:i.difficulty,elapsed_days:f,last_elapsed_days:i.elapsed_days,scheduled_days:i.scheduled_days,learning_steps:i.learning_steps,review:u},L=bn(u),L.last_review=u;else{if(typeof v>"u")throw new Error("reschedule: due is required for manual rating");const T=Xe(v,u,"days");D={rating:R.Manual,state:i.state,due:i.last_review||i.due,stability:i.stability,difficulty:i.difficulty,elapsed_days:f,last_elapsed_days:i.elapsed_days,scheduled_days:i.scheduled_days,learning_steps:i.learning_steps,review:u},L={...i,state:r,due:v,last_review:u,stability:c||i.stability,difficulty:g||i.difficulty,elapsed_days:f,scheduled_days:T,reps:i.reps+1}}return{card:L,log:D}}reschedule(i,r){const u=[];let f=bn(i.due);for(const c of r){let g;if(c.review=U.time(c.review),c.rating===R.Manual){let v=0;f.state!==G.New&&f.last_review&&(v=Xe(c.review,f.last_review,"days")),g=this.handleManualRating(f,c.state,c.review,v,c.stability,c.difficulty,c.due?U.time(c.due):void 0)}else g=this.replay(f,c.review,c.rating);u.push(g),f=g.card}return u}calculateManualRecord(i,r,u,f){if(!u)return null;const{card:c,log:g}=u,v=U.card(i);return v.due.getTime()===c.due.getTime()?null:(v.scheduled_days=Xe(c.due,v.due,"days"),this.handleManualRating(v,c.state,U.time(r),g.elapsed_days,f?c.stability:void 0,f?c.difficulty:void 0,c.due))}}class Ku extends O_{constructor(r){super(r);P(this,"strategyHandler",new Map);P(this,"Scheduler");const{enable_short_term:u}=this.parameters;this.Scheduler=u?qu:Yu}params_handler_proxy(){const r=this;return{set:function(u,f,c){return f==="request_retention"&&Number.isFinite(c)?r.intervalModifier=r.calculate_interval_modifier(Number(c)):f==="enable_short_term"?r.Scheduler=c===!0?qu:Yu:f==="w"&&(c=os(ls(c),u.relearning_steps.length),r.forgetting_curve=us.bind(this,c),r.intervalModifier=r.calculate_interval_modifier(Number(u.request_retention))),Reflect.set(u,f,c),!0}}}useStrategy(r,u){return this.strategyHandler.set(r,u),this}clearStrategy(r){return r?this.strategyHandler.delete(r):this.strategyHandler.clear(),this}getScheduler(r,u){const f=this.strategyHandler.get(br.SCHEDULER)||this.Scheduler;return new f(r,u,this,this.strategyHandler)}repeat(r,u,f){const c=this.getScheduler(r,u).preview();return f&&typeof f=="function"?f(c):c}next(r,u,f,c){const g=this.getScheduler(r,u),v=U.rating(f);if(v===R.Manual)throw new Error("Cannot review a manual rating");const D=g.review(v);return c&&typeof c=="function"?c(D):D}get_retrievability(r,u,f=!0){const c=U.card(r);u=u?U.time(u):new Date;const g=c.state!==G.New?Math.max(Xe(u,c.last_review,"days"),0):0,v=c.state!==G.New?this.forgetting_curve(g,+c.stability.toFixed(8)):0;return f?`${(v*100).toFixed(2)}%`:v}rollback(r,u,f){const c=U.card(r),g=U.review_log(u);if(g.rating===R.Manual)throw new Error("Cannot rollback a manual rating");let v,D,L;switch(g.state){case G.New:v=g.due,D=void 0,L=0;break;case G.Learning:case G.Relearning:case G.Review:v=g.review,D=g.due,L=c.lapses-(g.rating===R.Again&&g.state===G.Review?1:0);break}const T={...c,due:v,stability:g.stability,difficulty:g.difficulty,elapsed_days:g.last_elapsed_days,scheduled_days:g.scheduled_days,reps:Math.max(0,c.reps-1),lapses:Math.max(0,L),learning_steps:g.learning_steps,state:g.state,last_review:D};return f&&typeof f=="function"?f(T):T}forget(r,u,f=!1,c){const g=U.card(r);u=U.time(u);const v=g.state===G.New?0:Xe(u,g.due,"days"),D={rating:R.Manual,state:g.state,due:g.due,stability:g.stability,difficulty:g.difficulty,elapsed_days:0,last_elapsed_days:g.elapsed_days,scheduled_days:v,learning_steps:g.learning_steps,review:u},L={card:{...g,due:u,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:f?0:g.reps,lapses:f?0:g.lapses,learning_steps:0,state:G.New,last_review:g.last_review},log:D};return c&&typeof c=="function"?c(L):L}reschedule(r,u=[],f={}){const{recordLogHandler:c,reviewsOrderBy:g,skipManual:v=!0,now:D=new Date,update_memory_state:L=!1}=f;g&&typeof g=="function"&&u.sort(g),v&&(u=u.filter(Zt=>Zt.rating!==R.Manual));const T=new N_(this),N=T.reschedule(f.first_card||bn(),u),ut=N.length,V=U.card(r),nt=T.calculateManualRecord(V,D,ut?N[ut-1]:void 0,L);return c&&typeof c=="function"?{collections:N.map(c),reschedule_item:nt?c(nt):null}:{collections:N,reschedule_item:nt}}}function W_(d,i,r,u){if(typeof i=="function"?d!==i||!u:!i.has(d))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?u:r==="a"?u.call(d):u?u.value:i.get(d)}function F_(d,i,r,u,f){if(typeof i=="function"?d!==i||!0:!i.has(d))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i.set(d,r),r}var Rr;function G_(d,i=!1){return window.__TAURI_INTERNALS__.transformCallback(d,i)}async function ct(d,i={},r){return window.__TAURI_INTERNALS__.invoke(d,i,r)}class B_{get rid(){return W_(this,Rr,"f")}constructor(i){Rr.set(this,void 0),F_(this,Rr,i)}async close(){return ct("plugin:resources|close",{rid:this.rid})}}Rr=new WeakMap;function ts(){return!!(globalThis||window).isTauri}var Zu;(function(d){d.WINDOW_RESIZED="tauri://resize",d.WINDOW_MOVED="tauri://move",d.WINDOW_CLOSE_REQUESTED="tauri://close-requested",d.WINDOW_DESTROYED="tauri://destroyed",d.WINDOW_FOCUS="tauri://focus",d.WINDOW_BLUR="tauri://blur",d.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",d.WINDOW_THEME_CHANGED="tauri://theme-changed",d.WINDOW_CREATED="tauri://window-created",d.WEBVIEW_CREATED="tauri://webview-created",d.DRAG_ENTER="tauri://drag-enter",d.DRAG_OVER="tauri://drag-over",d.DRAG_DROP="tauri://drag-drop",d.DRAG_LEAVE="tauri://drag-leave"})(Zu||(Zu={}));async function k_(d,i){window.__TAURI_EVENT_PLUGIN_INTERNALS__.unregisterListener(d,i),await ct("plugin:event|unlisten",{event:d,eventId:i})}async function Ju(d,i,r){var u;const f=(u=void 0)!==null&&u!==void 0?u:{kind:"Any"};return ct("plugin:event|listen",{event:d,target:f,handler:G_(i)}).then(c=>async()=>k_(d,c))}async function $_(d,i){return await Lr.load(d,i)}class Lr extends B_{constructor(i){super(i)}static async load(i,r){const u=await ct("plugin:store|load",{path:i,...r});return new Lr(u)}static async get(i){return await ct("plugin:store|get_store",{path:i}).then(r=>r?new Lr(r):null)}async set(i,r){await ct("plugin:store|set",{rid:this.rid,key:i,value:r})}async get(i){const[r,u]=await ct("plugin:store|get",{rid:this.rid,key:i});return u?r:void 0}async has(i){return await ct("plugin:store|has",{rid:this.rid,key:i})}async delete(i){return await ct("plugin:store|delete",{rid:this.rid,key:i})}async clear(){await ct("plugin:store|clear",{rid:this.rid})}async reset(){await ct("plugin:store|reset",{rid:this.rid})}async keys(){return await ct("plugin:store|keys",{rid:this.rid})}async values(){return await ct("plugin:store|values",{rid:this.rid})}async entries(){return await ct("plugin:store|entries",{rid:this.rid})}async length(){return await ct("plugin:store|length",{rid:this.rid})}async reload(){await ct("plugin:store|reload",{rid:this.rid})}async save(){await ct("plugin:store|save",{rid:this.rid})}async onKeyChange(i,r){return await Ju("store://change",u=>{u.payload.resourceId===this.rid&&u.payload.key===i&&r(u.payload.exists?u.payload.value:void 0)})}async onChange(i){return await Ju("store://change",r=>{r.payload.resourceId===this.rid&&i(r.payload.key,r.payload.exists?r.payload.value:void 0)})}}class H_{constructor(i){P(this,"storeFilename");P(this,"store",null);P(this,"isLoaded",!1);this.storeFilename=i}async ensureStoreLoaded(){this.isLoaded||(this.store=await $_(this.storeFilename,{autoSave:!1}),this.isLoaded=!0)}async load(i){if(await this.ensureStoreLoaded(),!!this.store)return await this.store.get(i)}async save(i,r){await this.ensureStoreLoaded(),this.store&&await this.store.set(i,r)}}const z_="wenbun-deck-manager";class q_{constructor(i){P(this,"storeName");P(this,"db");this.storeName=i}async ensureDBLoaded(){return this.db?new Promise(i=>i()):new Promise((i,r)=>{const u=window.indexedDB.open(z_,1);u.onupgradeneeded=()=>{const f=u.result;f.objectStoreNames.contains(this.storeName)||f.createObjectStore(this.storeName)},u.onsuccess=()=>{this.db=u.result,i()},u.onerror=f=>{window.alert("Error opening database"),r(f)}})}async load(i){return await this.ensureDBLoaded(),new Promise((r,u)=>{if(!this.db)return r(void 0);const g=this.db.transaction(this.storeName,"readonly").objectStore(this.storeName).get(i);g.onsuccess=()=>r(g.result),g.onerror=()=>u(g.error)})}async save(i,r){return await this.ensureDBLoaded(),new Promise((u,f)=>{if(!this.db)return u();const v=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(r,i);v.onsuccess=()=>u(),v.onerror=()=>f(v.error)})}}var Dr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Y_(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var Rn={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */var K_=Rn.exports,Xu;function Z_(){return Xu||(Xu=1,function(d,i){(function(){var r,u="4.17.21",f=200,c="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",g="Expected a function",v="Invalid `variable` option passed into `_.template`",D="__lodash_hash_undefined__",L=500,T="__lodash_placeholder__",N=1,ut=2,V=4,nt=1,Zt=2,Ft=1,Me=2,fs=4,jt=8,Qe=16,te=32,Ve=64,ee=128,je=256,Er=512,ao=30,uo="...",oo=800,lo=16,cs=1,fo=2,co=3,Ce=1/0,he=9007199254740991,ho=17976931348623157e292,En=NaN,Jt=4294967295,go=Jt-1,po=Jt>>>1,_o=[["ary",ee],["bind",Ft],["bindKey",Me],["curry",jt],["curryRight",Qe],["flip",Er],["partial",te],["partialRight",Ve],["rearg",je]],Pe="[object Arguments]",Tn="[object Array]",wo="[object AsyncFunction]",tn="[object Boolean]",en="[object Date]",vo="[object DOMException]",In="[object Error]",On="[object Function]",hs="[object GeneratorFunction]",Gt="[object Map]",nn="[object Number]",yo="[object Null]",ne="[object Object]",ds="[object Promise]",mo="[object Proxy]",rn="[object RegExp]",Bt="[object Set]",sn="[object String]",Mn="[object Symbol]",So="[object Undefined]",an="[object WeakMap]",xo="[object WeakSet]",un="[object ArrayBuffer]",Ue="[object DataView]",Tr="[object Float32Array]",Ir="[object Float64Array]",Or="[object Int8Array]",Mr="[object Int16Array]",Pr="[object Int32Array]",Ur="[object Uint8Array]",Nr="[object Uint8ClampedArray]",Wr="[object Uint16Array]",Fr="[object Uint32Array]",Co=/\b__p \+= '';/g,Do=/\b(__p \+=) '' \+/g,Ro=/(__e\(.*?\)|\b__t\)) \+\n'';/g,gs=/&(?:amp|lt|gt|quot|#39);/g,ps=/[&<>"']/g,Ao=RegExp(gs.source),Lo=RegExp(ps.source),bo=/<%-([\s\S]+?)%>/g,Eo=/<%([\s\S]+?)%>/g,_s=/<%=([\s\S]+?)%>/g,To=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Io=/^\w*$/,Oo=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Gr=/[\\^$.*+?()[\]{}|]/g,Mo=RegExp(Gr.source),Br=/^\s+/,Po=/\s/,Uo=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,No=/\{\n\/\* \[wrapped with (.+)\] \*/,Wo=/,? & /,Fo=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Go=/[()=,{}\[\]\/\s]/,Bo=/\\(\\)?/g,ko=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ws=/\w*$/,$o=/^[-+]0x[0-9a-f]+$/i,Ho=/^0b[01]+$/i,zo=/^\[object .+?Constructor\]$/,qo=/^0o[0-7]+$/i,Yo=/^(?:0|[1-9]\d*)$/,Ko=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Pn=/($^)/,Zo=/['\n\r\u2028\u2029\\]/g,Un="\\ud800-\\udfff",Jo="\\u0300-\\u036f",Xo="\\ufe20-\\ufe2f",Qo="\\u20d0-\\u20ff",vs=Jo+Xo+Qo,ys="\\u2700-\\u27bf",ms="a-z\\xdf-\\xf6\\xf8-\\xff",Vo="\\xac\\xb1\\xd7\\xf7",jo="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",tl="\\u2000-\\u206f",el=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ss="A-Z\\xc0-\\xd6\\xd8-\\xde",xs="\\ufe0e\\ufe0f",Cs=Vo+jo+tl+el,kr="['’]",nl="["+Un+"]",Ds="["+Cs+"]",Nn="["+vs+"]",Rs="\\d+",rl="["+ys+"]",As="["+ms+"]",Ls="[^"+Un+Cs+Rs+ys+ms+Ss+"]",$r="\\ud83c[\\udffb-\\udfff]",il="(?:"+Nn+"|"+$r+")",bs="[^"+Un+"]",Hr="(?:\\ud83c[\\udde6-\\uddff]){2}",zr="[\\ud800-\\udbff][\\udc00-\\udfff]",Ne="["+Ss+"]",Es="\\u200d",Ts="(?:"+As+"|"+Ls+")",sl="(?:"+Ne+"|"+Ls+")",Is="(?:"+kr+"(?:d|ll|m|re|s|t|ve))?",Os="(?:"+kr+"(?:D|LL|M|RE|S|T|VE))?",Ms=il+"?",Ps="["+xs+"]?",al="(?:"+Es+"(?:"+[bs,Hr,zr].join("|")+")"+Ps+Ms+")*",ul="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ol="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Us=Ps+Ms+al,ll="(?:"+[rl,Hr,zr].join("|")+")"+Us,fl="(?:"+[bs+Nn+"?",Nn,Hr,zr,nl].join("|")+")",cl=RegExp(kr,"g"),hl=RegExp(Nn,"g"),qr=RegExp($r+"(?="+$r+")|"+fl+Us,"g"),dl=RegExp([Ne+"?"+As+"+"+Is+"(?="+[Ds,Ne,"$"].join("|")+")",sl+"+"+Os+"(?="+[Ds,Ne+Ts,"$"].join("|")+")",Ne+"?"+Ts+"+"+Is,Ne+"+"+Os,ol,ul,Rs,ll].join("|"),"g"),gl=RegExp("["+Es+Un+vs+xs+"]"),pl=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,_l=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],wl=-1,Q={};Q[Tr]=Q[Ir]=Q[Or]=Q[Mr]=Q[Pr]=Q[Ur]=Q[Nr]=Q[Wr]=Q[Fr]=!0,Q[Pe]=Q[Tn]=Q[un]=Q[tn]=Q[Ue]=Q[en]=Q[In]=Q[On]=Q[Gt]=Q[nn]=Q[ne]=Q[rn]=Q[Bt]=Q[sn]=Q[an]=!1;var X={};X[Pe]=X[Tn]=X[un]=X[Ue]=X[tn]=X[en]=X[Tr]=X[Ir]=X[Or]=X[Mr]=X[Pr]=X[Gt]=X[nn]=X[ne]=X[rn]=X[Bt]=X[sn]=X[Mn]=X[Ur]=X[Nr]=X[Wr]=X[Fr]=!0,X[In]=X[On]=X[an]=!1;var vl={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},yl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ml={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Sl={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},xl=parseFloat,Cl=parseInt,Ns=typeof Dr=="object"&&Dr&&Dr.Object===Object&&Dr,Dl=typeof self=="object"&&self&&self.Object===Object&&self,lt=Ns||Dl||Function("return this")(),Yr=i&&!i.nodeType&&i,De=Yr&&!0&&d&&!d.nodeType&&d,Ws=De&&De.exports===Yr,Kr=Ws&&Ns.process,Et=function(){try{var _=De&&De.require&&De.require("util").types;return _||Kr&&Kr.binding&&Kr.binding("util")}catch{}}(),Fs=Et&&Et.isArrayBuffer,Gs=Et&&Et.isDate,Bs=Et&&Et.isMap,ks=Et&&Et.isRegExp,$s=Et&&Et.isSet,Hs=Et&&Et.isTypedArray;function xt(_,m,y){switch(y.length){case 0:return _.call(m);case 1:return _.call(m,y[0]);case 2:return _.call(m,y[0],y[1]);case 3:return _.call(m,y[0],y[1],y[2])}return _.apply(m,y)}function Rl(_,m,y,b){for(var W=-1,Y=_==null?0:_.length;++W<Y;){var st=_[W];m(b,st,y(st),_)}return b}function Tt(_,m){for(var y=-1,b=_==null?0:_.length;++y<b&&m(_[y],y,_)!==!1;);return _}function Al(_,m){for(var y=_==null?0:_.length;y--&&m(_[y],y,_)!==!1;);return _}function zs(_,m){for(var y=-1,b=_==null?0:_.length;++y<b;)if(!m(_[y],y,_))return!1;return!0}function de(_,m){for(var y=-1,b=_==null?0:_.length,W=0,Y=[];++y<b;){var st=_[y];m(st,y,_)&&(Y[W++]=st)}return Y}function Wn(_,m){var y=_==null?0:_.length;return!!y&&We(_,m,0)>-1}function Zr(_,m,y){for(var b=-1,W=_==null?0:_.length;++b<W;)if(y(m,_[b]))return!0;return!1}function j(_,m){for(var y=-1,b=_==null?0:_.length,W=Array(b);++y<b;)W[y]=m(_[y],y,_);return W}function ge(_,m){for(var y=-1,b=m.length,W=_.length;++y<b;)_[W+y]=m[y];return _}function Jr(_,m,y,b){var W=-1,Y=_==null?0:_.length;for(b&&Y&&(y=_[++W]);++W<Y;)y=m(y,_[W],W,_);return y}function Ll(_,m,y,b){var W=_==null?0:_.length;for(b&&W&&(y=_[--W]);W--;)y=m(y,_[W],W,_);return y}function Xr(_,m){for(var y=-1,b=_==null?0:_.length;++y<b;)if(m(_[y],y,_))return!0;return!1}var bl=Qr("length");function El(_){return _.split("")}function Tl(_){return _.match(Fo)||[]}function qs(_,m,y){var b;return y(_,function(W,Y,st){if(m(W,Y,st))return b=Y,!1}),b}function Fn(_,m,y,b){for(var W=_.length,Y=y+(b?1:-1);b?Y--:++Y<W;)if(m(_[Y],Y,_))return Y;return-1}function We(_,m,y){return m===m?$l(_,m,y):Fn(_,Ys,y)}function Il(_,m,y,b){for(var W=y-1,Y=_.length;++W<Y;)if(b(_[W],m))return W;return-1}function Ys(_){return _!==_}function Ks(_,m){var y=_==null?0:_.length;return y?jr(_,m)/y:En}function Qr(_){return function(m){return m==null?r:m[_]}}function Vr(_){return function(m){return _==null?r:_[m]}}function Zs(_,m,y,b,W){return W(_,function(Y,st,J){y=b?(b=!1,Y):m(y,Y,st,J)}),y}function Ol(_,m){var y=_.length;for(_.sort(m);y--;)_[y]=_[y].value;return _}function jr(_,m){for(var y,b=-1,W=_.length;++b<W;){var Y=m(_[b]);Y!==r&&(y=y===r?Y:y+Y)}return y}function ti(_,m){for(var y=-1,b=Array(_);++y<_;)b[y]=m(y);return b}function Ml(_,m){return j(m,function(y){return[y,_[y]]})}function Js(_){return _&&_.slice(0,js(_)+1).replace(Br,"")}function Ct(_){return function(m){return _(m)}}function ei(_,m){return j(m,function(y){return _[y]})}function on(_,m){return _.has(m)}function Xs(_,m){for(var y=-1,b=_.length;++y<b&&We(m,_[y],0)>-1;);return y}function Qs(_,m){for(var y=_.length;y--&&We(m,_[y],0)>-1;);return y}function Pl(_,m){for(var y=_.length,b=0;y--;)_[y]===m&&++b;return b}var Ul=Vr(vl),Nl=Vr(yl);function Wl(_){return"\\"+Sl[_]}function Fl(_,m){return _==null?r:_[m]}function Fe(_){return gl.test(_)}function Gl(_){return pl.test(_)}function Bl(_){for(var m,y=[];!(m=_.next()).done;)y.push(m.value);return y}function ni(_){var m=-1,y=Array(_.size);return _.forEach(function(b,W){y[++m]=[W,b]}),y}function Vs(_,m){return function(y){return _(m(y))}}function pe(_,m){for(var y=-1,b=_.length,W=0,Y=[];++y<b;){var st=_[y];(st===m||st===T)&&(_[y]=T,Y[W++]=y)}return Y}function Gn(_){var m=-1,y=Array(_.size);return _.forEach(function(b){y[++m]=b}),y}function kl(_){var m=-1,y=Array(_.size);return _.forEach(function(b){y[++m]=[b,b]}),y}function $l(_,m,y){for(var b=y-1,W=_.length;++b<W;)if(_[b]===m)return b;return-1}function Hl(_,m,y){for(var b=y+1;b--;)if(_[b]===m)return b;return b}function Ge(_){return Fe(_)?ql(_):bl(_)}function kt(_){return Fe(_)?Yl(_):El(_)}function js(_){for(var m=_.length;m--&&Po.test(_.charAt(m)););return m}var zl=Vr(ml);function ql(_){for(var m=qr.lastIndex=0;qr.test(_);)++m;return m}function Yl(_){return _.match(qr)||[]}function Kl(_){return _.match(dl)||[]}var Zl=function _(m){m=m==null?lt:Be.defaults(lt.Object(),m,Be.pick(lt,_l));var y=m.Array,b=m.Date,W=m.Error,Y=m.Function,st=m.Math,J=m.Object,ri=m.RegExp,Jl=m.String,It=m.TypeError,Bn=y.prototype,Xl=Y.prototype,ke=J.prototype,kn=m["__core-js_shared__"],$n=Xl.toString,Z=ke.hasOwnProperty,Ql=0,ta=function(){var t=/[^.]+$/.exec(kn&&kn.keys&&kn.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Hn=ke.toString,Vl=$n.call(J),jl=lt._,tf=ri("^"+$n.call(Z).replace(Gr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),zn=Ws?m.Buffer:r,_e=m.Symbol,qn=m.Uint8Array,ea=zn?zn.allocUnsafe:r,Yn=Vs(J.getPrototypeOf,J),na=J.create,ra=ke.propertyIsEnumerable,Kn=Bn.splice,ia=_e?_e.isConcatSpreadable:r,ln=_e?_e.iterator:r,Re=_e?_e.toStringTag:r,Zn=function(){try{var t=Te(J,"defineProperty");return t({},"",{}),t}catch{}}(),ef=m.clearTimeout!==lt.clearTimeout&&m.clearTimeout,nf=b&&b.now!==lt.Date.now&&b.now,rf=m.setTimeout!==lt.setTimeout&&m.setTimeout,Jn=st.ceil,Xn=st.floor,ii=J.getOwnPropertySymbols,sf=zn?zn.isBuffer:r,sa=m.isFinite,af=Bn.join,uf=Vs(J.keys,J),at=st.max,ht=st.min,of=b.now,lf=m.parseInt,aa=st.random,ff=Bn.reverse,si=Te(m,"DataView"),fn=Te(m,"Map"),ai=Te(m,"Promise"),$e=Te(m,"Set"),cn=Te(m,"WeakMap"),hn=Te(J,"create"),Qn=cn&&new cn,He={},cf=Ie(si),hf=Ie(fn),df=Ie(ai),gf=Ie($e),pf=Ie(cn),Vn=_e?_e.prototype:r,dn=Vn?Vn.valueOf:r,ua=Vn?Vn.toString:r;function o(t){if(et(t)&&!F(t)&&!(t instanceof z)){if(t instanceof Ot)return t;if(Z.call(t,"__wrapped__"))return ou(t)}return new Ot(t)}var ze=function(){function t(){}return function(e){if(!tt(e))return{};if(na)return na(e);t.prototype=e;var n=new t;return t.prototype=r,n}}();function jn(){}function Ot(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=r}o.templateSettings={escape:bo,evaluate:Eo,interpolate:_s,variable:"",imports:{_:o}},o.prototype=jn.prototype,o.prototype.constructor=o,Ot.prototype=ze(jn.prototype),Ot.prototype.constructor=Ot;function z(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Jt,this.__views__=[]}function _f(){var t=new z(this.__wrapped__);return t.__actions__=vt(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=vt(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=vt(this.__views__),t}function wf(){if(this.__filtered__){var t=new z(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function vf(){var t=this.__wrapped__.value(),e=this.__dir__,n=F(t),s=e<0,a=n?t.length:0,l=Tc(0,a,this.__views__),h=l.start,p=l.end,w=p-h,S=s?p:h-1,x=this.__iteratees__,C=x.length,A=0,E=ht(w,this.__takeCount__);if(!n||!s&&a==w&&E==w)return Ia(t,this.__actions__);var O=[];t:for(;w--&&A<E;){S+=e;for(var k=-1,M=t[S];++k<C;){var H=x[k],q=H.iteratee,At=H.type,_t=q(M);if(At==fo)M=_t;else if(!_t){if(At==cs)continue t;break t}}O[A++]=M}return O}z.prototype=ze(jn.prototype),z.prototype.constructor=z;function Ae(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var s=t[e];this.set(s[0],s[1])}}function yf(){this.__data__=hn?hn(null):{},this.size=0}function mf(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function Sf(t){var e=this.__data__;if(hn){var n=e[t];return n===D?r:n}return Z.call(e,t)?e[t]:r}function xf(t){var e=this.__data__;return hn?e[t]!==r:Z.call(e,t)}function Cf(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=hn&&e===r?D:e,this}Ae.prototype.clear=yf,Ae.prototype.delete=mf,Ae.prototype.get=Sf,Ae.prototype.has=xf,Ae.prototype.set=Cf;function re(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var s=t[e];this.set(s[0],s[1])}}function Df(){this.__data__=[],this.size=0}function Rf(t){var e=this.__data__,n=tr(e,t);if(n<0)return!1;var s=e.length-1;return n==s?e.pop():Kn.call(e,n,1),--this.size,!0}function Af(t){var e=this.__data__,n=tr(e,t);return n<0?r:e[n][1]}function Lf(t){return tr(this.__data__,t)>-1}function bf(t,e){var n=this.__data__,s=tr(n,t);return s<0?(++this.size,n.push([t,e])):n[s][1]=e,this}re.prototype.clear=Df,re.prototype.delete=Rf,re.prototype.get=Af,re.prototype.has=Lf,re.prototype.set=bf;function ie(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var s=t[e];this.set(s[0],s[1])}}function Ef(){this.size=0,this.__data__={hash:new Ae,map:new(fn||re),string:new Ae}}function Tf(t){var e=hr(this,t).delete(t);return this.size-=e?1:0,e}function If(t){return hr(this,t).get(t)}function Of(t){return hr(this,t).has(t)}function Mf(t,e){var n=hr(this,t),s=n.size;return n.set(t,e),this.size+=n.size==s?0:1,this}ie.prototype.clear=Ef,ie.prototype.delete=Tf,ie.prototype.get=If,ie.prototype.has=Of,ie.prototype.set=Mf;function Le(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new ie;++e<n;)this.add(t[e])}function Pf(t){return this.__data__.set(t,D),this}function Uf(t){return this.__data__.has(t)}Le.prototype.add=Le.prototype.push=Pf,Le.prototype.has=Uf;function $t(t){var e=this.__data__=new re(t);this.size=e.size}function Nf(){this.__data__=new re,this.size=0}function Wf(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function Ff(t){return this.__data__.get(t)}function Gf(t){return this.__data__.has(t)}function Bf(t,e){var n=this.__data__;if(n instanceof re){var s=n.__data__;if(!fn||s.length<f-1)return s.push([t,e]),this.size=++n.size,this;n=this.__data__=new ie(s)}return n.set(t,e),this.size=n.size,this}$t.prototype.clear=Nf,$t.prototype.delete=Wf,$t.prototype.get=Ff,$t.prototype.has=Gf,$t.prototype.set=Bf;function oa(t,e){var n=F(t),s=!n&&Oe(t),a=!n&&!s&&Se(t),l=!n&&!s&&!a&&Ze(t),h=n||s||a||l,p=h?ti(t.length,Jl):[],w=p.length;for(var S in t)(e||Z.call(t,S))&&!(h&&(S=="length"||a&&(S=="offset"||S=="parent")||l&&(S=="buffer"||S=="byteLength"||S=="byteOffset")||oe(S,w)))&&p.push(S);return p}function la(t){var e=t.length;return e?t[wi(0,e-1)]:r}function kf(t,e){return dr(vt(t),be(e,0,t.length))}function $f(t){return dr(vt(t))}function ui(t,e,n){(n!==r&&!Ht(t[e],n)||n===r&&!(e in t))&&se(t,e,n)}function gn(t,e,n){var s=t[e];(!(Z.call(t,e)&&Ht(s,n))||n===r&&!(e in t))&&se(t,e,n)}function tr(t,e){for(var n=t.length;n--;)if(Ht(t[n][0],e))return n;return-1}function Hf(t,e,n,s){return we(t,function(a,l,h){e(s,a,n(a),h)}),s}function fa(t,e){return t&&Qt(e,ot(e),t)}function zf(t,e){return t&&Qt(e,mt(e),t)}function se(t,e,n){e=="__proto__"&&Zn?Zn(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function oi(t,e){for(var n=-1,s=e.length,a=y(s),l=t==null;++n<s;)a[n]=l?r:$i(t,e[n]);return a}function be(t,e,n){return t===t&&(n!==r&&(t=t<=n?t:n),e!==r&&(t=t>=e?t:e)),t}function Mt(t,e,n,s,a,l){var h,p=e&N,w=e&ut,S=e&V;if(n&&(h=a?n(t,s,a,l):n(t)),h!==r)return h;if(!tt(t))return t;var x=F(t);if(x){if(h=Oc(t),!p)return vt(t,h)}else{var C=dt(t),A=C==On||C==hs;if(Se(t))return Pa(t,p);if(C==ne||C==Pe||A&&!a){if(h=w||A?{}:ja(t),!p)return w?Sc(t,zf(h,t)):mc(t,fa(h,t))}else{if(!X[C])return a?t:{};h=Mc(t,C,p)}}l||(l=new $t);var E=l.get(t);if(E)return E;l.set(t,h),bu(t)?t.forEach(function(M){h.add(Mt(M,e,n,M,t,l))}):Au(t)&&t.forEach(function(M,H){h.set(H,Mt(M,e,n,H,t,l))});var O=S?w?bi:Li:w?mt:ot,k=x?r:O(t);return Tt(k||t,function(M,H){k&&(H=M,M=t[H]),gn(h,H,Mt(M,e,n,H,t,l))}),h}function qf(t){var e=ot(t);return function(n){return ca(n,t,e)}}function ca(t,e,n){var s=n.length;if(t==null)return!s;for(t=J(t);s--;){var a=n[s],l=e[a],h=t[a];if(h===r&&!(a in t)||!l(h))return!1}return!0}function ha(t,e,n){if(typeof t!="function")throw new It(g);return Sn(function(){t.apply(r,n)},e)}function pn(t,e,n,s){var a=-1,l=Wn,h=!0,p=t.length,w=[],S=e.length;if(!p)return w;n&&(e=j(e,Ct(n))),s?(l=Zr,h=!1):e.length>=f&&(l=on,h=!1,e=new Le(e));t:for(;++a<p;){var x=t[a],C=n==null?x:n(x);if(x=s||x!==0?x:0,h&&C===C){for(var A=S;A--;)if(e[A]===C)continue t;w.push(x)}else l(e,C,s)||w.push(x)}return w}var we=Ga(Xt),da=Ga(fi,!0);function Yf(t,e){var n=!0;return we(t,function(s,a,l){return n=!!e(s,a,l),n}),n}function er(t,e,n){for(var s=-1,a=t.length;++s<a;){var l=t[s],h=e(l);if(h!=null&&(p===r?h===h&&!Rt(h):n(h,p)))var p=h,w=l}return w}function Kf(t,e,n,s){var a=t.length;for(n=B(n),n<0&&(n=-n>a?0:a+n),s=s===r||s>a?a:B(s),s<0&&(s+=a),s=n>s?0:Tu(s);n<s;)t[n++]=e;return t}function ga(t,e){var n=[];return we(t,function(s,a,l){e(s,a,l)&&n.push(s)}),n}function ft(t,e,n,s,a){var l=-1,h=t.length;for(n||(n=Uc),a||(a=[]);++l<h;){var p=t[l];e>0&&n(p)?e>1?ft(p,e-1,n,s,a):ge(a,p):s||(a[a.length]=p)}return a}var li=Ba(),pa=Ba(!0);function Xt(t,e){return t&&li(t,e,ot)}function fi(t,e){return t&&pa(t,e,ot)}function nr(t,e){return de(e,function(n){return le(t[n])})}function Ee(t,e){e=ye(e,t);for(var n=0,s=e.length;t!=null&&n<s;)t=t[Vt(e[n++])];return n&&n==s?t:r}function _a(t,e,n){var s=e(t);return F(t)?s:ge(s,n(t))}function gt(t){return t==null?t===r?So:yo:Re&&Re in J(t)?Ec(t):$c(t)}function ci(t,e){return t>e}function Zf(t,e){return t!=null&&Z.call(t,e)}function Jf(t,e){return t!=null&&e in J(t)}function Xf(t,e,n){return t>=ht(e,n)&&t<at(e,n)}function hi(t,e,n){for(var s=n?Zr:Wn,a=t[0].length,l=t.length,h=l,p=y(l),w=1/0,S=[];h--;){var x=t[h];h&&e&&(x=j(x,Ct(e))),w=ht(x.length,w),p[h]=!n&&(e||a>=120&&x.length>=120)?new Le(h&&x):r}x=t[0];var C=-1,A=p[0];t:for(;++C<a&&S.length<w;){var E=x[C],O=e?e(E):E;if(E=n||E!==0?E:0,!(A?on(A,O):s(S,O,n))){for(h=l;--h;){var k=p[h];if(!(k?on(k,O):s(t[h],O,n)))continue t}A&&A.push(O),S.push(E)}}return S}function Qf(t,e,n,s){return Xt(t,function(a,l,h){e(s,n(a),l,h)}),s}function _n(t,e,n){e=ye(e,t),t=ru(t,e);var s=t==null?t:t[Vt(Ut(e))];return s==null?r:xt(s,t,n)}function wa(t){return et(t)&&gt(t)==Pe}function Vf(t){return et(t)&&gt(t)==un}function jf(t){return et(t)&&gt(t)==en}function wn(t,e,n,s,a){return t===e?!0:t==null||e==null||!et(t)&&!et(e)?t!==t&&e!==e:tc(t,e,n,s,wn,a)}function tc(t,e,n,s,a,l){var h=F(t),p=F(e),w=h?Tn:dt(t),S=p?Tn:dt(e);w=w==Pe?ne:w,S=S==Pe?ne:S;var x=w==ne,C=S==ne,A=w==S;if(A&&Se(t)){if(!Se(e))return!1;h=!0,x=!1}if(A&&!x)return l||(l=new $t),h||Ze(t)?Xa(t,e,n,s,a,l):Lc(t,e,w,n,s,a,l);if(!(n&nt)){var E=x&&Z.call(t,"__wrapped__"),O=C&&Z.call(e,"__wrapped__");if(E||O){var k=E?t.value():t,M=O?e.value():e;return l||(l=new $t),a(k,M,n,s,l)}}return A?(l||(l=new $t),bc(t,e,n,s,a,l)):!1}function ec(t){return et(t)&&dt(t)==Gt}function di(t,e,n,s){var a=n.length,l=a,h=!s;if(t==null)return!l;for(t=J(t);a--;){var p=n[a];if(h&&p[2]?p[1]!==t[p[0]]:!(p[0]in t))return!1}for(;++a<l;){p=n[a];var w=p[0],S=t[w],x=p[1];if(h&&p[2]){if(S===r&&!(w in t))return!1}else{var C=new $t;if(s)var A=s(S,x,w,t,e,C);if(!(A===r?wn(x,S,nt|Zt,s,C):A))return!1}}return!0}function va(t){if(!tt(t)||Wc(t))return!1;var e=le(t)?tf:zo;return e.test(Ie(t))}function nc(t){return et(t)&&gt(t)==rn}function rc(t){return et(t)&&dt(t)==Bt}function ic(t){return et(t)&&yr(t.length)&&!!Q[gt(t)]}function ya(t){return typeof t=="function"?t:t==null?St:typeof t=="object"?F(t)?xa(t[0],t[1]):Sa(t):ku(t)}function gi(t){if(!mn(t))return uf(t);var e=[];for(var n in J(t))Z.call(t,n)&&n!="constructor"&&e.push(n);return e}function sc(t){if(!tt(t))return kc(t);var e=mn(t),n=[];for(var s in t)s=="constructor"&&(e||!Z.call(t,s))||n.push(s);return n}function pi(t,e){return t<e}function ma(t,e){var n=-1,s=yt(t)?y(t.length):[];return we(t,function(a,l,h){s[++n]=e(a,l,h)}),s}function Sa(t){var e=Ti(t);return e.length==1&&e[0][2]?eu(e[0][0],e[0][1]):function(n){return n===t||di(n,t,e)}}function xa(t,e){return Oi(t)&&tu(e)?eu(Vt(t),e):function(n){var s=$i(n,t);return s===r&&s===e?Hi(n,t):wn(e,s,nt|Zt)}}function rr(t,e,n,s,a){t!==e&&li(e,function(l,h){if(a||(a=new $t),tt(l))ac(t,e,h,n,rr,s,a);else{var p=s?s(Pi(t,h),l,h+"",t,e,a):r;p===r&&(p=l),ui(t,h,p)}},mt)}function ac(t,e,n,s,a,l,h){var p=Pi(t,n),w=Pi(e,n),S=h.get(w);if(S){ui(t,n,S);return}var x=l?l(p,w,n+"",t,e,h):r,C=x===r;if(C){var A=F(w),E=!A&&Se(w),O=!A&&!E&&Ze(w);x=w,A||E||O?F(p)?x=p:rt(p)?x=vt(p):E?(C=!1,x=Pa(w,!0)):O?(C=!1,x=Ua(w,!0)):x=[]:xn(w)||Oe(w)?(x=p,Oe(p)?x=Iu(p):(!tt(p)||le(p))&&(x=ja(w))):C=!1}C&&(h.set(w,x),a(x,w,s,l,h),h.delete(w)),ui(t,n,x)}function Ca(t,e){var n=t.length;if(n)return e+=e<0?n:0,oe(e,n)?t[e]:r}function Da(t,e,n){e.length?e=j(e,function(l){return F(l)?function(h){return Ee(h,l.length===1?l[0]:l)}:l}):e=[St];var s=-1;e=j(e,Ct(I()));var a=ma(t,function(l,h,p){var w=j(e,function(S){return S(l)});return{criteria:w,index:++s,value:l}});return Ol(a,function(l,h){return yc(l,h,n)})}function uc(t,e){return Ra(t,e,function(n,s){return Hi(t,s)})}function Ra(t,e,n){for(var s=-1,a=e.length,l={};++s<a;){var h=e[s],p=Ee(t,h);n(p,h)&&vn(l,ye(h,t),p)}return l}function oc(t){return function(e){return Ee(e,t)}}function _i(t,e,n,s){var a=s?Il:We,l=-1,h=e.length,p=t;for(t===e&&(e=vt(e)),n&&(p=j(t,Ct(n)));++l<h;)for(var w=0,S=e[l],x=n?n(S):S;(w=a(p,x,w,s))>-1;)p!==t&&Kn.call(p,w,1),Kn.call(t,w,1);return t}function Aa(t,e){for(var n=t?e.length:0,s=n-1;n--;){var a=e[n];if(n==s||a!==l){var l=a;oe(a)?Kn.call(t,a,1):mi(t,a)}}return t}function wi(t,e){return t+Xn(aa()*(e-t+1))}function lc(t,e,n,s){for(var a=-1,l=at(Jn((e-t)/(n||1)),0),h=y(l);l--;)h[s?l:++a]=t,t+=n;return h}function vi(t,e){var n="";if(!t||e<1||e>he)return n;do e%2&&(n+=t),e=Xn(e/2),e&&(t+=t);while(e);return n}function $(t,e){return Ui(nu(t,e,St),t+"")}function fc(t){return la(Je(t))}function cc(t,e){var n=Je(t);return dr(n,be(e,0,n.length))}function vn(t,e,n,s){if(!tt(t))return t;e=ye(e,t);for(var a=-1,l=e.length,h=l-1,p=t;p!=null&&++a<l;){var w=Vt(e[a]),S=n;if(w==="__proto__"||w==="constructor"||w==="prototype")return t;if(a!=h){var x=p[w];S=s?s(x,w,p):r,S===r&&(S=tt(x)?x:oe(e[a+1])?[]:{})}gn(p,w,S),p=p[w]}return t}var La=Qn?function(t,e){return Qn.set(t,e),t}:St,hc=Zn?function(t,e){return Zn(t,"toString",{configurable:!0,enumerable:!1,value:qi(e),writable:!0})}:St;function dc(t){return dr(Je(t))}function Pt(t,e,n){var s=-1,a=t.length;e<0&&(e=-e>a?0:a+e),n=n>a?a:n,n<0&&(n+=a),a=e>n?0:n-e>>>0,e>>>=0;for(var l=y(a);++s<a;)l[s]=t[s+e];return l}function gc(t,e){var n;return we(t,function(s,a,l){return n=e(s,a,l),!n}),!!n}function ir(t,e,n){var s=0,a=t==null?s:t.length;if(typeof e=="number"&&e===e&&a<=po){for(;s<a;){var l=s+a>>>1,h=t[l];h!==null&&!Rt(h)&&(n?h<=e:h<e)?s=l+1:a=l}return a}return yi(t,e,St,n)}function yi(t,e,n,s){var a=0,l=t==null?0:t.length;if(l===0)return 0;e=n(e);for(var h=e!==e,p=e===null,w=Rt(e),S=e===r;a<l;){var x=Xn((a+l)/2),C=n(t[x]),A=C!==r,E=C===null,O=C===C,k=Rt(C);if(h)var M=s||O;else S?M=O&&(s||A):p?M=O&&A&&(s||!E):w?M=O&&A&&!E&&(s||!k):E||k?M=!1:M=s?C<=e:C<e;M?a=x+1:l=x}return ht(l,go)}function ba(t,e){for(var n=-1,s=t.length,a=0,l=[];++n<s;){var h=t[n],p=e?e(h):h;if(!n||!Ht(p,w)){var w=p;l[a++]=h===0?0:h}}return l}function Ea(t){return typeof t=="number"?t:Rt(t)?En:+t}function Dt(t){if(typeof t=="string")return t;if(F(t))return j(t,Dt)+"";if(Rt(t))return ua?ua.call(t):"";var e=t+"";return e=="0"&&1/t==-Ce?"-0":e}function ve(t,e,n){var s=-1,a=Wn,l=t.length,h=!0,p=[],w=p;if(n)h=!1,a=Zr;else if(l>=f){var S=e?null:Rc(t);if(S)return Gn(S);h=!1,a=on,w=new Le}else w=e?[]:p;t:for(;++s<l;){var x=t[s],C=e?e(x):x;if(x=n||x!==0?x:0,h&&C===C){for(var A=w.length;A--;)if(w[A]===C)continue t;e&&w.push(C),p.push(x)}else a(w,C,n)||(w!==p&&w.push(C),p.push(x))}return p}function mi(t,e){return e=ye(e,t),t=ru(t,e),t==null||delete t[Vt(Ut(e))]}function Ta(t,e,n,s){return vn(t,e,n(Ee(t,e)),s)}function sr(t,e,n,s){for(var a=t.length,l=s?a:-1;(s?l--:++l<a)&&e(t[l],l,t););return n?Pt(t,s?0:l,s?l+1:a):Pt(t,s?l+1:0,s?a:l)}function Ia(t,e){var n=t;return n instanceof z&&(n=n.value()),Jr(e,function(s,a){return a.func.apply(a.thisArg,ge([s],a.args))},n)}function Si(t,e,n){var s=t.length;if(s<2)return s?ve(t[0]):[];for(var a=-1,l=y(s);++a<s;)for(var h=t[a],p=-1;++p<s;)p!=a&&(l[a]=pn(l[a]||h,t[p],e,n));return ve(ft(l,1),e,n)}function Oa(t,e,n){for(var s=-1,a=t.length,l=e.length,h={};++s<a;){var p=s<l?e[s]:r;n(h,t[s],p)}return h}function xi(t){return rt(t)?t:[]}function Ci(t){return typeof t=="function"?t:St}function ye(t,e){return F(t)?t:Oi(t,e)?[t]:uu(K(t))}var pc=$;function me(t,e,n){var s=t.length;return n=n===r?s:n,!e&&n>=s?t:Pt(t,e,n)}var Ma=ef||function(t){return lt.clearTimeout(t)};function Pa(t,e){if(e)return t.slice();var n=t.length,s=ea?ea(n):new t.constructor(n);return t.copy(s),s}function Di(t){var e=new t.constructor(t.byteLength);return new qn(e).set(new qn(t)),e}function _c(t,e){var n=e?Di(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}function wc(t){var e=new t.constructor(t.source,ws.exec(t));return e.lastIndex=t.lastIndex,e}function vc(t){return dn?J(dn.call(t)):{}}function Ua(t,e){var n=e?Di(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Na(t,e){if(t!==e){var n=t!==r,s=t===null,a=t===t,l=Rt(t),h=e!==r,p=e===null,w=e===e,S=Rt(e);if(!p&&!S&&!l&&t>e||l&&h&&w&&!p&&!S||s&&h&&w||!n&&w||!a)return 1;if(!s&&!l&&!S&&t<e||S&&n&&a&&!s&&!l||p&&n&&a||!h&&a||!w)return-1}return 0}function yc(t,e,n){for(var s=-1,a=t.criteria,l=e.criteria,h=a.length,p=n.length;++s<h;){var w=Na(a[s],l[s]);if(w){if(s>=p)return w;var S=n[s];return w*(S=="desc"?-1:1)}}return t.index-e.index}function Wa(t,e,n,s){for(var a=-1,l=t.length,h=n.length,p=-1,w=e.length,S=at(l-h,0),x=y(w+S),C=!s;++p<w;)x[p]=e[p];for(;++a<h;)(C||a<l)&&(x[n[a]]=t[a]);for(;S--;)x[p++]=t[a++];return x}function Fa(t,e,n,s){for(var a=-1,l=t.length,h=-1,p=n.length,w=-1,S=e.length,x=at(l-p,0),C=y(x+S),A=!s;++a<x;)C[a]=t[a];for(var E=a;++w<S;)C[E+w]=e[w];for(;++h<p;)(A||a<l)&&(C[E+n[h]]=t[a++]);return C}function vt(t,e){var n=-1,s=t.length;for(e||(e=y(s));++n<s;)e[n]=t[n];return e}function Qt(t,e,n,s){var a=!n;n||(n={});for(var l=-1,h=e.length;++l<h;){var p=e[l],w=s?s(n[p],t[p],p,n,t):r;w===r&&(w=t[p]),a?se(n,p,w):gn(n,p,w)}return n}function mc(t,e){return Qt(t,Ii(t),e)}function Sc(t,e){return Qt(t,Qa(t),e)}function ar(t,e){return function(n,s){var a=F(n)?Rl:Hf,l=e?e():{};return a(n,t,I(s,2),l)}}function qe(t){return $(function(e,n){var s=-1,a=n.length,l=a>1?n[a-1]:r,h=a>2?n[2]:r;for(l=t.length>3&&typeof l=="function"?(a--,l):r,h&&pt(n[0],n[1],h)&&(l=a<3?r:l,a=1),e=J(e);++s<a;){var p=n[s];p&&t(e,p,s,l)}return e})}function Ga(t,e){return function(n,s){if(n==null)return n;if(!yt(n))return t(n,s);for(var a=n.length,l=e?a:-1,h=J(n);(e?l--:++l<a)&&s(h[l],l,h)!==!1;);return n}}function Ba(t){return function(e,n,s){for(var a=-1,l=J(e),h=s(e),p=h.length;p--;){var w=h[t?p:++a];if(n(l[w],w,l)===!1)break}return e}}function xc(t,e,n){var s=e&Ft,a=yn(t);function l(){var h=this&&this!==lt&&this instanceof l?a:t;return h.apply(s?n:this,arguments)}return l}function ka(t){return function(e){e=K(e);var n=Fe(e)?kt(e):r,s=n?n[0]:e.charAt(0),a=n?me(n,1).join(""):e.slice(1);return s[t]()+a}}function Ye(t){return function(e){return Jr(Gu(Fu(e).replace(cl,"")),t,"")}}function yn(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=ze(t.prototype),s=t.apply(n,e);return tt(s)?s:n}}function Cc(t,e,n){var s=yn(t);function a(){for(var l=arguments.length,h=y(l),p=l,w=Ke(a);p--;)h[p]=arguments[p];var S=l<3&&h[0]!==w&&h[l-1]!==w?[]:pe(h,w);if(l-=S.length,l<n)return Ya(t,e,ur,a.placeholder,r,h,S,r,r,n-l);var x=this&&this!==lt&&this instanceof a?s:t;return xt(x,this,h)}return a}function $a(t){return function(e,n,s){var a=J(e);if(!yt(e)){var l=I(n,3);e=ot(e),n=function(p){return l(a[p],p,a)}}var h=t(e,n,s);return h>-1?a[l?e[h]:h]:r}}function Ha(t){return ue(function(e){var n=e.length,s=n,a=Ot.prototype.thru;for(t&&e.reverse();s--;){var l=e[s];if(typeof l!="function")throw new It(g);if(a&&!h&&cr(l)=="wrapper")var h=new Ot([],!0)}for(s=h?s:n;++s<n;){l=e[s];var p=cr(l),w=p=="wrapper"?Ei(l):r;w&&Mi(w[0])&&w[1]==(ee|jt|te|je)&&!w[4].length&&w[9]==1?h=h[cr(w[0])].apply(h,w[3]):h=l.length==1&&Mi(l)?h[p]():h.thru(l)}return function(){var S=arguments,x=S[0];if(h&&S.length==1&&F(x))return h.plant(x).value();for(var C=0,A=n?e[C].apply(this,S):x;++C<n;)A=e[C].call(this,A);return A}})}function ur(t,e,n,s,a,l,h,p,w,S){var x=e&ee,C=e&Ft,A=e&Me,E=e&(jt|Qe),O=e&Er,k=A?r:yn(t);function M(){for(var H=arguments.length,q=y(H),At=H;At--;)q[At]=arguments[At];if(E)var _t=Ke(M),Lt=Pl(q,_t);if(s&&(q=Wa(q,s,a,E)),l&&(q=Fa(q,l,h,E)),H-=Lt,E&&H<S){var it=pe(q,_t);return Ya(t,e,ur,M.placeholder,n,q,it,p,w,S-H)}var zt=C?n:this,ce=A?zt[t]:t;return H=q.length,p?q=Hc(q,p):O&&H>1&&q.reverse(),x&&w<H&&(q.length=w),this&&this!==lt&&this instanceof M&&(ce=k||yn(ce)),ce.apply(zt,q)}return M}function za(t,e){return function(n,s){return Qf(n,t,e(s),{})}}function or(t,e){return function(n,s){var a;if(n===r&&s===r)return e;if(n!==r&&(a=n),s!==r){if(a===r)return s;typeof n=="string"||typeof s=="string"?(n=Dt(n),s=Dt(s)):(n=Ea(n),s=Ea(s)),a=t(n,s)}return a}}function Ri(t){return ue(function(e){return e=j(e,Ct(I())),$(function(n){var s=this;return t(e,function(a){return xt(a,s,n)})})})}function lr(t,e){e=e===r?" ":Dt(e);var n=e.length;if(n<2)return n?vi(e,t):e;var s=vi(e,Jn(t/Ge(e)));return Fe(e)?me(kt(s),0,t).join(""):s.slice(0,t)}function Dc(t,e,n,s){var a=e&Ft,l=yn(t);function h(){for(var p=-1,w=arguments.length,S=-1,x=s.length,C=y(x+w),A=this&&this!==lt&&this instanceof h?l:t;++S<x;)C[S]=s[S];for(;w--;)C[S++]=arguments[++p];return xt(A,a?n:this,C)}return h}function qa(t){return function(e,n,s){return s&&typeof s!="number"&&pt(e,n,s)&&(n=s=r),e=fe(e),n===r?(n=e,e=0):n=fe(n),s=s===r?e<n?1:-1:fe(s),lc(e,n,s,t)}}function fr(t){return function(e,n){return typeof e=="string"&&typeof n=="string"||(e=Nt(e),n=Nt(n)),t(e,n)}}function Ya(t,e,n,s,a,l,h,p,w,S){var x=e&jt,C=x?h:r,A=x?r:h,E=x?l:r,O=x?r:l;e|=x?te:Ve,e&=~(x?Ve:te),e&fs||(e&=-4);var k=[t,e,a,E,C,O,A,p,w,S],M=n.apply(r,k);return Mi(t)&&iu(M,k),M.placeholder=s,su(M,t,e)}function Ai(t){var e=st[t];return function(n,s){if(n=Nt(n),s=s==null?0:ht(B(s),292),s&&sa(n)){var a=(K(n)+"e").split("e"),l=e(a[0]+"e"+(+a[1]+s));return a=(K(l)+"e").split("e"),+(a[0]+"e"+(+a[1]-s))}return e(n)}}var Rc=$e&&1/Gn(new $e([,-0]))[1]==Ce?function(t){return new $e(t)}:Zi;function Ka(t){return function(e){var n=dt(e);return n==Gt?ni(e):n==Bt?kl(e):Ml(e,t(e))}}function ae(t,e,n,s,a,l,h,p){var w=e&Me;if(!w&&typeof t!="function")throw new It(g);var S=s?s.length:0;if(S||(e&=-97,s=a=r),h=h===r?h:at(B(h),0),p=p===r?p:B(p),S-=a?a.length:0,e&Ve){var x=s,C=a;s=a=r}var A=w?r:Ei(t),E=[t,e,n,s,a,x,C,l,h,p];if(A&&Bc(E,A),t=E[0],e=E[1],n=E[2],s=E[3],a=E[4],p=E[9]=E[9]===r?w?0:t.length:at(E[9]-S,0),!p&&e&(jt|Qe)&&(e&=-25),!e||e==Ft)var O=xc(t,e,n);else e==jt||e==Qe?O=Cc(t,e,p):(e==te||e==(Ft|te))&&!a.length?O=Dc(t,e,n,s):O=ur.apply(r,E);var k=A?La:iu;return su(k(O,E),t,e)}function Za(t,e,n,s){return t===r||Ht(t,ke[n])&&!Z.call(s,n)?e:t}function Ja(t,e,n,s,a,l){return tt(t)&&tt(e)&&(l.set(e,t),rr(t,e,r,Ja,l),l.delete(e)),t}function Ac(t){return xn(t)?r:t}function Xa(t,e,n,s,a,l){var h=n&nt,p=t.length,w=e.length;if(p!=w&&!(h&&w>p))return!1;var S=l.get(t),x=l.get(e);if(S&&x)return S==e&&x==t;var C=-1,A=!0,E=n&Zt?new Le:r;for(l.set(t,e),l.set(e,t);++C<p;){var O=t[C],k=e[C];if(s)var M=h?s(k,O,C,e,t,l):s(O,k,C,t,e,l);if(M!==r){if(M)continue;A=!1;break}if(E){if(!Xr(e,function(H,q){if(!on(E,q)&&(O===H||a(O,H,n,s,l)))return E.push(q)})){A=!1;break}}else if(!(O===k||a(O,k,n,s,l))){A=!1;break}}return l.delete(t),l.delete(e),A}function Lc(t,e,n,s,a,l,h){switch(n){case Ue:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case un:return!(t.byteLength!=e.byteLength||!l(new qn(t),new qn(e)));case tn:case en:case nn:return Ht(+t,+e);case In:return t.name==e.name&&t.message==e.message;case rn:case sn:return t==e+"";case Gt:var p=ni;case Bt:var w=s&nt;if(p||(p=Gn),t.size!=e.size&&!w)return!1;var S=h.get(t);if(S)return S==e;s|=Zt,h.set(t,e);var x=Xa(p(t),p(e),s,a,l,h);return h.delete(t),x;case Mn:if(dn)return dn.call(t)==dn.call(e)}return!1}function bc(t,e,n,s,a,l){var h=n&nt,p=Li(t),w=p.length,S=Li(e),x=S.length;if(w!=x&&!h)return!1;for(var C=w;C--;){var A=p[C];if(!(h?A in e:Z.call(e,A)))return!1}var E=l.get(t),O=l.get(e);if(E&&O)return E==e&&O==t;var k=!0;l.set(t,e),l.set(e,t);for(var M=h;++C<w;){A=p[C];var H=t[A],q=e[A];if(s)var At=h?s(q,H,A,e,t,l):s(H,q,A,t,e,l);if(!(At===r?H===q||a(H,q,n,s,l):At)){k=!1;break}M||(M=A=="constructor")}if(k&&!M){var _t=t.constructor,Lt=e.constructor;_t!=Lt&&"constructor"in t&&"constructor"in e&&!(typeof _t=="function"&&_t instanceof _t&&typeof Lt=="function"&&Lt instanceof Lt)&&(k=!1)}return l.delete(t),l.delete(e),k}function ue(t){return Ui(nu(t,r,cu),t+"")}function Li(t){return _a(t,ot,Ii)}function bi(t){return _a(t,mt,Qa)}var Ei=Qn?function(t){return Qn.get(t)}:Zi;function cr(t){for(var e=t.name+"",n=He[e],s=Z.call(He,e)?n.length:0;s--;){var a=n[s],l=a.func;if(l==null||l==t)return a.name}return e}function Ke(t){var e=Z.call(o,"placeholder")?o:t;return e.placeholder}function I(){var t=o.iteratee||Yi;return t=t===Yi?ya:t,arguments.length?t(arguments[0],arguments[1]):t}function hr(t,e){var n=t.__data__;return Nc(e)?n[typeof e=="string"?"string":"hash"]:n.map}function Ti(t){for(var e=ot(t),n=e.length;n--;){var s=e[n],a=t[s];e[n]=[s,a,tu(a)]}return e}function Te(t,e){var n=Fl(t,e);return va(n)?n:r}function Ec(t){var e=Z.call(t,Re),n=t[Re];try{t[Re]=r;var s=!0}catch{}var a=Hn.call(t);return s&&(e?t[Re]=n:delete t[Re]),a}var Ii=ii?function(t){return t==null?[]:(t=J(t),de(ii(t),function(e){return ra.call(t,e)}))}:Ji,Qa=ii?function(t){for(var e=[];t;)ge(e,Ii(t)),t=Yn(t);return e}:Ji,dt=gt;(si&&dt(new si(new ArrayBuffer(1)))!=Ue||fn&&dt(new fn)!=Gt||ai&&dt(ai.resolve())!=ds||$e&&dt(new $e)!=Bt||cn&&dt(new cn)!=an)&&(dt=function(t){var e=gt(t),n=e==ne?t.constructor:r,s=n?Ie(n):"";if(s)switch(s){case cf:return Ue;case hf:return Gt;case df:return ds;case gf:return Bt;case pf:return an}return e});function Tc(t,e,n){for(var s=-1,a=n.length;++s<a;){var l=n[s],h=l.size;switch(l.type){case"drop":t+=h;break;case"dropRight":e-=h;break;case"take":e=ht(e,t+h);break;case"takeRight":t=at(t,e-h);break}}return{start:t,end:e}}function Ic(t){var e=t.match(No);return e?e[1].split(Wo):[]}function Va(t,e,n){e=ye(e,t);for(var s=-1,a=e.length,l=!1;++s<a;){var h=Vt(e[s]);if(!(l=t!=null&&n(t,h)))break;t=t[h]}return l||++s!=a?l:(a=t==null?0:t.length,!!a&&yr(a)&&oe(h,a)&&(F(t)||Oe(t)))}function Oc(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&Z.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function ja(t){return typeof t.constructor=="function"&&!mn(t)?ze(Yn(t)):{}}function Mc(t,e,n){var s=t.constructor;switch(e){case un:return Di(t);case tn:case en:return new s(+t);case Ue:return _c(t,n);case Tr:case Ir:case Or:case Mr:case Pr:case Ur:case Nr:case Wr:case Fr:return Ua(t,n);case Gt:return new s;case nn:case sn:return new s(t);case rn:return wc(t);case Bt:return new s;case Mn:return vc(t)}}function Pc(t,e){var n=e.length;if(!n)return t;var s=n-1;return e[s]=(n>1?"& ":"")+e[s],e=e.join(n>2?", ":" "),t.replace(Uo,`{
/* [wrapped with `+e+`] */
`)}function Uc(t){return F(t)||Oe(t)||!!(ia&&t&&t[ia])}function oe(t,e){var n=typeof t;return e=e??he,!!e&&(n=="number"||n!="symbol"&&Yo.test(t))&&t>-1&&t%1==0&&t<e}function pt(t,e,n){if(!tt(n))return!1;var s=typeof e;return(s=="number"?yt(n)&&oe(e,n.length):s=="string"&&e in n)?Ht(n[e],t):!1}function Oi(t,e){if(F(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||Rt(t)?!0:Io.test(t)||!To.test(t)||e!=null&&t in J(e)}function Nc(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function Mi(t){var e=cr(t),n=o[e];if(typeof n!="function"||!(e in z.prototype))return!1;if(t===n)return!0;var s=Ei(n);return!!s&&t===s[0]}function Wc(t){return!!ta&&ta in t}var Fc=kn?le:Xi;function mn(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||ke;return t===n}function tu(t){return t===t&&!tt(t)}function eu(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==r||t in J(n))}}function Gc(t){var e=wr(t,function(s){return n.size===L&&n.clear(),s}),n=e.cache;return e}function Bc(t,e){var n=t[1],s=e[1],a=n|s,l=a<(Ft|Me|ee),h=s==ee&&n==jt||s==ee&&n==je&&t[7].length<=e[8]||s==(ee|je)&&e[7].length<=e[8]&&n==jt;if(!(l||h))return t;s&Ft&&(t[2]=e[2],a|=n&Ft?0:fs);var p=e[3];if(p){var w=t[3];t[3]=w?Wa(w,p,e[4]):p,t[4]=w?pe(t[3],T):e[4]}return p=e[5],p&&(w=t[5],t[5]=w?Fa(w,p,e[6]):p,t[6]=w?pe(t[5],T):e[6]),p=e[7],p&&(t[7]=p),s&ee&&(t[8]=t[8]==null?e[8]:ht(t[8],e[8])),t[9]==null&&(t[9]=e[9]),t[0]=e[0],t[1]=a,t}function kc(t){var e=[];if(t!=null)for(var n in J(t))e.push(n);return e}function $c(t){return Hn.call(t)}function nu(t,e,n){return e=at(e===r?t.length-1:e,0),function(){for(var s=arguments,a=-1,l=at(s.length-e,0),h=y(l);++a<l;)h[a]=s[e+a];a=-1;for(var p=y(e+1);++a<e;)p[a]=s[a];return p[e]=n(h),xt(t,this,p)}}function ru(t,e){return e.length<2?t:Ee(t,Pt(e,0,-1))}function Hc(t,e){for(var n=t.length,s=ht(e.length,n),a=vt(t);s--;){var l=e[s];t[s]=oe(l,n)?a[l]:r}return t}function Pi(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var iu=au(La),Sn=rf||function(t,e){return lt.setTimeout(t,e)},Ui=au(hc);function su(t,e,n){var s=e+"";return Ui(t,Pc(s,zc(Ic(s),n)))}function au(t){var e=0,n=0;return function(){var s=of(),a=lo-(s-n);if(n=s,a>0){if(++e>=oo)return arguments[0]}else e=0;return t.apply(r,arguments)}}function dr(t,e){var n=-1,s=t.length,a=s-1;for(e=e===r?s:e;++n<e;){var l=wi(n,a),h=t[l];t[l]=t[n],t[n]=h}return t.length=e,t}var uu=Gc(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Oo,function(n,s,a,l){e.push(a?l.replace(Bo,"$1"):s||n)}),e});function Vt(t){if(typeof t=="string"||Rt(t))return t;var e=t+"";return e=="0"&&1/t==-Ce?"-0":e}function Ie(t){if(t!=null){try{return $n.call(t)}catch{}try{return t+""}catch{}}return""}function zc(t,e){return Tt(_o,function(n){var s="_."+n[0];e&n[1]&&!Wn(t,s)&&t.push(s)}),t.sort()}function ou(t){if(t instanceof z)return t.clone();var e=new Ot(t.__wrapped__,t.__chain__);return e.__actions__=vt(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function qc(t,e,n){(n?pt(t,e,n):e===r)?e=1:e=at(B(e),0);var s=t==null?0:t.length;if(!s||e<1)return[];for(var a=0,l=0,h=y(Jn(s/e));a<s;)h[l++]=Pt(t,a,a+=e);return h}function Yc(t){for(var e=-1,n=t==null?0:t.length,s=0,a=[];++e<n;){var l=t[e];l&&(a[s++]=l)}return a}function Kc(){var t=arguments.length;if(!t)return[];for(var e=y(t-1),n=arguments[0],s=t;s--;)e[s-1]=arguments[s];return ge(F(n)?vt(n):[n],ft(e,1))}var Zc=$(function(t,e){return rt(t)?pn(t,ft(e,1,rt,!0)):[]}),Jc=$(function(t,e){var n=Ut(e);return rt(n)&&(n=r),rt(t)?pn(t,ft(e,1,rt,!0),I(n,2)):[]}),Xc=$(function(t,e){var n=Ut(e);return rt(n)&&(n=r),rt(t)?pn(t,ft(e,1,rt,!0),r,n):[]});function Qc(t,e,n){var s=t==null?0:t.length;return s?(e=n||e===r?1:B(e),Pt(t,e<0?0:e,s)):[]}function Vc(t,e,n){var s=t==null?0:t.length;return s?(e=n||e===r?1:B(e),e=s-e,Pt(t,0,e<0?0:e)):[]}function jc(t,e){return t&&t.length?sr(t,I(e,3),!0,!0):[]}function th(t,e){return t&&t.length?sr(t,I(e,3),!0):[]}function eh(t,e,n,s){var a=t==null?0:t.length;return a?(n&&typeof n!="number"&&pt(t,e,n)&&(n=0,s=a),Kf(t,e,n,s)):[]}function lu(t,e,n){var s=t==null?0:t.length;if(!s)return-1;var a=n==null?0:B(n);return a<0&&(a=at(s+a,0)),Fn(t,I(e,3),a)}function fu(t,e,n){var s=t==null?0:t.length;if(!s)return-1;var a=s-1;return n!==r&&(a=B(n),a=n<0?at(s+a,0):ht(a,s-1)),Fn(t,I(e,3),a,!0)}function cu(t){var e=t==null?0:t.length;return e?ft(t,1):[]}function nh(t){var e=t==null?0:t.length;return e?ft(t,Ce):[]}function rh(t,e){var n=t==null?0:t.length;return n?(e=e===r?1:B(e),ft(t,e)):[]}function ih(t){for(var e=-1,n=t==null?0:t.length,s={};++e<n;){var a=t[e];s[a[0]]=a[1]}return s}function hu(t){return t&&t.length?t[0]:r}function sh(t,e,n){var s=t==null?0:t.length;if(!s)return-1;var a=n==null?0:B(n);return a<0&&(a=at(s+a,0)),We(t,e,a)}function ah(t){var e=t==null?0:t.length;return e?Pt(t,0,-1):[]}var uh=$(function(t){var e=j(t,xi);return e.length&&e[0]===t[0]?hi(e):[]}),oh=$(function(t){var e=Ut(t),n=j(t,xi);return e===Ut(n)?e=r:n.pop(),n.length&&n[0]===t[0]?hi(n,I(e,2)):[]}),lh=$(function(t){var e=Ut(t),n=j(t,xi);return e=typeof e=="function"?e:r,e&&n.pop(),n.length&&n[0]===t[0]?hi(n,r,e):[]});function fh(t,e){return t==null?"":af.call(t,e)}function Ut(t){var e=t==null?0:t.length;return e?t[e-1]:r}function ch(t,e,n){var s=t==null?0:t.length;if(!s)return-1;var a=s;return n!==r&&(a=B(n),a=a<0?at(s+a,0):ht(a,s-1)),e===e?Hl(t,e,a):Fn(t,Ys,a,!0)}function hh(t,e){return t&&t.length?Ca(t,B(e)):r}var dh=$(du);function du(t,e){return t&&t.length&&e&&e.length?_i(t,e):t}function gh(t,e,n){return t&&t.length&&e&&e.length?_i(t,e,I(n,2)):t}function ph(t,e,n){return t&&t.length&&e&&e.length?_i(t,e,r,n):t}var _h=ue(function(t,e){var n=t==null?0:t.length,s=oi(t,e);return Aa(t,j(e,function(a){return oe(a,n)?+a:a}).sort(Na)),s});function wh(t,e){var n=[];if(!(t&&t.length))return n;var s=-1,a=[],l=t.length;for(e=I(e,3);++s<l;){var h=t[s];e(h,s,t)&&(n.push(h),a.push(s))}return Aa(t,a),n}function Ni(t){return t==null?t:ff.call(t)}function vh(t,e,n){var s=t==null?0:t.length;return s?(n&&typeof n!="number"&&pt(t,e,n)?(e=0,n=s):(e=e==null?0:B(e),n=n===r?s:B(n)),Pt(t,e,n)):[]}function yh(t,e){return ir(t,e)}function mh(t,e,n){return yi(t,e,I(n,2))}function Sh(t,e){var n=t==null?0:t.length;if(n){var s=ir(t,e);if(s<n&&Ht(t[s],e))return s}return-1}function xh(t,e){return ir(t,e,!0)}function Ch(t,e,n){return yi(t,e,I(n,2),!0)}function Dh(t,e){var n=t==null?0:t.length;if(n){var s=ir(t,e,!0)-1;if(Ht(t[s],e))return s}return-1}function Rh(t){return t&&t.length?ba(t):[]}function Ah(t,e){return t&&t.length?ba(t,I(e,2)):[]}function Lh(t){var e=t==null?0:t.length;return e?Pt(t,1,e):[]}function bh(t,e,n){return t&&t.length?(e=n||e===r?1:B(e),Pt(t,0,e<0?0:e)):[]}function Eh(t,e,n){var s=t==null?0:t.length;return s?(e=n||e===r?1:B(e),e=s-e,Pt(t,e<0?0:e,s)):[]}function Th(t,e){return t&&t.length?sr(t,I(e,3),!1,!0):[]}function Ih(t,e){return t&&t.length?sr(t,I(e,3)):[]}var Oh=$(function(t){return ve(ft(t,1,rt,!0))}),Mh=$(function(t){var e=Ut(t);return rt(e)&&(e=r),ve(ft(t,1,rt,!0),I(e,2))}),Ph=$(function(t){var e=Ut(t);return e=typeof e=="function"?e:r,ve(ft(t,1,rt,!0),r,e)});function Uh(t){return t&&t.length?ve(t):[]}function Nh(t,e){return t&&t.length?ve(t,I(e,2)):[]}function Wh(t,e){return e=typeof e=="function"?e:r,t&&t.length?ve(t,r,e):[]}function Wi(t){if(!(t&&t.length))return[];var e=0;return t=de(t,function(n){if(rt(n))return e=at(n.length,e),!0}),ti(e,function(n){return j(t,Qr(n))})}function gu(t,e){if(!(t&&t.length))return[];var n=Wi(t);return e==null?n:j(n,function(s){return xt(e,r,s)})}var Fh=$(function(t,e){return rt(t)?pn(t,e):[]}),Gh=$(function(t){return Si(de(t,rt))}),Bh=$(function(t){var e=Ut(t);return rt(e)&&(e=r),Si(de(t,rt),I(e,2))}),kh=$(function(t){var e=Ut(t);return e=typeof e=="function"?e:r,Si(de(t,rt),r,e)}),$h=$(Wi);function Hh(t,e){return Oa(t||[],e||[],gn)}function zh(t,e){return Oa(t||[],e||[],vn)}var qh=$(function(t){var e=t.length,n=e>1?t[e-1]:r;return n=typeof n=="function"?(t.pop(),n):r,gu(t,n)});function pu(t){var e=o(t);return e.__chain__=!0,e}function Yh(t,e){return e(t),t}function gr(t,e){return e(t)}var Kh=ue(function(t){var e=t.length,n=e?t[0]:0,s=this.__wrapped__,a=function(l){return oi(l,t)};return e>1||this.__actions__.length||!(s instanceof z)||!oe(n)?this.thru(a):(s=s.slice(n,+n+(e?1:0)),s.__actions__.push({func:gr,args:[a],thisArg:r}),new Ot(s,this.__chain__).thru(function(l){return e&&!l.length&&l.push(r),l}))});function Zh(){return pu(this)}function Jh(){return new Ot(this.value(),this.__chain__)}function Xh(){this.__values__===r&&(this.__values__=Eu(this.value()));var t=this.__index__>=this.__values__.length,e=t?r:this.__values__[this.__index__++];return{done:t,value:e}}function Qh(){return this}function Vh(t){for(var e,n=this;n instanceof jn;){var s=ou(n);s.__index__=0,s.__values__=r,e?a.__wrapped__=s:e=s;var a=s;n=n.__wrapped__}return a.__wrapped__=t,e}function jh(){var t=this.__wrapped__;if(t instanceof z){var e=t;return this.__actions__.length&&(e=new z(this)),e=e.reverse(),e.__actions__.push({func:gr,args:[Ni],thisArg:r}),new Ot(e,this.__chain__)}return this.thru(Ni)}function td(){return Ia(this.__wrapped__,this.__actions__)}var ed=ar(function(t,e,n){Z.call(t,n)?++t[n]:se(t,n,1)});function nd(t,e,n){var s=F(t)?zs:Yf;return n&&pt(t,e,n)&&(e=r),s(t,I(e,3))}function rd(t,e){var n=F(t)?de:ga;return n(t,I(e,3))}var id=$a(lu),sd=$a(fu);function ad(t,e){return ft(pr(t,e),1)}function ud(t,e){return ft(pr(t,e),Ce)}function od(t,e,n){return n=n===r?1:B(n),ft(pr(t,e),n)}function _u(t,e){var n=F(t)?Tt:we;return n(t,I(e,3))}function wu(t,e){var n=F(t)?Al:da;return n(t,I(e,3))}var ld=ar(function(t,e,n){Z.call(t,n)?t[n].push(e):se(t,n,[e])});function fd(t,e,n,s){t=yt(t)?t:Je(t),n=n&&!s?B(n):0;var a=t.length;return n<0&&(n=at(a+n,0)),mr(t)?n<=a&&t.indexOf(e,n)>-1:!!a&&We(t,e,n)>-1}var cd=$(function(t,e,n){var s=-1,a=typeof e=="function",l=yt(t)?y(t.length):[];return we(t,function(h){l[++s]=a?xt(e,h,n):_n(h,e,n)}),l}),hd=ar(function(t,e,n){se(t,n,e)});function pr(t,e){var n=F(t)?j:ma;return n(t,I(e,3))}function dd(t,e,n,s){return t==null?[]:(F(e)||(e=e==null?[]:[e]),n=s?r:n,F(n)||(n=n==null?[]:[n]),Da(t,e,n))}var gd=ar(function(t,e,n){t[n?0:1].push(e)},function(){return[[],[]]});function pd(t,e,n){var s=F(t)?Jr:Zs,a=arguments.length<3;return s(t,I(e,4),n,a,we)}function _d(t,e,n){var s=F(t)?Ll:Zs,a=arguments.length<3;return s(t,I(e,4),n,a,da)}function wd(t,e){var n=F(t)?de:ga;return n(t,vr(I(e,3)))}function vd(t){var e=F(t)?la:fc;return e(t)}function yd(t,e,n){(n?pt(t,e,n):e===r)?e=1:e=B(e);var s=F(t)?kf:cc;return s(t,e)}function md(t){var e=F(t)?$f:dc;return e(t)}function Sd(t){if(t==null)return 0;if(yt(t))return mr(t)?Ge(t):t.length;var e=dt(t);return e==Gt||e==Bt?t.size:gi(t).length}function xd(t,e,n){var s=F(t)?Xr:gc;return n&&pt(t,e,n)&&(e=r),s(t,I(e,3))}var Cd=$(function(t,e){if(t==null)return[];var n=e.length;return n>1&&pt(t,e[0],e[1])?e=[]:n>2&&pt(e[0],e[1],e[2])&&(e=[e[0]]),Da(t,ft(e,1),[])}),_r=nf||function(){return lt.Date.now()};function Dd(t,e){if(typeof e!="function")throw new It(g);return t=B(t),function(){if(--t<1)return e.apply(this,arguments)}}function vu(t,e,n){return e=n?r:e,e=t&&e==null?t.length:e,ae(t,ee,r,r,r,r,e)}function yu(t,e){var n;if(typeof e!="function")throw new It(g);return t=B(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=r),n}}var Fi=$(function(t,e,n){var s=Ft;if(n.length){var a=pe(n,Ke(Fi));s|=te}return ae(t,s,e,n,a)}),mu=$(function(t,e,n){var s=Ft|Me;if(n.length){var a=pe(n,Ke(mu));s|=te}return ae(e,s,t,n,a)});function Su(t,e,n){e=n?r:e;var s=ae(t,jt,r,r,r,r,r,e);return s.placeholder=Su.placeholder,s}function xu(t,e,n){e=n?r:e;var s=ae(t,Qe,r,r,r,r,r,e);return s.placeholder=xu.placeholder,s}function Cu(t,e,n){var s,a,l,h,p,w,S=0,x=!1,C=!1,A=!0;if(typeof t!="function")throw new It(g);e=Nt(e)||0,tt(n)&&(x=!!n.leading,C="maxWait"in n,l=C?at(Nt(n.maxWait)||0,e):l,A="trailing"in n?!!n.trailing:A);function E(it){var zt=s,ce=a;return s=a=r,S=it,h=t.apply(ce,zt),h}function O(it){return S=it,p=Sn(H,e),x?E(it):h}function k(it){var zt=it-w,ce=it-S,$u=e-zt;return C?ht($u,l-ce):$u}function M(it){var zt=it-w,ce=it-S;return w===r||zt>=e||zt<0||C&&ce>=l}function H(){var it=_r();if(M(it))return q(it);p=Sn(H,k(it))}function q(it){return p=r,A&&s?E(it):(s=a=r,h)}function At(){p!==r&&Ma(p),S=0,s=w=a=p=r}function _t(){return p===r?h:q(_r())}function Lt(){var it=_r(),zt=M(it);if(s=arguments,a=this,w=it,zt){if(p===r)return O(w);if(C)return Ma(p),p=Sn(H,e),E(w)}return p===r&&(p=Sn(H,e)),h}return Lt.cancel=At,Lt.flush=_t,Lt}var Rd=$(function(t,e){return ha(t,1,e)}),Ad=$(function(t,e,n){return ha(t,Nt(e)||0,n)});function Ld(t){return ae(t,Er)}function wr(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new It(g);var n=function(){var s=arguments,a=e?e.apply(this,s):s[0],l=n.cache;if(l.has(a))return l.get(a);var h=t.apply(this,s);return n.cache=l.set(a,h)||l,h};return n.cache=new(wr.Cache||ie),n}wr.Cache=ie;function vr(t){if(typeof t!="function")throw new It(g);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function bd(t){return yu(2,t)}var Ed=pc(function(t,e){e=e.length==1&&F(e[0])?j(e[0],Ct(I())):j(ft(e,1),Ct(I()));var n=e.length;return $(function(s){for(var a=-1,l=ht(s.length,n);++a<l;)s[a]=e[a].call(this,s[a]);return xt(t,this,s)})}),Gi=$(function(t,e){var n=pe(e,Ke(Gi));return ae(t,te,r,e,n)}),Du=$(function(t,e){var n=pe(e,Ke(Du));return ae(t,Ve,r,e,n)}),Td=ue(function(t,e){return ae(t,je,r,r,r,e)});function Id(t,e){if(typeof t!="function")throw new It(g);return e=e===r?e:B(e),$(t,e)}function Od(t,e){if(typeof t!="function")throw new It(g);return e=e==null?0:at(B(e),0),$(function(n){var s=n[e],a=me(n,0,e);return s&&ge(a,s),xt(t,this,a)})}function Md(t,e,n){var s=!0,a=!0;if(typeof t!="function")throw new It(g);return tt(n)&&(s="leading"in n?!!n.leading:s,a="trailing"in n?!!n.trailing:a),Cu(t,e,{leading:s,maxWait:e,trailing:a})}function Pd(t){return vu(t,1)}function Ud(t,e){return Gi(Ci(e),t)}function Nd(){if(!arguments.length)return[];var t=arguments[0];return F(t)?t:[t]}function Wd(t){return Mt(t,V)}function Fd(t,e){return e=typeof e=="function"?e:r,Mt(t,V,e)}function Gd(t){return Mt(t,N|V)}function Bd(t,e){return e=typeof e=="function"?e:r,Mt(t,N|V,e)}function kd(t,e){return e==null||ca(t,e,ot(e))}function Ht(t,e){return t===e||t!==t&&e!==e}var $d=fr(ci),Hd=fr(function(t,e){return t>=e}),Oe=wa(function(){return arguments}())?wa:function(t){return et(t)&&Z.call(t,"callee")&&!ra.call(t,"callee")},F=y.isArray,zd=Fs?Ct(Fs):Vf;function yt(t){return t!=null&&yr(t.length)&&!le(t)}function rt(t){return et(t)&&yt(t)}function qd(t){return t===!0||t===!1||et(t)&&gt(t)==tn}var Se=sf||Xi,Yd=Gs?Ct(Gs):jf;function Kd(t){return et(t)&&t.nodeType===1&&!xn(t)}function Zd(t){if(t==null)return!0;if(yt(t)&&(F(t)||typeof t=="string"||typeof t.splice=="function"||Se(t)||Ze(t)||Oe(t)))return!t.length;var e=dt(t);if(e==Gt||e==Bt)return!t.size;if(mn(t))return!gi(t).length;for(var n in t)if(Z.call(t,n))return!1;return!0}function Jd(t,e){return wn(t,e)}function Xd(t,e,n){n=typeof n=="function"?n:r;var s=n?n(t,e):r;return s===r?wn(t,e,r,n):!!s}function Bi(t){if(!et(t))return!1;var e=gt(t);return e==In||e==vo||typeof t.message=="string"&&typeof t.name=="string"&&!xn(t)}function Qd(t){return typeof t=="number"&&sa(t)}function le(t){if(!tt(t))return!1;var e=gt(t);return e==On||e==hs||e==wo||e==mo}function Ru(t){return typeof t=="number"&&t==B(t)}function yr(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=he}function tt(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function et(t){return t!=null&&typeof t=="object"}var Au=Bs?Ct(Bs):ec;function Vd(t,e){return t===e||di(t,e,Ti(e))}function jd(t,e,n){return n=typeof n=="function"?n:r,di(t,e,Ti(e),n)}function tg(t){return Lu(t)&&t!=+t}function eg(t){if(Fc(t))throw new W(c);return va(t)}function ng(t){return t===null}function rg(t){return t==null}function Lu(t){return typeof t=="number"||et(t)&&gt(t)==nn}function xn(t){if(!et(t)||gt(t)!=ne)return!1;var e=Yn(t);if(e===null)return!0;var n=Z.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&$n.call(n)==Vl}var ki=ks?Ct(ks):nc;function ig(t){return Ru(t)&&t>=-he&&t<=he}var bu=$s?Ct($s):rc;function mr(t){return typeof t=="string"||!F(t)&&et(t)&&gt(t)==sn}function Rt(t){return typeof t=="symbol"||et(t)&&gt(t)==Mn}var Ze=Hs?Ct(Hs):ic;function sg(t){return t===r}function ag(t){return et(t)&&dt(t)==an}function ug(t){return et(t)&&gt(t)==xo}var og=fr(pi),lg=fr(function(t,e){return t<=e});function Eu(t){if(!t)return[];if(yt(t))return mr(t)?kt(t):vt(t);if(ln&&t[ln])return Bl(t[ln]());var e=dt(t),n=e==Gt?ni:e==Bt?Gn:Je;return n(t)}function fe(t){if(!t)return t===0?t:0;if(t=Nt(t),t===Ce||t===-Ce){var e=t<0?-1:1;return e*ho}return t===t?t:0}function B(t){var e=fe(t),n=e%1;return e===e?n?e-n:e:0}function Tu(t){return t?be(B(t),0,Jt):0}function Nt(t){if(typeof t=="number")return t;if(Rt(t))return En;if(tt(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=tt(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Js(t);var n=Ho.test(t);return n||qo.test(t)?Cl(t.slice(2),n?2:8):$o.test(t)?En:+t}function Iu(t){return Qt(t,mt(t))}function fg(t){return t?be(B(t),-he,he):t===0?t:0}function K(t){return t==null?"":Dt(t)}var cg=qe(function(t,e){if(mn(e)||yt(e)){Qt(e,ot(e),t);return}for(var n in e)Z.call(e,n)&&gn(t,n,e[n])}),Ou=qe(function(t,e){Qt(e,mt(e),t)}),Sr=qe(function(t,e,n,s){Qt(e,mt(e),t,s)}),hg=qe(function(t,e,n,s){Qt(e,ot(e),t,s)}),dg=ue(oi);function gg(t,e){var n=ze(t);return e==null?n:fa(n,e)}var pg=$(function(t,e){t=J(t);var n=-1,s=e.length,a=s>2?e[2]:r;for(a&&pt(e[0],e[1],a)&&(s=1);++n<s;)for(var l=e[n],h=mt(l),p=-1,w=h.length;++p<w;){var S=h[p],x=t[S];(x===r||Ht(x,ke[S])&&!Z.call(t,S))&&(t[S]=l[S])}return t}),_g=$(function(t){return t.push(r,Ja),xt(Mu,r,t)});function wg(t,e){return qs(t,I(e,3),Xt)}function vg(t,e){return qs(t,I(e,3),fi)}function yg(t,e){return t==null?t:li(t,I(e,3),mt)}function mg(t,e){return t==null?t:pa(t,I(e,3),mt)}function Sg(t,e){return t&&Xt(t,I(e,3))}function xg(t,e){return t&&fi(t,I(e,3))}function Cg(t){return t==null?[]:nr(t,ot(t))}function Dg(t){return t==null?[]:nr(t,mt(t))}function $i(t,e,n){var s=t==null?r:Ee(t,e);return s===r?n:s}function Rg(t,e){return t!=null&&Va(t,e,Zf)}function Hi(t,e){return t!=null&&Va(t,e,Jf)}var Ag=za(function(t,e,n){e!=null&&typeof e.toString!="function"&&(e=Hn.call(e)),t[e]=n},qi(St)),Lg=za(function(t,e,n){e!=null&&typeof e.toString!="function"&&(e=Hn.call(e)),Z.call(t,e)?t[e].push(n):t[e]=[n]},I),bg=$(_n);function ot(t){return yt(t)?oa(t):gi(t)}function mt(t){return yt(t)?oa(t,!0):sc(t)}function Eg(t,e){var n={};return e=I(e,3),Xt(t,function(s,a,l){se(n,e(s,a,l),s)}),n}function Tg(t,e){var n={};return e=I(e,3),Xt(t,function(s,a,l){se(n,a,e(s,a,l))}),n}var Ig=qe(function(t,e,n){rr(t,e,n)}),Mu=qe(function(t,e,n,s){rr(t,e,n,s)}),Og=ue(function(t,e){var n={};if(t==null)return n;var s=!1;e=j(e,function(l){return l=ye(l,t),s||(s=l.length>1),l}),Qt(t,bi(t),n),s&&(n=Mt(n,N|ut|V,Ac));for(var a=e.length;a--;)mi(n,e[a]);return n});function Mg(t,e){return Pu(t,vr(I(e)))}var Pg=ue(function(t,e){return t==null?{}:uc(t,e)});function Pu(t,e){if(t==null)return{};var n=j(bi(t),function(s){return[s]});return e=I(e),Ra(t,n,function(s,a){return e(s,a[0])})}function Ug(t,e,n){e=ye(e,t);var s=-1,a=e.length;for(a||(a=1,t=r);++s<a;){var l=t==null?r:t[Vt(e[s])];l===r&&(s=a,l=n),t=le(l)?l.call(t):l}return t}function Ng(t,e,n){return t==null?t:vn(t,e,n)}function Wg(t,e,n,s){return s=typeof s=="function"?s:r,t==null?t:vn(t,e,n,s)}var Uu=Ka(ot),Nu=Ka(mt);function Fg(t,e,n){var s=F(t),a=s||Se(t)||Ze(t);if(e=I(e,4),n==null){var l=t&&t.constructor;a?n=s?new l:[]:tt(t)?n=le(l)?ze(Yn(t)):{}:n={}}return(a?Tt:Xt)(t,function(h,p,w){return e(n,h,p,w)}),n}function Gg(t,e){return t==null?!0:mi(t,e)}function Bg(t,e,n){return t==null?t:Ta(t,e,Ci(n))}function kg(t,e,n,s){return s=typeof s=="function"?s:r,t==null?t:Ta(t,e,Ci(n),s)}function Je(t){return t==null?[]:ei(t,ot(t))}function $g(t){return t==null?[]:ei(t,mt(t))}function Hg(t,e,n){return n===r&&(n=e,e=r),n!==r&&(n=Nt(n),n=n===n?n:0),e!==r&&(e=Nt(e),e=e===e?e:0),be(Nt(t),e,n)}function zg(t,e,n){return e=fe(e),n===r?(n=e,e=0):n=fe(n),t=Nt(t),Xf(t,e,n)}function qg(t,e,n){if(n&&typeof n!="boolean"&&pt(t,e,n)&&(e=n=r),n===r&&(typeof e=="boolean"?(n=e,e=r):typeof t=="boolean"&&(n=t,t=r)),t===r&&e===r?(t=0,e=1):(t=fe(t),e===r?(e=t,t=0):e=fe(e)),t>e){var s=t;t=e,e=s}if(n||t%1||e%1){var a=aa();return ht(t+a*(e-t+xl("1e-"+((a+"").length-1))),e)}return wi(t,e)}var Yg=Ye(function(t,e,n){return e=e.toLowerCase(),t+(n?Wu(e):e)});function Wu(t){return zi(K(t).toLowerCase())}function Fu(t){return t=K(t),t&&t.replace(Ko,Ul).replace(hl,"")}function Kg(t,e,n){t=K(t),e=Dt(e);var s=t.length;n=n===r?s:be(B(n),0,s);var a=n;return n-=e.length,n>=0&&t.slice(n,a)==e}function Zg(t){return t=K(t),t&&Lo.test(t)?t.replace(ps,Nl):t}function Jg(t){return t=K(t),t&&Mo.test(t)?t.replace(Gr,"\\$&"):t}var Xg=Ye(function(t,e,n){return t+(n?"-":"")+e.toLowerCase()}),Qg=Ye(function(t,e,n){return t+(n?" ":"")+e.toLowerCase()}),Vg=ka("toLowerCase");function jg(t,e,n){t=K(t),e=B(e);var s=e?Ge(t):0;if(!e||s>=e)return t;var a=(e-s)/2;return lr(Xn(a),n)+t+lr(Jn(a),n)}function tp(t,e,n){t=K(t),e=B(e);var s=e?Ge(t):0;return e&&s<e?t+lr(e-s,n):t}function ep(t,e,n){t=K(t),e=B(e);var s=e?Ge(t):0;return e&&s<e?lr(e-s,n)+t:t}function np(t,e,n){return n||e==null?e=0:e&&(e=+e),lf(K(t).replace(Br,""),e||0)}function rp(t,e,n){return(n?pt(t,e,n):e===r)?e=1:e=B(e),vi(K(t),e)}function ip(){var t=arguments,e=K(t[0]);return t.length<3?e:e.replace(t[1],t[2])}var sp=Ye(function(t,e,n){return t+(n?"_":"")+e.toLowerCase()});function ap(t,e,n){return n&&typeof n!="number"&&pt(t,e,n)&&(e=n=r),n=n===r?Jt:n>>>0,n?(t=K(t),t&&(typeof e=="string"||e!=null&&!ki(e))&&(e=Dt(e),!e&&Fe(t))?me(kt(t),0,n):t.split(e,n)):[]}var up=Ye(function(t,e,n){return t+(n?" ":"")+zi(e)});function op(t,e,n){return t=K(t),n=n==null?0:be(B(n),0,t.length),e=Dt(e),t.slice(n,n+e.length)==e}function lp(t,e,n){var s=o.templateSettings;n&&pt(t,e,n)&&(e=r),t=K(t),e=Sr({},e,s,Za);var a=Sr({},e.imports,s.imports,Za),l=ot(a),h=ei(a,l),p,w,S=0,x=e.interpolate||Pn,C="__p += '",A=ri((e.escape||Pn).source+"|"+x.source+"|"+(x===_s?ko:Pn).source+"|"+(e.evaluate||Pn).source+"|$","g"),E="//# sourceURL="+(Z.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++wl+"]")+`
`;t.replace(A,function(M,H,q,At,_t,Lt){return q||(q=At),C+=t.slice(S,Lt).replace(Zo,Wl),H&&(p=!0,C+=`' +
__e(`+H+`) +
'`),_t&&(w=!0,C+=`';
`+_t+`;
__p += '`),q&&(C+=`' +
((__t = (`+q+`)) == null ? '' : __t) +
'`),S=Lt+M.length,M}),C+=`';
`;var O=Z.call(e,"variable")&&e.variable;if(!O)C=`with (obj) {
`+C+`
}
`;else if(Go.test(O))throw new W(v);C=(w?C.replace(Co,""):C).replace(Do,"$1").replace(Ro,"$1;"),C="function("+(O||"obj")+`) {
`+(O?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(p?", __e = _.escape":"")+(w?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+C+`return __p
}`;var k=Bu(function(){return Y(l,E+"return "+C).apply(r,h)});if(k.source=C,Bi(k))throw k;return k}function fp(t){return K(t).toLowerCase()}function cp(t){return K(t).toUpperCase()}function hp(t,e,n){if(t=K(t),t&&(n||e===r))return Js(t);if(!t||!(e=Dt(e)))return t;var s=kt(t),a=kt(e),l=Xs(s,a),h=Qs(s,a)+1;return me(s,l,h).join("")}function dp(t,e,n){if(t=K(t),t&&(n||e===r))return t.slice(0,js(t)+1);if(!t||!(e=Dt(e)))return t;var s=kt(t),a=Qs(s,kt(e))+1;return me(s,0,a).join("")}function gp(t,e,n){if(t=K(t),t&&(n||e===r))return t.replace(Br,"");if(!t||!(e=Dt(e)))return t;var s=kt(t),a=Xs(s,kt(e));return me(s,a).join("")}function pp(t,e){var n=ao,s=uo;if(tt(e)){var a="separator"in e?e.separator:a;n="length"in e?B(e.length):n,s="omission"in e?Dt(e.omission):s}t=K(t);var l=t.length;if(Fe(t)){var h=kt(t);l=h.length}if(n>=l)return t;var p=n-Ge(s);if(p<1)return s;var w=h?me(h,0,p).join(""):t.slice(0,p);if(a===r)return w+s;if(h&&(p+=w.length-p),ki(a)){if(t.slice(p).search(a)){var S,x=w;for(a.global||(a=ri(a.source,K(ws.exec(a))+"g")),a.lastIndex=0;S=a.exec(x);)var C=S.index;w=w.slice(0,C===r?p:C)}}else if(t.indexOf(Dt(a),p)!=p){var A=w.lastIndexOf(a);A>-1&&(w=w.slice(0,A))}return w+s}function _p(t){return t=K(t),t&&Ao.test(t)?t.replace(gs,zl):t}var wp=Ye(function(t,e,n){return t+(n?" ":"")+e.toUpperCase()}),zi=ka("toUpperCase");function Gu(t,e,n){return t=K(t),e=n?r:e,e===r?Gl(t)?Kl(t):Tl(t):t.match(e)||[]}var Bu=$(function(t,e){try{return xt(t,r,e)}catch(n){return Bi(n)?n:new W(n)}}),vp=ue(function(t,e){return Tt(e,function(n){n=Vt(n),se(t,n,Fi(t[n],t))}),t});function yp(t){var e=t==null?0:t.length,n=I();return t=e?j(t,function(s){if(typeof s[1]!="function")throw new It(g);return[n(s[0]),s[1]]}):[],$(function(s){for(var a=-1;++a<e;){var l=t[a];if(xt(l[0],this,s))return xt(l[1],this,s)}})}function mp(t){return qf(Mt(t,N))}function qi(t){return function(){return t}}function Sp(t,e){return t==null||t!==t?e:t}var xp=Ha(),Cp=Ha(!0);function St(t){return t}function Yi(t){return ya(typeof t=="function"?t:Mt(t,N))}function Dp(t){return Sa(Mt(t,N))}function Rp(t,e){return xa(t,Mt(e,N))}var Ap=$(function(t,e){return function(n){return _n(n,t,e)}}),Lp=$(function(t,e){return function(n){return _n(t,n,e)}});function Ki(t,e,n){var s=ot(e),a=nr(e,s);n==null&&!(tt(e)&&(a.length||!s.length))&&(n=e,e=t,t=this,a=nr(e,ot(e)));var l=!(tt(n)&&"chain"in n)||!!n.chain,h=le(t);return Tt(a,function(p){var w=e[p];t[p]=w,h&&(t.prototype[p]=function(){var S=this.__chain__;if(l||S){var x=t(this.__wrapped__),C=x.__actions__=vt(this.__actions__);return C.push({func:w,args:arguments,thisArg:t}),x.__chain__=S,x}return w.apply(t,ge([this.value()],arguments))})}),t}function bp(){return lt._===this&&(lt._=jl),this}function Zi(){}function Ep(t){return t=B(t),$(function(e){return Ca(e,t)})}var Tp=Ri(j),Ip=Ri(zs),Op=Ri(Xr);function ku(t){return Oi(t)?Qr(Vt(t)):oc(t)}function Mp(t){return function(e){return t==null?r:Ee(t,e)}}var Pp=qa(),Up=qa(!0);function Ji(){return[]}function Xi(){return!1}function Np(){return{}}function Wp(){return""}function Fp(){return!0}function Gp(t,e){if(t=B(t),t<1||t>he)return[];var n=Jt,s=ht(t,Jt);e=I(e),t-=Jt;for(var a=ti(s,e);++n<t;)e(n);return a}function Bp(t){return F(t)?j(t,Vt):Rt(t)?[t]:vt(uu(K(t)))}function kp(t){var e=++Ql;return K(t)+e}var $p=or(function(t,e){return t+e},0),Hp=Ai("ceil"),zp=or(function(t,e){return t/e},1),qp=Ai("floor");function Yp(t){return t&&t.length?er(t,St,ci):r}function Kp(t,e){return t&&t.length?er(t,I(e,2),ci):r}function Zp(t){return Ks(t,St)}function Jp(t,e){return Ks(t,I(e,2))}function Xp(t){return t&&t.length?er(t,St,pi):r}function Qp(t,e){return t&&t.length?er(t,I(e,2),pi):r}var Vp=or(function(t,e){return t*e},1),jp=Ai("round"),t_=or(function(t,e){return t-e},0);function e_(t){return t&&t.length?jr(t,St):0}function n_(t,e){return t&&t.length?jr(t,I(e,2)):0}return o.after=Dd,o.ary=vu,o.assign=cg,o.assignIn=Ou,o.assignInWith=Sr,o.assignWith=hg,o.at=dg,o.before=yu,o.bind=Fi,o.bindAll=vp,o.bindKey=mu,o.castArray=Nd,o.chain=pu,o.chunk=qc,o.compact=Yc,o.concat=Kc,o.cond=yp,o.conforms=mp,o.constant=qi,o.countBy=ed,o.create=gg,o.curry=Su,o.curryRight=xu,o.debounce=Cu,o.defaults=pg,o.defaultsDeep=_g,o.defer=Rd,o.delay=Ad,o.difference=Zc,o.differenceBy=Jc,o.differenceWith=Xc,o.drop=Qc,o.dropRight=Vc,o.dropRightWhile=jc,o.dropWhile=th,o.fill=eh,o.filter=rd,o.flatMap=ad,o.flatMapDeep=ud,o.flatMapDepth=od,o.flatten=cu,o.flattenDeep=nh,o.flattenDepth=rh,o.flip=Ld,o.flow=xp,o.flowRight=Cp,o.fromPairs=ih,o.functions=Cg,o.functionsIn=Dg,o.groupBy=ld,o.initial=ah,o.intersection=uh,o.intersectionBy=oh,o.intersectionWith=lh,o.invert=Ag,o.invertBy=Lg,o.invokeMap=cd,o.iteratee=Yi,o.keyBy=hd,o.keys=ot,o.keysIn=mt,o.map=pr,o.mapKeys=Eg,o.mapValues=Tg,o.matches=Dp,o.matchesProperty=Rp,o.memoize=wr,o.merge=Ig,o.mergeWith=Mu,o.method=Ap,o.methodOf=Lp,o.mixin=Ki,o.negate=vr,o.nthArg=Ep,o.omit=Og,o.omitBy=Mg,o.once=bd,o.orderBy=dd,o.over=Tp,o.overArgs=Ed,o.overEvery=Ip,o.overSome=Op,o.partial=Gi,o.partialRight=Du,o.partition=gd,o.pick=Pg,o.pickBy=Pu,o.property=ku,o.propertyOf=Mp,o.pull=dh,o.pullAll=du,o.pullAllBy=gh,o.pullAllWith=ph,o.pullAt=_h,o.range=Pp,o.rangeRight=Up,o.rearg=Td,o.reject=wd,o.remove=wh,o.rest=Id,o.reverse=Ni,o.sampleSize=yd,o.set=Ng,o.setWith=Wg,o.shuffle=md,o.slice=vh,o.sortBy=Cd,o.sortedUniq=Rh,o.sortedUniqBy=Ah,o.split=ap,o.spread=Od,o.tail=Lh,o.take=bh,o.takeRight=Eh,o.takeRightWhile=Th,o.takeWhile=Ih,o.tap=Yh,o.throttle=Md,o.thru=gr,o.toArray=Eu,o.toPairs=Uu,o.toPairsIn=Nu,o.toPath=Bp,o.toPlainObject=Iu,o.transform=Fg,o.unary=Pd,o.union=Oh,o.unionBy=Mh,o.unionWith=Ph,o.uniq=Uh,o.uniqBy=Nh,o.uniqWith=Wh,o.unset=Gg,o.unzip=Wi,o.unzipWith=gu,o.update=Bg,o.updateWith=kg,o.values=Je,o.valuesIn=$g,o.without=Fh,o.words=Gu,o.wrap=Ud,o.xor=Gh,o.xorBy=Bh,o.xorWith=kh,o.zip=$h,o.zipObject=Hh,o.zipObjectDeep=zh,o.zipWith=qh,o.entries=Uu,o.entriesIn=Nu,o.extend=Ou,o.extendWith=Sr,Ki(o,o),o.add=$p,o.attempt=Bu,o.camelCase=Yg,o.capitalize=Wu,o.ceil=Hp,o.clamp=Hg,o.clone=Wd,o.cloneDeep=Gd,o.cloneDeepWith=Bd,o.cloneWith=Fd,o.conformsTo=kd,o.deburr=Fu,o.defaultTo=Sp,o.divide=zp,o.endsWith=Kg,o.eq=Ht,o.escape=Zg,o.escapeRegExp=Jg,o.every=nd,o.find=id,o.findIndex=lu,o.findKey=wg,o.findLast=sd,o.findLastIndex=fu,o.findLastKey=vg,o.floor=qp,o.forEach=_u,o.forEachRight=wu,o.forIn=yg,o.forInRight=mg,o.forOwn=Sg,o.forOwnRight=xg,o.get=$i,o.gt=$d,o.gte=Hd,o.has=Rg,o.hasIn=Hi,o.head=hu,o.identity=St,o.includes=fd,o.indexOf=sh,o.inRange=zg,o.invoke=bg,o.isArguments=Oe,o.isArray=F,o.isArrayBuffer=zd,o.isArrayLike=yt,o.isArrayLikeObject=rt,o.isBoolean=qd,o.isBuffer=Se,o.isDate=Yd,o.isElement=Kd,o.isEmpty=Zd,o.isEqual=Jd,o.isEqualWith=Xd,o.isError=Bi,o.isFinite=Qd,o.isFunction=le,o.isInteger=Ru,o.isLength=yr,o.isMap=Au,o.isMatch=Vd,o.isMatchWith=jd,o.isNaN=tg,o.isNative=eg,o.isNil=rg,o.isNull=ng,o.isNumber=Lu,o.isObject=tt,o.isObjectLike=et,o.isPlainObject=xn,o.isRegExp=ki,o.isSafeInteger=ig,o.isSet=bu,o.isString=mr,o.isSymbol=Rt,o.isTypedArray=Ze,o.isUndefined=sg,o.isWeakMap=ag,o.isWeakSet=ug,o.join=fh,o.kebabCase=Xg,o.last=Ut,o.lastIndexOf=ch,o.lowerCase=Qg,o.lowerFirst=Vg,o.lt=og,o.lte=lg,o.max=Yp,o.maxBy=Kp,o.mean=Zp,o.meanBy=Jp,o.min=Xp,o.minBy=Qp,o.stubArray=Ji,o.stubFalse=Xi,o.stubObject=Np,o.stubString=Wp,o.stubTrue=Fp,o.multiply=Vp,o.nth=hh,o.noConflict=bp,o.noop=Zi,o.now=_r,o.pad=jg,o.padEnd=tp,o.padStart=ep,o.parseInt=np,o.random=qg,o.reduce=pd,o.reduceRight=_d,o.repeat=rp,o.replace=ip,o.result=Ug,o.round=jp,o.runInContext=_,o.sample=vd,o.size=Sd,o.snakeCase=sp,o.some=xd,o.sortedIndex=yh,o.sortedIndexBy=mh,o.sortedIndexOf=Sh,o.sortedLastIndex=xh,o.sortedLastIndexBy=Ch,o.sortedLastIndexOf=Dh,o.startCase=up,o.startsWith=op,o.subtract=t_,o.sum=e_,o.sumBy=n_,o.template=lp,o.times=Gp,o.toFinite=fe,o.toInteger=B,o.toLength=Tu,o.toLower=fp,o.toNumber=Nt,o.toSafeInteger=fg,o.toString=K,o.toUpper=cp,o.trim=hp,o.trimEnd=dp,o.trimStart=gp,o.truncate=pp,o.unescape=_p,o.uniqueId=kp,o.upperCase=wp,o.upperFirst=zi,o.each=_u,o.eachRight=wu,o.first=hu,Ki(o,function(){var t={};return Xt(o,function(e,n){Z.call(o.prototype,n)||(t[n]=e)}),t}(),{chain:!1}),o.VERSION=u,Tt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){o[t].placeholder=o}),Tt(["drop","take"],function(t,e){z.prototype[t]=function(n){n=n===r?1:at(B(n),0);var s=this.__filtered__&&!e?new z(this):this.clone();return s.__filtered__?s.__takeCount__=ht(n,s.__takeCount__):s.__views__.push({size:ht(n,Jt),type:t+(s.__dir__<0?"Right":"")}),s},z.prototype[t+"Right"]=function(n){return this.reverse()[t](n).reverse()}}),Tt(["filter","map","takeWhile"],function(t,e){var n=e+1,s=n==cs||n==co;z.prototype[t]=function(a){var l=this.clone();return l.__iteratees__.push({iteratee:I(a,3),type:n}),l.__filtered__=l.__filtered__||s,l}}),Tt(["head","last"],function(t,e){var n="take"+(e?"Right":"");z.prototype[t]=function(){return this[n](1).value()[0]}}),Tt(["initial","tail"],function(t,e){var n="drop"+(e?"":"Right");z.prototype[t]=function(){return this.__filtered__?new z(this):this[n](1)}}),z.prototype.compact=function(){return this.filter(St)},z.prototype.find=function(t){return this.filter(t).head()},z.prototype.findLast=function(t){return this.reverse().find(t)},z.prototype.invokeMap=$(function(t,e){return typeof t=="function"?new z(this):this.map(function(n){return _n(n,t,e)})}),z.prototype.reject=function(t){return this.filter(vr(I(t)))},z.prototype.slice=function(t,e){t=B(t);var n=this;return n.__filtered__&&(t>0||e<0)?new z(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),e!==r&&(e=B(e),n=e<0?n.dropRight(-e):n.take(e-t)),n)},z.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},z.prototype.toArray=function(){return this.take(Jt)},Xt(z.prototype,function(t,e){var n=/^(?:filter|find|map|reject)|While$/.test(e),s=/^(?:head|last)$/.test(e),a=o[s?"take"+(e=="last"?"Right":""):e],l=s||/^find/.test(e);a&&(o.prototype[e]=function(){var h=this.__wrapped__,p=s?[1]:arguments,w=h instanceof z,S=p[0],x=w||F(h),C=function(H){var q=a.apply(o,ge([H],p));return s&&A?q[0]:q};x&&n&&typeof S=="function"&&S.length!=1&&(w=x=!1);var A=this.__chain__,E=!!this.__actions__.length,O=l&&!A,k=w&&!E;if(!l&&x){h=k?h:new z(this);var M=t.apply(h,p);return M.__actions__.push({func:gr,args:[C],thisArg:r}),new Ot(M,A)}return O&&k?t.apply(this,p):(M=this.thru(C),O?s?M.value()[0]:M.value():M)})}),Tt(["pop","push","shift","sort","splice","unshift"],function(t){var e=Bn[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",s=/^(?:pop|shift)$/.test(t);o.prototype[t]=function(){var a=arguments;if(s&&!this.__chain__){var l=this.value();return e.apply(F(l)?l:[],a)}return this[n](function(h){return e.apply(F(h)?h:[],a)})}}),Xt(z.prototype,function(t,e){var n=o[e];if(n){var s=n.name+"";Z.call(He,s)||(He[s]=[]),He[s].push({name:e,func:n})}}),He[ur(r,Me).name]=[{name:"wrapper",func:r}],z.prototype.clone=_f,z.prototype.reverse=wf,z.prototype.value=vf,o.prototype.at=Kh,o.prototype.chain=Zh,o.prototype.commit=Jh,o.prototype.next=Xh,o.prototype.plant=Vh,o.prototype.reverse=jh,o.prototype.toJSON=o.prototype.valueOf=o.prototype.value=td,o.prototype.first=o.prototype.head,ln&&(o.prototype[ln]=Qh),o},Be=Zl();De?((De.exports=Be)._=Be,Yr._=Be):lt._=Be}).call(K_)}(Rn,Rn.exports)),Rn.exports}var J_=Z_();const Wt=Y_(J_);class X_{async upload(i=[]){return new Promise(r=>{const u=document.createElement("input");u.type="file",i.length&&(u.accept=i.map(f=>`.${f}`).join(",")),u.onchange=async()=>{var v;const f=(v=u.files)==null?void 0:v[0];if(!f)return r(null);const c=f.type.startsWith("text/")||f.name.match(/\.(txt|json|csv|md)$/),g=c?await f.text():new Uint8Array(await f.arrayBuffer());r({data:g,filename:f.name,mimeType:f.type||(c?"text/plain":"application/octet-stream")})},u.click()})}async download({data:i,filename:r,mimeType:u}){const f=i instanceof Uint8Array?new Blob([i],{type:u}):new Blob([i],{type:u});if("showSaveFilePicker"in window){const v=r.includes(".")?r.slice(r.lastIndexOf(".")):"",L=await(await window.showSaveFilePicker({suggestedName:r,types:[{description:"File",accept:{[u]:[v]}}]})).createWritable();await L.write(f),await L.close();return}const c=URL.createObjectURL(f),g=document.createElement("a");g.href=c,g.download=r,g.click(),URL.revokeObjectURL(c)}}class Q_{constructor(i){P(this,"reviewCardIdsOverride");P(this,"extraStudyLastCardId");this.app=i}init(){this.reviewCardIdsOverride=void 0}registerReviewCardIdsOverride(i){this.reviewCardIdsOverride=i}isExtraStudy(){return this.reviewCardIdsOverride!==void 0}getNextCard(){if(this.reviewCardIdsOverride){if(this.reviewCardIdsOverride.length===1)return this.reviewCardIdsOverride[0];{const i=this.reviewCardIdsOverride.filter(r=>r!==this.extraStudyLastCardId);return i[Math.floor(Math.random()*i.length)]}}}getCardsCount(){var i;return((i=this.reviewCardIdsOverride)==null?void 0:i.length)??0}rateAgain(i){this.extraStudyLastCardId=i}rateGood(i){if(this.extraStudyLastCardId=i,this.reviewCardIdsOverride){const r=this.reviewCardIdsOverride.indexOf(i);r>=0&&this.reviewCardIdsOverride.splice(r,1)}}getCardIds(i,r){const u=this.app.deckData[i];if(!u)return[];switch(r.type){case bt.StudiedCards:{const f=Object.keys(u.schedule).length,c=Math.min(f,r.count),g=Object.keys(u.schedule).map(v=>+v);return Wt.shuffle(g).slice(0,c)}case bt.NewCards:{const f=this.app.getNewCardsCount(i),c=Math.min(f,r.count);return this.app.getNewCards(i).slice(0,c)}case bt.YoungCards:{const c=this.app.getAllNonIgnoredIds(i).filter(v=>this.app.getWenbunCustomState(i,v)===Ln.ReviewYoung),g=Math.min(c.length,r.count);return Wt.shuffle(c).slice(0,g)}case bt.MatureCards:{const c=this.app.getAllNonIgnoredIds(i).filter(v=>this.app.getWenbunCustomState(i,v)===Ln.ReviewMature),g=Math.min(c.length,r.count);return Wt.shuffle(c).slice(0,g)}case bt.Group:{const f=u.groups.find(c=>c.label===r.group);return f?f.cardIds:[]}case bt.HardCards:{const f=Object.keys(u.schedule).length,c=Math.min(f,r.count);return Object.entries(u.schedule).sort((D,L)=>L[1].difficulty-D[1].difficulty).map(D=>+D[0]).slice(0,c)}}}getDescription(i,r){const u=this.app.deckData[i];if(!u)return{desc:"",subdesc:""};switch(r.type){case bt.StudiedCards:{const f=Object.keys(u.schedule).length;return{desc:`Study ${Math.min(f,r.count)} cards`,subdesc:`(out of ${f} cards that have been studied in this deck)`}}case bt.NewCards:{const f=this.app.getNewCardsCount(i);return{desc:`Study the next ${Math.min(f,r.count)} new cards`,subdesc:`(out of ${f} new cards)`}}case bt.YoungCards:{const c=this.app.getAllNonIgnoredIds(i).filter(v=>this.app.getWenbunCustomState(i,v)===Ln.ReviewYoung);return{desc:`Study ${Math.min(c.length,r.count)} young cards`,subdesc:`(out of ${c.length} young cards)`}}case bt.MatureCards:{const c=this.app.getAllNonIgnoredIds(i).filter(v=>this.app.getWenbunCustomState(i,v)===Ln.ReviewMature);return{desc:`Study ${Math.min(c.length,r.count)} mature cards`,subdesc:`(out of ${c.length} mature cards)`}}case bt.Group:{const f=u.groups.find(g=>g.label===r.group);return f?{desc:`Study ${Math.min(f.cardIds.length,r.count)} cards from ${r.group}`,subdesc:`(out of ${f.cardIds.length} cards)`}:{desc:"ERROR: Group Not Found",subdesc:""}}case bt.HardCards:{const f=Object.keys(u.schedule).length;return{desc:`Study ${Math.min(f,r.count)} hardest cards`,subdesc:`(out of ${f} cards that have been studied in this app)`}}}}}const so="https://wenbun-api.photon-ray.xyz";var qt=(d=>(d.Profile="/profile",d.ProfileData="/profiledata",d.ReviewLog="/reviewlog",d.ReviewLogMostRecent="/reviewlog/mostrecent",d.AuthGoogle="/auth/google",d.AuthLogout="/auth/logout",d))(qt||{});function xe(d,i){let r=`${so}${d}`;if(i&&Object.keys(i).length>0){const u=new URLSearchParams;for(const[f,c]of Object.entries(i))u.append(f,String(c));r+=`?${u.toString()}`}return r}function Qu(d){return`${so}${d}`}const Vu="loginStatus";var An=(d=>(d.ask="ask",d.forcePull="forcePull",d.forcePush="forcePush",d.normalPull="normalPull",d.normalPush="normalPush",d))(An||{});class V_{constructor(i){P(this,"isLoggedIn",!1);P(this,"isSyncConflict",!1);P(this,"syncConflictInfo");P(this,"profileInfo",null);P(this,"storedLoginStatus");this.storage=i}async init(){this.storedLoginStatus=await this.storage.load(Vu);const i=await fetch(xe(qt.Profile),{credentials:"include"});if(i.ok){const r=await i.json();this.isLoggedIn=!0,this.profileInfo=r}else i.status===401?this.isLoggedIn=!1:(this.isLoggedIn=!1,console.warn(`Unexpected status: ${i.status}`));await this.checkAndUpdateLoginStatus()}async updateLoginStatus(i){await this.storage.save(Vu,i),this.storedLoginStatus=i}async checkAndUpdateLoginStatus(){if(this.storedLoginStatus===void 0){const i=this.isLoggedIn?"loggedIn":"loggedOut";await this.updateLoginStatus(i)}}async trySyncProfile(i,r="ask"){if(!this.isLoggedIn)return!1;try{const[u,f]=await Promise.all([this.getProfileData(),this.getLatestReviewLog()]);if(u===null)return(await Promise.all([this.updateProfileData(i.exportProfile(!1)),this.pushReviewLog(f,i.reviewLogs,!0)])).every(g=>g)&&(i.lastSyncTime=new Date().toISOString(),await i.updateLastSyncTime()),!1;{const c=new Date(i.meta.modifiedAt??0),g=new Date(u.meta.modifiedAt??0),v=new Date(i.lastSyncTime??0),D=this.getSyncDecision(c,g,v);let L=Wt.isEqual(u,i.exportProfile(!1))?"none":D;switch(L=await this.autoResolveSyncConflict(L,r,i),L){case"conflict":return this.syncConflictInfo={localModifiedAt:c,remoteModifiedAt:g,lastSyncTime:v},this.isSyncConflict=!0,d_.url.pathname.startsWith("/settings")||window.confirm("Sync Failed, Conflict Detected. Do you want to go to settings?")&&c_(`${h_}/settings/`),!1;case"push":return(await Promise.all([this.updateProfileData(i.exportProfile(!1)),this.pushReviewLog(f,i.reviewLogs)])).every(N=>N)?(i.lastSyncTime=new Date().toISOString(),await i.updateLastSyncTime()):window.alert("Failed to push profile data to server"),this.isSyncConflict=!1,!1;case"pull":return(await Promise.all([i.tryImportProfile(u,!1,!0),this.pullReviewLog(i)])).every(N=>N)?(i.lastSyncTime=new Date().toISOString(),await i.updateLastSyncTime()):window.alert("Failed to pull profile data from server"),this.isSyncConflict=!1,!0;case"none":return this.isSyncConflict=!1,!1}}}catch(u){return console.error(u),!1}}async autoResolveSyncConflict(i,r,u){if(i!=="conflict")return i;switch(r){case"ask":return"conflict";case"normalPull":return"pull";case"normalPush":return"push";case"forcePull":return await this.tryForcePull(u),"pull";case"forcePush":return await this.tryForcePush(u),"push"}}async tryForcePull(i){const r=await this.getProfileData(),u=await Promise.all([this.updateProfileData(i.exportProfile(!1),"pull"),this.pullReviewLog(i,!0)]),f=await i.tryImportProfile(r,!1,!0);u.every(c=>c)&&f?(i.lastSyncTime=new Date().toISOString(),await i.updateLastSyncTime(),this.isSyncConflict=!1):window.alert("Failed to pull profile data from server")}async tryForcePush(i){(await Promise.all([this.updateProfileData(i.exportProfile(!1),"push"),this.pushReviewLog(null,i.reviewLogs,!0)])).every(u=>u)?(i.lastSyncTime=new Date().toISOString(),await i.updateLastSyncTime(),this.isSyncConflict=!1):window.alert("Failed to push profile data to server")}getSyncDecision(i,r,u){const f=i>u,c=r>u;return f&&c?"conflict":f?"push":c?"pull":"none"}getName(){var i;return((i=this.profileInfo)==null?void 0:i.name)??"(no name)"}async getProfileData(){const i=await fetch(xe(qt.ProfileData),{credentials:"include"});if(i.status===204)return null;if(i.ok)return await i.json();throw new Error(`Unexpected status: ${i.status}`)}async updateProfileData(i,r="normal"){return(await fetch(xe(qt.ProfileData,{decision:r}),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).ok}async getLatestReviewLog(){const i=await fetch(xe(qt.ReviewLogMostRecent),{credentials:"include"});if(i.status===204)return null;if(i.ok)return await i.json();throw new Error(`Unexpected status: ${i.status}`)}async pushReviewLog(i,r,u=!1){if(i===null||u)return(await fetch(xe(qt.ReviewLog,{force:u}),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).ok;{const f=+new Date(i.log.review),c=r.findLastIndex(D=>{const L=D.log.review;return+new Date(L)<=f}),g=r.slice(c+1);return(await fetch(xe(qt.ReviewLog),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)})).ok}}async pullReviewLog(i,r=!1){try{const u=await this.getReviewLogs(i.reviewLogs,r);return u===null||(r?i.reviewLogs=u:i.reviewLogs.push(...u),i.save(!1)),!0}catch(u){return console.error(u),!1}}async getReviewLogs(i,r=!1){var u;if(r){const f=new Date(0).toISOString(),c=await fetch(xe(qt.ReviewLog,{from:f}),{method:"GET",credentials:"include"});if(c.status===204)return null;if(c.ok)return(await c.json()).map(v=>v.review_log);throw new Error(`Unexpected status: ${c.status}`)}else{const f=i[i.length-1],c=new Date(((u=f==null?void 0:f.log)==null?void 0:u.review)??0).toISOString(),g=await fetch(xe(qt.ReviewLog,{from:c}),{method:"GET",credentials:"include"});if(g.status===204)return null;if(g.ok)return await g.json();throw new Error(`Unexpected status: ${g.status}`)}}async loginGoogle(i){window.location.assign(Qu(qt.AuthGoogle))}async logout(i){await this.updateLoginStatus(void 0),await i.updateLastSyncTime(new Date(0)),window.location.assign(Qu(qt.AuthLogout))}isAutomaticallyLoggedOut(){return!this.isLoggedIn&&this.storedLoginStatus==="loggedIn"}}const j_="__ungrouped__",ju="profile.json",es="decks",ns="deckData",rs="config",is="reviewLogs",ss="autoReviewGradeLog",to="meta",as="lastSyncTime",eo=[R.Again,R.Hard,R.Good,R.Easy],tw=30,no=3;var Ln=(d=>(d.New="New",d.WarmUp="WarmUp",d.Learning="Learning",d.ReviewYoung="Young",d.ReviewMature="Mature",d.Relearning="Relearning",d.PreviouslyStudied="Previously Studied",d.Ignored="Ignored",d))(Ln||{}),ew=(d=>(d.Mix="Mix",d.AfterReviews="After Reviews",d.BeforeReviews="Before Reviews",d))(ew||{}),bt=(d=>(d.StudiedCards="Studied Cards",d.HardCards="Hard Cards",d.NewCards="New Cards",d.YoungCards="Young Cards",d.MatureCards="Mature Cards",d.Group="Group",d))(bt||{});const Dn={newCardPerDay:5,maxReviewsPerDay:200,newCardOrder:"Mix",newPreviouslyStudiedCardPerDay:20,newPreviouslyStudiedCardOrder:"Mix",startPreviouslyStudiedCardFromTheBack:!0,gradeWarmUpCards:!1,uiScale:"normal",customFontSize:16,gradingMethod:"auto",strokeLeniency:1.5,learningSteps:["1m","10m"],previouslyStudiedLearningSteps:["1m","5d"],desiredRetention:.9,enableShortTerm:!1,enableFuzz:!1,FSRSParams:u_,zh:{isColorBasedOnTone:!0,toneColors:a_.Default,alwaysShowReading:!1,mandarinReading:s_.Pinyin,playAudio:!0}};class aw{constructor(){P(this,"decks",[]);P(this,"deckData",{});P(this,"config",Dn);P(this,"reviewLogs",[]);P(this,"autoReviewGradeLog",[]);P(this,"meta",{});P(this,"lastSyncTime",new Date(0).toISOString());P(this,"isLoadDone",!1);P(this,"fsrs");P(this,"fsrsPrevStudied");P(this,"storage");P(this,"fileManager");P(this,"extraStudyHandler");P(this,"profile");this.updateFSRS(),ts()?this.storage=new H_(ju):this.storage=new q_(ju),this.fileManager=new X_,this.extraStudyHandler=new Q_(this),this.profile=new V_(this.storage)}updateFSRS(){const i=this.getConfig(),r=Ar({request_retention:i.desiredRetention,w:i.FSRSParams,enable_fuzz:i.enableFuzz,enable_short_term:i.enableShortTerm,learning_steps:i.learningSteps});this.fsrs=new Ku(r);const u=Ar({request_retention:i.desiredRetention,w:i.FSRSParams,enable_fuzz:i.enableFuzz,enable_short_term:i.enableShortTerm,learning_steps:i.previouslyStudiedLearningSteps});this.fsrsPrevStudied=new Ku(u)}async init(){await this.load(),this.updateFontSize(),this.extraStudyHandler.init(),this.updateFSRS(),this.isNeedToProcessTodaySchedule()&&await this.processTodaySchedule()}async initProfile(){if(await this.profile.init(),this.profile.isLoggedIn){const i=ts()?An.ask:An.normalPull;return await this.profile.trySyncProfile(this,i)}else return!1}async debug(){this.decks=["test"],this.deckData={},this.reviewLogs=[],this.config=Dn,await this.save()}debugSimulate(){let i=bn();const r=this.fsrs,u=f=>{const c=r.repeat(i,i.due);let g={1:"",2:"",3:"",4:""};for(const v of eo){const D=c[v].log.review,L=c[v].card.due;g[v]=Qi(D,L)}console.log(f,g),i=c[f].card};u(R.Again),u(R.Again),u(R.Good),u(R.Good),u(R.Good),u(R.Again)}updateFontSize(){const i=`${this.getFontSizePx()}px`;document.body.style.fontSize=i}getCurrentUIScale(){return this.getFontSizePx()/16}getFontSizePx(){const i=this.getConfig();switch(i.uiScale){case"small":return 10;case"normal":return 16;case"custom":return Wt.clamp(i.customFontSize,8,32)}}async load(){const[i,r,u,f,c,g,v]=await Promise.all([this.storage.load(es),this.storage.load(ns),this.storage.load(rs),this.storage.load(is),this.storage.load(ss),this.storage.load(to),this.storage.load(as)]);this.decks=i||[],this.deckData=r||{},this.config=u||Dn,this.reviewLogs=f||[],this.autoReviewGradeLog=c||[],this.meta=g||{clientVersion:"0.8.2"},this.lastSyncTime=v||new Date(0).toISOString(),this.isLoadDone=!0}async save(i=!1,r=!1,u=!0){if(await this.isDataChanged()&&(this.updateFontSize(),this.meta.modifiedAt=new Date().toISOString(),this.meta._profileVersion=1,u&&(this.meta.clientVersion="0.8.2"),await Promise.all([this.storage.save(es,this.decks),this.storage.save(ns,this.deckData),this.storage.save(rs,this.config),this.storage.save(is,this.reviewLogs),this.storage.save(ss,this.autoReviewGradeLog),this.storage.save(to,this.meta),this.storage.save(as,this.lastSyncTime)]),!i)){const c=ts()?An.ask:An.normalPush;r?await this.profile.trySyncProfile(this,c):this.profile.trySyncProfile(this,c).catch(console.error)}}async updateLastSyncTime(i=new Date){this.lastSyncTime=i.toISOString(),await this.storage.save(as,this.lastSyncTime)}async isDataChanged(){const[i,r,u,f,c]=await Promise.all([this.storage.load(es),this.storage.load(ns),this.storage.load(rs),this.storage.load(is),this.storage.load(ss)]);return!Wt.isEqual(this.decks,i)||!Wt.isEqual(this.deckData,r)||!Wt.isEqual(this.config,u)||!Wt.isEqual(this.reviewLogs,f)||!Wt.isEqual(this.autoReviewGradeLog,c)}exportProfileStr(i=!0){return JSON.stringify(this.exportProfile(i))}async tryImportProfileStr(i,r=!0){try{const u=JSON.parse(i);return this.tryImportProfile(u,r)}catch{return!1}}exportProfile(i=!0){return{config:this.config,decks:this.decks,deckData:this.deckData,reviewLogs:i?this.reviewLogs:[],meta:this.meta}}async tryImportProfile(i,r=!0,u=!1){try{const{config:f,decks:c,deckData:g,reviewLogs:v,meta:D}=i;return this.config=f,this.decks=c,this.deckData=g,r&&(this.reviewLogs=v),this.meta=D,await this.save(u,void 0,!1),!0}catch{return!1}}isNeedToProcessTodaySchedule(){const i=new Date;for(const r of Object.keys(this.deckData)){const u=this.deckData[r];if(new Date(u.lastScheduleCheckDate).getDate()<i.getDate())return!0}return!1}async processTodaySchedule(){const i=new Date,r=xr(i);for(const u of Object.keys(this.deckData)){const f=this.deckData[u];xr(new Date(f.lastScheduleCheckDate))<r&&(f.doneTodayNewCardCount=0,f.doneTodayPreviouslyStudiedCardCount=0,f.doneTodayReviewCount=0,f.lastScheduleCheckDate=i.getTime())}await this.save()}async getInitDeckDataById(i){const r=o_.find(f=>f.id===i),u=await l_((r==null?void 0:r.src)??`${i}.txt`);if(u)return this.getInitDeckData(u,(r==null?void 0:r.tags)??[])}getInitDeckData(i,r){return{deck:i,tags:r,groups:[{label:j_,cardIds:Array.from(i.keys())}],ignoredIds:[],previouslyStudied:[],schedule:{},lastScheduleCheckDate:new Date(0).getTime(),doneTodayNewCardCount:0,doneTodayPreviouslyStudiedCardCount:0,doneTodayReviewCount:0}}async addDeckById(i){const r=await this.getInitDeckDataById(i);if(!r)return Promise.reject(new Error("loading deck failed"));await this.addDeck(i,r)}async addDeck(i,r){this.deckData[i]||(this.deckData[i]=r,!this.decks.includes(i)&&(this.decks.push(i),this.splitDeckIntoGroupOfN(i,tw),await this.save()))}async deleteDeck(i,r=!1){r&&(this.decks.includes(i)&&(this.decks=this.decks.filter(u=>u!=i)),delete this.deckData[i])}isDeckIdExists(i){return this.decks.includes(i)}getConfig(){return Wt.merge({},Dn,this.config)}async resetConfigToDefault(){this.config=Wt.cloneDeep(Dn),await this.save()}async saveConfig(i){this.config=i,await this.save()}rateCard(i,r,u,f){var T,N;this.stopWarmUp(i,r);const c=this.deckData[i],g=this.getCard(i,r,!0);if(!g)return;const L=(((N=(T=this.deckData[i])==null?void 0:T.previouslyStudied)==null?void 0:N.includes(r))?this.fsrsPrevStudied:this.fsrs).repeat(g,f??new Date);this.setCard(i,r,L[u].card),this.pushReviewLog(i,r,L[u].log),c.previouslyStudied.includes(r)?(c.previouslyStudied.splice(c.previouslyStudied.indexOf(r),1),c.doneTodayPreviouslyStudiedCardCount++):g.state===G.New?c.doneTodayNewCardCount++:g.state===G.Review&&c.doneTodayReviewCount++}warmUpNext(i,r){var f;const u=this.deckData[i];u&&((f=u.warmUpIds)==null?void 0:f[r])!==void 0&&u.warmUpIds[r]++}getNextCard(i){if(this.extraStudyHandler.isExtraStudy())return this.extraStudyHandler.getNextCard();const r=this.getConfig(),u=this.getScheduledNewOrWarmUpCardsCount(i),f=this.getScheduledPreviouslyStudiedCardsCount(i),c=this.getScheduledReviewCardsCount(i),g=this.getTotalScheduledNewOrWarmUpTotalCount(i),v=u>0?this.getNewOrWarmUpCard(i):void 0,D=f>0?this.getPreviouslyStudiedCard(i):void 0,L=c>0?this.getTodaysScheduledCards(i)[0]:void 0,T=[],N=[L],ut=[];if(r.newCardOrder==="Before Reviews"&&T.push(v),r.newCardOrder==="After Reviews"&&ut.push(v),r.newPreviouslyStudiedCardOrder==="Before Reviews"&&T.push(D),r.newPreviouslyStudiedCardOrder==="After Reviews"&&ut.push(D),r.newCardOrder==="Mix"){const nt=g/(g+c);Math.random()<nt?N.unshift(v):N.push(v)}if(r.newPreviouslyStudiedCardOrder==="Mix"){const nt=f/(g+f+c);Math.random()<nt?N.unshift(D):N.push(D)}return[...T,...N,...ut].reduce((nt,Zt)=>nt??Zt,void 0)}skipWarmUp(i,r){const u=this.deckData[i];u&&(this.startWarmUp(i,r),u.warmUpIds[r]=no)}startWarmUp(i,r){const u=this.deckData[i];u&&(u.warmUpIds===void 0&&(u.warmUpIds={}),u.warmUpIds[r]=0)}stopWarmUp(i,r){var f;const u=(f=this.deckData[i])==null?void 0:f.warmUpIds;u&&delete u[r]}getWarmUpCount(i,r){var u,f;return(f=(u=this.deckData[i])==null?void 0:u.warmUpIds)==null?void 0:f[r]}getMaxWarmUpCount(){return no}isWarmUpCard(i,r){return this.getWarmUpCount(i,r)!==void 0}getNewOrWarmUpCard(i){const u=this.getScheduledNewOrWarmUpCardsCount(i)-this.getWarmUpCardsCount(i),f=this.getNewCard(i),c=this.deckData[i];if(!c.warmUpIds)return f;const g=Object.keys(c.warmUpIds),v=+g[Math.floor(Math.random()*g.length)];if(u<=0)return v;const D=this.getNewCardsCount(i),L=g.length;if(D+L!==0)return Math.random()<D/(D+L)?f:v}getNewCard(i){return this.getNewCards(i)[0]}getNewCards(i){return this.deckData[i].groups.flatMap(g=>g.cardIds).filter(g=>this.getWenbunCustomState(i,g)==="New")}getPreviouslyStudiedCard(i){var u;const r=this.deckData[i];if(r)return this.getConfig().startPreviouslyStudiedCardFromTheBack?(u=r.previouslyStudied)==null?void 0:u[r.previouslyStudied.length-1]:r.previouslyStudied[0]}getNewCardsCount(i){return this.getNewCards(i).length}getPreviouslyStudiedCardCount(i){var r;return((r=this.deckData[i])==null?void 0:r.previouslyStudied.length)??0}getWarmUpCardsCount(i){var r;return(r=this.deckData[i])!=null&&r.warmUpIds?Object.keys(this.deckData[i].warmUpIds).length:0}pushReviewLog(i,r,u){this.reviewLogs.push({deckId:i,cardId:r,log:u})}setCard(i,r,u){const f=this.deckData[i];f&&(f.schedule[r]=u)}getCard(i,r,u=!1){const f=this.deckData[i];if(f)return u&&f.schedule[r]===void 0?bn():f.schedule[r]}getCardWord(i,r){const u=this.deckData[i];if(!u)return"";const f=u.deck[r];return f||""}getCardDue(i,r){var u;return(u=this.getCard(i,r))==null?void 0:u.due}getCardDueFormatted(i,r){if(this.isWarmUpCard(i,r))return"Warm Up";const u=this.getCardDue(i,r);return u?Qi(new Date,new Date(u)):"Not Started"}getRatingScheduledTimeStr(i,r){var D,L;const u=this.getCard(i,r,!0);let f={1:"",2:"",3:"",4:""};if(!u)return f;const v=(((L=(D=this.deckData[i])==null?void 0:D.previouslyStudied)==null?void 0:L.includes(r))?this.fsrsPrevStudied:this.fsrs).repeat(u,new Date);for(const T of eo){const N=v[T].log.review,ut=v[T].card.due;f[T]=Qi(N,ut)}return f}getWenbunCustomState(i,r){var f,c,g,v,D,L;if(((c=(f=this.deckData[i])==null?void 0:f.warmUpIds)==null?void 0:c[r])!==void 0)return"WarmUp";if((v=(g=this.deckData[i])==null?void 0:g.previouslyStudied)!=null&&v.includes(r))return"Previously Studied";if((L=(D=this.deckData[i])==null?void 0:D.ignoredIds)!=null&&L.includes(r))return"Ignored";const u=this.getCard(i,r);switch(u==null?void 0:u.state){case G.Learning:return"Learning";case G.Review:return u.scheduled_days>=21?"Mature":"Young";case G.Relearning:return"Relearning";case G.New:default:return"New"}}getTodaysReviewCards(i){const r=this.deckData[i];return this.getTodaysScheduledCards(i).filter(c=>{var g;return((g=r.schedule[c])==null?void 0:g.state)===G.Review})}getScheduledReviewCardsCount(i){const r=this.deckData[i],u=this.getTodaysReviewCards(i),f=this.getConfig(),c=Math.min(u.length,f.maxReviewsPerDay-r.doneTodayReviewCount);return Math.max(0,c)}getScheduledNewOrWarmUpCardsCount(i){const r=this.getConfig(),u=this.deckData[i],f=this.getNewCardsCount(i),c=this.getWarmUpCardsCount(i),g=Math.min(f+c,r.newCardPerDay-u.doneTodayNewCardCount);return Math.max(0,g)}getScheduledNewCardsCount(i){return this.getScheduledNewOrWarmUpCardsCount(i)-this.getWarmUpCardsCount(i)}getScheduledPreviouslyStudiedCardsCount(i){const r=this.getConfig(),u=this.deckData[i],f=Math.min(this.getPreviouslyStudiedCardCount(i),r.newPreviouslyStudiedCardPerDay-u.doneTodayPreviouslyStudiedCardCount);return Math.max(0,f)}getLearningRelearningCardsCount(i){const r=this.deckData[i];return Object.entries(r.schedule).filter(([u,f])=>f.state===G.Learning||f.state===G.Relearning).length}getTotalScheduledNewOrWarmUpTotalCount(i){var c;let r=0;const u=this.getMaxWarmUpCount(),f=this.getScheduledNewCardsCount(i);return r+=f*(u+1),(c=this.deckData[i])!=null&&c.warmUpIds&&Object.values(this.deckData[i].warmUpIds).forEach(g=>{const v=u-g+1;r+=v}),r}addPreviouslyStudiedMark(i,r){const u=this.deckData[i];!u||u.previouslyStudied.includes(r)||this.getWenbunCustomState(i,r)!=="New"||u.previouslyStudied.push(r)}removePreviouslyStudiedMark(i,r){const u=this.deckData[i];if(!u)return;const f=u.previouslyStudied.indexOf(r);f<0||u.previouslyStudied.splice(f,1)}ensureIgnoreIdArray(i){const r=this.deckData[i];r&&(r.ignoredIds||(r.ignoredIds=[]))}addIgnoredMark(i,r){var f,c;const u=this.deckData[i];u&&(this.ensureIgnoreIdArray(i),!((f=u.ignoredIds)!=null&&f.includes(r))&&((c=u.ignoredIds)==null||c.push(r)))}removeIgnoredMark(i,r){var c,g;const u=this.deckData[i];if(!u)return;const f=(c=u.ignoredIds)==null?void 0:c.indexOf(r);f==null||f<0||(g=u.ignoredIds)==null||g.splice(f,1)}getTodaysScheduledCards(i){const r=this.deckData[i];if(!r)return[];const f=xr(new Date)+1,c=Object.entries(r.schedule).filter(([g,v])=>{var T;if(!!((T=r.ignoredIds)!=null&&T.includes(+g)))return!1;const L=xr(new Date(v.due));return v.state===G.Review?L<f:!0});return c.sort((g,v)=>new Date(g[1].due).getTime()-new Date(v[1].due).getTime()),c.map(g=>+g[0])}getChineseToneColor(i){if(!i)return;const r=this.getConfig();return r.zh.isColorBasedOnTone?r.zh.toneColors[i-1]:void 0}splitDeckIntoGroupOfN(i,r){const u=this.deckData[i];if(!u)return;const f=Array.from(u.deck.keys()),c=[],g=Math.ceil(f.length/r);for(let v=0;v<g;v++){const D=`group-${v+1}`;c.push({label:D,cardIds:f.slice(v*r,(v+1)*r)})}u.groups=c}getGroupLabels(i){const r=this.deckData[i];return r?r.groups.map(u=>u.label):[]}getAllNonIgnoredIds(i){const r=this.deckData[i];return r?Array.from(r.deck.keys()).filter(f=>{var c;return!((c=r.ignoredIds)!=null&&c.includes(f))}):[]}async downloadProfile(){const i=this.exportProfileStr(),r=new Date().toLocaleDateString("en-CA");await this.fileManager.download({data:i,filename:`wenbun-profile-${r}.txt`,mimeType:"text/plain"})}async tryUploadProfile(){const i=await this.fileManager.upload();return i===null||typeof i.data!="string"?!1:this.tryImportProfileStr(i.data)}getDeckProgress(i){var L;const r=this.deckData[i];if(!r)return{totalCount:1,previouslyStudiedCount:0,youngCount:0,matureCount:0,ignoredCount:0};const u=this.getAllNonIgnoredIds(i),f=r.deck.length,c=r.previouslyStudied.length,g=u.filter(T=>this.getWenbunCustomState(i,T)==="Young").length,v=u.filter(T=>this.getWenbunCustomState(i,T)==="Mature").length,D=((L=r.ignoredIds)==null?void 0:L.length)??0;return{totalCount:f,previouslyStudiedCount:c,youngCount:g,matureCount:v,ignoredCount:D}}getDeckProgressNormalized(i){const r=this.getDeckProgress(i);return{young:r.youngCount/r.totalCount*100,mature:r.matureCount/r.totalCount*100,previouslyStudied:r.previouslyStudiedCount/r.totalCount*100,ignored:r.ignoredCount/r.totalCount*100,rest:(r.totalCount-r.youngCount-r.matureCount-r.previouslyStudiedCount-r.ignoredCount)/r.totalCount*100}}isAutoGrading(){return this.getConfig().gradingMethod==="auto"}storeAutoGradeLog(i,r,u){this.autoReviewGradeLog.push({correctCount:i,mistakeCount:r,grade:u})}getCurrentAppVersion(){return"0.8.2"}isNewUpdateExist(){return f_("0.8.2",this.meta.clientVersion??"0.0.0")}}export{aw as A,tw as D,bt as E,ew as N,Ln as W,Wt as _,R as l};
