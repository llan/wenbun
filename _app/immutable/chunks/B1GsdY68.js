var n_=Object.defineProperty;var r_=(d,i,r)=>i in d?n_(d,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):d[i]=r;var P=(d,i,r)=>r_(d,typeof i!="symbol"?i+"":i,r);import{e as i_,f as s_,h as a_,i as Sr,D as u_,l as o_,j as $u}from"./S7QYTU3w.js";import{g as l_,b as f_}from"./DIKJuRZX.js";import{p as c_}from"./CZscHdP7.js";var W=(d=>(d[d.New=0]="New",d[d.Learning=1]="Learning",d[d.Review=2]="Review",d[d.Relearning=3]="Relearning",d))(W||{}),b=(d=>(d[d.Manual=0]="Manual",d[d.Again=1]="Again",d[d.Hard=2]="Hard",d[d.Good=3]="Good",d[d.Easy=4]="Easy",d))(b||{});class N{static card(i){return{...i,state:N.state(i.state),due:N.time(i.due),last_review:i.last_review?N.time(i.last_review):void 0}}static rating(i){if(typeof i=="string"){const r=i.charAt(0).toUpperCase(),u=i.slice(1).toLowerCase(),f=b[`${r}${u}`];if(f===void 0)throw new Error(`Invalid rating:[${i}]`);return f}else if(typeof i=="number")return i;throw new Error(`Invalid rating:[${i}]`)}static state(i){if(typeof i=="string"){const r=i.charAt(0).toUpperCase(),u=i.slice(1).toLowerCase(),f=W[`${r}${u}`];if(f===void 0)throw new Error(`Invalid state:[${i}]`);return f}else if(typeof i=="number")return i;throw new Error(`Invalid state:[${i}]`)}static time(i){if(typeof i=="object"&&i instanceof Date)return i;if(typeof i=="string"){const r=Date.parse(i);if(isNaN(r))throw new Error(`Invalid date:[${i}]`);return new Date(r)}else if(typeof i=="number")return new Date(i);throw new Error(`Invalid date:[${i}]`)}static review_log(i){return{...i,due:N.time(i.due),rating:N.rating(i.rating),state:N.state(i.state),review:N.time(i.review)}}}Date.prototype.scheduler=function(d,i){return Yt(this,d,i)},Date.prototype.diff=function(d,i){return Xe(this,d,i)},Date.prototype.format=function(){return h_(this)},Date.prototype.dueFormat=function(d,i,r){return d_(this,d,i,r)};function Yt(d,i,r){return new Date(r?N.time(d).getTime()+i*24*60*60*1e3:N.time(d).getTime()+i*60*1e3)}function Xe(d,i,r){if(!d||!i)throw new Error("Invalid date");const u=N.time(d).getTime()-N.time(i).getTime();let f=0;switch(r){case"days":f=Math.floor(u/(24*60*60*1e3));break;case"minutes":f=Math.floor(u/(60*1e3));break}return f}function h_(d){const i=N.time(d),r=i.getFullYear(),u=i.getMonth()+1,f=i.getDate(),c=i.getHours(),p=i.getMinutes(),w=i.getSeconds();return`${r}-${Cn(u)}-${Cn(f)} ${Cn(c)}:${Cn(p)}:${Cn(w)}`}function Cn(d){return d<10?`0${d}`:`${d}`}const Qi=[60,60,24,31,12],Vi=["second","min","hour","day","month","year"];function d_(d,i,r,u=Vi){d=N.time(d),i=N.time(i),u.length!==Vi.length&&(u=Vi);let f=d.getTime()-i.getTime(),c;for(f/=1e3,c=0;c<Qi.length&&!(f<Qi[c]);c++)f/=Qi[c];return`${Math.floor(f)}${r?u[c]:""}`}const g_=Object.freeze([b.Again,b.Hard,b.Good,b.Easy]),p_=[{start:2.5,end:7,factor:.15},{start:7,end:20,factor:.1},{start:20,end:1/0,factor:.05}];function __(d,i,r){let u=1;for(const p of p_)u+=p.factor*Math.max(Math.min(d,p.end)-p.start,0);d=Math.min(d,r);let f=Math.max(2,Math.round(d-u));const c=Math.min(Math.round(d+u),r);return d>i&&(f=Math.max(f,i+1)),f=Math.min(f,c),{min_ivl:f,max_ivl:c}}function vt(d,i,r){return Math.min(Math.max(d,i),r)}function v_(d,i){const r=Date.UTC(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()),u=Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate());return Math.floor((u-r)/864e5)}const w_=.9,y_=36500,m_=!1,S_=!0,x_=Object.freeze(["1m","10m"]),C_=Object.freeze(["10m"]),Kt=.001,xr=100,Hu=.5,D_=.1542,zu=Object.freeze([.212,1.2931,2.3065,8.2956,6.4133,.8334,3.0194,.001,1.8722,.1666,.796,1.4835,.0614,.2629,1.6483,.6014,1.8729,.5425,.0912,.0658,D_]),R_=2,L_=d=>[[Kt,xr],[Kt,xr],[Kt,xr],[Kt,xr],[1,10],[.001,4],[.001,4],[.001,.75],[0,4.5],[0,.8],[.001,3.5],[.001,5],[.001,.25],[.001,.9],[0,4],[0,1],[1,6],[0,d],[0,d],[0,.8],[.1,.8]],us=(d,i)=>{let r=R_;if(Math.max(0,i)>1){const u=-(Math.log(d[11])+Math.log(Math.pow(2,d[13])-1)+d[14]*.3)/i;r=vt(+u.toFixed(8),.01,2)}return L_(r).map(([u,f],c)=>vt(d[c],u,f))},os=d=>{if(d===void 0)return[...zu];switch(d.length){case 21:return[...d];case 19:return console.debug("[FSRS-6]auto fill w from 19 to 21 length"),[...d,0,Hu];case 17:{const i=[...d];return i[4]=+(i[5]*2+i[4]).toFixed(8),i[5]=+(Math.log(i[5]*3+1)/3).toFixed(8),i[6]=+(i[6]+.5).toFixed(8),console.debug("[FSRS-6]auto fill w from 17 to 21 length"),i.concat([0,0,0,Hu])}default:return console.warn("[FSRS]Invalid parameters length, using default parameters"),[...zu]}},Rr=d=>{const i=Array.isArray(d==null?void 0:d.learning_steps)?d.learning_steps:x_,r=Array.isArray(d==null?void 0:d.relearning_steps)?d.relearning_steps:C_,u=us(os(d==null?void 0:d.w),r.length);return{request_retention:(d==null?void 0:d.request_retention)||w_,maximum_interval:(d==null?void 0:d.maximum_interval)||y_,w:u,enable_fuzz:(d==null?void 0:d.enable_fuzz)??m_,enable_short_term:(d==null?void 0:d.enable_short_term)??S_,learning_steps:i,relearning_steps:r}};function Lr(d,i){const r={due:d?N.time(d):new Date,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:0,lapses:0,learning_steps:0,state:W.New,last_review:void 0};return i&&typeof i=="function"?i(r):r}class b_{constructor(i){P(this,"c");P(this,"s0");P(this,"s1");P(this,"s2");const r=A_();this.c=1,this.s0=r(" "),this.s1=r(" "),this.s2=r(" "),i==null&&(i=+new Date),this.s0-=r(i),this.s0<0&&(this.s0+=1),this.s1-=r(i),this.s1<0&&(this.s1+=1),this.s2-=r(i),this.s2<0&&(this.s2+=1)}next(){const i=2091639*this.s0+this.c*23283064365386963e-26;return this.s0=this.s1,this.s1=this.s2,this.s2=i-(this.c=i|0),this.s2}set state(i){this.c=i.c,this.s0=i.s0,this.s1=i.s1,this.s2=i.s2}get state(){return{c:this.c,s0:this.s0,s1:this.s1,s2:this.s2}}}function A_(){let d=4022871197;return function(i){i=String(i);for(let r=0;r<i.length;r++){d+=i.charCodeAt(r);let u=.02519603282416938*d;d=u>>>0,u-=d,u*=d,d=u>>>0,u-=d,d+=u*4294967296}return(d>>>0)*23283064365386963e-26}}function E_(d){const i=new b_(d),r=()=>i.next();return r.int32=()=>i.next()*4294967296|0,r.double=()=>r()+(r()*2097152|0)*11102230246251565e-32,r.state=()=>i.state,r.importState=u=>(i.state=u,r),r}const no=d=>{const i=typeof d=="number"?-d:-d[20],r=Math.exp(Math.pow(i,-1)*Math.log(.9))-1;return{decay:i,factor:+r.toFixed(8)}};function as(d,i,r){const{decay:u,factor:f}=no(d);return+Math.pow(1+f*i/r,u).toFixed(8)}class I_{constructor(i){P(this,"param");P(this,"intervalModifier");P(this,"_seed");P(this,"forgetting_curve");this.param=new Proxy(Rr(i),this.params_handler_proxy()),this.intervalModifier=this.calculate_interval_modifier(this.param.request_retention),this.forgetting_curve=as.bind(this,this.param.w)}get interval_modifier(){return this.intervalModifier}set seed(i){this._seed=i}calculate_interval_modifier(i){if(i<=0||i>1)throw new Error("Requested retention rate should be in the range (0,1]");const{decay:r,factor:u}=no(this.param.w);return+((Math.pow(i,1/r)-1)/u).toFixed(8)}get parameters(){return this.param}set parameters(i){this.update_parameters(i)}params_handler_proxy(){const i=this;return{set:function(r,u,f){return u==="request_retention"&&Number.isFinite(f)?i.intervalModifier=i.calculate_interval_modifier(Number(f)):u==="w"&&(f=us(os(f),r.relearning_steps.length),i.forgetting_curve=as.bind(this,f),i.intervalModifier=i.calculate_interval_modifier(Number(r.request_retention))),Reflect.set(r,u,f),!0}}}update_parameters(i){const r=Rr(i);for(const u in r)if(u in this.param){const f=u;this.param[f]=r[f]}}init_stability(i){return Math.max(this.param.w[i-1],.1)}init_difficulty(i){return+(this.param.w[4]-Math.exp((i-1)*this.param.w[5])+1).toFixed(8)}apply_fuzz(i,r){if(!this.param.enable_fuzz||i<2.5)return Math.round(i);const u=E_(this._seed)(),{min_ivl:f,max_ivl:c}=__(i,r,this.param.maximum_interval);return Math.floor(u*(c-f+1)+f)}next_interval(i,r){const u=Math.min(Math.max(1,Math.round(i*this.intervalModifier)),this.param.maximum_interval);return this.apply_fuzz(u,r)}linear_damping(i,r){return+(i*(10-r)/9).toFixed(8)}next_difficulty(i,r){const u=-this.param.w[6]*(r-3),f=i+this.linear_damping(u,i);return vt(this.mean_reversion(this.init_difficulty(b.Easy),f),1,10)}mean_reversion(i,r){return+(this.param.w[7]*i+(1-this.param.w[7])*r).toFixed(8)}next_recall_stability(i,r,u,f){const c=b.Hard===f?this.param.w[15]:1,p=b.Easy===f?this.param.w[16]:1;return+vt(r*(1+Math.exp(this.param.w[8])*(11-i)*Math.pow(r,-this.param.w[9])*(Math.exp((1-u)*this.param.w[10])-1)*c*p),Kt,36500).toFixed(8)}next_forget_stability(i,r,u){return+vt(this.param.w[11]*Math.pow(i,-this.param.w[12])*(Math.pow(r+1,this.param.w[13])-1)*Math.exp((1-u)*this.param.w[14]),Kt,36500).toFixed(8)}next_short_term_stability(i,r){const u=Math.pow(i,-this.param.w[19])*Math.exp(this.param.w[17]*(r-3+this.param.w[18])),f=r>=3?Math.max(u,1):u;return+vt(i*f,Kt,36500).toFixed(8)}next_state(i,r,u){const{difficulty:f,stability:c}=i??{difficulty:0,stability:0};if(r<0)throw new Error(`Invalid delta_t "${r}"`);if(u<0||u>4)throw new Error(`Invalid grade "${u}"`);if(f===0&&c===0)return{difficulty:vt(this.init_difficulty(u),1,10),stability:this.init_stability(u)};if(u===0)return{difficulty:f,stability:c};if(f<1||c<Kt)throw new Error(`Invalid memory state { difficulty: ${f}, stability: ${c} }`);const p=this.forgetting_curve(r,c),w=this.next_recall_stability(f,c,p,u),D=this.next_forget_stability(f,c,p),L=this.next_short_term_stability(c,u);let I=w;if(u===1){let[G,dt]=[0,0];this.param.enable_short_term&&(G=this.param.w[17],dt=this.param.w[18]);const Z=c/Math.exp(G*dt);I=vt(+Z.toFixed(8),Kt,D)}return r===0&&this.param.enable_short_term&&(I=L),{difficulty:this.next_difficulty(f,u),stability:I}}}function T_(){const d=this.review_time.getTime(),i=this.current.reps,r=this.current.difficulty*this.current.stability;return`${d}_${i}_${r}`}const O_=d=>{const i=d.slice(-1),r=parseInt(d.slice(0,-1),10);if(isNaN(r)||!Number.isFinite(r)||r<0)throw new Error(`Invalid step value: ${d}`);switch(i){case"m":return r;case"h":return r*60;case"d":return r*1440;default:throw new Error(`Invalid step unit: ${d}, expected m/h/d`)}},M_=(d,i,r)=>{const u=i===W.Relearning||i===W.Review?d.relearning_steps:d.learning_steps,f=u.length;if(f===0||r>=f)return{};const c=u[0],p=O_,w=()=>p(c),D=()=>{if(f===1)return Math.round(p(c)*1.5);const Z=u[1];return Math.round((p(c)+p(Z))/2)},L=Z=>Z<0||Z>=f?null:u[Z],I=Z=>p(Z),G={},dt=L(Math.max(0,r));if(i===W.Review)return G[b.Again]={scheduled_minutes:p(dt),next_step:0},G;{G[b.Again]={scheduled_minutes:w(),next_step:0},G[b.Hard]={scheduled_minutes:D(),next_step:r};const Z=L(r+1);if(Z){const ut=I(Z);ut&&(G[b.Good]={scheduled_minutes:Math.round(ut),next_step:r+1})}}return G};var Ar=(d=>(d.SCHEDULER="Scheduler",d.LEARNING_STEPS="LearningSteps",d.SEED="Seed",d))(Ar||{});class ro{constructor(i,r,u,f){P(this,"last");P(this,"current");P(this,"review_time");P(this,"next",new Map);P(this,"algorithm");P(this,"strategies");P(this,"elapsed_days",0);this.algorithm=u,this.last=N.card(i),this.current=N.card(i),this.review_time=N.time(r),this.strategies=f,this.init()}checkGrade(i){if(!Number.isFinite(i)||i<0||i>4)throw new Error(`Invalid grade "${i}",expected 1-4`)}init(){const{state:i,last_review:r}=this.current;let u=0;i!==W.New&&r&&(u=v_(r,this.review_time)),this.current.last_review=this.review_time,this.elapsed_days=u,this.current.elapsed_days=u,this.current.reps+=1;let f=T_;if(this.strategies){const c=this.strategies.get(Ar.SEED);c&&(f=c)}this.algorithm.seed=f.call(this)}preview(){return{[b.Again]:this.review(b.Again),[b.Hard]:this.review(b.Hard),[b.Good]:this.review(b.Good),[b.Easy]:this.review(b.Easy),[Symbol.iterator]:this.previewIterator.bind(this)}}*previewIterator(){for(const i of g_)yield this.review(i)}review(i){const{state:r}=this.last;let u;switch(this.checkGrade(i),r){case W.New:u=this.newState(i);break;case W.Learning:case W.Relearning:u=this.learningState(i);break;case W.Review:u=this.reviewState(i);break}return u}buildLog(i){const{last_review:r,due:u,elapsed_days:f}=this.last;return{rating:i,state:this.current.state,due:r||u,stability:this.current.stability,difficulty:this.current.difficulty,elapsed_days:this.elapsed_days,last_elapsed_days:f,scheduled_days:this.current.scheduled_days,learning_steps:this.current.learning_steps,review:this.review_time}}}class qu extends ro{constructor(r,u,f,c){super(r,u,f,c);P(this,"learningStepsStrategy");let p=M_;if(this.strategies){const w=this.strategies.get(Ar.LEARNING_STEPS);w&&(p=w)}this.learningStepsStrategy=p}getLearningInfo(r,u){var D,L;const f=this.algorithm.parameters;r.learning_steps=r.learning_steps||0;const c=this.learningStepsStrategy(f,r.state,this.current.state===W.Learning?r.learning_steps+1:r.learning_steps),p=Math.max(0,((D=c[u])==null?void 0:D.scheduled_minutes)??0),w=Math.max(0,((L=c[u])==null?void 0:L.next_step)??0);return{scheduled_minutes:p,next_steps:w}}applyLearningSteps(r,u,f){const{scheduled_minutes:c,next_steps:p}=this.getLearningInfo(this.current,u);if(c>0&&c<1440)r.learning_steps=p,r.scheduled_days=0,r.state=f,r.due=Yt(this.review_time,Math.round(c),!1);else if(r.state=W.Review,c>=1440)r.learning_steps=p,r.due=Yt(this.review_time,Math.round(c),!1),r.scheduled_days=Math.floor(c/1440);else{r.learning_steps=0;const w=this.algorithm.next_interval(r.stability,this.elapsed_days);r.scheduled_days=w,r.due=Yt(this.review_time,w,!0)}}newState(r){const u=this.next.get(r);if(u)return u;const f=N.card(this.current);f.difficulty=vt(this.algorithm.init_difficulty(r),1,10),f.stability=this.algorithm.init_stability(r),this.applyLearningSteps(f,r,W.Learning);const c={card:f,log:this.buildLog(r)};return this.next.set(r,c),c}learningState(r){const u=this.next.get(r);if(u)return u;const{state:f,difficulty:c,stability:p}=this.last,w=N.card(this.current);w.difficulty=this.algorithm.next_difficulty(c,r),w.stability=this.algorithm.next_short_term_stability(p,r),this.applyLearningSteps(w,r,f);const D={card:w,log:this.buildLog(r)};return this.next.set(r,D),D}reviewState(r){const u=this.next.get(r);if(u)return u;const f=this.elapsed_days,{difficulty:c,stability:p}=this.last,w=this.algorithm.forgetting_curve(f,p),D=N.card(this.current),L=N.card(this.current),I=N.card(this.current),G=N.card(this.current);this.next_ds(D,L,I,G,c,p,w),this.next_interval(L,I,G,f),this.next_state(L,I,G),this.applyLearningSteps(D,b.Again,W.Relearning),D.lapses+=1;const dt={card:D,log:this.buildLog(b.Again)},Z={card:L,log:super.buildLog(b.Hard)},ut={card:I,log:super.buildLog(b.Good)},ce={card:G,log:super.buildLog(b.Easy)};return this.next.set(b.Again,dt),this.next.set(b.Hard,Z),this.next.set(b.Good,ut),this.next.set(b.Easy,ce),this.next.get(r)}next_ds(r,u,f,c,p,w,D){r.difficulty=this.algorithm.next_difficulty(p,b.Again);const L=w/Math.exp(this.algorithm.parameters.w[17]*this.algorithm.parameters.w[18]),I=this.algorithm.next_forget_stability(p,w,D);r.stability=vt(+L.toFixed(8),Kt,I),u.difficulty=this.algorithm.next_difficulty(p,b.Hard),u.stability=this.algorithm.next_recall_stability(p,w,D,b.Hard),f.difficulty=this.algorithm.next_difficulty(p,b.Good),f.stability=this.algorithm.next_recall_stability(p,w,D,b.Good),c.difficulty=this.algorithm.next_difficulty(p,b.Easy),c.stability=this.algorithm.next_recall_stability(p,w,D,b.Easy)}next_interval(r,u,f,c){let p,w;p=this.algorithm.next_interval(r.stability,c),w=this.algorithm.next_interval(u.stability,c),p=Math.min(p,w),w=Math.max(w,p+1);const D=Math.max(this.algorithm.next_interval(f.stability,c),w+1);r.scheduled_days=p,r.due=Yt(this.review_time,p,!0),u.scheduled_days=w,u.due=Yt(this.review_time,w,!0),f.scheduled_days=D,f.due=Yt(this.review_time,D,!0)}next_state(r,u,f){r.state=W.Review,r.learning_steps=0,u.state=W.Review,u.learning_steps=0,f.state=W.Review,f.learning_steps=0}}class Yu extends ro{newState(i){const r=this.next.get(i);if(r)return r;this.current.scheduled_days=0,this.current.elapsed_days=0;const u=N.card(this.current),f=N.card(this.current),c=N.card(this.current),p=N.card(this.current);return this.init_ds(u,f,c,p),this.next_interval(u,f,c,p,0),this.next_state(u,f,c,p),this.update_next(u,f,c,p),this.next.get(i)}init_ds(i,r,u,f){i.difficulty=vt(this.algorithm.init_difficulty(b.Again),1,10),i.stability=this.algorithm.init_stability(b.Again),r.difficulty=vt(this.algorithm.init_difficulty(b.Hard),1,10),r.stability=this.algorithm.init_stability(b.Hard),u.difficulty=vt(this.algorithm.init_difficulty(b.Good),1,10),u.stability=this.algorithm.init_stability(b.Good),f.difficulty=vt(this.algorithm.init_difficulty(b.Easy),1,10),f.stability=this.algorithm.init_stability(b.Easy)}learningState(i){return this.reviewState(i)}reviewState(i){const r=this.next.get(i);if(r)return r;const u=this.elapsed_days,{difficulty:f,stability:c}=this.last,p=this.algorithm.forgetting_curve(u,c),w=N.card(this.current),D=N.card(this.current),L=N.card(this.current),I=N.card(this.current);return this.next_ds(w,D,L,I,f,c,p),this.next_interval(w,D,L,I,u),this.next_state(w,D,L,I),w.lapses+=1,this.update_next(w,D,L,I),this.next.get(i)}next_ds(i,r,u,f,c,p,w){i.difficulty=this.algorithm.next_difficulty(c,b.Again);const D=this.algorithm.next_forget_stability(c,p,w);i.stability=vt(p,Kt,D),r.difficulty=this.algorithm.next_difficulty(c,b.Hard),r.stability=this.algorithm.next_recall_stability(c,p,w,b.Hard),u.difficulty=this.algorithm.next_difficulty(c,b.Good),u.stability=this.algorithm.next_recall_stability(c,p,w,b.Good),f.difficulty=this.algorithm.next_difficulty(c,b.Easy),f.stability=this.algorithm.next_recall_stability(c,p,w,b.Easy)}next_interval(i,r,u,f,c){let p,w,D,L;p=this.algorithm.next_interval(i.stability,c),w=this.algorithm.next_interval(r.stability,c),D=this.algorithm.next_interval(u.stability,c),L=this.algorithm.next_interval(f.stability,c),p=Math.min(p,w),w=Math.max(w,p+1),D=Math.max(D,w+1),L=Math.max(L,D+1),i.scheduled_days=p,i.due=Yt(this.review_time,p,!0),r.scheduled_days=w,r.due=Yt(this.review_time,w,!0),u.scheduled_days=D,u.due=Yt(this.review_time,D,!0),f.scheduled_days=L,f.due=Yt(this.review_time,L,!0)}next_state(i,r,u,f){i.state=W.Review,i.learning_steps=0,r.state=W.Review,r.learning_steps=0,u.state=W.Review,u.learning_steps=0,f.state=W.Review,f.learning_steps=0}update_next(i,r,u,f){const c={card:i,log:this.buildLog(b.Again)},p={card:r,log:super.buildLog(b.Hard)},w={card:u,log:super.buildLog(b.Good)},D={card:f,log:super.buildLog(b.Easy)};this.next.set(b.Again,c),this.next.set(b.Hard,p),this.next.set(b.Good,w),this.next.set(b.Easy,D)}}class P_{constructor(i){P(this,"fsrs");this.fsrs=i}replay(i,r,u){return this.fsrs.next(i,r,u)}handleManualRating(i,r,u,f,c,p,w){if(typeof r>"u")throw new Error("reschedule: state is required for manual rating");let D,L;if(r===W.New)D={rating:b.Manual,state:r,due:w??u,stability:i.stability,difficulty:i.difficulty,elapsed_days:f,last_elapsed_days:i.elapsed_days,scheduled_days:i.scheduled_days,learning_steps:i.learning_steps,review:u},L=Lr(u),L.last_review=u;else{if(typeof w>"u")throw new Error("reschedule: due is required for manual rating");const I=Xe(w,u,"days");D={rating:b.Manual,state:i.state,due:i.last_review||i.due,stability:i.stability,difficulty:i.difficulty,elapsed_days:f,last_elapsed_days:i.elapsed_days,scheduled_days:i.scheduled_days,learning_steps:i.learning_steps,review:u},L={...i,state:r,due:w,last_review:u,stability:c||i.stability,difficulty:p||i.difficulty,elapsed_days:f,scheduled_days:I,reps:i.reps+1}}return{card:L,log:D}}reschedule(i,r){const u=[];let f=Lr(i.due);for(const c of r){let p;if(c.review=N.time(c.review),c.rating===b.Manual){let w=0;f.state!==W.New&&f.last_review&&(w=Xe(c.review,f.last_review,"days")),p=this.handleManualRating(f,c.state,c.review,w,c.stability,c.difficulty,c.due?N.time(c.due):void 0)}else p=this.replay(f,c.review,c.rating);u.push(p),f=p.card}return u}calculateManualRecord(i,r,u,f){if(!u)return null;const{card:c,log:p}=u,w=N.card(i);return w.due.getTime()===c.due.getTime()?null:(w.scheduled_days=Xe(c.due,w.due,"days"),this.handleManualRating(w,c.state,N.time(r),p.elapsed_days,f?c.stability:void 0,f?c.difficulty:void 0,c.due))}}class Ku extends I_{constructor(r){super(r);P(this,"strategyHandler",new Map);P(this,"Scheduler");const{enable_short_term:u}=this.parameters;this.Scheduler=u?qu:Yu}params_handler_proxy(){const r=this;return{set:function(u,f,c){return f==="request_retention"&&Number.isFinite(c)?r.intervalModifier=r.calculate_interval_modifier(Number(c)):f==="enable_short_term"?r.Scheduler=c===!0?qu:Yu:f==="w"&&(c=us(os(c),u.relearning_steps.length),r.forgetting_curve=as.bind(this,c),r.intervalModifier=r.calculate_interval_modifier(Number(u.request_retention))),Reflect.set(u,f,c),!0}}}useStrategy(r,u){return this.strategyHandler.set(r,u),this}clearStrategy(r){return r?this.strategyHandler.delete(r):this.strategyHandler.clear(),this}getScheduler(r,u){const f=this.strategyHandler.get(Ar.SCHEDULER)||this.Scheduler;return new f(r,u,this,this.strategyHandler)}repeat(r,u,f){const c=this.getScheduler(r,u).preview();return f&&typeof f=="function"?f(c):c}next(r,u,f,c){const p=this.getScheduler(r,u),w=N.rating(f);if(w===b.Manual)throw new Error("Cannot review a manual rating");const D=p.review(w);return c&&typeof c=="function"?c(D):D}get_retrievability(r,u,f=!0){const c=N.card(r);u=u?N.time(u):new Date;const p=c.state!==W.New?Math.max(Xe(u,c.last_review,"days"),0):0,w=c.state!==W.New?this.forgetting_curve(p,+c.stability.toFixed(8)):0;return f?`${(w*100).toFixed(2)}%`:w}rollback(r,u,f){const c=N.card(r),p=N.review_log(u);if(p.rating===b.Manual)throw new Error("Cannot rollback a manual rating");let w,D,L;switch(p.state){case W.New:w=p.due,D=void 0,L=0;break;case W.Learning:case W.Relearning:case W.Review:w=p.review,D=p.due,L=c.lapses-(p.rating===b.Again&&p.state===W.Review?1:0);break}const I={...c,due:w,stability:p.stability,difficulty:p.difficulty,elapsed_days:p.last_elapsed_days,scheduled_days:p.scheduled_days,reps:Math.max(0,c.reps-1),lapses:Math.max(0,L),learning_steps:p.learning_steps,state:p.state,last_review:D};return f&&typeof f=="function"?f(I):I}forget(r,u,f=!1,c){const p=N.card(r);u=N.time(u);const w=p.state===W.New?0:Xe(u,p.due,"days"),D={rating:b.Manual,state:p.state,due:p.due,stability:p.stability,difficulty:p.difficulty,elapsed_days:0,last_elapsed_days:p.elapsed_days,scheduled_days:w,learning_steps:p.learning_steps,review:u},L={card:{...p,due:u,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:f?0:p.reps,lapses:f?0:p.lapses,learning_steps:0,state:W.New,last_review:p.last_review},log:D};return c&&typeof c=="function"?c(L):L}reschedule(r,u=[],f={}){const{recordLogHandler:c,reviewsOrderBy:p,skipManual:w=!0,now:D=new Date,update_memory_state:L=!1}=f;p&&typeof p=="function"&&u.sort(p),w&&(u=u.filter(ce=>ce.rating!==b.Manual));const I=new P_(this),G=I.reschedule(f.first_card||Lr(),u),dt=G.length,Z=N.card(r),ut=I.calculateManualRecord(Z,D,dt?G[dt-1]:void 0,L);return c&&typeof c=="function"?{collections:G.map(c),reschedule_item:ut?c(ut):null}:{collections:G,reschedule_item:ut}}}function N_(d,i,r,u){if(typeof i=="function"?d!==i||!u:!i.has(d))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?u:r==="a"?u.call(d):u?u.value:i.get(d)}function U_(d,i,r,u,f){if(typeof i=="function"?d!==i||!0:!i.has(d))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i.set(d,r),r}var Dr;function F_(d,i=!1){return window.__TAURI_INTERNALS__.transformCallback(d,i)}async function ft(d,i={},r){return window.__TAURI_INTERNALS__.invoke(d,i,r)}class W_{get rid(){return N_(this,Dr,"f")}constructor(i){Dr.set(this,void 0),U_(this,Dr,i)}async close(){return ft("plugin:resources|close",{rid:this.rid})}}Dr=new WeakMap;function ji(){return!!(globalThis||window).isTauri}var Zu;(function(d){d.WINDOW_RESIZED="tauri://resize",d.WINDOW_MOVED="tauri://move",d.WINDOW_CLOSE_REQUESTED="tauri://close-requested",d.WINDOW_DESTROYED="tauri://destroyed",d.WINDOW_FOCUS="tauri://focus",d.WINDOW_BLUR="tauri://blur",d.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",d.WINDOW_THEME_CHANGED="tauri://theme-changed",d.WINDOW_CREATED="tauri://window-created",d.WEBVIEW_CREATED="tauri://webview-created",d.DRAG_ENTER="tauri://drag-enter",d.DRAG_OVER="tauri://drag-over",d.DRAG_DROP="tauri://drag-drop",d.DRAG_LEAVE="tauri://drag-leave"})(Zu||(Zu={}));async function G_(d,i){window.__TAURI_EVENT_PLUGIN_INTERNALS__.unregisterListener(d,i),await ft("plugin:event|unlisten",{event:d,eventId:i})}async function Ju(d,i,r){var u;const f=(u=void 0)!==null&&u!==void 0?u:{kind:"Any"};return ft("plugin:event|listen",{event:d,target:f,handler:F_(i)}).then(c=>async()=>G_(d,c))}async function B_(d,i){return await br.load(d,i)}class br extends W_{constructor(i){super(i)}static async load(i,r){const u=await ft("plugin:store|load",{path:i,...r});return new br(u)}static async get(i){return await ft("plugin:store|get_store",{path:i}).then(r=>r?new br(r):null)}async set(i,r){await ft("plugin:store|set",{rid:this.rid,key:i,value:r})}async get(i){const[r,u]=await ft("plugin:store|get",{rid:this.rid,key:i});return u?r:void 0}async has(i){return await ft("plugin:store|has",{rid:this.rid,key:i})}async delete(i){return await ft("plugin:store|delete",{rid:this.rid,key:i})}async clear(){await ft("plugin:store|clear",{rid:this.rid})}async reset(){await ft("plugin:store|reset",{rid:this.rid})}async keys(){return await ft("plugin:store|keys",{rid:this.rid})}async values(){return await ft("plugin:store|values",{rid:this.rid})}async entries(){return await ft("plugin:store|entries",{rid:this.rid})}async length(){return await ft("plugin:store|length",{rid:this.rid})}async reload(){await ft("plugin:store|reload",{rid:this.rid})}async save(){await ft("plugin:store|save",{rid:this.rid})}async onKeyChange(i,r){return await Ju("store://change",u=>{u.payload.resourceId===this.rid&&u.payload.key===i&&r(u.payload.exists?u.payload.value:void 0)})}async onChange(i){return await Ju("store://change",r=>{r.payload.resourceId===this.rid&&i(r.payload.key,r.payload.exists?r.payload.value:void 0)})}}class k_{constructor(i){P(this,"storeFilename");P(this,"store",null);P(this,"isLoaded",!1);this.storeFilename=i}async ensureStoreLoaded(){this.isLoaded||(this.store=await B_(this.storeFilename,{autoSave:!1}),this.isLoaded=!0)}async load(i){if(await this.ensureStoreLoaded(),!!this.store)return await this.store.get(i)}async save(i,r){await this.ensureStoreLoaded(),this.store&&await this.store.set(i,r)}}const $_="wenbun-deck-manager";class H_{constructor(i){P(this,"storeName");P(this,"db");this.storeName=i}async ensureDBLoaded(){return this.db?new Promise(i=>i()):new Promise((i,r)=>{const u=window.indexedDB.open($_,1);u.onupgradeneeded=()=>{const f=u.result;f.objectStoreNames.contains(this.storeName)||f.createObjectStore(this.storeName)},u.onsuccess=()=>{this.db=u.result,i()},u.onerror=f=>{window.alert("Error opening database"),r(f)}})}async load(i){return await this.ensureDBLoaded(),new Promise((r,u)=>{if(!this.db)return r(void 0);const p=this.db.transaction(this.storeName,"readonly").objectStore(this.storeName).get(i);p.onsuccess=()=>r(p.result),p.onerror=()=>u(p.error)})}async save(i,r){return await this.ensureDBLoaded(),new Promise((u,f)=>{if(!this.db)return u();const w=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(r,i);w.onsuccess=()=>u(),w.onerror=()=>f(w.error)})}}var Cr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function z_(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var Rn={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */var q_=Rn.exports,Xu;function Y_(){return Xu||(Xu=1,function(d,i){(function(){var r,u="4.17.21",f=200,c="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",p="Expected a function",w="Invalid `variable` option passed into `_.template`",D="__lodash_hash_undefined__",L=500,I="__lodash_placeholder__",G=1,dt=2,Z=4,ut=1,ce=2,Wt=1,Me=2,ls=4,Vt=8,Qe=16,jt=32,Ve=64,te=128,je=256,Er=512,so=30,ao="...",uo=800,oo=16,fs=1,lo=2,fo=3,Ce=1/0,he=9007199254740991,co=17976931348623157e292,An=NaN,Zt=4294967295,ho=Zt-1,go=Zt>>>1,po=[["ary",te],["bind",Wt],["bindKey",Me],["curry",Vt],["curryRight",Qe],["flip",Er],["partial",jt],["partialRight",Ve],["rearg",je]],Pe="[object Arguments]",En="[object Array]",_o="[object AsyncFunction]",tn="[object Boolean]",en="[object Date]",vo="[object DOMException]",In="[object Error]",Tn="[object Function]",cs="[object GeneratorFunction]",Gt="[object Map]",nn="[object Number]",wo="[object Null]",ee="[object Object]",hs="[object Promise]",yo="[object Proxy]",rn="[object RegExp]",Bt="[object Set]",sn="[object String]",On="[object Symbol]",mo="[object Undefined]",an="[object WeakMap]",So="[object WeakSet]",un="[object ArrayBuffer]",Ne="[object DataView]",Ir="[object Float32Array]",Tr="[object Float64Array]",Or="[object Int8Array]",Mr="[object Int16Array]",Pr="[object Int32Array]",Nr="[object Uint8Array]",Ur="[object Uint8ClampedArray]",Fr="[object Uint16Array]",Wr="[object Uint32Array]",xo=/\b__p \+= '';/g,Co=/\b(__p \+=) '' \+/g,Do=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ds=/&(?:amp|lt|gt|quot|#39);/g,gs=/[&<>"']/g,Ro=RegExp(ds.source),Lo=RegExp(gs.source),bo=/<%-([\s\S]+?)%>/g,Ao=/<%([\s\S]+?)%>/g,ps=/<%=([\s\S]+?)%>/g,Eo=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Io=/^\w*$/,To=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Gr=/[\\^$.*+?()[\]{}|]/g,Oo=RegExp(Gr.source),Br=/^\s+/,Mo=/\s/,Po=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,No=/\{\n\/\* \[wrapped with (.+)\] \*/,Uo=/,? & /,Fo=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Wo=/[()=,{}\[\]\/\s]/,Go=/\\(\\)?/g,Bo=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,_s=/\w*$/,ko=/^[-+]0x[0-9a-f]+$/i,$o=/^0b[01]+$/i,Ho=/^\[object .+?Constructor\]$/,zo=/^0o[0-7]+$/i,qo=/^(?:0|[1-9]\d*)$/,Yo=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Mn=/($^)/,Ko=/['\n\r\u2028\u2029\\]/g,Pn="\\ud800-\\udfff",Zo="\\u0300-\\u036f",Jo="\\ufe20-\\ufe2f",Xo="\\u20d0-\\u20ff",vs=Zo+Jo+Xo,ws="\\u2700-\\u27bf",ys="a-z\\xdf-\\xf6\\xf8-\\xff",Qo="\\xac\\xb1\\xd7\\xf7",Vo="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",jo="\\u2000-\\u206f",tl=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ms="A-Z\\xc0-\\xd6\\xd8-\\xde",Ss="\\ufe0e\\ufe0f",xs=Qo+Vo+jo+tl,kr="['’]",el="["+Pn+"]",Cs="["+xs+"]",Nn="["+vs+"]",Ds="\\d+",nl="["+ws+"]",Rs="["+ys+"]",Ls="[^"+Pn+xs+Ds+ws+ys+ms+"]",$r="\\ud83c[\\udffb-\\udfff]",rl="(?:"+Nn+"|"+$r+")",bs="[^"+Pn+"]",Hr="(?:\\ud83c[\\udde6-\\uddff]){2}",zr="[\\ud800-\\udbff][\\udc00-\\udfff]",Ue="["+ms+"]",As="\\u200d",Es="(?:"+Rs+"|"+Ls+")",il="(?:"+Ue+"|"+Ls+")",Is="(?:"+kr+"(?:d|ll|m|re|s|t|ve))?",Ts="(?:"+kr+"(?:D|LL|M|RE|S|T|VE))?",Os=rl+"?",Ms="["+Ss+"]?",sl="(?:"+As+"(?:"+[bs,Hr,zr].join("|")+")"+Ms+Os+")*",al="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ul="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ps=Ms+Os+sl,ol="(?:"+[nl,Hr,zr].join("|")+")"+Ps,ll="(?:"+[bs+Nn+"?",Nn,Hr,zr,el].join("|")+")",fl=RegExp(kr,"g"),cl=RegExp(Nn,"g"),qr=RegExp($r+"(?="+$r+")|"+ll+Ps,"g"),hl=RegExp([Ue+"?"+Rs+"+"+Is+"(?="+[Cs,Ue,"$"].join("|")+")",il+"+"+Ts+"(?="+[Cs,Ue+Es,"$"].join("|")+")",Ue+"?"+Es+"+"+Is,Ue+"+"+Ts,ul,al,Ds,ol].join("|"),"g"),dl=RegExp("["+As+Pn+vs+Ss+"]"),gl=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,pl=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],_l=-1,V={};V[Ir]=V[Tr]=V[Or]=V[Mr]=V[Pr]=V[Nr]=V[Ur]=V[Fr]=V[Wr]=!0,V[Pe]=V[En]=V[un]=V[tn]=V[Ne]=V[en]=V[In]=V[Tn]=V[Gt]=V[nn]=V[ee]=V[rn]=V[Bt]=V[sn]=V[an]=!1;var Q={};Q[Pe]=Q[En]=Q[un]=Q[Ne]=Q[tn]=Q[en]=Q[Ir]=Q[Tr]=Q[Or]=Q[Mr]=Q[Pr]=Q[Gt]=Q[nn]=Q[ee]=Q[rn]=Q[Bt]=Q[sn]=Q[On]=Q[Nr]=Q[Ur]=Q[Fr]=Q[Wr]=!0,Q[In]=Q[Tn]=Q[an]=!1;var vl={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},wl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},yl={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},ml={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Sl=parseFloat,xl=parseInt,Ns=typeof Cr=="object"&&Cr&&Cr.Object===Object&&Cr,Cl=typeof self=="object"&&self&&self.Object===Object&&self,ot=Ns||Cl||Function("return this")(),Yr=i&&!i.nodeType&&i,De=Yr&&!0&&d&&!d.nodeType&&d,Us=De&&De.exports===Yr,Kr=Us&&Ns.process,Et=function(){try{var _=De&&De.require&&De.require("util").types;return _||Kr&&Kr.binding&&Kr.binding("util")}catch{}}(),Fs=Et&&Et.isArrayBuffer,Ws=Et&&Et.isDate,Gs=Et&&Et.isMap,Bs=Et&&Et.isRegExp,ks=Et&&Et.isSet,$s=Et&&Et.isTypedArray;function xt(_,m,y){switch(y.length){case 0:return _.call(m);case 1:return _.call(m,y[0]);case 2:return _.call(m,y[0],y[1]);case 3:return _.call(m,y[0],y[1],y[2])}return _.apply(m,y)}function Dl(_,m,y,A){for(var U=-1,Y=_==null?0:_.length;++U<Y;){var it=_[U];m(A,it,y(it),_)}return A}function It(_,m){for(var y=-1,A=_==null?0:_.length;++y<A&&m(_[y],y,_)!==!1;);return _}function Rl(_,m){for(var y=_==null?0:_.length;y--&&m(_[y],y,_)!==!1;);return _}function Hs(_,m){for(var y=-1,A=_==null?0:_.length;++y<A;)if(!m(_[y],y,_))return!1;return!0}function de(_,m){for(var y=-1,A=_==null?0:_.length,U=0,Y=[];++y<A;){var it=_[y];m(it,y,_)&&(Y[U++]=it)}return Y}function Un(_,m){var y=_==null?0:_.length;return!!y&&Fe(_,m,0)>-1}function Zr(_,m,y){for(var A=-1,U=_==null?0:_.length;++A<U;)if(y(m,_[A]))return!0;return!1}function j(_,m){for(var y=-1,A=_==null?0:_.length,U=Array(A);++y<A;)U[y]=m(_[y],y,_);return U}function ge(_,m){for(var y=-1,A=m.length,U=_.length;++y<A;)_[U+y]=m[y];return _}function Jr(_,m,y,A){var U=-1,Y=_==null?0:_.length;for(A&&Y&&(y=_[++U]);++U<Y;)y=m(y,_[U],U,_);return y}function Ll(_,m,y,A){var U=_==null?0:_.length;for(A&&U&&(y=_[--U]);U--;)y=m(y,_[U],U,_);return y}function Xr(_,m){for(var y=-1,A=_==null?0:_.length;++y<A;)if(m(_[y],y,_))return!0;return!1}var bl=Qr("length");function Al(_){return _.split("")}function El(_){return _.match(Fo)||[]}function zs(_,m,y){var A;return y(_,function(U,Y,it){if(m(U,Y,it))return A=Y,!1}),A}function Fn(_,m,y,A){for(var U=_.length,Y=y+(A?1:-1);A?Y--:++Y<U;)if(m(_[Y],Y,_))return Y;return-1}function Fe(_,m,y){return m===m?kl(_,m,y):Fn(_,qs,y)}function Il(_,m,y,A){for(var U=y-1,Y=_.length;++U<Y;)if(A(_[U],m))return U;return-1}function qs(_){return _!==_}function Ys(_,m){var y=_==null?0:_.length;return y?jr(_,m)/y:An}function Qr(_){return function(m){return m==null?r:m[_]}}function Vr(_){return function(m){return _==null?r:_[m]}}function Ks(_,m,y,A,U){return U(_,function(Y,it,X){y=A?(A=!1,Y):m(y,Y,it,X)}),y}function Tl(_,m){var y=_.length;for(_.sort(m);y--;)_[y]=_[y].value;return _}function jr(_,m){for(var y,A=-1,U=_.length;++A<U;){var Y=m(_[A]);Y!==r&&(y=y===r?Y:y+Y)}return y}function ti(_,m){for(var y=-1,A=Array(_);++y<_;)A[y]=m(y);return A}function Ol(_,m){return j(m,function(y){return[y,_[y]]})}function Zs(_){return _&&_.slice(0,Vs(_)+1).replace(Br,"")}function Ct(_){return function(m){return _(m)}}function ei(_,m){return j(m,function(y){return _[y]})}function on(_,m){return _.has(m)}function Js(_,m){for(var y=-1,A=_.length;++y<A&&Fe(m,_[y],0)>-1;);return y}function Xs(_,m){for(var y=_.length;y--&&Fe(m,_[y],0)>-1;);return y}function Ml(_,m){for(var y=_.length,A=0;y--;)_[y]===m&&++A;return A}var Pl=Vr(vl),Nl=Vr(wl);function Ul(_){return"\\"+ml[_]}function Fl(_,m){return _==null?r:_[m]}function We(_){return dl.test(_)}function Wl(_){return gl.test(_)}function Gl(_){for(var m,y=[];!(m=_.next()).done;)y.push(m.value);return y}function ni(_){var m=-1,y=Array(_.size);return _.forEach(function(A,U){y[++m]=[U,A]}),y}function Qs(_,m){return function(y){return _(m(y))}}function pe(_,m){for(var y=-1,A=_.length,U=0,Y=[];++y<A;){var it=_[y];(it===m||it===I)&&(_[y]=I,Y[U++]=y)}return Y}function Wn(_){var m=-1,y=Array(_.size);return _.forEach(function(A){y[++m]=A}),y}function Bl(_){var m=-1,y=Array(_.size);return _.forEach(function(A){y[++m]=[A,A]}),y}function kl(_,m,y){for(var A=y-1,U=_.length;++A<U;)if(_[A]===m)return A;return-1}function $l(_,m,y){for(var A=y+1;A--;)if(_[A]===m)return A;return A}function Ge(_){return We(_)?zl(_):bl(_)}function kt(_){return We(_)?ql(_):Al(_)}function Vs(_){for(var m=_.length;m--&&Mo.test(_.charAt(m)););return m}var Hl=Vr(yl);function zl(_){for(var m=qr.lastIndex=0;qr.test(_);)++m;return m}function ql(_){return _.match(qr)||[]}function Yl(_){return _.match(hl)||[]}var Kl=function _(m){m=m==null?ot:Be.defaults(ot.Object(),m,Be.pick(ot,pl));var y=m.Array,A=m.Date,U=m.Error,Y=m.Function,it=m.Math,X=m.Object,ri=m.RegExp,Zl=m.String,Tt=m.TypeError,Gn=y.prototype,Jl=Y.prototype,ke=X.prototype,Bn=m["__core-js_shared__"],kn=Jl.toString,J=ke.hasOwnProperty,Xl=0,js=function(){var t=/[^.]+$/.exec(Bn&&Bn.keys&&Bn.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),$n=ke.toString,Ql=kn.call(X),Vl=ot._,jl=ri("^"+kn.call(J).replace(Gr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Hn=Us?m.Buffer:r,_e=m.Symbol,zn=m.Uint8Array,ta=Hn?Hn.allocUnsafe:r,qn=Qs(X.getPrototypeOf,X),ea=X.create,na=ke.propertyIsEnumerable,Yn=Gn.splice,ra=_e?_e.isConcatSpreadable:r,ln=_e?_e.iterator:r,Re=_e?_e.toStringTag:r,Kn=function(){try{var t=Ie(X,"defineProperty");return t({},"",{}),t}catch{}}(),tf=m.clearTimeout!==ot.clearTimeout&&m.clearTimeout,ef=A&&A.now!==ot.Date.now&&A.now,nf=m.setTimeout!==ot.setTimeout&&m.setTimeout,Zn=it.ceil,Jn=it.floor,ii=X.getOwnPropertySymbols,rf=Hn?Hn.isBuffer:r,ia=m.isFinite,sf=Gn.join,af=Qs(X.keys,X),st=it.max,ct=it.min,uf=A.now,of=m.parseInt,sa=it.random,lf=Gn.reverse,si=Ie(m,"DataView"),fn=Ie(m,"Map"),ai=Ie(m,"Promise"),$e=Ie(m,"Set"),cn=Ie(m,"WeakMap"),hn=Ie(X,"create"),Xn=cn&&new cn,He={},ff=Te(si),cf=Te(fn),hf=Te(ai),df=Te($e),gf=Te(cn),Qn=_e?_e.prototype:r,dn=Qn?Qn.valueOf:r,aa=Qn?Qn.toString:r;function o(t){if(et(t)&&!F(t)&&!(t instanceof z)){if(t instanceof Ot)return t;if(J.call(t,"__wrapped__"))return uu(t)}return new Ot(t)}var ze=function(){function t(){}return function(e){if(!tt(e))return{};if(ea)return ea(e);t.prototype=e;var n=new t;return t.prototype=r,n}}();function Vn(){}function Ot(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=r}o.templateSettings={escape:bo,evaluate:Ao,interpolate:ps,variable:"",imports:{_:o}},o.prototype=Vn.prototype,o.prototype.constructor=o,Ot.prototype=ze(Vn.prototype),Ot.prototype.constructor=Ot;function z(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Zt,this.__views__=[]}function pf(){var t=new z(this.__wrapped__);return t.__actions__=wt(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=wt(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=wt(this.__views__),t}function _f(){if(this.__filtered__){var t=new z(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function vf(){var t=this.__wrapped__.value(),e=this.__dir__,n=F(t),s=e<0,a=n?t.length:0,l=Ec(0,a,this.__views__),h=l.start,g=l.end,v=g-h,S=s?g:h-1,x=this.__iteratees__,C=x.length,R=0,E=ct(v,this.__takeCount__);if(!n||!s&&a==v&&E==v)return Ia(t,this.__actions__);var O=[];t:for(;v--&&R<E;){S+=e;for(var k=-1,M=t[S];++k<C;){var H=x[k],q=H.iteratee,Lt=H.type,_t=q(M);if(Lt==lo)M=_t;else if(!_t){if(Lt==fs)continue t;break t}}O[R++]=M}return O}z.prototype=ze(Vn.prototype),z.prototype.constructor=z;function Le(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var s=t[e];this.set(s[0],s[1])}}function wf(){this.__data__=hn?hn(null):{},this.size=0}function yf(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function mf(t){var e=this.__data__;if(hn){var n=e[t];return n===D?r:n}return J.call(e,t)?e[t]:r}function Sf(t){var e=this.__data__;return hn?e[t]!==r:J.call(e,t)}function xf(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=hn&&e===r?D:e,this}Le.prototype.clear=wf,Le.prototype.delete=yf,Le.prototype.get=mf,Le.prototype.has=Sf,Le.prototype.set=xf;function ne(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var s=t[e];this.set(s[0],s[1])}}function Cf(){this.__data__=[],this.size=0}function Df(t){var e=this.__data__,n=jn(e,t);if(n<0)return!1;var s=e.length-1;return n==s?e.pop():Yn.call(e,n,1),--this.size,!0}function Rf(t){var e=this.__data__,n=jn(e,t);return n<0?r:e[n][1]}function Lf(t){return jn(this.__data__,t)>-1}function bf(t,e){var n=this.__data__,s=jn(n,t);return s<0?(++this.size,n.push([t,e])):n[s][1]=e,this}ne.prototype.clear=Cf,ne.prototype.delete=Df,ne.prototype.get=Rf,ne.prototype.has=Lf,ne.prototype.set=bf;function re(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var s=t[e];this.set(s[0],s[1])}}function Af(){this.size=0,this.__data__={hash:new Le,map:new(fn||ne),string:new Le}}function Ef(t){var e=cr(this,t).delete(t);return this.size-=e?1:0,e}function If(t){return cr(this,t).get(t)}function Tf(t){return cr(this,t).has(t)}function Of(t,e){var n=cr(this,t),s=n.size;return n.set(t,e),this.size+=n.size==s?0:1,this}re.prototype.clear=Af,re.prototype.delete=Ef,re.prototype.get=If,re.prototype.has=Tf,re.prototype.set=Of;function be(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new re;++e<n;)this.add(t[e])}function Mf(t){return this.__data__.set(t,D),this}function Pf(t){return this.__data__.has(t)}be.prototype.add=be.prototype.push=Mf,be.prototype.has=Pf;function $t(t){var e=this.__data__=new ne(t);this.size=e.size}function Nf(){this.__data__=new ne,this.size=0}function Uf(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function Ff(t){return this.__data__.get(t)}function Wf(t){return this.__data__.has(t)}function Gf(t,e){var n=this.__data__;if(n instanceof ne){var s=n.__data__;if(!fn||s.length<f-1)return s.push([t,e]),this.size=++n.size,this;n=this.__data__=new re(s)}return n.set(t,e),this.size=n.size,this}$t.prototype.clear=Nf,$t.prototype.delete=Uf,$t.prototype.get=Ff,$t.prototype.has=Wf,$t.prototype.set=Gf;function ua(t,e){var n=F(t),s=!n&&Oe(t),a=!n&&!s&&Se(t),l=!n&&!s&&!a&&Ze(t),h=n||s||a||l,g=h?ti(t.length,Zl):[],v=g.length;for(var S in t)(e||J.call(t,S))&&!(h&&(S=="length"||a&&(S=="offset"||S=="parent")||l&&(S=="buffer"||S=="byteLength"||S=="byteOffset")||ue(S,v)))&&g.push(S);return g}function oa(t){var e=t.length;return e?t[vi(0,e-1)]:r}function Bf(t,e){return hr(wt(t),Ae(e,0,t.length))}function kf(t){return hr(wt(t))}function ui(t,e,n){(n!==r&&!Ht(t[e],n)||n===r&&!(e in t))&&ie(t,e,n)}function gn(t,e,n){var s=t[e];(!(J.call(t,e)&&Ht(s,n))||n===r&&!(e in t))&&ie(t,e,n)}function jn(t,e){for(var n=t.length;n--;)if(Ht(t[n][0],e))return n;return-1}function $f(t,e,n,s){return ve(t,function(a,l,h){e(s,a,n(a),h)}),s}function la(t,e){return t&&Xt(e,at(e),t)}function Hf(t,e){return t&&Xt(e,mt(e),t)}function ie(t,e,n){e=="__proto__"&&Kn?Kn(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function oi(t,e){for(var n=-1,s=e.length,a=y(s),l=t==null;++n<s;)a[n]=l?r:$i(t,e[n]);return a}function Ae(t,e,n){return t===t&&(n!==r&&(t=t<=n?t:n),e!==r&&(t=t>=e?t:e)),t}function Mt(t,e,n,s,a,l){var h,g=e&G,v=e&dt,S=e&Z;if(n&&(h=a?n(t,s,a,l):n(t)),h!==r)return h;if(!tt(t))return t;var x=F(t);if(x){if(h=Tc(t),!g)return wt(t,h)}else{var C=ht(t),R=C==Tn||C==cs;if(Se(t))return Ma(t,g);if(C==ee||C==Pe||R&&!a){if(h=v||R?{}:Va(t),!g)return v?mc(t,Hf(h,t)):yc(t,la(h,t))}else{if(!Q[C])return a?t:{};h=Oc(t,C,g)}}l||(l=new $t);var E=l.get(t);if(E)return E;l.set(t,h),bu(t)?t.forEach(function(M){h.add(Mt(M,e,n,M,t,l))}):Ru(t)&&t.forEach(function(M,H){h.set(H,Mt(M,e,n,H,t,l))});var O=S?v?Ai:bi:v?mt:at,k=x?r:O(t);return It(k||t,function(M,H){k&&(H=M,M=t[H]),gn(h,H,Mt(M,e,n,H,t,l))}),h}function zf(t){var e=at(t);return function(n){return fa(n,t,e)}}function fa(t,e,n){var s=n.length;if(t==null)return!s;for(t=X(t);s--;){var a=n[s],l=e[a],h=t[a];if(h===r&&!(a in t)||!l(h))return!1}return!0}function ca(t,e,n){if(typeof t!="function")throw new Tt(p);return Sn(function(){t.apply(r,n)},e)}function pn(t,e,n,s){var a=-1,l=Un,h=!0,g=t.length,v=[],S=e.length;if(!g)return v;n&&(e=j(e,Ct(n))),s?(l=Zr,h=!1):e.length>=f&&(l=on,h=!1,e=new be(e));t:for(;++a<g;){var x=t[a],C=n==null?x:n(x);if(x=s||x!==0?x:0,h&&C===C){for(var R=S;R--;)if(e[R]===C)continue t;v.push(x)}else l(e,C,s)||v.push(x)}return v}var ve=Wa(Jt),ha=Wa(fi,!0);function qf(t,e){var n=!0;return ve(t,function(s,a,l){return n=!!e(s,a,l),n}),n}function tr(t,e,n){for(var s=-1,a=t.length;++s<a;){var l=t[s],h=e(l);if(h!=null&&(g===r?h===h&&!Rt(h):n(h,g)))var g=h,v=l}return v}function Yf(t,e,n,s){var a=t.length;for(n=B(n),n<0&&(n=-n>a?0:a+n),s=s===r||s>a?a:B(s),s<0&&(s+=a),s=n>s?0:Eu(s);n<s;)t[n++]=e;return t}function da(t,e){var n=[];return ve(t,function(s,a,l){e(s,a,l)&&n.push(s)}),n}function lt(t,e,n,s,a){var l=-1,h=t.length;for(n||(n=Pc),a||(a=[]);++l<h;){var g=t[l];e>0&&n(g)?e>1?lt(g,e-1,n,s,a):ge(a,g):s||(a[a.length]=g)}return a}var li=Ga(),ga=Ga(!0);function Jt(t,e){return t&&li(t,e,at)}function fi(t,e){return t&&ga(t,e,at)}function er(t,e){return de(e,function(n){return oe(t[n])})}function Ee(t,e){e=ye(e,t);for(var n=0,s=e.length;t!=null&&n<s;)t=t[Qt(e[n++])];return n&&n==s?t:r}function pa(t,e,n){var s=e(t);return F(t)?s:ge(s,n(t))}function gt(t){return t==null?t===r?mo:wo:Re&&Re in X(t)?Ac(t):kc(t)}function ci(t,e){return t>e}function Kf(t,e){return t!=null&&J.call(t,e)}function Zf(t,e){return t!=null&&e in X(t)}function Jf(t,e,n){return t>=ct(e,n)&&t<st(e,n)}function hi(t,e,n){for(var s=n?Zr:Un,a=t[0].length,l=t.length,h=l,g=y(l),v=1/0,S=[];h--;){var x=t[h];h&&e&&(x=j(x,Ct(e))),v=ct(x.length,v),g[h]=!n&&(e||a>=120&&x.length>=120)?new be(h&&x):r}x=t[0];var C=-1,R=g[0];t:for(;++C<a&&S.length<v;){var E=x[C],O=e?e(E):E;if(E=n||E!==0?E:0,!(R?on(R,O):s(S,O,n))){for(h=l;--h;){var k=g[h];if(!(k?on(k,O):s(t[h],O,n)))continue t}R&&R.push(O),S.push(E)}}return S}function Xf(t,e,n,s){return Jt(t,function(a,l,h){e(s,n(a),l,h)}),s}function _n(t,e,n){e=ye(e,t),t=nu(t,e);var s=t==null?t:t[Qt(Nt(e))];return s==null?r:xt(s,t,n)}function _a(t){return et(t)&&gt(t)==Pe}function Qf(t){return et(t)&&gt(t)==un}function Vf(t){return et(t)&&gt(t)==en}function vn(t,e,n,s,a){return t===e?!0:t==null||e==null||!et(t)&&!et(e)?t!==t&&e!==e:jf(t,e,n,s,vn,a)}function jf(t,e,n,s,a,l){var h=F(t),g=F(e),v=h?En:ht(t),S=g?En:ht(e);v=v==Pe?ee:v,S=S==Pe?ee:S;var x=v==ee,C=S==ee,R=v==S;if(R&&Se(t)){if(!Se(e))return!1;h=!0,x=!1}if(R&&!x)return l||(l=new $t),h||Ze(t)?Ja(t,e,n,s,a,l):Lc(t,e,v,n,s,a,l);if(!(n&ut)){var E=x&&J.call(t,"__wrapped__"),O=C&&J.call(e,"__wrapped__");if(E||O){var k=E?t.value():t,M=O?e.value():e;return l||(l=new $t),a(k,M,n,s,l)}}return R?(l||(l=new $t),bc(t,e,n,s,a,l)):!1}function tc(t){return et(t)&&ht(t)==Gt}function di(t,e,n,s){var a=n.length,l=a,h=!s;if(t==null)return!l;for(t=X(t);a--;){var g=n[a];if(h&&g[2]?g[1]!==t[g[0]]:!(g[0]in t))return!1}for(;++a<l;){g=n[a];var v=g[0],S=t[v],x=g[1];if(h&&g[2]){if(S===r&&!(v in t))return!1}else{var C=new $t;if(s)var R=s(S,x,v,t,e,C);if(!(R===r?vn(x,S,ut|ce,s,C):R))return!1}}return!0}function va(t){if(!tt(t)||Uc(t))return!1;var e=oe(t)?jl:Ho;return e.test(Te(t))}function ec(t){return et(t)&&gt(t)==rn}function nc(t){return et(t)&&ht(t)==Bt}function rc(t){return et(t)&&wr(t.length)&&!!V[gt(t)]}function wa(t){return typeof t=="function"?t:t==null?St:typeof t=="object"?F(t)?Sa(t[0],t[1]):ma(t):Bu(t)}function gi(t){if(!mn(t))return af(t);var e=[];for(var n in X(t))J.call(t,n)&&n!="constructor"&&e.push(n);return e}function ic(t){if(!tt(t))return Bc(t);var e=mn(t),n=[];for(var s in t)s=="constructor"&&(e||!J.call(t,s))||n.push(s);return n}function pi(t,e){return t<e}function ya(t,e){var n=-1,s=yt(t)?y(t.length):[];return ve(t,function(a,l,h){s[++n]=e(a,l,h)}),s}function ma(t){var e=Ii(t);return e.length==1&&e[0][2]?tu(e[0][0],e[0][1]):function(n){return n===t||di(n,t,e)}}function Sa(t,e){return Oi(t)&&ja(e)?tu(Qt(t),e):function(n){var s=$i(n,t);return s===r&&s===e?Hi(n,t):vn(e,s,ut|ce)}}function nr(t,e,n,s,a){t!==e&&li(e,function(l,h){if(a||(a=new $t),tt(l))sc(t,e,h,n,nr,s,a);else{var g=s?s(Pi(t,h),l,h+"",t,e,a):r;g===r&&(g=l),ui(t,h,g)}},mt)}function sc(t,e,n,s,a,l,h){var g=Pi(t,n),v=Pi(e,n),S=h.get(v);if(S){ui(t,n,S);return}var x=l?l(g,v,n+"",t,e,h):r,C=x===r;if(C){var R=F(v),E=!R&&Se(v),O=!R&&!E&&Ze(v);x=v,R||E||O?F(g)?x=g:nt(g)?x=wt(g):E?(C=!1,x=Ma(v,!0)):O?(C=!1,x=Pa(v,!0)):x=[]:xn(v)||Oe(v)?(x=g,Oe(g)?x=Iu(g):(!tt(g)||oe(g))&&(x=Va(v))):C=!1}C&&(h.set(v,x),a(x,v,s,l,h),h.delete(v)),ui(t,n,x)}function xa(t,e){var n=t.length;if(n)return e+=e<0?n:0,ue(e,n)?t[e]:r}function Ca(t,e,n){e.length?e=j(e,function(l){return F(l)?function(h){return Ee(h,l.length===1?l[0]:l)}:l}):e=[St];var s=-1;e=j(e,Ct(T()));var a=ya(t,function(l,h,g){var v=j(e,function(S){return S(l)});return{criteria:v,index:++s,value:l}});return Tl(a,function(l,h){return wc(l,h,n)})}function ac(t,e){return Da(t,e,function(n,s){return Hi(t,s)})}function Da(t,e,n){for(var s=-1,a=e.length,l={};++s<a;){var h=e[s],g=Ee(t,h);n(g,h)&&wn(l,ye(h,t),g)}return l}function uc(t){return function(e){return Ee(e,t)}}function _i(t,e,n,s){var a=s?Il:Fe,l=-1,h=e.length,g=t;for(t===e&&(e=wt(e)),n&&(g=j(t,Ct(n)));++l<h;)for(var v=0,S=e[l],x=n?n(S):S;(v=a(g,x,v,s))>-1;)g!==t&&Yn.call(g,v,1),Yn.call(t,v,1);return t}function Ra(t,e){for(var n=t?e.length:0,s=n-1;n--;){var a=e[n];if(n==s||a!==l){var l=a;ue(a)?Yn.call(t,a,1):mi(t,a)}}return t}function vi(t,e){return t+Jn(sa()*(e-t+1))}function oc(t,e,n,s){for(var a=-1,l=st(Zn((e-t)/(n||1)),0),h=y(l);l--;)h[s?l:++a]=t,t+=n;return h}function wi(t,e){var n="";if(!t||e<1||e>he)return n;do e%2&&(n+=t),e=Jn(e/2),e&&(t+=t);while(e);return n}function $(t,e){return Ni(eu(t,e,St),t+"")}function lc(t){return oa(Je(t))}function fc(t,e){var n=Je(t);return hr(n,Ae(e,0,n.length))}function wn(t,e,n,s){if(!tt(t))return t;e=ye(e,t);for(var a=-1,l=e.length,h=l-1,g=t;g!=null&&++a<l;){var v=Qt(e[a]),S=n;if(v==="__proto__"||v==="constructor"||v==="prototype")return t;if(a!=h){var x=g[v];S=s?s(x,v,g):r,S===r&&(S=tt(x)?x:ue(e[a+1])?[]:{})}gn(g,v,S),g=g[v]}return t}var La=Xn?function(t,e){return Xn.set(t,e),t}:St,cc=Kn?function(t,e){return Kn(t,"toString",{configurable:!0,enumerable:!1,value:qi(e),writable:!0})}:St;function hc(t){return hr(Je(t))}function Pt(t,e,n){var s=-1,a=t.length;e<0&&(e=-e>a?0:a+e),n=n>a?a:n,n<0&&(n+=a),a=e>n?0:n-e>>>0,e>>>=0;for(var l=y(a);++s<a;)l[s]=t[s+e];return l}function dc(t,e){var n;return ve(t,function(s,a,l){return n=e(s,a,l),!n}),!!n}function rr(t,e,n){var s=0,a=t==null?s:t.length;if(typeof e=="number"&&e===e&&a<=go){for(;s<a;){var l=s+a>>>1,h=t[l];h!==null&&!Rt(h)&&(n?h<=e:h<e)?s=l+1:a=l}return a}return yi(t,e,St,n)}function yi(t,e,n,s){var a=0,l=t==null?0:t.length;if(l===0)return 0;e=n(e);for(var h=e!==e,g=e===null,v=Rt(e),S=e===r;a<l;){var x=Jn((a+l)/2),C=n(t[x]),R=C!==r,E=C===null,O=C===C,k=Rt(C);if(h)var M=s||O;else S?M=O&&(s||R):g?M=O&&R&&(s||!E):v?M=O&&R&&!E&&(s||!k):E||k?M=!1:M=s?C<=e:C<e;M?a=x+1:l=x}return ct(l,ho)}function ba(t,e){for(var n=-1,s=t.length,a=0,l=[];++n<s;){var h=t[n],g=e?e(h):h;if(!n||!Ht(g,v)){var v=g;l[a++]=h===0?0:h}}return l}function Aa(t){return typeof t=="number"?t:Rt(t)?An:+t}function Dt(t){if(typeof t=="string")return t;if(F(t))return j(t,Dt)+"";if(Rt(t))return aa?aa.call(t):"";var e=t+"";return e=="0"&&1/t==-Ce?"-0":e}function we(t,e,n){var s=-1,a=Un,l=t.length,h=!0,g=[],v=g;if(n)h=!1,a=Zr;else if(l>=f){var S=e?null:Dc(t);if(S)return Wn(S);h=!1,a=on,v=new be}else v=e?[]:g;t:for(;++s<l;){var x=t[s],C=e?e(x):x;if(x=n||x!==0?x:0,h&&C===C){for(var R=v.length;R--;)if(v[R]===C)continue t;e&&v.push(C),g.push(x)}else a(v,C,n)||(v!==g&&v.push(C),g.push(x))}return g}function mi(t,e){return e=ye(e,t),t=nu(t,e),t==null||delete t[Qt(Nt(e))]}function Ea(t,e,n,s){return wn(t,e,n(Ee(t,e)),s)}function ir(t,e,n,s){for(var a=t.length,l=s?a:-1;(s?l--:++l<a)&&e(t[l],l,t););return n?Pt(t,s?0:l,s?l+1:a):Pt(t,s?l+1:0,s?a:l)}function Ia(t,e){var n=t;return n instanceof z&&(n=n.value()),Jr(e,function(s,a){return a.func.apply(a.thisArg,ge([s],a.args))},n)}function Si(t,e,n){var s=t.length;if(s<2)return s?we(t[0]):[];for(var a=-1,l=y(s);++a<s;)for(var h=t[a],g=-1;++g<s;)g!=a&&(l[a]=pn(l[a]||h,t[g],e,n));return we(lt(l,1),e,n)}function Ta(t,e,n){for(var s=-1,a=t.length,l=e.length,h={};++s<a;){var g=s<l?e[s]:r;n(h,t[s],g)}return h}function xi(t){return nt(t)?t:[]}function Ci(t){return typeof t=="function"?t:St}function ye(t,e){return F(t)?t:Oi(t,e)?[t]:au(K(t))}var gc=$;function me(t,e,n){var s=t.length;return n=n===r?s:n,!e&&n>=s?t:Pt(t,e,n)}var Oa=tf||function(t){return ot.clearTimeout(t)};function Ma(t,e){if(e)return t.slice();var n=t.length,s=ta?ta(n):new t.constructor(n);return t.copy(s),s}function Di(t){var e=new t.constructor(t.byteLength);return new zn(e).set(new zn(t)),e}function pc(t,e){var n=e?Di(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}function _c(t){var e=new t.constructor(t.source,_s.exec(t));return e.lastIndex=t.lastIndex,e}function vc(t){return dn?X(dn.call(t)):{}}function Pa(t,e){var n=e?Di(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Na(t,e){if(t!==e){var n=t!==r,s=t===null,a=t===t,l=Rt(t),h=e!==r,g=e===null,v=e===e,S=Rt(e);if(!g&&!S&&!l&&t>e||l&&h&&v&&!g&&!S||s&&h&&v||!n&&v||!a)return 1;if(!s&&!l&&!S&&t<e||S&&n&&a&&!s&&!l||g&&n&&a||!h&&a||!v)return-1}return 0}function wc(t,e,n){for(var s=-1,a=t.criteria,l=e.criteria,h=a.length,g=n.length;++s<h;){var v=Na(a[s],l[s]);if(v){if(s>=g)return v;var S=n[s];return v*(S=="desc"?-1:1)}}return t.index-e.index}function Ua(t,e,n,s){for(var a=-1,l=t.length,h=n.length,g=-1,v=e.length,S=st(l-h,0),x=y(v+S),C=!s;++g<v;)x[g]=e[g];for(;++a<h;)(C||a<l)&&(x[n[a]]=t[a]);for(;S--;)x[g++]=t[a++];return x}function Fa(t,e,n,s){for(var a=-1,l=t.length,h=-1,g=n.length,v=-1,S=e.length,x=st(l-g,0),C=y(x+S),R=!s;++a<x;)C[a]=t[a];for(var E=a;++v<S;)C[E+v]=e[v];for(;++h<g;)(R||a<l)&&(C[E+n[h]]=t[a++]);return C}function wt(t,e){var n=-1,s=t.length;for(e||(e=y(s));++n<s;)e[n]=t[n];return e}function Xt(t,e,n,s){var a=!n;n||(n={});for(var l=-1,h=e.length;++l<h;){var g=e[l],v=s?s(n[g],t[g],g,n,t):r;v===r&&(v=t[g]),a?ie(n,g,v):gn(n,g,v)}return n}function yc(t,e){return Xt(t,Ti(t),e)}function mc(t,e){return Xt(t,Xa(t),e)}function sr(t,e){return function(n,s){var a=F(n)?Dl:$f,l=e?e():{};return a(n,t,T(s,2),l)}}function qe(t){return $(function(e,n){var s=-1,a=n.length,l=a>1?n[a-1]:r,h=a>2?n[2]:r;for(l=t.length>3&&typeof l=="function"?(a--,l):r,h&&pt(n[0],n[1],h)&&(l=a<3?r:l,a=1),e=X(e);++s<a;){var g=n[s];g&&t(e,g,s,l)}return e})}function Wa(t,e){return function(n,s){if(n==null)return n;if(!yt(n))return t(n,s);for(var a=n.length,l=e?a:-1,h=X(n);(e?l--:++l<a)&&s(h[l],l,h)!==!1;);return n}}function Ga(t){return function(e,n,s){for(var a=-1,l=X(e),h=s(e),g=h.length;g--;){var v=h[t?g:++a];if(n(l[v],v,l)===!1)break}return e}}function Sc(t,e,n){var s=e&Wt,a=yn(t);function l(){var h=this&&this!==ot&&this instanceof l?a:t;return h.apply(s?n:this,arguments)}return l}function Ba(t){return function(e){e=K(e);var n=We(e)?kt(e):r,s=n?n[0]:e.charAt(0),a=n?me(n,1).join(""):e.slice(1);return s[t]()+a}}function Ye(t){return function(e){return Jr(Wu(Fu(e).replace(fl,"")),t,"")}}function yn(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=ze(t.prototype),s=t.apply(n,e);return tt(s)?s:n}}function xc(t,e,n){var s=yn(t);function a(){for(var l=arguments.length,h=y(l),g=l,v=Ke(a);g--;)h[g]=arguments[g];var S=l<3&&h[0]!==v&&h[l-1]!==v?[]:pe(h,v);if(l-=S.length,l<n)return qa(t,e,ar,a.placeholder,r,h,S,r,r,n-l);var x=this&&this!==ot&&this instanceof a?s:t;return xt(x,this,h)}return a}function ka(t){return function(e,n,s){var a=X(e);if(!yt(e)){var l=T(n,3);e=at(e),n=function(g){return l(a[g],g,a)}}var h=t(e,n,s);return h>-1?a[l?e[h]:h]:r}}function $a(t){return ae(function(e){var n=e.length,s=n,a=Ot.prototype.thru;for(t&&e.reverse();s--;){var l=e[s];if(typeof l!="function")throw new Tt(p);if(a&&!h&&fr(l)=="wrapper")var h=new Ot([],!0)}for(s=h?s:n;++s<n;){l=e[s];var g=fr(l),v=g=="wrapper"?Ei(l):r;v&&Mi(v[0])&&v[1]==(te|Vt|jt|je)&&!v[4].length&&v[9]==1?h=h[fr(v[0])].apply(h,v[3]):h=l.length==1&&Mi(l)?h[g]():h.thru(l)}return function(){var S=arguments,x=S[0];if(h&&S.length==1&&F(x))return h.plant(x).value();for(var C=0,R=n?e[C].apply(this,S):x;++C<n;)R=e[C].call(this,R);return R}})}function ar(t,e,n,s,a,l,h,g,v,S){var x=e&te,C=e&Wt,R=e&Me,E=e&(Vt|Qe),O=e&Er,k=R?r:yn(t);function M(){for(var H=arguments.length,q=y(H),Lt=H;Lt--;)q[Lt]=arguments[Lt];if(E)var _t=Ke(M),bt=Ml(q,_t);if(s&&(q=Ua(q,s,a,E)),l&&(q=Fa(q,l,h,E)),H-=bt,E&&H<S){var rt=pe(q,_t);return qa(t,e,ar,M.placeholder,n,q,rt,g,v,S-H)}var zt=C?n:this,fe=R?zt[t]:t;return H=q.length,g?q=$c(q,g):O&&H>1&&q.reverse(),x&&v<H&&(q.length=v),this&&this!==ot&&this instanceof M&&(fe=k||yn(fe)),fe.apply(zt,q)}return M}function Ha(t,e){return function(n,s){return Xf(n,t,e(s),{})}}function ur(t,e){return function(n,s){var a;if(n===r&&s===r)return e;if(n!==r&&(a=n),s!==r){if(a===r)return s;typeof n=="string"||typeof s=="string"?(n=Dt(n),s=Dt(s)):(n=Aa(n),s=Aa(s)),a=t(n,s)}return a}}function Ri(t){return ae(function(e){return e=j(e,Ct(T())),$(function(n){var s=this;return t(e,function(a){return xt(a,s,n)})})})}function or(t,e){e=e===r?" ":Dt(e);var n=e.length;if(n<2)return n?wi(e,t):e;var s=wi(e,Zn(t/Ge(e)));return We(e)?me(kt(s),0,t).join(""):s.slice(0,t)}function Cc(t,e,n,s){var a=e&Wt,l=yn(t);function h(){for(var g=-1,v=arguments.length,S=-1,x=s.length,C=y(x+v),R=this&&this!==ot&&this instanceof h?l:t;++S<x;)C[S]=s[S];for(;v--;)C[S++]=arguments[++g];return xt(R,a?n:this,C)}return h}function za(t){return function(e,n,s){return s&&typeof s!="number"&&pt(e,n,s)&&(n=s=r),e=le(e),n===r?(n=e,e=0):n=le(n),s=s===r?e<n?1:-1:le(s),oc(e,n,s,t)}}function lr(t){return function(e,n){return typeof e=="string"&&typeof n=="string"||(e=Ut(e),n=Ut(n)),t(e,n)}}function qa(t,e,n,s,a,l,h,g,v,S){var x=e&Vt,C=x?h:r,R=x?r:h,E=x?l:r,O=x?r:l;e|=x?jt:Ve,e&=~(x?Ve:jt),e&ls||(e&=-4);var k=[t,e,a,E,C,O,R,g,v,S],M=n.apply(r,k);return Mi(t)&&ru(M,k),M.placeholder=s,iu(M,t,e)}function Li(t){var e=it[t];return function(n,s){if(n=Ut(n),s=s==null?0:ct(B(s),292),s&&ia(n)){var a=(K(n)+"e").split("e"),l=e(a[0]+"e"+(+a[1]+s));return a=(K(l)+"e").split("e"),+(a[0]+"e"+(+a[1]-s))}return e(n)}}var Dc=$e&&1/Wn(new $e([,-0]))[1]==Ce?function(t){return new $e(t)}:Zi;function Ya(t){return function(e){var n=ht(e);return n==Gt?ni(e):n==Bt?Bl(e):Ol(e,t(e))}}function se(t,e,n,s,a,l,h,g){var v=e&Me;if(!v&&typeof t!="function")throw new Tt(p);var S=s?s.length:0;if(S||(e&=-97,s=a=r),h=h===r?h:st(B(h),0),g=g===r?g:B(g),S-=a?a.length:0,e&Ve){var x=s,C=a;s=a=r}var R=v?r:Ei(t),E=[t,e,n,s,a,x,C,l,h,g];if(R&&Gc(E,R),t=E[0],e=E[1],n=E[2],s=E[3],a=E[4],g=E[9]=E[9]===r?v?0:t.length:st(E[9]-S,0),!g&&e&(Vt|Qe)&&(e&=-25),!e||e==Wt)var O=Sc(t,e,n);else e==Vt||e==Qe?O=xc(t,e,g):(e==jt||e==(Wt|jt))&&!a.length?O=Cc(t,e,n,s):O=ar.apply(r,E);var k=R?La:ru;return iu(k(O,E),t,e)}function Ka(t,e,n,s){return t===r||Ht(t,ke[n])&&!J.call(s,n)?e:t}function Za(t,e,n,s,a,l){return tt(t)&&tt(e)&&(l.set(e,t),nr(t,e,r,Za,l),l.delete(e)),t}function Rc(t){return xn(t)?r:t}function Ja(t,e,n,s,a,l){var h=n&ut,g=t.length,v=e.length;if(g!=v&&!(h&&v>g))return!1;var S=l.get(t),x=l.get(e);if(S&&x)return S==e&&x==t;var C=-1,R=!0,E=n&ce?new be:r;for(l.set(t,e),l.set(e,t);++C<g;){var O=t[C],k=e[C];if(s)var M=h?s(k,O,C,e,t,l):s(O,k,C,t,e,l);if(M!==r){if(M)continue;R=!1;break}if(E){if(!Xr(e,function(H,q){if(!on(E,q)&&(O===H||a(O,H,n,s,l)))return E.push(q)})){R=!1;break}}else if(!(O===k||a(O,k,n,s,l))){R=!1;break}}return l.delete(t),l.delete(e),R}function Lc(t,e,n,s,a,l,h){switch(n){case Ne:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case un:return!(t.byteLength!=e.byteLength||!l(new zn(t),new zn(e)));case tn:case en:case nn:return Ht(+t,+e);case In:return t.name==e.name&&t.message==e.message;case rn:case sn:return t==e+"";case Gt:var g=ni;case Bt:var v=s&ut;if(g||(g=Wn),t.size!=e.size&&!v)return!1;var S=h.get(t);if(S)return S==e;s|=ce,h.set(t,e);var x=Ja(g(t),g(e),s,a,l,h);return h.delete(t),x;case On:if(dn)return dn.call(t)==dn.call(e)}return!1}function bc(t,e,n,s,a,l){var h=n&ut,g=bi(t),v=g.length,S=bi(e),x=S.length;if(v!=x&&!h)return!1;for(var C=v;C--;){var R=g[C];if(!(h?R in e:J.call(e,R)))return!1}var E=l.get(t),O=l.get(e);if(E&&O)return E==e&&O==t;var k=!0;l.set(t,e),l.set(e,t);for(var M=h;++C<v;){R=g[C];var H=t[R],q=e[R];if(s)var Lt=h?s(q,H,R,e,t,l):s(H,q,R,t,e,l);if(!(Lt===r?H===q||a(H,q,n,s,l):Lt)){k=!1;break}M||(M=R=="constructor")}if(k&&!M){var _t=t.constructor,bt=e.constructor;_t!=bt&&"constructor"in t&&"constructor"in e&&!(typeof _t=="function"&&_t instanceof _t&&typeof bt=="function"&&bt instanceof bt)&&(k=!1)}return l.delete(t),l.delete(e),k}function ae(t){return Ni(eu(t,r,fu),t+"")}function bi(t){return pa(t,at,Ti)}function Ai(t){return pa(t,mt,Xa)}var Ei=Xn?function(t){return Xn.get(t)}:Zi;function fr(t){for(var e=t.name+"",n=He[e],s=J.call(He,e)?n.length:0;s--;){var a=n[s],l=a.func;if(l==null||l==t)return a.name}return e}function Ke(t){var e=J.call(o,"placeholder")?o:t;return e.placeholder}function T(){var t=o.iteratee||Yi;return t=t===Yi?wa:t,arguments.length?t(arguments[0],arguments[1]):t}function cr(t,e){var n=t.__data__;return Nc(e)?n[typeof e=="string"?"string":"hash"]:n.map}function Ii(t){for(var e=at(t),n=e.length;n--;){var s=e[n],a=t[s];e[n]=[s,a,ja(a)]}return e}function Ie(t,e){var n=Fl(t,e);return va(n)?n:r}function Ac(t){var e=J.call(t,Re),n=t[Re];try{t[Re]=r;var s=!0}catch{}var a=$n.call(t);return s&&(e?t[Re]=n:delete t[Re]),a}var Ti=ii?function(t){return t==null?[]:(t=X(t),de(ii(t),function(e){return na.call(t,e)}))}:Ji,Xa=ii?function(t){for(var e=[];t;)ge(e,Ti(t)),t=qn(t);return e}:Ji,ht=gt;(si&&ht(new si(new ArrayBuffer(1)))!=Ne||fn&&ht(new fn)!=Gt||ai&&ht(ai.resolve())!=hs||$e&&ht(new $e)!=Bt||cn&&ht(new cn)!=an)&&(ht=function(t){var e=gt(t),n=e==ee?t.constructor:r,s=n?Te(n):"";if(s)switch(s){case ff:return Ne;case cf:return Gt;case hf:return hs;case df:return Bt;case gf:return an}return e});function Ec(t,e,n){for(var s=-1,a=n.length;++s<a;){var l=n[s],h=l.size;switch(l.type){case"drop":t+=h;break;case"dropRight":e-=h;break;case"take":e=ct(e,t+h);break;case"takeRight":t=st(t,e-h);break}}return{start:t,end:e}}function Ic(t){var e=t.match(No);return e?e[1].split(Uo):[]}function Qa(t,e,n){e=ye(e,t);for(var s=-1,a=e.length,l=!1;++s<a;){var h=Qt(e[s]);if(!(l=t!=null&&n(t,h)))break;t=t[h]}return l||++s!=a?l:(a=t==null?0:t.length,!!a&&wr(a)&&ue(h,a)&&(F(t)||Oe(t)))}function Tc(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&J.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function Va(t){return typeof t.constructor=="function"&&!mn(t)?ze(qn(t)):{}}function Oc(t,e,n){var s=t.constructor;switch(e){case un:return Di(t);case tn:case en:return new s(+t);case Ne:return pc(t,n);case Ir:case Tr:case Or:case Mr:case Pr:case Nr:case Ur:case Fr:case Wr:return Pa(t,n);case Gt:return new s;case nn:case sn:return new s(t);case rn:return _c(t);case Bt:return new s;case On:return vc(t)}}function Mc(t,e){var n=e.length;if(!n)return t;var s=n-1;return e[s]=(n>1?"& ":"")+e[s],e=e.join(n>2?", ":" "),t.replace(Po,`{
/* [wrapped with `+e+`] */
`)}function Pc(t){return F(t)||Oe(t)||!!(ra&&t&&t[ra])}function ue(t,e){var n=typeof t;return e=e??he,!!e&&(n=="number"||n!="symbol"&&qo.test(t))&&t>-1&&t%1==0&&t<e}function pt(t,e,n){if(!tt(n))return!1;var s=typeof e;return(s=="number"?yt(n)&&ue(e,n.length):s=="string"&&e in n)?Ht(n[e],t):!1}function Oi(t,e){if(F(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||Rt(t)?!0:Io.test(t)||!Eo.test(t)||e!=null&&t in X(e)}function Nc(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function Mi(t){var e=fr(t),n=o[e];if(typeof n!="function"||!(e in z.prototype))return!1;if(t===n)return!0;var s=Ei(n);return!!s&&t===s[0]}function Uc(t){return!!js&&js in t}var Fc=Bn?oe:Xi;function mn(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||ke;return t===n}function ja(t){return t===t&&!tt(t)}function tu(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==r||t in X(n))}}function Wc(t){var e=_r(t,function(s){return n.size===L&&n.clear(),s}),n=e.cache;return e}function Gc(t,e){var n=t[1],s=e[1],a=n|s,l=a<(Wt|Me|te),h=s==te&&n==Vt||s==te&&n==je&&t[7].length<=e[8]||s==(te|je)&&e[7].length<=e[8]&&n==Vt;if(!(l||h))return t;s&Wt&&(t[2]=e[2],a|=n&Wt?0:ls);var g=e[3];if(g){var v=t[3];t[3]=v?Ua(v,g,e[4]):g,t[4]=v?pe(t[3],I):e[4]}return g=e[5],g&&(v=t[5],t[5]=v?Fa(v,g,e[6]):g,t[6]=v?pe(t[5],I):e[6]),g=e[7],g&&(t[7]=g),s&te&&(t[8]=t[8]==null?e[8]:ct(t[8],e[8])),t[9]==null&&(t[9]=e[9]),t[0]=e[0],t[1]=a,t}function Bc(t){var e=[];if(t!=null)for(var n in X(t))e.push(n);return e}function kc(t){return $n.call(t)}function eu(t,e,n){return e=st(e===r?t.length-1:e,0),function(){for(var s=arguments,a=-1,l=st(s.length-e,0),h=y(l);++a<l;)h[a]=s[e+a];a=-1;for(var g=y(e+1);++a<e;)g[a]=s[a];return g[e]=n(h),xt(t,this,g)}}function nu(t,e){return e.length<2?t:Ee(t,Pt(e,0,-1))}function $c(t,e){for(var n=t.length,s=ct(e.length,n),a=wt(t);s--;){var l=e[s];t[s]=ue(l,n)?a[l]:r}return t}function Pi(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var ru=su(La),Sn=nf||function(t,e){return ot.setTimeout(t,e)},Ni=su(cc);function iu(t,e,n){var s=e+"";return Ni(t,Mc(s,Hc(Ic(s),n)))}function su(t){var e=0,n=0;return function(){var s=uf(),a=oo-(s-n);if(n=s,a>0){if(++e>=uo)return arguments[0]}else e=0;return t.apply(r,arguments)}}function hr(t,e){var n=-1,s=t.length,a=s-1;for(e=e===r?s:e;++n<e;){var l=vi(n,a),h=t[l];t[l]=t[n],t[n]=h}return t.length=e,t}var au=Wc(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(To,function(n,s,a,l){e.push(a?l.replace(Go,"$1"):s||n)}),e});function Qt(t){if(typeof t=="string"||Rt(t))return t;var e=t+"";return e=="0"&&1/t==-Ce?"-0":e}function Te(t){if(t!=null){try{return kn.call(t)}catch{}try{return t+""}catch{}}return""}function Hc(t,e){return It(po,function(n){var s="_."+n[0];e&n[1]&&!Un(t,s)&&t.push(s)}),t.sort()}function uu(t){if(t instanceof z)return t.clone();var e=new Ot(t.__wrapped__,t.__chain__);return e.__actions__=wt(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function zc(t,e,n){(n?pt(t,e,n):e===r)?e=1:e=st(B(e),0);var s=t==null?0:t.length;if(!s||e<1)return[];for(var a=0,l=0,h=y(Zn(s/e));a<s;)h[l++]=Pt(t,a,a+=e);return h}function qc(t){for(var e=-1,n=t==null?0:t.length,s=0,a=[];++e<n;){var l=t[e];l&&(a[s++]=l)}return a}function Yc(){var t=arguments.length;if(!t)return[];for(var e=y(t-1),n=arguments[0],s=t;s--;)e[s-1]=arguments[s];return ge(F(n)?wt(n):[n],lt(e,1))}var Kc=$(function(t,e){return nt(t)?pn(t,lt(e,1,nt,!0)):[]}),Zc=$(function(t,e){var n=Nt(e);return nt(n)&&(n=r),nt(t)?pn(t,lt(e,1,nt,!0),T(n,2)):[]}),Jc=$(function(t,e){var n=Nt(e);return nt(n)&&(n=r),nt(t)?pn(t,lt(e,1,nt,!0),r,n):[]});function Xc(t,e,n){var s=t==null?0:t.length;return s?(e=n||e===r?1:B(e),Pt(t,e<0?0:e,s)):[]}function Qc(t,e,n){var s=t==null?0:t.length;return s?(e=n||e===r?1:B(e),e=s-e,Pt(t,0,e<0?0:e)):[]}function Vc(t,e){return t&&t.length?ir(t,T(e,3),!0,!0):[]}function jc(t,e){return t&&t.length?ir(t,T(e,3),!0):[]}function th(t,e,n,s){var a=t==null?0:t.length;return a?(n&&typeof n!="number"&&pt(t,e,n)&&(n=0,s=a),Yf(t,e,n,s)):[]}function ou(t,e,n){var s=t==null?0:t.length;if(!s)return-1;var a=n==null?0:B(n);return a<0&&(a=st(s+a,0)),Fn(t,T(e,3),a)}function lu(t,e,n){var s=t==null?0:t.length;if(!s)return-1;var a=s-1;return n!==r&&(a=B(n),a=n<0?st(s+a,0):ct(a,s-1)),Fn(t,T(e,3),a,!0)}function fu(t){var e=t==null?0:t.length;return e?lt(t,1):[]}function eh(t){var e=t==null?0:t.length;return e?lt(t,Ce):[]}function nh(t,e){var n=t==null?0:t.length;return n?(e=e===r?1:B(e),lt(t,e)):[]}function rh(t){for(var e=-1,n=t==null?0:t.length,s={};++e<n;){var a=t[e];s[a[0]]=a[1]}return s}function cu(t){return t&&t.length?t[0]:r}function ih(t,e,n){var s=t==null?0:t.length;if(!s)return-1;var a=n==null?0:B(n);return a<0&&(a=st(s+a,0)),Fe(t,e,a)}function sh(t){var e=t==null?0:t.length;return e?Pt(t,0,-1):[]}var ah=$(function(t){var e=j(t,xi);return e.length&&e[0]===t[0]?hi(e):[]}),uh=$(function(t){var e=Nt(t),n=j(t,xi);return e===Nt(n)?e=r:n.pop(),n.length&&n[0]===t[0]?hi(n,T(e,2)):[]}),oh=$(function(t){var e=Nt(t),n=j(t,xi);return e=typeof e=="function"?e:r,e&&n.pop(),n.length&&n[0]===t[0]?hi(n,r,e):[]});function lh(t,e){return t==null?"":sf.call(t,e)}function Nt(t){var e=t==null?0:t.length;return e?t[e-1]:r}function fh(t,e,n){var s=t==null?0:t.length;if(!s)return-1;var a=s;return n!==r&&(a=B(n),a=a<0?st(s+a,0):ct(a,s-1)),e===e?$l(t,e,a):Fn(t,qs,a,!0)}function ch(t,e){return t&&t.length?xa(t,B(e)):r}var hh=$(hu);function hu(t,e){return t&&t.length&&e&&e.length?_i(t,e):t}function dh(t,e,n){return t&&t.length&&e&&e.length?_i(t,e,T(n,2)):t}function gh(t,e,n){return t&&t.length&&e&&e.length?_i(t,e,r,n):t}var ph=ae(function(t,e){var n=t==null?0:t.length,s=oi(t,e);return Ra(t,j(e,function(a){return ue(a,n)?+a:a}).sort(Na)),s});function _h(t,e){var n=[];if(!(t&&t.length))return n;var s=-1,a=[],l=t.length;for(e=T(e,3);++s<l;){var h=t[s];e(h,s,t)&&(n.push(h),a.push(s))}return Ra(t,a),n}function Ui(t){return t==null?t:lf.call(t)}function vh(t,e,n){var s=t==null?0:t.length;return s?(n&&typeof n!="number"&&pt(t,e,n)?(e=0,n=s):(e=e==null?0:B(e),n=n===r?s:B(n)),Pt(t,e,n)):[]}function wh(t,e){return rr(t,e)}function yh(t,e,n){return yi(t,e,T(n,2))}function mh(t,e){var n=t==null?0:t.length;if(n){var s=rr(t,e);if(s<n&&Ht(t[s],e))return s}return-1}function Sh(t,e){return rr(t,e,!0)}function xh(t,e,n){return yi(t,e,T(n,2),!0)}function Ch(t,e){var n=t==null?0:t.length;if(n){var s=rr(t,e,!0)-1;if(Ht(t[s],e))return s}return-1}function Dh(t){return t&&t.length?ba(t):[]}function Rh(t,e){return t&&t.length?ba(t,T(e,2)):[]}function Lh(t){var e=t==null?0:t.length;return e?Pt(t,1,e):[]}function bh(t,e,n){return t&&t.length?(e=n||e===r?1:B(e),Pt(t,0,e<0?0:e)):[]}function Ah(t,e,n){var s=t==null?0:t.length;return s?(e=n||e===r?1:B(e),e=s-e,Pt(t,e<0?0:e,s)):[]}function Eh(t,e){return t&&t.length?ir(t,T(e,3),!1,!0):[]}function Ih(t,e){return t&&t.length?ir(t,T(e,3)):[]}var Th=$(function(t){return we(lt(t,1,nt,!0))}),Oh=$(function(t){var e=Nt(t);return nt(e)&&(e=r),we(lt(t,1,nt,!0),T(e,2))}),Mh=$(function(t){var e=Nt(t);return e=typeof e=="function"?e:r,we(lt(t,1,nt,!0),r,e)});function Ph(t){return t&&t.length?we(t):[]}function Nh(t,e){return t&&t.length?we(t,T(e,2)):[]}function Uh(t,e){return e=typeof e=="function"?e:r,t&&t.length?we(t,r,e):[]}function Fi(t){if(!(t&&t.length))return[];var e=0;return t=de(t,function(n){if(nt(n))return e=st(n.length,e),!0}),ti(e,function(n){return j(t,Qr(n))})}function du(t,e){if(!(t&&t.length))return[];var n=Fi(t);return e==null?n:j(n,function(s){return xt(e,r,s)})}var Fh=$(function(t,e){return nt(t)?pn(t,e):[]}),Wh=$(function(t){return Si(de(t,nt))}),Gh=$(function(t){var e=Nt(t);return nt(e)&&(e=r),Si(de(t,nt),T(e,2))}),Bh=$(function(t){var e=Nt(t);return e=typeof e=="function"?e:r,Si(de(t,nt),r,e)}),kh=$(Fi);function $h(t,e){return Ta(t||[],e||[],gn)}function Hh(t,e){return Ta(t||[],e||[],wn)}var zh=$(function(t){var e=t.length,n=e>1?t[e-1]:r;return n=typeof n=="function"?(t.pop(),n):r,du(t,n)});function gu(t){var e=o(t);return e.__chain__=!0,e}function qh(t,e){return e(t),t}function dr(t,e){return e(t)}var Yh=ae(function(t){var e=t.length,n=e?t[0]:0,s=this.__wrapped__,a=function(l){return oi(l,t)};return e>1||this.__actions__.length||!(s instanceof z)||!ue(n)?this.thru(a):(s=s.slice(n,+n+(e?1:0)),s.__actions__.push({func:dr,args:[a],thisArg:r}),new Ot(s,this.__chain__).thru(function(l){return e&&!l.length&&l.push(r),l}))});function Kh(){return gu(this)}function Zh(){return new Ot(this.value(),this.__chain__)}function Jh(){this.__values__===r&&(this.__values__=Au(this.value()));var t=this.__index__>=this.__values__.length,e=t?r:this.__values__[this.__index__++];return{done:t,value:e}}function Xh(){return this}function Qh(t){for(var e,n=this;n instanceof Vn;){var s=uu(n);s.__index__=0,s.__values__=r,e?a.__wrapped__=s:e=s;var a=s;n=n.__wrapped__}return a.__wrapped__=t,e}function Vh(){var t=this.__wrapped__;if(t instanceof z){var e=t;return this.__actions__.length&&(e=new z(this)),e=e.reverse(),e.__actions__.push({func:dr,args:[Ui],thisArg:r}),new Ot(e,this.__chain__)}return this.thru(Ui)}function jh(){return Ia(this.__wrapped__,this.__actions__)}var td=sr(function(t,e,n){J.call(t,n)?++t[n]:ie(t,n,1)});function ed(t,e,n){var s=F(t)?Hs:qf;return n&&pt(t,e,n)&&(e=r),s(t,T(e,3))}function nd(t,e){var n=F(t)?de:da;return n(t,T(e,3))}var rd=ka(ou),id=ka(lu);function sd(t,e){return lt(gr(t,e),1)}function ad(t,e){return lt(gr(t,e),Ce)}function ud(t,e,n){return n=n===r?1:B(n),lt(gr(t,e),n)}function pu(t,e){var n=F(t)?It:ve;return n(t,T(e,3))}function _u(t,e){var n=F(t)?Rl:ha;return n(t,T(e,3))}var od=sr(function(t,e,n){J.call(t,n)?t[n].push(e):ie(t,n,[e])});function ld(t,e,n,s){t=yt(t)?t:Je(t),n=n&&!s?B(n):0;var a=t.length;return n<0&&(n=st(a+n,0)),yr(t)?n<=a&&t.indexOf(e,n)>-1:!!a&&Fe(t,e,n)>-1}var fd=$(function(t,e,n){var s=-1,a=typeof e=="function",l=yt(t)?y(t.length):[];return ve(t,function(h){l[++s]=a?xt(e,h,n):_n(h,e,n)}),l}),cd=sr(function(t,e,n){ie(t,n,e)});function gr(t,e){var n=F(t)?j:ya;return n(t,T(e,3))}function hd(t,e,n,s){return t==null?[]:(F(e)||(e=e==null?[]:[e]),n=s?r:n,F(n)||(n=n==null?[]:[n]),Ca(t,e,n))}var dd=sr(function(t,e,n){t[n?0:1].push(e)},function(){return[[],[]]});function gd(t,e,n){var s=F(t)?Jr:Ks,a=arguments.length<3;return s(t,T(e,4),n,a,ve)}function pd(t,e,n){var s=F(t)?Ll:Ks,a=arguments.length<3;return s(t,T(e,4),n,a,ha)}function _d(t,e){var n=F(t)?de:da;return n(t,vr(T(e,3)))}function vd(t){var e=F(t)?oa:lc;return e(t)}function wd(t,e,n){(n?pt(t,e,n):e===r)?e=1:e=B(e);var s=F(t)?Bf:fc;return s(t,e)}function yd(t){var e=F(t)?kf:hc;return e(t)}function md(t){if(t==null)return 0;if(yt(t))return yr(t)?Ge(t):t.length;var e=ht(t);return e==Gt||e==Bt?t.size:gi(t).length}function Sd(t,e,n){var s=F(t)?Xr:dc;return n&&pt(t,e,n)&&(e=r),s(t,T(e,3))}var xd=$(function(t,e){if(t==null)return[];var n=e.length;return n>1&&pt(t,e[0],e[1])?e=[]:n>2&&pt(e[0],e[1],e[2])&&(e=[e[0]]),Ca(t,lt(e,1),[])}),pr=ef||function(){return ot.Date.now()};function Cd(t,e){if(typeof e!="function")throw new Tt(p);return t=B(t),function(){if(--t<1)return e.apply(this,arguments)}}function vu(t,e,n){return e=n?r:e,e=t&&e==null?t.length:e,se(t,te,r,r,r,r,e)}function wu(t,e){var n;if(typeof e!="function")throw new Tt(p);return t=B(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=r),n}}var Wi=$(function(t,e,n){var s=Wt;if(n.length){var a=pe(n,Ke(Wi));s|=jt}return se(t,s,e,n,a)}),yu=$(function(t,e,n){var s=Wt|Me;if(n.length){var a=pe(n,Ke(yu));s|=jt}return se(e,s,t,n,a)});function mu(t,e,n){e=n?r:e;var s=se(t,Vt,r,r,r,r,r,e);return s.placeholder=mu.placeholder,s}function Su(t,e,n){e=n?r:e;var s=se(t,Qe,r,r,r,r,r,e);return s.placeholder=Su.placeholder,s}function xu(t,e,n){var s,a,l,h,g,v,S=0,x=!1,C=!1,R=!0;if(typeof t!="function")throw new Tt(p);e=Ut(e)||0,tt(n)&&(x=!!n.leading,C="maxWait"in n,l=C?st(Ut(n.maxWait)||0,e):l,R="trailing"in n?!!n.trailing:R);function E(rt){var zt=s,fe=a;return s=a=r,S=rt,h=t.apply(fe,zt),h}function O(rt){return S=rt,g=Sn(H,e),x?E(rt):h}function k(rt){var zt=rt-v,fe=rt-S,ku=e-zt;return C?ct(ku,l-fe):ku}function M(rt){var zt=rt-v,fe=rt-S;return v===r||zt>=e||zt<0||C&&fe>=l}function H(){var rt=pr();if(M(rt))return q(rt);g=Sn(H,k(rt))}function q(rt){return g=r,R&&s?E(rt):(s=a=r,h)}function Lt(){g!==r&&Oa(g),S=0,s=v=a=g=r}function _t(){return g===r?h:q(pr())}function bt(){var rt=pr(),zt=M(rt);if(s=arguments,a=this,v=rt,zt){if(g===r)return O(v);if(C)return Oa(g),g=Sn(H,e),E(v)}return g===r&&(g=Sn(H,e)),h}return bt.cancel=Lt,bt.flush=_t,bt}var Dd=$(function(t,e){return ca(t,1,e)}),Rd=$(function(t,e,n){return ca(t,Ut(e)||0,n)});function Ld(t){return se(t,Er)}function _r(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new Tt(p);var n=function(){var s=arguments,a=e?e.apply(this,s):s[0],l=n.cache;if(l.has(a))return l.get(a);var h=t.apply(this,s);return n.cache=l.set(a,h)||l,h};return n.cache=new(_r.Cache||re),n}_r.Cache=re;function vr(t){if(typeof t!="function")throw new Tt(p);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function bd(t){return wu(2,t)}var Ad=gc(function(t,e){e=e.length==1&&F(e[0])?j(e[0],Ct(T())):j(lt(e,1),Ct(T()));var n=e.length;return $(function(s){for(var a=-1,l=ct(s.length,n);++a<l;)s[a]=e[a].call(this,s[a]);return xt(t,this,s)})}),Gi=$(function(t,e){var n=pe(e,Ke(Gi));return se(t,jt,r,e,n)}),Cu=$(function(t,e){var n=pe(e,Ke(Cu));return se(t,Ve,r,e,n)}),Ed=ae(function(t,e){return se(t,je,r,r,r,e)});function Id(t,e){if(typeof t!="function")throw new Tt(p);return e=e===r?e:B(e),$(t,e)}function Td(t,e){if(typeof t!="function")throw new Tt(p);return e=e==null?0:st(B(e),0),$(function(n){var s=n[e],a=me(n,0,e);return s&&ge(a,s),xt(t,this,a)})}function Od(t,e,n){var s=!0,a=!0;if(typeof t!="function")throw new Tt(p);return tt(n)&&(s="leading"in n?!!n.leading:s,a="trailing"in n?!!n.trailing:a),xu(t,e,{leading:s,maxWait:e,trailing:a})}function Md(t){return vu(t,1)}function Pd(t,e){return Gi(Ci(e),t)}function Nd(){if(!arguments.length)return[];var t=arguments[0];return F(t)?t:[t]}function Ud(t){return Mt(t,Z)}function Fd(t,e){return e=typeof e=="function"?e:r,Mt(t,Z,e)}function Wd(t){return Mt(t,G|Z)}function Gd(t,e){return e=typeof e=="function"?e:r,Mt(t,G|Z,e)}function Bd(t,e){return e==null||fa(t,e,at(e))}function Ht(t,e){return t===e||t!==t&&e!==e}var kd=lr(ci),$d=lr(function(t,e){return t>=e}),Oe=_a(function(){return arguments}())?_a:function(t){return et(t)&&J.call(t,"callee")&&!na.call(t,"callee")},F=y.isArray,Hd=Fs?Ct(Fs):Qf;function yt(t){return t!=null&&wr(t.length)&&!oe(t)}function nt(t){return et(t)&&yt(t)}function zd(t){return t===!0||t===!1||et(t)&&gt(t)==tn}var Se=rf||Xi,qd=Ws?Ct(Ws):Vf;function Yd(t){return et(t)&&t.nodeType===1&&!xn(t)}function Kd(t){if(t==null)return!0;if(yt(t)&&(F(t)||typeof t=="string"||typeof t.splice=="function"||Se(t)||Ze(t)||Oe(t)))return!t.length;var e=ht(t);if(e==Gt||e==Bt)return!t.size;if(mn(t))return!gi(t).length;for(var n in t)if(J.call(t,n))return!1;return!0}function Zd(t,e){return vn(t,e)}function Jd(t,e,n){n=typeof n=="function"?n:r;var s=n?n(t,e):r;return s===r?vn(t,e,r,n):!!s}function Bi(t){if(!et(t))return!1;var e=gt(t);return e==In||e==vo||typeof t.message=="string"&&typeof t.name=="string"&&!xn(t)}function Xd(t){return typeof t=="number"&&ia(t)}function oe(t){if(!tt(t))return!1;var e=gt(t);return e==Tn||e==cs||e==_o||e==yo}function Du(t){return typeof t=="number"&&t==B(t)}function wr(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=he}function tt(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function et(t){return t!=null&&typeof t=="object"}var Ru=Gs?Ct(Gs):tc;function Qd(t,e){return t===e||di(t,e,Ii(e))}function Vd(t,e,n){return n=typeof n=="function"?n:r,di(t,e,Ii(e),n)}function jd(t){return Lu(t)&&t!=+t}function tg(t){if(Fc(t))throw new U(c);return va(t)}function eg(t){return t===null}function ng(t){return t==null}function Lu(t){return typeof t=="number"||et(t)&&gt(t)==nn}function xn(t){if(!et(t)||gt(t)!=ee)return!1;var e=qn(t);if(e===null)return!0;var n=J.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&kn.call(n)==Ql}var ki=Bs?Ct(Bs):ec;function rg(t){return Du(t)&&t>=-he&&t<=he}var bu=ks?Ct(ks):nc;function yr(t){return typeof t=="string"||!F(t)&&et(t)&&gt(t)==sn}function Rt(t){return typeof t=="symbol"||et(t)&&gt(t)==On}var Ze=$s?Ct($s):rc;function ig(t){return t===r}function sg(t){return et(t)&&ht(t)==an}function ag(t){return et(t)&&gt(t)==So}var ug=lr(pi),og=lr(function(t,e){return t<=e});function Au(t){if(!t)return[];if(yt(t))return yr(t)?kt(t):wt(t);if(ln&&t[ln])return Gl(t[ln]());var e=ht(t),n=e==Gt?ni:e==Bt?Wn:Je;return n(t)}function le(t){if(!t)return t===0?t:0;if(t=Ut(t),t===Ce||t===-Ce){var e=t<0?-1:1;return e*co}return t===t?t:0}function B(t){var e=le(t),n=e%1;return e===e?n?e-n:e:0}function Eu(t){return t?Ae(B(t),0,Zt):0}function Ut(t){if(typeof t=="number")return t;if(Rt(t))return An;if(tt(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=tt(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Zs(t);var n=$o.test(t);return n||zo.test(t)?xl(t.slice(2),n?2:8):ko.test(t)?An:+t}function Iu(t){return Xt(t,mt(t))}function lg(t){return t?Ae(B(t),-he,he):t===0?t:0}function K(t){return t==null?"":Dt(t)}var fg=qe(function(t,e){if(mn(e)||yt(e)){Xt(e,at(e),t);return}for(var n in e)J.call(e,n)&&gn(t,n,e[n])}),Tu=qe(function(t,e){Xt(e,mt(e),t)}),mr=qe(function(t,e,n,s){Xt(e,mt(e),t,s)}),cg=qe(function(t,e,n,s){Xt(e,at(e),t,s)}),hg=ae(oi);function dg(t,e){var n=ze(t);return e==null?n:la(n,e)}var gg=$(function(t,e){t=X(t);var n=-1,s=e.length,a=s>2?e[2]:r;for(a&&pt(e[0],e[1],a)&&(s=1);++n<s;)for(var l=e[n],h=mt(l),g=-1,v=h.length;++g<v;){var S=h[g],x=t[S];(x===r||Ht(x,ke[S])&&!J.call(t,S))&&(t[S]=l[S])}return t}),pg=$(function(t){return t.push(r,Za),xt(Ou,r,t)});function _g(t,e){return zs(t,T(e,3),Jt)}function vg(t,e){return zs(t,T(e,3),fi)}function wg(t,e){return t==null?t:li(t,T(e,3),mt)}function yg(t,e){return t==null?t:ga(t,T(e,3),mt)}function mg(t,e){return t&&Jt(t,T(e,3))}function Sg(t,e){return t&&fi(t,T(e,3))}function xg(t){return t==null?[]:er(t,at(t))}function Cg(t){return t==null?[]:er(t,mt(t))}function $i(t,e,n){var s=t==null?r:Ee(t,e);return s===r?n:s}function Dg(t,e){return t!=null&&Qa(t,e,Kf)}function Hi(t,e){return t!=null&&Qa(t,e,Zf)}var Rg=Ha(function(t,e,n){e!=null&&typeof e.toString!="function"&&(e=$n.call(e)),t[e]=n},qi(St)),Lg=Ha(function(t,e,n){e!=null&&typeof e.toString!="function"&&(e=$n.call(e)),J.call(t,e)?t[e].push(n):t[e]=[n]},T),bg=$(_n);function at(t){return yt(t)?ua(t):gi(t)}function mt(t){return yt(t)?ua(t,!0):ic(t)}function Ag(t,e){var n={};return e=T(e,3),Jt(t,function(s,a,l){ie(n,e(s,a,l),s)}),n}function Eg(t,e){var n={};return e=T(e,3),Jt(t,function(s,a,l){ie(n,a,e(s,a,l))}),n}var Ig=qe(function(t,e,n){nr(t,e,n)}),Ou=qe(function(t,e,n,s){nr(t,e,n,s)}),Tg=ae(function(t,e){var n={};if(t==null)return n;var s=!1;e=j(e,function(l){return l=ye(l,t),s||(s=l.length>1),l}),Xt(t,Ai(t),n),s&&(n=Mt(n,G|dt|Z,Rc));for(var a=e.length;a--;)mi(n,e[a]);return n});function Og(t,e){return Mu(t,vr(T(e)))}var Mg=ae(function(t,e){return t==null?{}:ac(t,e)});function Mu(t,e){if(t==null)return{};var n=j(Ai(t),function(s){return[s]});return e=T(e),Da(t,n,function(s,a){return e(s,a[0])})}function Pg(t,e,n){e=ye(e,t);var s=-1,a=e.length;for(a||(a=1,t=r);++s<a;){var l=t==null?r:t[Qt(e[s])];l===r&&(s=a,l=n),t=oe(l)?l.call(t):l}return t}function Ng(t,e,n){return t==null?t:wn(t,e,n)}function Ug(t,e,n,s){return s=typeof s=="function"?s:r,t==null?t:wn(t,e,n,s)}var Pu=Ya(at),Nu=Ya(mt);function Fg(t,e,n){var s=F(t),a=s||Se(t)||Ze(t);if(e=T(e,4),n==null){var l=t&&t.constructor;a?n=s?new l:[]:tt(t)?n=oe(l)?ze(qn(t)):{}:n={}}return(a?It:Jt)(t,function(h,g,v){return e(n,h,g,v)}),n}function Wg(t,e){return t==null?!0:mi(t,e)}function Gg(t,e,n){return t==null?t:Ea(t,e,Ci(n))}function Bg(t,e,n,s){return s=typeof s=="function"?s:r,t==null?t:Ea(t,e,Ci(n),s)}function Je(t){return t==null?[]:ei(t,at(t))}function kg(t){return t==null?[]:ei(t,mt(t))}function $g(t,e,n){return n===r&&(n=e,e=r),n!==r&&(n=Ut(n),n=n===n?n:0),e!==r&&(e=Ut(e),e=e===e?e:0),Ae(Ut(t),e,n)}function Hg(t,e,n){return e=le(e),n===r?(n=e,e=0):n=le(n),t=Ut(t),Jf(t,e,n)}function zg(t,e,n){if(n&&typeof n!="boolean"&&pt(t,e,n)&&(e=n=r),n===r&&(typeof e=="boolean"?(n=e,e=r):typeof t=="boolean"&&(n=t,t=r)),t===r&&e===r?(t=0,e=1):(t=le(t),e===r?(e=t,t=0):e=le(e)),t>e){var s=t;t=e,e=s}if(n||t%1||e%1){var a=sa();return ct(t+a*(e-t+Sl("1e-"+((a+"").length-1))),e)}return vi(t,e)}var qg=Ye(function(t,e,n){return e=e.toLowerCase(),t+(n?Uu(e):e)});function Uu(t){return zi(K(t).toLowerCase())}function Fu(t){return t=K(t),t&&t.replace(Yo,Pl).replace(cl,"")}function Yg(t,e,n){t=K(t),e=Dt(e);var s=t.length;n=n===r?s:Ae(B(n),0,s);var a=n;return n-=e.length,n>=0&&t.slice(n,a)==e}function Kg(t){return t=K(t),t&&Lo.test(t)?t.replace(gs,Nl):t}function Zg(t){return t=K(t),t&&Oo.test(t)?t.replace(Gr,"\\$&"):t}var Jg=Ye(function(t,e,n){return t+(n?"-":"")+e.toLowerCase()}),Xg=Ye(function(t,e,n){return t+(n?" ":"")+e.toLowerCase()}),Qg=Ba("toLowerCase");function Vg(t,e,n){t=K(t),e=B(e);var s=e?Ge(t):0;if(!e||s>=e)return t;var a=(e-s)/2;return or(Jn(a),n)+t+or(Zn(a),n)}function jg(t,e,n){t=K(t),e=B(e);var s=e?Ge(t):0;return e&&s<e?t+or(e-s,n):t}function tp(t,e,n){t=K(t),e=B(e);var s=e?Ge(t):0;return e&&s<e?or(e-s,n)+t:t}function ep(t,e,n){return n||e==null?e=0:e&&(e=+e),of(K(t).replace(Br,""),e||0)}function np(t,e,n){return(n?pt(t,e,n):e===r)?e=1:e=B(e),wi(K(t),e)}function rp(){var t=arguments,e=K(t[0]);return t.length<3?e:e.replace(t[1],t[2])}var ip=Ye(function(t,e,n){return t+(n?"_":"")+e.toLowerCase()});function sp(t,e,n){return n&&typeof n!="number"&&pt(t,e,n)&&(e=n=r),n=n===r?Zt:n>>>0,n?(t=K(t),t&&(typeof e=="string"||e!=null&&!ki(e))&&(e=Dt(e),!e&&We(t))?me(kt(t),0,n):t.split(e,n)):[]}var ap=Ye(function(t,e,n){return t+(n?" ":"")+zi(e)});function up(t,e,n){return t=K(t),n=n==null?0:Ae(B(n),0,t.length),e=Dt(e),t.slice(n,n+e.length)==e}function op(t,e,n){var s=o.templateSettings;n&&pt(t,e,n)&&(e=r),t=K(t),e=mr({},e,s,Ka);var a=mr({},e.imports,s.imports,Ka),l=at(a),h=ei(a,l),g,v,S=0,x=e.interpolate||Mn,C="__p += '",R=ri((e.escape||Mn).source+"|"+x.source+"|"+(x===ps?Bo:Mn).source+"|"+(e.evaluate||Mn).source+"|$","g"),E="//# sourceURL="+(J.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++_l+"]")+`
`;t.replace(R,function(M,H,q,Lt,_t,bt){return q||(q=Lt),C+=t.slice(S,bt).replace(Ko,Ul),H&&(g=!0,C+=`' +
__e(`+H+`) +
'`),_t&&(v=!0,C+=`';
`+_t+`;
__p += '`),q&&(C+=`' +
((__t = (`+q+`)) == null ? '' : __t) +
'`),S=bt+M.length,M}),C+=`';
`;var O=J.call(e,"variable")&&e.variable;if(!O)C=`with (obj) {
`+C+`
}
`;else if(Wo.test(O))throw new U(w);C=(v?C.replace(xo,""):C).replace(Co,"$1").replace(Do,"$1;"),C="function("+(O||"obj")+`) {
`+(O?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(g?", __e = _.escape":"")+(v?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+C+`return __p
}`;var k=Gu(function(){return Y(l,E+"return "+C).apply(r,h)});if(k.source=C,Bi(k))throw k;return k}function lp(t){return K(t).toLowerCase()}function fp(t){return K(t).toUpperCase()}function cp(t,e,n){if(t=K(t),t&&(n||e===r))return Zs(t);if(!t||!(e=Dt(e)))return t;var s=kt(t),a=kt(e),l=Js(s,a),h=Xs(s,a)+1;return me(s,l,h).join("")}function hp(t,e,n){if(t=K(t),t&&(n||e===r))return t.slice(0,Vs(t)+1);if(!t||!(e=Dt(e)))return t;var s=kt(t),a=Xs(s,kt(e))+1;return me(s,0,a).join("")}function dp(t,e,n){if(t=K(t),t&&(n||e===r))return t.replace(Br,"");if(!t||!(e=Dt(e)))return t;var s=kt(t),a=Js(s,kt(e));return me(s,a).join("")}function gp(t,e){var n=so,s=ao;if(tt(e)){var a="separator"in e?e.separator:a;n="length"in e?B(e.length):n,s="omission"in e?Dt(e.omission):s}t=K(t);var l=t.length;if(We(t)){var h=kt(t);l=h.length}if(n>=l)return t;var g=n-Ge(s);if(g<1)return s;var v=h?me(h,0,g).join(""):t.slice(0,g);if(a===r)return v+s;if(h&&(g+=v.length-g),ki(a)){if(t.slice(g).search(a)){var S,x=v;for(a.global||(a=ri(a.source,K(_s.exec(a))+"g")),a.lastIndex=0;S=a.exec(x);)var C=S.index;v=v.slice(0,C===r?g:C)}}else if(t.indexOf(Dt(a),g)!=g){var R=v.lastIndexOf(a);R>-1&&(v=v.slice(0,R))}return v+s}function pp(t){return t=K(t),t&&Ro.test(t)?t.replace(ds,Hl):t}var _p=Ye(function(t,e,n){return t+(n?" ":"")+e.toUpperCase()}),zi=Ba("toUpperCase");function Wu(t,e,n){return t=K(t),e=n?r:e,e===r?Wl(t)?Yl(t):El(t):t.match(e)||[]}var Gu=$(function(t,e){try{return xt(t,r,e)}catch(n){return Bi(n)?n:new U(n)}}),vp=ae(function(t,e){return It(e,function(n){n=Qt(n),ie(t,n,Wi(t[n],t))}),t});function wp(t){var e=t==null?0:t.length,n=T();return t=e?j(t,function(s){if(typeof s[1]!="function")throw new Tt(p);return[n(s[0]),s[1]]}):[],$(function(s){for(var a=-1;++a<e;){var l=t[a];if(xt(l[0],this,s))return xt(l[1],this,s)}})}function yp(t){return zf(Mt(t,G))}function qi(t){return function(){return t}}function mp(t,e){return t==null||t!==t?e:t}var Sp=$a(),xp=$a(!0);function St(t){return t}function Yi(t){return wa(typeof t=="function"?t:Mt(t,G))}function Cp(t){return ma(Mt(t,G))}function Dp(t,e){return Sa(t,Mt(e,G))}var Rp=$(function(t,e){return function(n){return _n(n,t,e)}}),Lp=$(function(t,e){return function(n){return _n(t,n,e)}});function Ki(t,e,n){var s=at(e),a=er(e,s);n==null&&!(tt(e)&&(a.length||!s.length))&&(n=e,e=t,t=this,a=er(e,at(e)));var l=!(tt(n)&&"chain"in n)||!!n.chain,h=oe(t);return It(a,function(g){var v=e[g];t[g]=v,h&&(t.prototype[g]=function(){var S=this.__chain__;if(l||S){var x=t(this.__wrapped__),C=x.__actions__=wt(this.__actions__);return C.push({func:v,args:arguments,thisArg:t}),x.__chain__=S,x}return v.apply(t,ge([this.value()],arguments))})}),t}function bp(){return ot._===this&&(ot._=Vl),this}function Zi(){}function Ap(t){return t=B(t),$(function(e){return xa(e,t)})}var Ep=Ri(j),Ip=Ri(Hs),Tp=Ri(Xr);function Bu(t){return Oi(t)?Qr(Qt(t)):uc(t)}function Op(t){return function(e){return t==null?r:Ee(t,e)}}var Mp=za(),Pp=za(!0);function Ji(){return[]}function Xi(){return!1}function Np(){return{}}function Up(){return""}function Fp(){return!0}function Wp(t,e){if(t=B(t),t<1||t>he)return[];var n=Zt,s=ct(t,Zt);e=T(e),t-=Zt;for(var a=ti(s,e);++n<t;)e(n);return a}function Gp(t){return F(t)?j(t,Qt):Rt(t)?[t]:wt(au(K(t)))}function Bp(t){var e=++Xl;return K(t)+e}var kp=ur(function(t,e){return t+e},0),$p=Li("ceil"),Hp=ur(function(t,e){return t/e},1),zp=Li("floor");function qp(t){return t&&t.length?tr(t,St,ci):r}function Yp(t,e){return t&&t.length?tr(t,T(e,2),ci):r}function Kp(t){return Ys(t,St)}function Zp(t,e){return Ys(t,T(e,2))}function Jp(t){return t&&t.length?tr(t,St,pi):r}function Xp(t,e){return t&&t.length?tr(t,T(e,2),pi):r}var Qp=ur(function(t,e){return t*e},1),Vp=Li("round"),jp=ur(function(t,e){return t-e},0);function t_(t){return t&&t.length?jr(t,St):0}function e_(t,e){return t&&t.length?jr(t,T(e,2)):0}return o.after=Cd,o.ary=vu,o.assign=fg,o.assignIn=Tu,o.assignInWith=mr,o.assignWith=cg,o.at=hg,o.before=wu,o.bind=Wi,o.bindAll=vp,o.bindKey=yu,o.castArray=Nd,o.chain=gu,o.chunk=zc,o.compact=qc,o.concat=Yc,o.cond=wp,o.conforms=yp,o.constant=qi,o.countBy=td,o.create=dg,o.curry=mu,o.curryRight=Su,o.debounce=xu,o.defaults=gg,o.defaultsDeep=pg,o.defer=Dd,o.delay=Rd,o.difference=Kc,o.differenceBy=Zc,o.differenceWith=Jc,o.drop=Xc,o.dropRight=Qc,o.dropRightWhile=Vc,o.dropWhile=jc,o.fill=th,o.filter=nd,o.flatMap=sd,o.flatMapDeep=ad,o.flatMapDepth=ud,o.flatten=fu,o.flattenDeep=eh,o.flattenDepth=nh,o.flip=Ld,o.flow=Sp,o.flowRight=xp,o.fromPairs=rh,o.functions=xg,o.functionsIn=Cg,o.groupBy=od,o.initial=sh,o.intersection=ah,o.intersectionBy=uh,o.intersectionWith=oh,o.invert=Rg,o.invertBy=Lg,o.invokeMap=fd,o.iteratee=Yi,o.keyBy=cd,o.keys=at,o.keysIn=mt,o.map=gr,o.mapKeys=Ag,o.mapValues=Eg,o.matches=Cp,o.matchesProperty=Dp,o.memoize=_r,o.merge=Ig,o.mergeWith=Ou,o.method=Rp,o.methodOf=Lp,o.mixin=Ki,o.negate=vr,o.nthArg=Ap,o.omit=Tg,o.omitBy=Og,o.once=bd,o.orderBy=hd,o.over=Ep,o.overArgs=Ad,o.overEvery=Ip,o.overSome=Tp,o.partial=Gi,o.partialRight=Cu,o.partition=dd,o.pick=Mg,o.pickBy=Mu,o.property=Bu,o.propertyOf=Op,o.pull=hh,o.pullAll=hu,o.pullAllBy=dh,o.pullAllWith=gh,o.pullAt=ph,o.range=Mp,o.rangeRight=Pp,o.rearg=Ed,o.reject=_d,o.remove=_h,o.rest=Id,o.reverse=Ui,o.sampleSize=wd,o.set=Ng,o.setWith=Ug,o.shuffle=yd,o.slice=vh,o.sortBy=xd,o.sortedUniq=Dh,o.sortedUniqBy=Rh,o.split=sp,o.spread=Td,o.tail=Lh,o.take=bh,o.takeRight=Ah,o.takeRightWhile=Eh,o.takeWhile=Ih,o.tap=qh,o.throttle=Od,o.thru=dr,o.toArray=Au,o.toPairs=Pu,o.toPairsIn=Nu,o.toPath=Gp,o.toPlainObject=Iu,o.transform=Fg,o.unary=Md,o.union=Th,o.unionBy=Oh,o.unionWith=Mh,o.uniq=Ph,o.uniqBy=Nh,o.uniqWith=Uh,o.unset=Wg,o.unzip=Fi,o.unzipWith=du,o.update=Gg,o.updateWith=Bg,o.values=Je,o.valuesIn=kg,o.without=Fh,o.words=Wu,o.wrap=Pd,o.xor=Wh,o.xorBy=Gh,o.xorWith=Bh,o.zip=kh,o.zipObject=$h,o.zipObjectDeep=Hh,o.zipWith=zh,o.entries=Pu,o.entriesIn=Nu,o.extend=Tu,o.extendWith=mr,Ki(o,o),o.add=kp,o.attempt=Gu,o.camelCase=qg,o.capitalize=Uu,o.ceil=$p,o.clamp=$g,o.clone=Ud,o.cloneDeep=Wd,o.cloneDeepWith=Gd,o.cloneWith=Fd,o.conformsTo=Bd,o.deburr=Fu,o.defaultTo=mp,o.divide=Hp,o.endsWith=Yg,o.eq=Ht,o.escape=Kg,o.escapeRegExp=Zg,o.every=ed,o.find=rd,o.findIndex=ou,o.findKey=_g,o.findLast=id,o.findLastIndex=lu,o.findLastKey=vg,o.floor=zp,o.forEach=pu,o.forEachRight=_u,o.forIn=wg,o.forInRight=yg,o.forOwn=mg,o.forOwnRight=Sg,o.get=$i,o.gt=kd,o.gte=$d,o.has=Dg,o.hasIn=Hi,o.head=cu,o.identity=St,o.includes=ld,o.indexOf=ih,o.inRange=Hg,o.invoke=bg,o.isArguments=Oe,o.isArray=F,o.isArrayBuffer=Hd,o.isArrayLike=yt,o.isArrayLikeObject=nt,o.isBoolean=zd,o.isBuffer=Se,o.isDate=qd,o.isElement=Yd,o.isEmpty=Kd,o.isEqual=Zd,o.isEqualWith=Jd,o.isError=Bi,o.isFinite=Xd,o.isFunction=oe,o.isInteger=Du,o.isLength=wr,o.isMap=Ru,o.isMatch=Qd,o.isMatchWith=Vd,o.isNaN=jd,o.isNative=tg,o.isNil=ng,o.isNull=eg,o.isNumber=Lu,o.isObject=tt,o.isObjectLike=et,o.isPlainObject=xn,o.isRegExp=ki,o.isSafeInteger=rg,o.isSet=bu,o.isString=yr,o.isSymbol=Rt,o.isTypedArray=Ze,o.isUndefined=ig,o.isWeakMap=sg,o.isWeakSet=ag,o.join=lh,o.kebabCase=Jg,o.last=Nt,o.lastIndexOf=fh,o.lowerCase=Xg,o.lowerFirst=Qg,o.lt=ug,o.lte=og,o.max=qp,o.maxBy=Yp,o.mean=Kp,o.meanBy=Zp,o.min=Jp,o.minBy=Xp,o.stubArray=Ji,o.stubFalse=Xi,o.stubObject=Np,o.stubString=Up,o.stubTrue=Fp,o.multiply=Qp,o.nth=ch,o.noConflict=bp,o.noop=Zi,o.now=pr,o.pad=Vg,o.padEnd=jg,o.padStart=tp,o.parseInt=ep,o.random=zg,o.reduce=gd,o.reduceRight=pd,o.repeat=np,o.replace=rp,o.result=Pg,o.round=Vp,o.runInContext=_,o.sample=vd,o.size=md,o.snakeCase=ip,o.some=Sd,o.sortedIndex=wh,o.sortedIndexBy=yh,o.sortedIndexOf=mh,o.sortedLastIndex=Sh,o.sortedLastIndexBy=xh,o.sortedLastIndexOf=Ch,o.startCase=ap,o.startsWith=up,o.subtract=jp,o.sum=t_,o.sumBy=e_,o.template=op,o.times=Wp,o.toFinite=le,o.toInteger=B,o.toLength=Eu,o.toLower=lp,o.toNumber=Ut,o.toSafeInteger=lg,o.toString=K,o.toUpper=fp,o.trim=cp,o.trimEnd=hp,o.trimStart=dp,o.truncate=gp,o.unescape=pp,o.uniqueId=Bp,o.upperCase=_p,o.upperFirst=zi,o.each=pu,o.eachRight=_u,o.first=cu,Ki(o,function(){var t={};return Jt(o,function(e,n){J.call(o.prototype,n)||(t[n]=e)}),t}(),{chain:!1}),o.VERSION=u,It(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){o[t].placeholder=o}),It(["drop","take"],function(t,e){z.prototype[t]=function(n){n=n===r?1:st(B(n),0);var s=this.__filtered__&&!e?new z(this):this.clone();return s.__filtered__?s.__takeCount__=ct(n,s.__takeCount__):s.__views__.push({size:ct(n,Zt),type:t+(s.__dir__<0?"Right":"")}),s},z.prototype[t+"Right"]=function(n){return this.reverse()[t](n).reverse()}}),It(["filter","map","takeWhile"],function(t,e){var n=e+1,s=n==fs||n==fo;z.prototype[t]=function(a){var l=this.clone();return l.__iteratees__.push({iteratee:T(a,3),type:n}),l.__filtered__=l.__filtered__||s,l}}),It(["head","last"],function(t,e){var n="take"+(e?"Right":"");z.prototype[t]=function(){return this[n](1).value()[0]}}),It(["initial","tail"],function(t,e){var n="drop"+(e?"":"Right");z.prototype[t]=function(){return this.__filtered__?new z(this):this[n](1)}}),z.prototype.compact=function(){return this.filter(St)},z.prototype.find=function(t){return this.filter(t).head()},z.prototype.findLast=function(t){return this.reverse().find(t)},z.prototype.invokeMap=$(function(t,e){return typeof t=="function"?new z(this):this.map(function(n){return _n(n,t,e)})}),z.prototype.reject=function(t){return this.filter(vr(T(t)))},z.prototype.slice=function(t,e){t=B(t);var n=this;return n.__filtered__&&(t>0||e<0)?new z(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),e!==r&&(e=B(e),n=e<0?n.dropRight(-e):n.take(e-t)),n)},z.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},z.prototype.toArray=function(){return this.take(Zt)},Jt(z.prototype,function(t,e){var n=/^(?:filter|find|map|reject)|While$/.test(e),s=/^(?:head|last)$/.test(e),a=o[s?"take"+(e=="last"?"Right":""):e],l=s||/^find/.test(e);a&&(o.prototype[e]=function(){var h=this.__wrapped__,g=s?[1]:arguments,v=h instanceof z,S=g[0],x=v||F(h),C=function(H){var q=a.apply(o,ge([H],g));return s&&R?q[0]:q};x&&n&&typeof S=="function"&&S.length!=1&&(v=x=!1);var R=this.__chain__,E=!!this.__actions__.length,O=l&&!R,k=v&&!E;if(!l&&x){h=k?h:new z(this);var M=t.apply(h,g);return M.__actions__.push({func:dr,args:[C],thisArg:r}),new Ot(M,R)}return O&&k?t.apply(this,g):(M=this.thru(C),O?s?M.value()[0]:M.value():M)})}),It(["pop","push","shift","sort","splice","unshift"],function(t){var e=Gn[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",s=/^(?:pop|shift)$/.test(t);o.prototype[t]=function(){var a=arguments;if(s&&!this.__chain__){var l=this.value();return e.apply(F(l)?l:[],a)}return this[n](function(h){return e.apply(F(h)?h:[],a)})}}),Jt(z.prototype,function(t,e){var n=o[e];if(n){var s=n.name+"";J.call(He,s)||(He[s]=[]),He[s].push({name:e,func:n})}}),He[ar(r,Me).name]=[{name:"wrapper",func:r}],z.prototype.clone=pf,z.prototype.reverse=_f,z.prototype.value=vf,o.prototype.at=Yh,o.prototype.chain=Kh,o.prototype.commit=Zh,o.prototype.next=Jh,o.prototype.plant=Qh,o.prototype.reverse=Vh,o.prototype.toJSON=o.prototype.valueOf=o.prototype.value=jh,o.prototype.first=o.prototype.head,ln&&(o.prototype[ln]=Xh),o},Be=Kl();De?((De.exports=Be)._=Be,Yr._=Be):ot._=Be}).call(q_)}(Rn,Rn.exports)),Rn.exports}var K_=Y_();const Ft=z_(K_);class Z_{async upload(i=[]){return new Promise(r=>{const u=document.createElement("input");u.type="file",i.length&&(u.accept=i.map(f=>`.${f}`).join(",")),u.onchange=async()=>{var w;const f=(w=u.files)==null?void 0:w[0];if(!f)return r(null);const c=f.type.startsWith("text/")||f.name.match(/\.(txt|json|csv|md)$/),p=c?await f.text():new Uint8Array(await f.arrayBuffer());r({data:p,filename:f.name,mimeType:f.type||(c?"text/plain":"application/octet-stream")})},u.click()})}async download({data:i,filename:r,mimeType:u}){const f=i instanceof Uint8Array?new Blob([i],{type:u}):new Blob([i],{type:u});if("showSaveFilePicker"in window){const w=r.includes(".")?r.slice(r.lastIndexOf(".")):"",L=await(await window.showSaveFilePicker({suggestedName:r,types:[{description:"File",accept:{[u]:[w]}}]})).createWritable();await L.write(f),await L.close();return}const c=URL.createObjectURL(f),p=document.createElement("a");p.href=c,p.download=r,p.click(),URL.revokeObjectURL(c)}}class J_{constructor(i){P(this,"reviewCardIdsOverride");P(this,"extraStudyLastCardId");this.app=i}init(){this.reviewCardIdsOverride=void 0}registerReviewCardIdsOverride(i){this.reviewCardIdsOverride=i}isExtraStudy(){return this.reviewCardIdsOverride!==void 0}getNextCard(){if(this.reviewCardIdsOverride){if(this.reviewCardIdsOverride.length===1)return this.reviewCardIdsOverride[0];{const i=this.reviewCardIdsOverride.filter(r=>r!==this.extraStudyLastCardId);return i[Math.floor(Math.random()*i.length)]}}}getCardsCount(){var i;return((i=this.reviewCardIdsOverride)==null?void 0:i.length)??0}rateAgain(i){this.extraStudyLastCardId=i}rateGood(i){if(this.extraStudyLastCardId=i,this.reviewCardIdsOverride){const r=this.reviewCardIdsOverride.indexOf(i);r>=0&&this.reviewCardIdsOverride.splice(r,1)}}getCardIds(i,r){const u=this.app.deckData[i];if(!u)return[];switch(r.type){case At.StudiedCards:{const f=Object.keys(u.schedule).length,c=Math.min(f,r.count),p=Object.keys(u.schedule).map(w=>+w);return Ft.shuffle(p).slice(0,c)}case At.NewCards:{const f=this.app.getNewCardsCount(i),c=Math.min(f,r.count);return this.app.getNewCards(i).slice(0,c)}case At.YoungCards:{const c=this.app.getAllNonIgnoredIds(i).filter(w=>this.app.getWenbunCustomState(i,w)===bn.ReviewYoung),p=Math.min(c.length,r.count);return Ft.shuffle(c).slice(0,p)}case At.MatureCards:{const c=this.app.getAllNonIgnoredIds(i).filter(w=>this.app.getWenbunCustomState(i,w)===bn.ReviewMature),p=Math.min(c.length,r.count);return Ft.shuffle(c).slice(0,p)}case At.Group:{const f=u.groups.find(c=>c.label===r.group);return f?f.cardIds:[]}case At.HardCards:{const f=Object.keys(u.schedule).length,c=Math.min(f,r.count);return Object.entries(u.schedule).sort((D,L)=>L[1].difficulty-D[1].difficulty).map(D=>+D[0]).slice(0,c)}}}getDescription(i,r){const u=this.app.deckData[i];if(!u)return{desc:"",subdesc:""};switch(r.type){case At.StudiedCards:{const f=Object.keys(u.schedule).length;return{desc:`Study ${Math.min(f,r.count)} cards`,subdesc:`(out of ${f} cards that have been studied in this deck)`}}case At.NewCards:{const f=this.app.getNewCardsCount(i);return{desc:`Study the next ${Math.min(f,r.count)} new cards`,subdesc:`(out of ${f} new cards)`}}case At.YoungCards:{const c=this.app.getAllNonIgnoredIds(i).filter(w=>this.app.getWenbunCustomState(i,w)===bn.ReviewYoung);return{desc:`Study ${Math.min(c.length,r.count)} young cards`,subdesc:`(out of ${c.length} young cards)`}}case At.MatureCards:{const c=this.app.getAllNonIgnoredIds(i).filter(w=>this.app.getWenbunCustomState(i,w)===bn.ReviewMature);return{desc:`Study ${Math.min(c.length,r.count)} mature cards`,subdesc:`(out of ${c.length} mature cards)`}}case At.Group:{const f=u.groups.find(p=>p.label===r.group);return f?{desc:`Study ${Math.min(f.cardIds.length,r.count)} cards from ${r.group}`,subdesc:`(out of ${f.cardIds.length} cards)`}:{desc:"ERROR: Group Not Found",subdesc:""}}case At.HardCards:{const f=Object.keys(u.schedule).length;return{desc:`Study ${Math.min(f,r.count)} hardest cards`,subdesc:`(out of ${f} cards that have been studied in this app)`}}}}}const io="https://wenbun-api.photon-ray.xyz";var qt=(d=>(d.Profile="/profile",d.ProfileData="/profiledata",d.ReviewLog="/reviewlog",d.ReviewLogMostRecent="/reviewlog/mostrecent",d.AuthGoogle="/auth/google",d.AuthLogout="/auth/logout",d))(qt||{});function xe(d,i){let r=`${io}${d}`;if(i&&Object.keys(i).length>0){const u=new URLSearchParams;for(const[f,c]of Object.entries(i))u.append(f,String(c));r+=`?${u.toString()}`}return r}function Qu(d){return`${io}${d}`}const Vu="loginStatus";var Ln=(d=>(d.ask="ask",d.forcePull="forcePull",d.forcePush="forcePush",d.normalPull="normalPull",d.normalPush="normalPush",d))(Ln||{});class X_{constructor(i){P(this,"isLoggedIn",!1);P(this,"isSyncConflict",!1);P(this,"syncConflictInfo");P(this,"profileInfo",null);P(this,"storedLoginStatus");this.storage=i}async init(){this.storedLoginStatus=await this.storage.load(Vu);const i=await fetch(xe(qt.Profile),{credentials:"include"});if(i.ok){const r=await i.json();this.isLoggedIn=!0,this.profileInfo=r}else i.status===401?this.isLoggedIn=!1:(this.isLoggedIn=!1,console.warn(`Unexpected status: ${i.status}`));await this.checkAndUpdateLoginStatus()}async updateLoginStatus(i){await this.storage.save(Vu,i),this.storedLoginStatus=i}async checkAndUpdateLoginStatus(){if(this.storedLoginStatus===void 0){const i=this.isLoggedIn?"loggedIn":"loggedOut";await this.updateLoginStatus(i)}}async trySyncProfile(i,r="ask"){if(!this.isLoggedIn)return!1;try{const[u,f]=await Promise.all([this.getProfileData(),this.getLatestReviewLog()]);if(u===null)return(await Promise.all([this.updateProfileData(i.exportProfile(!1)),this.pushReviewLog(f,i.reviewLogs,!0)])).every(p=>p)&&(i.lastSyncTime=new Date().toISOString(),await i.updateLastSyncTime()),!1;{const c=new Date(i.meta.modifiedAt??0),p=new Date(u.meta.modifiedAt??0),w=new Date(i.lastSyncTime??0),D=this.getSyncDecision(c,p,w);let L=Ft.isEqual(u,i.exportProfile(!1))?"none":D;switch(L=await this.autoResolveSyncConflict(L,r,i),L){case"conflict":return this.syncConflictInfo={localModifiedAt:c,remoteModifiedAt:p,lastSyncTime:w},this.isSyncConflict=!0,c_.url.pathname.startsWith("/settings")||window.confirm("Sync Failed, Conflict Detected. Do you want to go to settings?")&&l_(`${f_}/settings/`),!1;case"push":return(await Promise.all([this.updateProfileData(i.exportProfile(!1)),this.pushReviewLog(f,i.reviewLogs)])).every(G=>G)?(i.lastSyncTime=new Date().toISOString(),await i.updateLastSyncTime()):window.alert("Failed to push profile data to server"),this.isSyncConflict=!1,!1;case"pull":return(await Promise.all([i.tryImportProfile(u,!1,!0),this.pullReviewLog(i)])).every(G=>G)?(i.lastSyncTime=new Date().toISOString(),await i.updateLastSyncTime()):window.alert("Failed to pull profile data from server"),this.isSyncConflict=!1,!0;case"none":return this.isSyncConflict=!1,!1}}}catch(u){return console.error(u),!1}}async autoResolveSyncConflict(i,r,u){if(i!=="conflict")return i;switch(r){case"ask":return"conflict";case"normalPull":return"pull";case"normalPush":return"push";case"forcePull":return await this.tryForcePull(u),"pull";case"forcePush":return await this.tryForcePush(u),"push"}}async tryForcePull(i){const r=await this.getProfileData(),u=await Promise.all([this.updateProfileData(i.exportProfile(!1),"pull"),this.pullReviewLog(i,!0)]),f=await i.tryImportProfile(r,!1,!0);u.every(c=>c)&&f?(i.lastSyncTime=new Date().toISOString(),await i.updateLastSyncTime(),this.isSyncConflict=!1):window.alert("Failed to pull profile data from server")}async tryForcePush(i){(await Promise.all([this.updateProfileData(i.exportProfile(!1),"push"),this.pushReviewLog(null,i.reviewLogs,!0)])).every(u=>u)?(i.lastSyncTime=new Date().toISOString(),await i.updateLastSyncTime(),this.isSyncConflict=!1):window.alert("Failed to push profile data to server")}getSyncDecision(i,r,u){const f=i>u,c=r>u;return f&&c?"conflict":f?"push":c?"pull":"none"}getName(){var i;return((i=this.profileInfo)==null?void 0:i.name)??"(no name)"}async getProfileData(){const i=await fetch(xe(qt.ProfileData),{credentials:"include"});if(i.status===204)return null;if(i.ok)return await i.json();throw new Error(`Unexpected status: ${i.status}`)}async updateProfileData(i,r="normal"){return(await fetch(xe(qt.ProfileData,{decision:r}),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).ok}async getLatestReviewLog(){const i=await fetch(xe(qt.ReviewLogMostRecent),{credentials:"include"});if(i.status===204)return null;if(i.ok)return await i.json();throw new Error(`Unexpected status: ${i.status}`)}async pushReviewLog(i,r,u=!1){if(i===null||u)return(await fetch(xe(qt.ReviewLog,{force:u}),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).ok;{const f=+new Date(i.log.review),c=r.findLastIndex(D=>{const L=D.log.review;return+new Date(L)<=f}),p=r.slice(c+1);return(await fetch(xe(qt.ReviewLog),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)})).ok}}async pullReviewLog(i,r=!1){try{const u=await this.getReviewLogs(i.reviewLogs,r);return u===null||(r?i.reviewLogs=u:i.reviewLogs.push(...u),i.save(!1)),!0}catch(u){return console.error(u),!1}}async getReviewLogs(i,r=!1){var u;if(r){const f=new Date(0).toISOString(),c=await fetch(xe(qt.ReviewLog,{from:f}),{method:"GET",credentials:"include"});if(c.status===204)return null;if(c.ok)return(await c.json()).map(w=>w.review_log);throw new Error(`Unexpected status: ${c.status}`)}else{const f=i[i.length-1],c=new Date(((u=f==null?void 0:f.log)==null?void 0:u.review)??0).toISOString(),p=await fetch(xe(qt.ReviewLog,{from:c}),{method:"GET",credentials:"include"});if(p.status===204)return null;if(p.ok)return await p.json();throw new Error(`Unexpected status: ${p.status}`)}}async loginGoogle(i){window.location.assign(Qu(qt.AuthGoogle))}async logout(i){await this.updateLoginStatus(void 0),await i.updateLastSyncTime(new Date(0)),window.location.assign(Qu(qt.AuthLogout))}isAutomaticallyLoggedOut(){return!this.isLoggedIn&&this.storedLoginStatus==="loggedIn"}}const Q_="__ungrouped__",ju="profile.json",ts="decks",es="deckData",ns="config",rs="reviewLogs",is="autoReviewGradeLog",to="meta",ss="lastSyncTime",V_=[b.Again,b.Hard,b.Good,b.Easy],j_=30,eo=3;var bn=(d=>(d.New="New",d.WarmUp="WarmUp",d.Learning="Learning",d.ReviewYoung="Young",d.ReviewMature="Mature",d.Relearning="Relearning",d.PreviouslyStudied="Previously Studied",d.Ignored="Ignored",d))(bn||{}),tv=(d=>(d.Mix="Mix",d.AfterReviews="After Reviews",d.BeforeReviews="Before Reviews",d))(tv||{}),At=(d=>(d.StudiedCards="Studied Cards",d.HardCards="Hard Cards",d.NewCards="New Cards",d.YoungCards="Young Cards",d.MatureCards="Mature Cards",d.Group="Group",d))(At||{});const Dn={newCardPerDay:5,maxReviewsPerDay:200,newCardOrder:"Mix",newPreviouslyStudiedCardPerDay:20,newPreviouslyStudiedCardOrder:"Mix",startPreviouslyStudiedCardFromTheBack:!0,uiScale:"normal",customFontSize:16,gradingMethod:"auto",strokeLeniency:2,learningSteps:["1m","10m"],previouslyStudiedLearningSteps:["1m","5d"],desiredRetention:.9,enableShortTerm:!1,enableFuzz:!1,FSRSParams:a_,zh:{isColorBasedOnTone:!0,toneColors:s_.Default,alwaysShowReading:!1,mandarinReading:i_.Pinyin,playAudio:!0}};class sv{constructor(){P(this,"decks",[]);P(this,"deckData",{});P(this,"config",Dn);P(this,"reviewLogs",[]);P(this,"autoReviewGradeLog",[]);P(this,"meta",{});P(this,"lastSyncTime",new Date(0).toISOString());P(this,"isLoadDone",!1);P(this,"fsrs");P(this,"fsrsPrevStudied");P(this,"storage");P(this,"fileManager");P(this,"extraStudyHandler");P(this,"profile");this.updateFSRS(),ji()?this.storage=new k_(ju):this.storage=new H_(ju),this.fileManager=new Z_,this.extraStudyHandler=new J_(this),this.profile=new X_(this.storage)}updateFSRS(){const i=this.getConfig(),r=Rr({request_retention:i.desiredRetention,w:i.FSRSParams,enable_fuzz:i.enableFuzz,enable_short_term:i.enableShortTerm,learning_steps:i.learningSteps});this.fsrs=new Ku(r);const u=Rr({request_retention:i.desiredRetention,w:i.FSRSParams,enable_fuzz:i.enableFuzz,enable_short_term:i.enableShortTerm,learning_steps:i.previouslyStudiedLearningSteps});this.fsrsPrevStudied=new Ku(u)}async init(){await this.load(),this.updateFontSize(),this.extraStudyHandler.init(),this.updateFSRS(),this.isNeedToProcessTodaySchedule()&&await this.processTodaySchedule()}async initProfile(){if(await this.profile.init(),this.profile.isLoggedIn){const i=ji()?Ln.ask:Ln.forcePull;return await this.profile.trySyncProfile(this,i)}else return!1}async debug(){this.decks=["test"],this.deckData={},this.reviewLogs=[],this.config=Dn,await this.ensureDeckData(),await this.save()}updateFontSize(){const i=`${this.getFontSizePx()}px`;document.body.style.fontSize=i}getCurrentUIScale(){return this.getFontSizePx()/16}getFontSizePx(){const i=this.getConfig();switch(i.uiScale){case"small":return 10;case"normal":return 16;case"custom":return Ft.clamp(i.customFontSize,8,32)}}async load(){const[i,r,u,f,c,p,w]=await Promise.all([this.storage.load(ts),this.storage.load(es),this.storage.load(ns),this.storage.load(rs),this.storage.load(is),this.storage.load(to),this.storage.load(ss)]);this.decks=i||[],this.deckData=r||{},this.config=u||Dn,this.reviewLogs=f||[],this.autoReviewGradeLog=c||[],this.meta=p||{},this.lastSyncTime=w||new Date(0).toISOString(),this.isLoadDone=!0}async save(i=!1,r=!1){if(await this.isDataChanged()&&(this.updateFontSize(),this.meta.modifiedAt=new Date().toISOString(),this.meta._profileVersion=1,await Promise.all([this.storage.save(ts,this.decks),this.storage.save(es,this.deckData),this.storage.save(ns,this.config),this.storage.save(rs,this.reviewLogs),this.storage.save(is,this.autoReviewGradeLog),this.storage.save(to,this.meta),this.storage.save(ss,this.lastSyncTime)]),!i)){const f=ji()?Ln.ask:Ln.normalPush;r?await this.profile.trySyncProfile(this,f):this.profile.trySyncProfile(this,f).catch(console.error)}}async updateLastSyncTime(i=new Date){this.lastSyncTime=i.toISOString(),await this.storage.save(ss,this.lastSyncTime)}async isDataChanged(){const[i,r,u,f,c]=await Promise.all([this.storage.load(ts),this.storage.load(es),this.storage.load(ns),this.storage.load(rs),this.storage.load(is)]);return!Ft.isEqual(this.decks,i)||!Ft.isEqual(this.deckData,r)||!Ft.isEqual(this.config,u)||!Ft.isEqual(this.reviewLogs,f)||!Ft.isEqual(this.autoReviewGradeLog,c)}exportProfileStr(i=!0){return JSON.stringify(this.exportProfile(i))}async tryImportProfileStr(i,r=!0){try{const u=JSON.parse(i);return this.tryImportProfile(u,r)}catch{return!1}}exportProfile(i=!0){return{config:this.config,decks:this.decks,deckData:this.deckData,reviewLogs:i?this.reviewLogs:[],meta:this.meta}}async tryImportProfile(i,r=!0,u=!1){try{const{config:f,decks:c,deckData:p,reviewLogs:w,meta:D}=i;return this.config=f,this.decks=c,this.deckData=p,r&&(this.reviewLogs=w),await this.save(u),!0}catch{return!1}}isNeedToProcessTodaySchedule(){const i=new Date;for(const r of Object.keys(this.deckData)){const u=this.deckData[r];if(new Date(u.lastScheduleCheckDate).getDate()<i.getDate())return!0}return!1}async processTodaySchedule(){const i=new Date,r=Sr(i);for(const u of Object.keys(this.deckData)){const f=this.deckData[u];Sr(new Date(f.lastScheduleCheckDate))<r&&(f.doneTodayNewCardCount=0,f.doneTodayPreviouslyStudiedCardCount=0,f.doneTodayReviewCount=0,f.lastScheduleCheckDate=i.getTime())}await this.save()}async getInitDeckData(i){const r=u_.find(f=>f.id===i),u=await o_((r==null?void 0:r.src)??`${i}.txt`);if(u)return{deck:u,tags:(r==null?void 0:r.tags)??[],groups:[{label:Q_,cardIds:Array.from(u.keys())}],ignoredIds:[],previouslyStudied:[],schedule:{},lastScheduleCheckDate:new Date(0).getTime(),doneTodayNewCardCount:0,doneTodayPreviouslyStudiedCardCount:0,doneTodayReviewCount:0}}async addDeck(i){this.decks.includes(i)||(this.decks.push(i),await this.ensureDeckDataById(i),this.splitDeckIntoGroupOfN(i,j_),await this.save())}async deleteDeck(i,r=!1){r&&(this.decks.includes(i)&&(this.decks=this.decks.filter(u=>u!=i)),delete this.deckData[i])}async ensureDeckData(){const i=this.decks.map(async r=>{await this.ensureDeckDataById(r)});await Promise.all(i)}async ensureDeckDataById(i){if(!this.deckData[i]){const r=await this.getInitDeckData(i);if(!r)return Promise.reject(new Error("loading deck failed"));this.deckData[i]=r}}getConfig(){return Ft.merge({},Dn,this.config)}async resetConfigToDefault(){this.config=Ft.cloneDeep(Dn),await this.save()}async saveConfig(i){this.config=i,await this.save()}rateCard(i,r,u,f){var I,G;this.stopWarmUp(i,r);const c=this.deckData[i],p=this.getCard(i,r,!0);if(!p)return;const L=(((G=(I=this.deckData[i])==null?void 0:I.previouslyStudied)==null?void 0:G.includes(r))?this.fsrsPrevStudied:this.fsrs).repeat(p,f??new Date);this.setCard(i,r,L[u].card),this.pushReviewLog(i,r,L[u].log),c.previouslyStudied.includes(r)?(c.previouslyStudied.splice(c.previouslyStudied.indexOf(r),1),c.doneTodayPreviouslyStudiedCardCount++):p.state===W.New?c.doneTodayNewCardCount++:p.state===W.Review&&c.doneTodayReviewCount++}warmUpNext(i,r){var f;const u=this.deckData[i];u&&((f=u.warmUpIds)==null?void 0:f[r])!==void 0&&u.warmUpIds[r]++}getNextCard(i){if(this.extraStudyHandler.isExtraStudy())return this.extraStudyHandler.getNextCard();const r=this.getConfig(),u=this.getScheduledNewOrWarmUpCardsCount(i),f=this.getScheduledPreviouslyStudiedCardsCount(i),c=this.getScheduledReviewCardsCount(i),p=u>0?this.getNewOrWarmUpCard(i):void 0,w=f>0?this.getPreviouslyStudiedCard(i):void 0,D=c>0?this.getTodaysScheduledCards(i)[0]:void 0,L=[],I=[D],G=[];if(r.newCardOrder==="Before Reviews"&&L.push(p),r.newCardOrder==="After Reviews"&&G.push(p),r.newPreviouslyStudiedCardOrder==="Before Reviews"&&L.push(w),r.newPreviouslyStudiedCardOrder==="After Reviews"&&G.push(w),r.newCardOrder==="Mix"){const Z=u/(u+c);Math.random()<Z?I.unshift(p):I.push(p)}if(r.newPreviouslyStudiedCardOrder==="Mix"){const Z=f/(u+f+c);Math.random()<Z?I.unshift(w):I.push(w)}return[...L,...I,...G].reduce((Z,ut)=>Z??ut,void 0)}skipWarmUp(i,r){const u=this.deckData[i];u&&(this.startWarmUp(i,r),u.warmUpIds[r]=eo)}startWarmUp(i,r){const u=this.deckData[i];u&&(u.warmUpIds===void 0&&(u.warmUpIds={}),u.warmUpIds[r]=0)}stopWarmUp(i,r){var f;const u=(f=this.deckData[i])==null?void 0:f.warmUpIds;u&&delete u[r]}getWarmUpCount(i,r){var u,f;return(f=(u=this.deckData[i])==null?void 0:u.warmUpIds)==null?void 0:f[r]}getMaxWarmUpCount(){return eo}isWarmUpCard(i,r){return this.getWarmUpCount(i,r)!==void 0}getNewOrWarmUpCard(i){const u=this.getScheduledNewOrWarmUpCardsCount(i)-this.getWarmUpCardsCount(i),f=this.getNewCard(i),c=this.deckData[i];if(!c.warmUpIds)return f;const p=Object.keys(c.warmUpIds),w=+p[Math.floor(Math.random()*p.length)];if(u<=0)return w;const D=this.getNewCardsCount(i),L=p.length;if(D+L!==0)return Math.random()<D/(D+L)?f:w}getNewCard(i){return this.getNewCards(i)[0]}getNewCards(i){return this.deckData[i].groups.flatMap(p=>p.cardIds).filter(p=>this.getWenbunCustomState(i,p)==="New")}getPreviouslyStudiedCard(i){var u;const r=this.deckData[i];if(r)return this.getConfig().startPreviouslyStudiedCardFromTheBack?(u=r.previouslyStudied)==null?void 0:u[r.previouslyStudied.length-1]:r.previouslyStudied[0]}getNewCardsCount(i){return this.getNewCards(i).length}getPreviouslyStudiedCardCount(i){var r;return((r=this.deckData[i])==null?void 0:r.previouslyStudied.length)??0}getWarmUpCardsCount(i){var r;return(r=this.deckData[i])!=null&&r.warmUpIds?Object.keys(this.deckData[i].warmUpIds).length:0}pushReviewLog(i,r,u){this.reviewLogs.push({deckId:i,cardId:r,log:u})}setCard(i,r,u){const f=this.deckData[i];f&&(f.schedule[r]=u)}getCard(i,r,u=!1){const f=this.deckData[i];if(f)return u&&f.schedule[r]===void 0?Lr():f.schedule[r]}getCardWord(i,r){const u=this.deckData[i];if(!u)return"";const f=u.deck[r];return f||""}getCardDue(i,r){var u;return(u=this.getCard(i,r))==null?void 0:u.due}getCardDueFormatted(i,r){if(this.isWarmUpCard(i,r))return"Warm Up";const u=this.getCardDue(i,r);return u?$u(new Date,new Date(u)):"Not Started"}getRatingScheduledTimeStr(i,r){var D,L;const u=this.getCard(i,r,!0);let f={1:"",2:"",3:"",4:""};if(!u)return f;const w=(((L=(D=this.deckData[i])==null?void 0:D.previouslyStudied)==null?void 0:L.includes(r))?this.fsrsPrevStudied:this.fsrs).repeat(u,new Date);for(const I of V_){const G=w[I].log.due,dt=w[I].card.due;f[I]=$u(G,dt)}return f}getWenbunCustomState(i,r){var f,c,p,w,D,L;if(((c=(f=this.deckData[i])==null?void 0:f.warmUpIds)==null?void 0:c[r])!==void 0)return"WarmUp";if((w=(p=this.deckData[i])==null?void 0:p.previouslyStudied)!=null&&w.includes(r))return"Previously Studied";if((L=(D=this.deckData[i])==null?void 0:D.ignoredIds)!=null&&L.includes(r))return"Ignored";const u=this.getCard(i,r);switch(u==null?void 0:u.state){case W.Learning:return"Learning";case W.Review:return u.scheduled_days>=21?"Mature":"Young";case W.Relearning:return"Relearning";case W.New:default:return"New"}}getTodaysReviewCards(i){const r=this.deckData[i];return this.getTodaysScheduledCards(i).filter(c=>{var p;return((p=r.schedule[c])==null?void 0:p.state)===W.Review})}getScheduledReviewCardsCount(i){const r=this.deckData[i],u=this.getTodaysReviewCards(i),f=this.getConfig(),c=Math.min(u.length,f.maxReviewsPerDay-r.doneTodayReviewCount);return Math.max(0,c)}getScheduledNewOrWarmUpCardsCount(i){const r=this.getConfig(),u=this.deckData[i],f=this.getNewCardsCount(i),c=this.getWarmUpCardsCount(i),p=Math.min(f+c,r.newCardPerDay-u.doneTodayNewCardCount);return Math.max(0,p)}getScheduledPreviouslyStudiedCardsCount(i){const r=this.getConfig(),u=this.deckData[i],f=Math.min(this.getPreviouslyStudiedCardCount(i),r.newPreviouslyStudiedCardPerDay-u.doneTodayPreviouslyStudiedCardCount);return Math.max(0,f)}getLearningRelearningCardsCount(i){const r=this.deckData[i];return Object.entries(r.schedule).filter(([u,f])=>f.state===W.Learning||f.state===W.Relearning).length}addPreviouslyStudiedMark(i,r){const u=this.deckData[i];!u||u.previouslyStudied.includes(r)||this.getWenbunCustomState(i,r)!=="New"||u.previouslyStudied.push(r)}removePreviouslyStudiedMark(i,r){const u=this.deckData[i];if(!u)return;const f=u.previouslyStudied.indexOf(r);f<0||u.previouslyStudied.splice(f,1)}ensureIgnoreIdArray(i){const r=this.deckData[i];r&&(r.ignoredIds||(r.ignoredIds=[]))}addIgnoredMark(i,r){var f,c;const u=this.deckData[i];u&&(this.ensureIgnoreIdArray(i),!((f=u.ignoredIds)!=null&&f.includes(r))&&((c=u.ignoredIds)==null||c.push(r)))}removeIgnoredMark(i,r){var c,p;const u=this.deckData[i];if(!u)return;const f=(c=u.ignoredIds)==null?void 0:c.indexOf(r);f==null||f<0||(p=u.ignoredIds)==null||p.splice(f,1)}getTodaysScheduledCards(i){const r=this.deckData[i];if(!r)return[];const f=Sr(new Date)+1,c=Object.entries(r.schedule).filter(([p,w])=>{var I;if(!!((I=r.ignoredIds)!=null&&I.includes(+p)))return!1;const L=Sr(new Date(w.due));return w.state===W.Review?L<f:!0});return c.sort((p,w)=>new Date(p[1].due).getTime()-new Date(w[1].due).getTime()),c.map(p=>+p[0])}getChineseToneColor(i){if(!i)return;const r=this.getConfig();return r.zh.isColorBasedOnTone?r.zh.toneColors[i-1]:void 0}splitDeckIntoGroupOfN(i,r){const u=this.deckData[i];if(!u)return;const f=Array.from(u.deck.keys()),c=[],p=Math.ceil(f.length/r);for(let w=0;w<p;w++){const D=`group-${w+1}`;c.push({label:D,cardIds:f.slice(w*r,(w+1)*r)})}u.groups=c}getGroupLabels(i){const r=this.deckData[i];return r?r.groups.map(u=>u.label):[]}getAllNonIgnoredIds(i){const r=this.deckData[i];return r?Array.from(r.deck.keys()).filter(f=>{var c;return!((c=r.ignoredIds)!=null&&c.includes(f))}):[]}async downloadProfile(){const i=this.exportProfileStr(),r=new Date().toLocaleDateString("en-CA");await this.fileManager.download({data:i,filename:`wenbun-profile-${r}.txt`,mimeType:"text/plain"})}async tryUploadProfile(){const i=await this.fileManager.upload();return i===null||typeof i.data!="string"?!1:this.tryImportProfileStr(i.data)}getDeckProgress(i){var L;const r=this.deckData[i];if(!r)return{totalCount:1,previouslyStudiedCount:0,youngCount:0,matureCount:0,ignoredCount:0};const u=this.getAllNonIgnoredIds(i),f=r.deck.length,c=r.previouslyStudied.length,p=u.filter(I=>this.getWenbunCustomState(i,I)==="Young").length,w=u.filter(I=>this.getWenbunCustomState(i,I)==="Mature").length,D=((L=r.ignoredIds)==null?void 0:L.length)??0;return{totalCount:f,previouslyStudiedCount:c,youngCount:p,matureCount:w,ignoredCount:D}}getDeckProgressNormalized(i){const r=this.getDeckProgress(i);return{young:r.youngCount/r.totalCount*100,mature:r.matureCount/r.totalCount*100,previouslyStudied:r.previouslyStudiedCount/r.totalCount*100,ignored:r.ignoredCount/r.totalCount*100,rest:(r.totalCount-r.youngCount-r.matureCount-r.previouslyStudiedCount-r.ignoredCount)/r.totalCount*100}}isAutoGrading(){return this.getConfig().gradingMethod==="auto"}storeAutoGradeLog(i,r,u){this.autoReviewGradeLog.push({correctCount:i,mistakeCount:r,grade:u})}}export{sv as A,j_ as D,At as E,tv as N,bn as W,Ft as _,b as l};
