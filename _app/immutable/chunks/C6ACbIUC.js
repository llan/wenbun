var t_=Object.defineProperty;var e_=(d,s,r)=>s in d?t_(d,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):d[s]=r;var P=(d,s,r)=>e_(d,typeof s!="symbol"?s+"":s,r);import{e as n_,f as r_,h as i_,i as mr,D as s_,l as a_,j as Bu}from"./ClazNTlN.js";import{g as u_,b as o_}from"./Bcg1A-YH.js";import{p as l_}from"./CVy8Qdw7.js";var F=(d=>(d[d.New=0]="New",d[d.Learning=1]="Learning",d[d.Review=2]="Review",d[d.Relearning=3]="Relearning",d))(F||{}),A=(d=>(d[d.Manual=0]="Manual",d[d.Again=1]="Again",d[d.Hard=2]="Hard",d[d.Good=3]="Good",d[d.Easy=4]="Easy",d))(A||{});class N{static card(s){return{...s,state:N.state(s.state),due:N.time(s.due),last_review:s.last_review?N.time(s.last_review):void 0}}static rating(s){if(typeof s=="string"){const r=s.charAt(0).toUpperCase(),u=s.slice(1).toLowerCase(),f=A[`${r}${u}`];if(f===void 0)throw new Error(`Invalid rating:[${s}]`);return f}else if(typeof s=="number")return s;throw new Error(`Invalid rating:[${s}]`)}static state(s){if(typeof s=="string"){const r=s.charAt(0).toUpperCase(),u=s.slice(1).toLowerCase(),f=F[`${r}${u}`];if(f===void 0)throw new Error(`Invalid state:[${s}]`);return f}else if(typeof s=="number")return s;throw new Error(`Invalid state:[${s}]`)}static time(s){if(typeof s=="object"&&s instanceof Date)return s;if(typeof s=="string"){const r=Date.parse(s);if(isNaN(r))throw new Error(`Invalid date:[${s}]`);return new Date(r)}else if(typeof s=="number")return new Date(s);throw new Error(`Invalid date:[${s}]`)}static review_log(s){return{...s,due:N.time(s.due),rating:N.rating(s.rating),state:N.state(s.state),review:N.time(s.review)}}}Date.prototype.scheduler=function(d,s){return Yt(this,d,s)},Date.prototype.diff=function(d,s){return Xe(this,d,s)},Date.prototype.format=function(){return f_(this)},Date.prototype.dueFormat=function(d,s,r){return c_(this,d,s,r)};function Yt(d,s,r){return new Date(r?N.time(d).getTime()+s*24*60*60*1e3:N.time(d).getTime()+s*60*1e3)}function Xe(d,s,r){if(!d||!s)throw new Error("Invalid date");const u=N.time(d).getTime()-N.time(s).getTime();let f=0;switch(r){case"days":f=Math.floor(u/(24*60*60*1e3));break;case"minutes":f=Math.floor(u/(60*1e3));break}return f}function f_(d){const s=N.time(d),r=s.getFullYear(),u=s.getMonth()+1,f=s.getDate(),c=s.getHours(),p=s.getMinutes(),w=s.getSeconds();return`${r}-${Cn(u)}-${Cn(f)} ${Cn(c)}:${Cn(p)}:${Cn(w)}`}function Cn(d){return d<10?`0${d}`:`${d}`}const Xi=[60,60,24,31,12],Qi=["second","min","hour","day","month","year"];function c_(d,s,r,u=Qi){d=N.time(d),s=N.time(s),u.length!==Qi.length&&(u=Qi);let f=d.getTime()-s.getTime(),c;for(f/=1e3,c=0;c<Xi.length&&!(f<Xi[c]);c++)f/=Xi[c];return`${Math.floor(f)}${r?u[c]:""}`}const h_=Object.freeze([A.Again,A.Hard,A.Good,A.Easy]),d_=[{start:2.5,end:7,factor:.15},{start:7,end:20,factor:.1},{start:20,end:1/0,factor:.05}];function g_(d,s,r){let u=1;for(const p of d_)u+=p.factor*Math.max(Math.min(d,p.end)-p.start,0);d=Math.min(d,r);let f=Math.max(2,Math.round(d-u));const c=Math.min(Math.round(d+u),r);return d>s&&(f=Math.max(f,s+1)),f=Math.min(f,c),{min_ivl:f,max_ivl:c}}function vt(d,s,r){return Math.min(Math.max(d,s),r)}function p_(d,s){const r=Date.UTC(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()),u=Date.UTC(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate());return Math.floor((u-r)/864e5)}const __=.9,v_=36500,w_=!1,y_=!0,m_=Object.freeze(["1m","10m"]),S_=Object.freeze(["10m"]),Kt=.001,Sr=100,ku=.5,x_=.1542,$u=Object.freeze([.212,1.2931,2.3065,8.2956,6.4133,.8334,3.0194,.001,1.8722,.1666,.796,1.4835,.0614,.2629,1.6483,.6014,1.8729,.5425,.0912,.0658,x_]),C_=2,D_=d=>[[Kt,Sr],[Kt,Sr],[Kt,Sr],[Kt,Sr],[1,10],[.001,4],[.001,4],[.001,.75],[0,4.5],[0,.8],[.001,3.5],[.001,5],[.001,.25],[.001,.9],[0,4],[0,1],[1,6],[0,d],[0,d],[0,.8],[.1,.8]],ss=(d,s)=>{let r=C_;if(Math.max(0,s)>1){const u=-(Math.log(d[11])+Math.log(Math.pow(2,d[13])-1)+d[14]*.3)/s;r=vt(+u.toFixed(8),.01,2)}return D_(r).map(([u,f],c)=>vt(d[c],u,f))},as=d=>{if(d===void 0)return[...$u];switch(d.length){case 21:return[...d];case 19:return console.debug("[FSRS-6]auto fill w from 19 to 21 length"),[...d,0,ku];case 17:{const s=[...d];return s[4]=+(s[5]*2+s[4]).toFixed(8),s[5]=+(Math.log(s[5]*3+1)/3).toFixed(8),s[6]=+(s[6]+.5).toFixed(8),console.debug("[FSRS-6]auto fill w from 17 to 21 length"),s.concat([0,0,0,ku])}default:return console.warn("[FSRS]Invalid parameters length, using default parameters"),[...$u]}},Dr=d=>{const s=Array.isArray(d==null?void 0:d.learning_steps)?d.learning_steps:m_,r=Array.isArray(d==null?void 0:d.relearning_steps)?d.relearning_steps:S_,u=ss(as(d==null?void 0:d.w),r.length);return{request_retention:(d==null?void 0:d.request_retention)||__,maximum_interval:(d==null?void 0:d.maximum_interval)||v_,w:u,enable_fuzz:(d==null?void 0:d.enable_fuzz)??w_,enable_short_term:(d==null?void 0:d.enable_short_term)??y_,learning_steps:s,relearning_steps:r}};function Rr(d,s){const r={due:d?N.time(d):new Date,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:0,lapses:0,learning_steps:0,state:F.New,last_review:void 0};return s&&typeof s=="function"?s(r):r}class R_{constructor(s){P(this,"c");P(this,"s0");P(this,"s1");P(this,"s2");const r=L_();this.c=1,this.s0=r(" "),this.s1=r(" "),this.s2=r(" "),s==null&&(s=+new Date),this.s0-=r(s),this.s0<0&&(this.s0+=1),this.s1-=r(s),this.s1<0&&(this.s1+=1),this.s2-=r(s),this.s2<0&&(this.s2+=1)}next(){const s=2091639*this.s0+this.c*23283064365386963e-26;return this.s0=this.s1,this.s1=this.s2,this.s2=s-(this.c=s|0),this.s2}set state(s){this.c=s.c,this.s0=s.s0,this.s1=s.s1,this.s2=s.s2}get state(){return{c:this.c,s0:this.s0,s1:this.s1,s2:this.s2}}}function L_(){let d=4022871197;return function(s){s=String(s);for(let r=0;r<s.length;r++){d+=s.charCodeAt(r);let u=.02519603282416938*d;d=u>>>0,u-=d,u*=d,d=u>>>0,u-=d,d+=u*4294967296}return(d>>>0)*23283064365386963e-26}}function A_(d){const s=new R_(d),r=()=>s.next();return r.int32=()=>s.next()*4294967296|0,r.double=()=>r()+(r()*2097152|0)*11102230246251565e-32,r.state=()=>s.state,r.importState=u=>(s.state=u,r),r}const to=d=>{const s=typeof d=="number"?-d:-d[20],r=Math.exp(Math.pow(s,-1)*Math.log(.9))-1;return{decay:s,factor:+r.toFixed(8)}};function is(d,s,r){const{decay:u,factor:f}=to(d);return+Math.pow(1+f*s/r,u).toFixed(8)}class b_{constructor(s){P(this,"param");P(this,"intervalModifier");P(this,"_seed");P(this,"forgetting_curve");this.param=new Proxy(Dr(s),this.params_handler_proxy()),this.intervalModifier=this.calculate_interval_modifier(this.param.request_retention),this.forgetting_curve=is.bind(this,this.param.w)}get interval_modifier(){return this.intervalModifier}set seed(s){this._seed=s}calculate_interval_modifier(s){if(s<=0||s>1)throw new Error("Requested retention rate should be in the range (0,1]");const{decay:r,factor:u}=to(this.param.w);return+((Math.pow(s,1/r)-1)/u).toFixed(8)}get parameters(){return this.param}set parameters(s){this.update_parameters(s)}params_handler_proxy(){const s=this;return{set:function(r,u,f){return u==="request_retention"&&Number.isFinite(f)?s.intervalModifier=s.calculate_interval_modifier(Number(f)):u==="w"&&(f=ss(as(f),r.relearning_steps.length),s.forgetting_curve=is.bind(this,f),s.intervalModifier=s.calculate_interval_modifier(Number(r.request_retention))),Reflect.set(r,u,f),!0}}}update_parameters(s){const r=Dr(s);for(const u in r)if(u in this.param){const f=u;this.param[f]=r[f]}}init_stability(s){return Math.max(this.param.w[s-1],.1)}init_difficulty(s){return+(this.param.w[4]-Math.exp((s-1)*this.param.w[5])+1).toFixed(8)}apply_fuzz(s,r){if(!this.param.enable_fuzz||s<2.5)return Math.round(s);const u=A_(this._seed)(),{min_ivl:f,max_ivl:c}=g_(s,r,this.param.maximum_interval);return Math.floor(u*(c-f+1)+f)}next_interval(s,r){const u=Math.min(Math.max(1,Math.round(s*this.intervalModifier)),this.param.maximum_interval);return this.apply_fuzz(u,r)}linear_damping(s,r){return+(s*(10-r)/9).toFixed(8)}next_difficulty(s,r){const u=-this.param.w[6]*(r-3),f=s+this.linear_damping(u,s);return vt(this.mean_reversion(this.init_difficulty(A.Easy),f),1,10)}mean_reversion(s,r){return+(this.param.w[7]*s+(1-this.param.w[7])*r).toFixed(8)}next_recall_stability(s,r,u,f){const c=A.Hard===f?this.param.w[15]:1,p=A.Easy===f?this.param.w[16]:1;return+vt(r*(1+Math.exp(this.param.w[8])*(11-s)*Math.pow(r,-this.param.w[9])*(Math.exp((1-u)*this.param.w[10])-1)*c*p),Kt,36500).toFixed(8)}next_forget_stability(s,r,u){return+vt(this.param.w[11]*Math.pow(s,-this.param.w[12])*(Math.pow(r+1,this.param.w[13])-1)*Math.exp((1-u)*this.param.w[14]),Kt,36500).toFixed(8)}next_short_term_stability(s,r){const u=Math.pow(s,-this.param.w[19])*Math.exp(this.param.w[17]*(r-3+this.param.w[18])),f=r>=3?Math.max(u,1):u;return+vt(s*f,Kt,36500).toFixed(8)}next_state(s,r,u){const{difficulty:f,stability:c}=s??{difficulty:0,stability:0};if(r<0)throw new Error(`Invalid delta_t "${r}"`);if(u<0||u>4)throw new Error(`Invalid grade "${u}"`);if(f===0&&c===0)return{difficulty:vt(this.init_difficulty(u),1,10),stability:this.init_stability(u)};if(u===0)return{difficulty:f,stability:c};if(f<1||c<Kt)throw new Error(`Invalid memory state { difficulty: ${f}, stability: ${c} }`);const p=this.forgetting_curve(r,c),w=this.next_recall_stability(f,c,p,u),D=this.next_forget_stability(f,c,p),L=this.next_short_term_stability(c,u);let I=w;if(u===1){let[$,dt]=[0,0];this.param.enable_short_term&&($=this.param.w[17],dt=this.param.w[18]);const Z=c/Math.exp($*dt);I=vt(+Z.toFixed(8),Kt,D)}return r===0&&this.param.enable_short_term&&(I=L),{difficulty:this.next_difficulty(f,u),stability:I}}}function E_(){const d=this.review_time.getTime(),s=this.current.reps,r=this.current.difficulty*this.current.stability;return`${d}_${s}_${r}`}const I_=d=>{const s=d.slice(-1),r=parseInt(d.slice(0,-1),10);if(isNaN(r)||!Number.isFinite(r)||r<0)throw new Error(`Invalid step value: ${d}`);switch(s){case"m":return r;case"h":return r*60;case"d":return r*1440;default:throw new Error(`Invalid step unit: ${d}, expected m/h/d`)}},T_=(d,s,r)=>{const u=s===F.Relearning||s===F.Review?d.relearning_steps:d.learning_steps,f=u.length;if(f===0||r>=f)return{};const c=u[0],p=I_,w=()=>p(c),D=()=>{if(f===1)return Math.round(p(c)*1.5);const Z=u[1];return Math.round((p(c)+p(Z))/2)},L=Z=>Z<0||Z>=f?null:u[Z],I=Z=>p(Z),$={},dt=L(Math.max(0,r));if(s===F.Review)return $[A.Again]={scheduled_minutes:p(dt),next_step:0},$;{$[A.Again]={scheduled_minutes:w(),next_step:0},$[A.Hard]={scheduled_minutes:D(),next_step:r};const Z=L(r+1);if(Z){const ut=I(Z);ut&&($[A.Good]={scheduled_minutes:Math.round(ut),next_step:r+1})}}return $};var Ar=(d=>(d.SCHEDULER="Scheduler",d.LEARNING_STEPS="LearningSteps",d.SEED="Seed",d))(Ar||{});class eo{constructor(s,r,u,f){P(this,"last");P(this,"current");P(this,"review_time");P(this,"next",new Map);P(this,"algorithm");P(this,"strategies");P(this,"elapsed_days",0);this.algorithm=u,this.last=N.card(s),this.current=N.card(s),this.review_time=N.time(r),this.strategies=f,this.init()}checkGrade(s){if(!Number.isFinite(s)||s<0||s>4)throw new Error(`Invalid grade "${s}",expected 1-4`)}init(){const{state:s,last_review:r}=this.current;let u=0;s!==F.New&&r&&(u=p_(r,this.review_time)),this.current.last_review=this.review_time,this.elapsed_days=u,this.current.elapsed_days=u,this.current.reps+=1;let f=E_;if(this.strategies){const c=this.strategies.get(Ar.SEED);c&&(f=c)}this.algorithm.seed=f.call(this)}preview(){return{[A.Again]:this.review(A.Again),[A.Hard]:this.review(A.Hard),[A.Good]:this.review(A.Good),[A.Easy]:this.review(A.Easy),[Symbol.iterator]:this.previewIterator.bind(this)}}*previewIterator(){for(const s of h_)yield this.review(s)}review(s){const{state:r}=this.last;let u;switch(this.checkGrade(s),r){case F.New:u=this.newState(s);break;case F.Learning:case F.Relearning:u=this.learningState(s);break;case F.Review:u=this.reviewState(s);break}return u}buildLog(s){const{last_review:r,due:u,elapsed_days:f}=this.last;return{rating:s,state:this.current.state,due:r||u,stability:this.current.stability,difficulty:this.current.difficulty,elapsed_days:this.elapsed_days,last_elapsed_days:f,scheduled_days:this.current.scheduled_days,learning_steps:this.current.learning_steps,review:this.review_time}}}class Hu extends eo{constructor(r,u,f,c){super(r,u,f,c);P(this,"learningStepsStrategy");let p=T_;if(this.strategies){const w=this.strategies.get(Ar.LEARNING_STEPS);w&&(p=w)}this.learningStepsStrategy=p}getLearningInfo(r,u){var D,L;const f=this.algorithm.parameters;r.learning_steps=r.learning_steps||0;const c=this.learningStepsStrategy(f,r.state,this.current.state===F.Learning?r.learning_steps+1:r.learning_steps),p=Math.max(0,((D=c[u])==null?void 0:D.scheduled_minutes)??0),w=Math.max(0,((L=c[u])==null?void 0:L.next_step)??0);return{scheduled_minutes:p,next_steps:w}}applyLearningSteps(r,u,f){const{scheduled_minutes:c,next_steps:p}=this.getLearningInfo(this.current,u);if(c>0&&c<1440)r.learning_steps=p,r.scheduled_days=0,r.state=f,r.due=Yt(this.review_time,Math.round(c),!1);else if(r.state=F.Review,c>=1440)r.learning_steps=p,r.due=Yt(this.review_time,Math.round(c),!1),r.scheduled_days=Math.floor(c/1440);else{r.learning_steps=0;const w=this.algorithm.next_interval(r.stability,this.elapsed_days);r.scheduled_days=w,r.due=Yt(this.review_time,w,!0)}}newState(r){const u=this.next.get(r);if(u)return u;const f=N.card(this.current);f.difficulty=vt(this.algorithm.init_difficulty(r),1,10),f.stability=this.algorithm.init_stability(r),this.applyLearningSteps(f,r,F.Learning);const c={card:f,log:this.buildLog(r)};return this.next.set(r,c),c}learningState(r){const u=this.next.get(r);if(u)return u;const{state:f,difficulty:c,stability:p}=this.last,w=N.card(this.current);w.difficulty=this.algorithm.next_difficulty(c,r),w.stability=this.algorithm.next_short_term_stability(p,r),this.applyLearningSteps(w,r,f);const D={card:w,log:this.buildLog(r)};return this.next.set(r,D),D}reviewState(r){const u=this.next.get(r);if(u)return u;const f=this.elapsed_days,{difficulty:c,stability:p}=this.last,w=this.algorithm.forgetting_curve(f,p),D=N.card(this.current),L=N.card(this.current),I=N.card(this.current),$=N.card(this.current);this.next_ds(D,L,I,$,c,p,w),this.next_interval(L,I,$,f),this.next_state(L,I,$),this.applyLearningSteps(D,A.Again,F.Relearning),D.lapses+=1;const dt={card:D,log:this.buildLog(A.Again)},Z={card:L,log:super.buildLog(A.Hard)},ut={card:I,log:super.buildLog(A.Good)},ce={card:$,log:super.buildLog(A.Easy)};return this.next.set(A.Again,dt),this.next.set(A.Hard,Z),this.next.set(A.Good,ut),this.next.set(A.Easy,ce),this.next.get(r)}next_ds(r,u,f,c,p,w,D){r.difficulty=this.algorithm.next_difficulty(p,A.Again);const L=w/Math.exp(this.algorithm.parameters.w[17]*this.algorithm.parameters.w[18]),I=this.algorithm.next_forget_stability(p,w,D);r.stability=vt(+L.toFixed(8),Kt,I),u.difficulty=this.algorithm.next_difficulty(p,A.Hard),u.stability=this.algorithm.next_recall_stability(p,w,D,A.Hard),f.difficulty=this.algorithm.next_difficulty(p,A.Good),f.stability=this.algorithm.next_recall_stability(p,w,D,A.Good),c.difficulty=this.algorithm.next_difficulty(p,A.Easy),c.stability=this.algorithm.next_recall_stability(p,w,D,A.Easy)}next_interval(r,u,f,c){let p,w;p=this.algorithm.next_interval(r.stability,c),w=this.algorithm.next_interval(u.stability,c),p=Math.min(p,w),w=Math.max(w,p+1);const D=Math.max(this.algorithm.next_interval(f.stability,c),w+1);r.scheduled_days=p,r.due=Yt(this.review_time,p,!0),u.scheduled_days=w,u.due=Yt(this.review_time,w,!0),f.scheduled_days=D,f.due=Yt(this.review_time,D,!0)}next_state(r,u,f){r.state=F.Review,r.learning_steps=0,u.state=F.Review,u.learning_steps=0,f.state=F.Review,f.learning_steps=0}}class qu extends eo{newState(s){const r=this.next.get(s);if(r)return r;this.current.scheduled_days=0,this.current.elapsed_days=0;const u=N.card(this.current),f=N.card(this.current),c=N.card(this.current),p=N.card(this.current);return this.init_ds(u,f,c,p),this.next_interval(u,f,c,p,0),this.next_state(u,f,c,p),this.update_next(u,f,c,p),this.next.get(s)}init_ds(s,r,u,f){s.difficulty=vt(this.algorithm.init_difficulty(A.Again),1,10),s.stability=this.algorithm.init_stability(A.Again),r.difficulty=vt(this.algorithm.init_difficulty(A.Hard),1,10),r.stability=this.algorithm.init_stability(A.Hard),u.difficulty=vt(this.algorithm.init_difficulty(A.Good),1,10),u.stability=this.algorithm.init_stability(A.Good),f.difficulty=vt(this.algorithm.init_difficulty(A.Easy),1,10),f.stability=this.algorithm.init_stability(A.Easy)}learningState(s){return this.reviewState(s)}reviewState(s){const r=this.next.get(s);if(r)return r;const u=this.elapsed_days,{difficulty:f,stability:c}=this.last,p=this.algorithm.forgetting_curve(u,c),w=N.card(this.current),D=N.card(this.current),L=N.card(this.current),I=N.card(this.current);return this.next_ds(w,D,L,I,f,c,p),this.next_interval(w,D,L,I,u),this.next_state(w,D,L,I),w.lapses+=1,this.update_next(w,D,L,I),this.next.get(s)}next_ds(s,r,u,f,c,p,w){s.difficulty=this.algorithm.next_difficulty(c,A.Again);const D=this.algorithm.next_forget_stability(c,p,w);s.stability=vt(p,Kt,D),r.difficulty=this.algorithm.next_difficulty(c,A.Hard),r.stability=this.algorithm.next_recall_stability(c,p,w,A.Hard),u.difficulty=this.algorithm.next_difficulty(c,A.Good),u.stability=this.algorithm.next_recall_stability(c,p,w,A.Good),f.difficulty=this.algorithm.next_difficulty(c,A.Easy),f.stability=this.algorithm.next_recall_stability(c,p,w,A.Easy)}next_interval(s,r,u,f,c){let p,w,D,L;p=this.algorithm.next_interval(s.stability,c),w=this.algorithm.next_interval(r.stability,c),D=this.algorithm.next_interval(u.stability,c),L=this.algorithm.next_interval(f.stability,c),p=Math.min(p,w),w=Math.max(w,p+1),D=Math.max(D,w+1),L=Math.max(L,D+1),s.scheduled_days=p,s.due=Yt(this.review_time,p,!0),r.scheduled_days=w,r.due=Yt(this.review_time,w,!0),u.scheduled_days=D,u.due=Yt(this.review_time,D,!0),f.scheduled_days=L,f.due=Yt(this.review_time,L,!0)}next_state(s,r,u,f){s.state=F.Review,s.learning_steps=0,r.state=F.Review,r.learning_steps=0,u.state=F.Review,u.learning_steps=0,f.state=F.Review,f.learning_steps=0}update_next(s,r,u,f){const c={card:s,log:this.buildLog(A.Again)},p={card:r,log:super.buildLog(A.Hard)},w={card:u,log:super.buildLog(A.Good)},D={card:f,log:super.buildLog(A.Easy)};this.next.set(A.Again,c),this.next.set(A.Hard,p),this.next.set(A.Good,w),this.next.set(A.Easy,D)}}class O_{constructor(s){P(this,"fsrs");this.fsrs=s}replay(s,r,u){return this.fsrs.next(s,r,u)}handleManualRating(s,r,u,f,c,p,w){if(typeof r>"u")throw new Error("reschedule: state is required for manual rating");let D,L;if(r===F.New)D={rating:A.Manual,state:r,due:w??u,stability:s.stability,difficulty:s.difficulty,elapsed_days:f,last_elapsed_days:s.elapsed_days,scheduled_days:s.scheduled_days,learning_steps:s.learning_steps,review:u},L=Rr(u),L.last_review=u;else{if(typeof w>"u")throw new Error("reschedule: due is required for manual rating");const I=Xe(w,u,"days");D={rating:A.Manual,state:s.state,due:s.last_review||s.due,stability:s.stability,difficulty:s.difficulty,elapsed_days:f,last_elapsed_days:s.elapsed_days,scheduled_days:s.scheduled_days,learning_steps:s.learning_steps,review:u},L={...s,state:r,due:w,last_review:u,stability:c||s.stability,difficulty:p||s.difficulty,elapsed_days:f,scheduled_days:I,reps:s.reps+1}}return{card:L,log:D}}reschedule(s,r){const u=[];let f=Rr(s.due);for(const c of r){let p;if(c.review=N.time(c.review),c.rating===A.Manual){let w=0;f.state!==F.New&&f.last_review&&(w=Xe(c.review,f.last_review,"days")),p=this.handleManualRating(f,c.state,c.review,w,c.stability,c.difficulty,c.due?N.time(c.due):void 0)}else p=this.replay(f,c.review,c.rating);u.push(p),f=p.card}return u}calculateManualRecord(s,r,u,f){if(!u)return null;const{card:c,log:p}=u,w=N.card(s);return w.due.getTime()===c.due.getTime()?null:(w.scheduled_days=Xe(c.due,w.due,"days"),this.handleManualRating(w,c.state,N.time(r),p.elapsed_days,f?c.stability:void 0,f?c.difficulty:void 0,c.due))}}class zu extends b_{constructor(r){super(r);P(this,"strategyHandler",new Map);P(this,"Scheduler");const{enable_short_term:u}=this.parameters;this.Scheduler=u?Hu:qu}params_handler_proxy(){const r=this;return{set:function(u,f,c){return f==="request_retention"&&Number.isFinite(c)?r.intervalModifier=r.calculate_interval_modifier(Number(c)):f==="enable_short_term"?r.Scheduler=c===!0?Hu:qu:f==="w"&&(c=ss(as(c),u.relearning_steps.length),r.forgetting_curve=is.bind(this,c),r.intervalModifier=r.calculate_interval_modifier(Number(u.request_retention))),Reflect.set(u,f,c),!0}}}useStrategy(r,u){return this.strategyHandler.set(r,u),this}clearStrategy(r){return r?this.strategyHandler.delete(r):this.strategyHandler.clear(),this}getScheduler(r,u){const f=this.strategyHandler.get(Ar.SCHEDULER)||this.Scheduler;return new f(r,u,this,this.strategyHandler)}repeat(r,u,f){const c=this.getScheduler(r,u).preview();return f&&typeof f=="function"?f(c):c}next(r,u,f,c){const p=this.getScheduler(r,u),w=N.rating(f);if(w===A.Manual)throw new Error("Cannot review a manual rating");const D=p.review(w);return c&&typeof c=="function"?c(D):D}get_retrievability(r,u,f=!0){const c=N.card(r);u=u?N.time(u):new Date;const p=c.state!==F.New?Math.max(Xe(u,c.last_review,"days"),0):0,w=c.state!==F.New?this.forgetting_curve(p,+c.stability.toFixed(8)):0;return f?`${(w*100).toFixed(2)}%`:w}rollback(r,u,f){const c=N.card(r),p=N.review_log(u);if(p.rating===A.Manual)throw new Error("Cannot rollback a manual rating");let w,D,L;switch(p.state){case F.New:w=p.due,D=void 0,L=0;break;case F.Learning:case F.Relearning:case F.Review:w=p.review,D=p.due,L=c.lapses-(p.rating===A.Again&&p.state===F.Review?1:0);break}const I={...c,due:w,stability:p.stability,difficulty:p.difficulty,elapsed_days:p.last_elapsed_days,scheduled_days:p.scheduled_days,reps:Math.max(0,c.reps-1),lapses:Math.max(0,L),learning_steps:p.learning_steps,state:p.state,last_review:D};return f&&typeof f=="function"?f(I):I}forget(r,u,f=!1,c){const p=N.card(r);u=N.time(u);const w=p.state===F.New?0:Xe(u,p.due,"days"),D={rating:A.Manual,state:p.state,due:p.due,stability:p.stability,difficulty:p.difficulty,elapsed_days:0,last_elapsed_days:p.elapsed_days,scheduled_days:w,learning_steps:p.learning_steps,review:u},L={card:{...p,due:u,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:f?0:p.reps,lapses:f?0:p.lapses,learning_steps:0,state:F.New,last_review:p.last_review},log:D};return c&&typeof c=="function"?c(L):L}reschedule(r,u=[],f={}){const{recordLogHandler:c,reviewsOrderBy:p,skipManual:w=!0,now:D=new Date,update_memory_state:L=!1}=f;p&&typeof p=="function"&&u.sort(p),w&&(u=u.filter(ce=>ce.rating!==A.Manual));const I=new O_(this),$=I.reschedule(f.first_card||Rr(),u),dt=$.length,Z=N.card(r),ut=I.calculateManualRecord(Z,D,dt?$[dt-1]:void 0,L);return c&&typeof c=="function"?{collections:$.map(c),reschedule_item:ut?c(ut):null}:{collections:$,reschedule_item:ut}}}function M_(d,s,r,u){if(typeof s=="function"?d!==s||!u:!s.has(d))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?u:r==="a"?u.call(d):u?u.value:s.get(d)}function P_(d,s,r,u,f){if(typeof s=="function"?d!==s||!0:!s.has(d))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s.set(d,r),r}var Cr;function N_(d,s=!1){return window.__TAURI_INTERNALS__.transformCallback(d,s)}async function ft(d,s={},r){return window.__TAURI_INTERNALS__.invoke(d,s,r)}class U_{get rid(){return M_(this,Cr,"f")}constructor(s){Cr.set(this,void 0),P_(this,Cr,s)}async close(){return ft("plugin:resources|close",{rid:this.rid})}}Cr=new WeakMap;function W_(){return!!(globalThis||window).isTauri}var Yu;(function(d){d.WINDOW_RESIZED="tauri://resize",d.WINDOW_MOVED="tauri://move",d.WINDOW_CLOSE_REQUESTED="tauri://close-requested",d.WINDOW_DESTROYED="tauri://destroyed",d.WINDOW_FOCUS="tauri://focus",d.WINDOW_BLUR="tauri://blur",d.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",d.WINDOW_THEME_CHANGED="tauri://theme-changed",d.WINDOW_CREATED="tauri://window-created",d.WEBVIEW_CREATED="tauri://webview-created",d.DRAG_ENTER="tauri://drag-enter",d.DRAG_OVER="tauri://drag-over",d.DRAG_DROP="tauri://drag-drop",d.DRAG_LEAVE="tauri://drag-leave"})(Yu||(Yu={}));async function F_(d,s){window.__TAURI_EVENT_PLUGIN_INTERNALS__.unregisterListener(d,s),await ft("plugin:event|unlisten",{event:d,eventId:s})}async function Ku(d,s,r){var u;const f=(u=void 0)!==null&&u!==void 0?u:{kind:"Any"};return ft("plugin:event|listen",{event:d,target:f,handler:N_(s)}).then(c=>async()=>F_(d,c))}async function G_(d,s){return await Lr.load(d,s)}class Lr extends U_{constructor(s){super(s)}static async load(s,r){const u=await ft("plugin:store|load",{path:s,...r});return new Lr(u)}static async get(s){return await ft("plugin:store|get_store",{path:s}).then(r=>r?new Lr(r):null)}async set(s,r){await ft("plugin:store|set",{rid:this.rid,key:s,value:r})}async get(s){const[r,u]=await ft("plugin:store|get",{rid:this.rid,key:s});return u?r:void 0}async has(s){return await ft("plugin:store|has",{rid:this.rid,key:s})}async delete(s){return await ft("plugin:store|delete",{rid:this.rid,key:s})}async clear(){await ft("plugin:store|clear",{rid:this.rid})}async reset(){await ft("plugin:store|reset",{rid:this.rid})}async keys(){return await ft("plugin:store|keys",{rid:this.rid})}async values(){return await ft("plugin:store|values",{rid:this.rid})}async entries(){return await ft("plugin:store|entries",{rid:this.rid})}async length(){return await ft("plugin:store|length",{rid:this.rid})}async reload(){await ft("plugin:store|reload",{rid:this.rid})}async save(){await ft("plugin:store|save",{rid:this.rid})}async onKeyChange(s,r){return await Ku("store://change",u=>{u.payload.resourceId===this.rid&&u.payload.key===s&&r(u.payload.exists?u.payload.value:void 0)})}async onChange(s){return await Ku("store://change",r=>{r.payload.resourceId===this.rid&&s(r.payload.key,r.payload.exists?r.payload.value:void 0)})}}class B_{constructor(s){P(this,"storeFilename");P(this,"store",null);P(this,"isLoaded",!1);this.storeFilename=s}async ensureStoreLoaded(){this.isLoaded||(this.store=await G_(this.storeFilename,{autoSave:!1}),this.isLoaded=!0)}async load(s){if(await this.ensureStoreLoaded(),!!this.store)return await this.store.get(s)}async save(s,r){await this.ensureStoreLoaded(),this.store&&await this.store.set(s,r)}}const k_="wenbun-deck-manager";class $_{constructor(s){P(this,"storeName");P(this,"db");this.storeName=s}async ensureDBLoaded(){return this.db?new Promise(s=>s()):new Promise((s,r)=>{const u=window.indexedDB.open(k_,1);u.onupgradeneeded=()=>{const f=u.result;f.objectStoreNames.contains(this.storeName)||f.createObjectStore(this.storeName)},u.onsuccess=()=>{this.db=u.result,s()},u.onerror=f=>{window.alert("Error opening database"),r(f)}})}async load(s){return await this.ensureDBLoaded(),new Promise((r,u)=>{if(!this.db)return r(void 0);const p=this.db.transaction(this.storeName,"readonly").objectStore(this.storeName).get(s);p.onsuccess=()=>r(p.result),p.onerror=()=>u(p.error)})}async save(s,r){return await this.ensureDBLoaded(),new Promise((u,f)=>{if(!this.db)return u();const w=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(r,s);w.onsuccess=()=>u(),w.onerror=()=>f(w.error)})}}var xr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function H_(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var Rn={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */var q_=Rn.exports,Zu;function z_(){return Zu||(Zu=1,function(d,s){(function(){var r,u="4.17.21",f=200,c="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",p="Expected a function",w="Invalid `variable` option passed into `_.template`",D="__lodash_hash_undefined__",L=500,I="__lodash_placeholder__",$=1,dt=2,Z=4,ut=1,ce=2,Wt=1,Me=2,us=4,Vt=8,Qe=16,jt=32,Ve=64,te=128,je=256,br=512,ro=30,io="...",so=800,ao=16,os=1,uo=2,oo=3,Ce=1/0,he=9007199254740991,lo=17976931348623157e292,An=NaN,Zt=4294967295,fo=Zt-1,co=Zt>>>1,ho=[["ary",te],["bind",Wt],["bindKey",Me],["curry",Vt],["curryRight",Qe],["flip",br],["partial",jt],["partialRight",Ve],["rearg",je]],Pe="[object Arguments]",bn="[object Array]",go="[object AsyncFunction]",tn="[object Boolean]",en="[object Date]",po="[object DOMException]",En="[object Error]",In="[object Function]",ls="[object GeneratorFunction]",Ft="[object Map]",nn="[object Number]",_o="[object Null]",ee="[object Object]",fs="[object Promise]",vo="[object Proxy]",rn="[object RegExp]",Gt="[object Set]",sn="[object String]",Tn="[object Symbol]",wo="[object Undefined]",an="[object WeakMap]",yo="[object WeakSet]",un="[object ArrayBuffer]",Ne="[object DataView]",Er="[object Float32Array]",Ir="[object Float64Array]",Tr="[object Int8Array]",Or="[object Int16Array]",Mr="[object Int32Array]",Pr="[object Uint8Array]",Nr="[object Uint8ClampedArray]",Ur="[object Uint16Array]",Wr="[object Uint32Array]",mo=/\b__p \+= '';/g,So=/\b(__p \+=) '' \+/g,xo=/(__e\(.*?\)|\b__t\)) \+\n'';/g,cs=/&(?:amp|lt|gt|quot|#39);/g,hs=/[&<>"']/g,Co=RegExp(cs.source),Do=RegExp(hs.source),Ro=/<%-([\s\S]+?)%>/g,Lo=/<%([\s\S]+?)%>/g,ds=/<%=([\s\S]+?)%>/g,Ao=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,bo=/^\w*$/,Eo=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Fr=/[\\^$.*+?()[\]{}|]/g,Io=RegExp(Fr.source),Gr=/^\s+/,To=/\s/,Oo=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Mo=/\{\n\/\* \[wrapped with (.+)\] \*/,Po=/,? & /,No=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Uo=/[()=,{}\[\]\/\s]/,Wo=/\\(\\)?/g,Fo=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,gs=/\w*$/,Go=/^[-+]0x[0-9a-f]+$/i,Bo=/^0b[01]+$/i,ko=/^\[object .+?Constructor\]$/,$o=/^0o[0-7]+$/i,Ho=/^(?:0|[1-9]\d*)$/,qo=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,On=/($^)/,zo=/['\n\r\u2028\u2029\\]/g,Mn="\\ud800-\\udfff",Yo="\\u0300-\\u036f",Ko="\\ufe20-\\ufe2f",Zo="\\u20d0-\\u20ff",ps=Yo+Ko+Zo,_s="\\u2700-\\u27bf",vs="a-z\\xdf-\\xf6\\xf8-\\xff",Jo="\\xac\\xb1\\xd7\\xf7",Xo="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Qo="\\u2000-\\u206f",Vo=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ws="A-Z\\xc0-\\xd6\\xd8-\\xde",ys="\\ufe0e\\ufe0f",ms=Jo+Xo+Qo+Vo,Br="['’]",jo="["+Mn+"]",Ss="["+ms+"]",Pn="["+ps+"]",xs="\\d+",tl="["+_s+"]",Cs="["+vs+"]",Ds="[^"+Mn+ms+xs+_s+vs+ws+"]",kr="\\ud83c[\\udffb-\\udfff]",el="(?:"+Pn+"|"+kr+")",Rs="[^"+Mn+"]",$r="(?:\\ud83c[\\udde6-\\uddff]){2}",Hr="[\\ud800-\\udbff][\\udc00-\\udfff]",Ue="["+ws+"]",Ls="\\u200d",As="(?:"+Cs+"|"+Ds+")",nl="(?:"+Ue+"|"+Ds+")",bs="(?:"+Br+"(?:d|ll|m|re|s|t|ve))?",Es="(?:"+Br+"(?:D|LL|M|RE|S|T|VE))?",Is=el+"?",Ts="["+ys+"]?",rl="(?:"+Ls+"(?:"+[Rs,$r,Hr].join("|")+")"+Ts+Is+")*",il="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",sl="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Os=Ts+Is+rl,al="(?:"+[tl,$r,Hr].join("|")+")"+Os,ul="(?:"+[Rs+Pn+"?",Pn,$r,Hr,jo].join("|")+")",ol=RegExp(Br,"g"),ll=RegExp(Pn,"g"),qr=RegExp(kr+"(?="+kr+")|"+ul+Os,"g"),fl=RegExp([Ue+"?"+Cs+"+"+bs+"(?="+[Ss,Ue,"$"].join("|")+")",nl+"+"+Es+"(?="+[Ss,Ue+As,"$"].join("|")+")",Ue+"?"+As+"+"+bs,Ue+"+"+Es,sl,il,xs,al].join("|"),"g"),cl=RegExp("["+Ls+Mn+ps+ys+"]"),hl=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,dl=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],gl=-1,V={};V[Er]=V[Ir]=V[Tr]=V[Or]=V[Mr]=V[Pr]=V[Nr]=V[Ur]=V[Wr]=!0,V[Pe]=V[bn]=V[un]=V[tn]=V[Ne]=V[en]=V[En]=V[In]=V[Ft]=V[nn]=V[ee]=V[rn]=V[Gt]=V[sn]=V[an]=!1;var Q={};Q[Pe]=Q[bn]=Q[un]=Q[Ne]=Q[tn]=Q[en]=Q[Er]=Q[Ir]=Q[Tr]=Q[Or]=Q[Mr]=Q[Ft]=Q[nn]=Q[ee]=Q[rn]=Q[Gt]=Q[sn]=Q[Tn]=Q[Pr]=Q[Nr]=Q[Ur]=Q[Wr]=!0,Q[En]=Q[In]=Q[an]=!1;var pl={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},_l={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},vl={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},wl={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},yl=parseFloat,ml=parseInt,Ms=typeof xr=="object"&&xr&&xr.Object===Object&&xr,Sl=typeof self=="object"&&self&&self.Object===Object&&self,ot=Ms||Sl||Function("return this")(),zr=s&&!s.nodeType&&s,De=zr&&!0&&d&&!d.nodeType&&d,Ps=De&&De.exports===zr,Yr=Ps&&Ms.process,Et=function(){try{var _=De&&De.require&&De.require("util").types;return _||Yr&&Yr.binding&&Yr.binding("util")}catch{}}(),Ns=Et&&Et.isArrayBuffer,Us=Et&&Et.isDate,Ws=Et&&Et.isMap,Fs=Et&&Et.isRegExp,Gs=Et&&Et.isSet,Bs=Et&&Et.isTypedArray;function xt(_,m,y){switch(y.length){case 0:return _.call(m);case 1:return _.call(m,y[0]);case 2:return _.call(m,y[0],y[1]);case 3:return _.call(m,y[0],y[1],y[2])}return _.apply(m,y)}function xl(_,m,y,b){for(var U=-1,Y=_==null?0:_.length;++U<Y;){var it=_[U];m(b,it,y(it),_)}return b}function It(_,m){for(var y=-1,b=_==null?0:_.length;++y<b&&m(_[y],y,_)!==!1;);return _}function Cl(_,m){for(var y=_==null?0:_.length;y--&&m(_[y],y,_)!==!1;);return _}function ks(_,m){for(var y=-1,b=_==null?0:_.length;++y<b;)if(!m(_[y],y,_))return!1;return!0}function de(_,m){for(var y=-1,b=_==null?0:_.length,U=0,Y=[];++y<b;){var it=_[y];m(it,y,_)&&(Y[U++]=it)}return Y}function Nn(_,m){var y=_==null?0:_.length;return!!y&&We(_,m,0)>-1}function Kr(_,m,y){for(var b=-1,U=_==null?0:_.length;++b<U;)if(y(m,_[b]))return!0;return!1}function j(_,m){for(var y=-1,b=_==null?0:_.length,U=Array(b);++y<b;)U[y]=m(_[y],y,_);return U}function ge(_,m){for(var y=-1,b=m.length,U=_.length;++y<b;)_[U+y]=m[y];return _}function Zr(_,m,y,b){var U=-1,Y=_==null?0:_.length;for(b&&Y&&(y=_[++U]);++U<Y;)y=m(y,_[U],U,_);return y}function Dl(_,m,y,b){var U=_==null?0:_.length;for(b&&U&&(y=_[--U]);U--;)y=m(y,_[U],U,_);return y}function Jr(_,m){for(var y=-1,b=_==null?0:_.length;++y<b;)if(m(_[y],y,_))return!0;return!1}var Rl=Xr("length");function Ll(_){return _.split("")}function Al(_){return _.match(No)||[]}function $s(_,m,y){var b;return y(_,function(U,Y,it){if(m(U,Y,it))return b=Y,!1}),b}function Un(_,m,y,b){for(var U=_.length,Y=y+(b?1:-1);b?Y--:++Y<U;)if(m(_[Y],Y,_))return Y;return-1}function We(_,m,y){return m===m?Gl(_,m,y):Un(_,Hs,y)}function bl(_,m,y,b){for(var U=y-1,Y=_.length;++U<Y;)if(b(_[U],m))return U;return-1}function Hs(_){return _!==_}function qs(_,m){var y=_==null?0:_.length;return y?Vr(_,m)/y:An}function Xr(_){return function(m){return m==null?r:m[_]}}function Qr(_){return function(m){return _==null?r:_[m]}}function zs(_,m,y,b,U){return U(_,function(Y,it,X){y=b?(b=!1,Y):m(y,Y,it,X)}),y}function El(_,m){var y=_.length;for(_.sort(m);y--;)_[y]=_[y].value;return _}function Vr(_,m){for(var y,b=-1,U=_.length;++b<U;){var Y=m(_[b]);Y!==r&&(y=y===r?Y:y+Y)}return y}function jr(_,m){for(var y=-1,b=Array(_);++y<_;)b[y]=m(y);return b}function Il(_,m){return j(m,function(y){return[y,_[y]]})}function Ys(_){return _&&_.slice(0,Xs(_)+1).replace(Gr,"")}function Ct(_){return function(m){return _(m)}}function ti(_,m){return j(m,function(y){return _[y]})}function on(_,m){return _.has(m)}function Ks(_,m){for(var y=-1,b=_.length;++y<b&&We(m,_[y],0)>-1;);return y}function Zs(_,m){for(var y=_.length;y--&&We(m,_[y],0)>-1;);return y}function Tl(_,m){for(var y=_.length,b=0;y--;)_[y]===m&&++b;return b}var Ol=Qr(pl),Ml=Qr(_l);function Pl(_){return"\\"+wl[_]}function Nl(_,m){return _==null?r:_[m]}function Fe(_){return cl.test(_)}function Ul(_){return hl.test(_)}function Wl(_){for(var m,y=[];!(m=_.next()).done;)y.push(m.value);return y}function ei(_){var m=-1,y=Array(_.size);return _.forEach(function(b,U){y[++m]=[U,b]}),y}function Js(_,m){return function(y){return _(m(y))}}function pe(_,m){for(var y=-1,b=_.length,U=0,Y=[];++y<b;){var it=_[y];(it===m||it===I)&&(_[y]=I,Y[U++]=y)}return Y}function Wn(_){var m=-1,y=Array(_.size);return _.forEach(function(b){y[++m]=b}),y}function Fl(_){var m=-1,y=Array(_.size);return _.forEach(function(b){y[++m]=[b,b]}),y}function Gl(_,m,y){for(var b=y-1,U=_.length;++b<U;)if(_[b]===m)return b;return-1}function Bl(_,m,y){for(var b=y+1;b--;)if(_[b]===m)return b;return b}function Ge(_){return Fe(_)?$l(_):Rl(_)}function Bt(_){return Fe(_)?Hl(_):Ll(_)}function Xs(_){for(var m=_.length;m--&&To.test(_.charAt(m)););return m}var kl=Qr(vl);function $l(_){for(var m=qr.lastIndex=0;qr.test(_);)++m;return m}function Hl(_){return _.match(qr)||[]}function ql(_){return _.match(fl)||[]}var zl=function _(m){m=m==null?ot:Be.defaults(ot.Object(),m,Be.pick(ot,dl));var y=m.Array,b=m.Date,U=m.Error,Y=m.Function,it=m.Math,X=m.Object,ni=m.RegExp,Yl=m.String,Tt=m.TypeError,Fn=y.prototype,Kl=Y.prototype,ke=X.prototype,Gn=m["__core-js_shared__"],Bn=Kl.toString,J=ke.hasOwnProperty,Zl=0,Qs=function(){var t=/[^.]+$/.exec(Gn&&Gn.keys&&Gn.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),kn=ke.toString,Jl=Bn.call(X),Xl=ot._,Ql=ni("^"+Bn.call(J).replace(Fr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),$n=Ps?m.Buffer:r,_e=m.Symbol,Hn=m.Uint8Array,Vs=$n?$n.allocUnsafe:r,qn=Js(X.getPrototypeOf,X),js=X.create,ta=ke.propertyIsEnumerable,zn=Fn.splice,ea=_e?_e.isConcatSpreadable:r,ln=_e?_e.iterator:r,Re=_e?_e.toStringTag:r,Yn=function(){try{var t=Ie(X,"defineProperty");return t({},"",{}),t}catch{}}(),Vl=m.clearTimeout!==ot.clearTimeout&&m.clearTimeout,jl=b&&b.now!==ot.Date.now&&b.now,tf=m.setTimeout!==ot.setTimeout&&m.setTimeout,Kn=it.ceil,Zn=it.floor,ri=X.getOwnPropertySymbols,ef=$n?$n.isBuffer:r,na=m.isFinite,nf=Fn.join,rf=Js(X.keys,X),st=it.max,ct=it.min,sf=b.now,af=m.parseInt,ra=it.random,uf=Fn.reverse,ii=Ie(m,"DataView"),fn=Ie(m,"Map"),si=Ie(m,"Promise"),$e=Ie(m,"Set"),cn=Ie(m,"WeakMap"),hn=Ie(X,"create"),Jn=cn&&new cn,He={},of=Te(ii),lf=Te(fn),ff=Te(si),cf=Te($e),hf=Te(cn),Xn=_e?_e.prototype:r,dn=Xn?Xn.valueOf:r,ia=Xn?Xn.toString:r;function o(t){if(et(t)&&!W(t)&&!(t instanceof q)){if(t instanceof Ot)return t;if(J.call(t,"__wrapped__"))return su(t)}return new Ot(t)}var qe=function(){function t(){}return function(e){if(!tt(e))return{};if(js)return js(e);t.prototype=e;var n=new t;return t.prototype=r,n}}();function Qn(){}function Ot(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=r}o.templateSettings={escape:Ro,evaluate:Lo,interpolate:ds,variable:"",imports:{_:o}},o.prototype=Qn.prototype,o.prototype.constructor=o,Ot.prototype=qe(Qn.prototype),Ot.prototype.constructor=Ot;function q(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Zt,this.__views__=[]}function df(){var t=new q(this.__wrapped__);return t.__actions__=wt(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=wt(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=wt(this.__views__),t}function gf(){if(this.__filtered__){var t=new q(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function pf(){var t=this.__wrapped__.value(),e=this.__dir__,n=W(t),i=e<0,a=n?t.length:0,l=Ac(0,a,this.__views__),h=l.start,g=l.end,v=g-h,S=i?g:h-1,x=this.__iteratees__,C=x.length,R=0,E=ct(v,this.__takeCount__);if(!n||!i&&a==v&&E==v)return ba(t,this.__actions__);var O=[];t:for(;v--&&R<E;){S+=e;for(var B=-1,M=t[S];++B<C;){var H=x[B],z=H.iteratee,Lt=H.type,_t=z(M);if(Lt==uo)M=_t;else if(!_t){if(Lt==os)continue t;break t}}O[R++]=M}return O}q.prototype=qe(Qn.prototype),q.prototype.constructor=q;function Le(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function _f(){this.__data__=hn?hn(null):{},this.size=0}function vf(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function wf(t){var e=this.__data__;if(hn){var n=e[t];return n===D?r:n}return J.call(e,t)?e[t]:r}function yf(t){var e=this.__data__;return hn?e[t]!==r:J.call(e,t)}function mf(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=hn&&e===r?D:e,this}Le.prototype.clear=_f,Le.prototype.delete=vf,Le.prototype.get=wf,Le.prototype.has=yf,Le.prototype.set=mf;function ne(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function Sf(){this.__data__=[],this.size=0}function xf(t){var e=this.__data__,n=Vn(e,t);if(n<0)return!1;var i=e.length-1;return n==i?e.pop():zn.call(e,n,1),--this.size,!0}function Cf(t){var e=this.__data__,n=Vn(e,t);return n<0?r:e[n][1]}function Df(t){return Vn(this.__data__,t)>-1}function Rf(t,e){var n=this.__data__,i=Vn(n,t);return i<0?(++this.size,n.push([t,e])):n[i][1]=e,this}ne.prototype.clear=Sf,ne.prototype.delete=xf,ne.prototype.get=Cf,ne.prototype.has=Df,ne.prototype.set=Rf;function re(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function Lf(){this.size=0,this.__data__={hash:new Le,map:new(fn||ne),string:new Le}}function Af(t){var e=fr(this,t).delete(t);return this.size-=e?1:0,e}function bf(t){return fr(this,t).get(t)}function Ef(t){return fr(this,t).has(t)}function If(t,e){var n=fr(this,t),i=n.size;return n.set(t,e),this.size+=n.size==i?0:1,this}re.prototype.clear=Lf,re.prototype.delete=Af,re.prototype.get=bf,re.prototype.has=Ef,re.prototype.set=If;function Ae(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new re;++e<n;)this.add(t[e])}function Tf(t){return this.__data__.set(t,D),this}function Of(t){return this.__data__.has(t)}Ae.prototype.add=Ae.prototype.push=Tf,Ae.prototype.has=Of;function kt(t){var e=this.__data__=new ne(t);this.size=e.size}function Mf(){this.__data__=new ne,this.size=0}function Pf(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function Nf(t){return this.__data__.get(t)}function Uf(t){return this.__data__.has(t)}function Wf(t,e){var n=this.__data__;if(n instanceof ne){var i=n.__data__;if(!fn||i.length<f-1)return i.push([t,e]),this.size=++n.size,this;n=this.__data__=new re(i)}return n.set(t,e),this.size=n.size,this}kt.prototype.clear=Mf,kt.prototype.delete=Pf,kt.prototype.get=Nf,kt.prototype.has=Uf,kt.prototype.set=Wf;function sa(t,e){var n=W(t),i=!n&&Oe(t),a=!n&&!i&&Se(t),l=!n&&!i&&!a&&Ze(t),h=n||i||a||l,g=h?jr(t.length,Yl):[],v=g.length;for(var S in t)(e||J.call(t,S))&&!(h&&(S=="length"||a&&(S=="offset"||S=="parent")||l&&(S=="buffer"||S=="byteLength"||S=="byteOffset")||ue(S,v)))&&g.push(S);return g}function aa(t){var e=t.length;return e?t[_i(0,e-1)]:r}function Ff(t,e){return cr(wt(t),be(e,0,t.length))}function Gf(t){return cr(wt(t))}function ai(t,e,n){(n!==r&&!$t(t[e],n)||n===r&&!(e in t))&&ie(t,e,n)}function gn(t,e,n){var i=t[e];(!(J.call(t,e)&&$t(i,n))||n===r&&!(e in t))&&ie(t,e,n)}function Vn(t,e){for(var n=t.length;n--;)if($t(t[n][0],e))return n;return-1}function Bf(t,e,n,i){return ve(t,function(a,l,h){e(i,a,n(a),h)}),i}function ua(t,e){return t&&Xt(e,at(e),t)}function kf(t,e){return t&&Xt(e,mt(e),t)}function ie(t,e,n){e=="__proto__"&&Yn?Yn(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function ui(t,e){for(var n=-1,i=e.length,a=y(i),l=t==null;++n<i;)a[n]=l?r:ki(t,e[n]);return a}function be(t,e,n){return t===t&&(n!==r&&(t=t<=n?t:n),e!==r&&(t=t>=e?t:e)),t}function Mt(t,e,n,i,a,l){var h,g=e&$,v=e&dt,S=e&Z;if(n&&(h=a?n(t,i,a,l):n(t)),h!==r)return h;if(!tt(t))return t;var x=W(t);if(x){if(h=Ec(t),!g)return wt(t,h)}else{var C=ht(t),R=C==In||C==ls;if(Se(t))return Ta(t,g);if(C==ee||C==Pe||R&&!a){if(h=v||R?{}:Xa(t),!g)return v?wc(t,kf(h,t)):vc(t,ua(h,t))}else{if(!Q[C])return a?t:{};h=Ic(t,C,g)}}l||(l=new kt);var E=l.get(t);if(E)return E;l.set(t,h),Ru(t)?t.forEach(function(M){h.add(Mt(M,e,n,M,t,l))}):Cu(t)&&t.forEach(function(M,H){h.set(H,Mt(M,e,n,H,t,l))});var O=S?v?Ai:Li:v?mt:at,B=x?r:O(t);return It(B||t,function(M,H){B&&(H=M,M=t[H]),gn(h,H,Mt(M,e,n,H,t,l))}),h}function $f(t){var e=at(t);return function(n){return oa(n,t,e)}}function oa(t,e,n){var i=n.length;if(t==null)return!i;for(t=X(t);i--;){var a=n[i],l=e[a],h=t[a];if(h===r&&!(a in t)||!l(h))return!1}return!0}function la(t,e,n){if(typeof t!="function")throw new Tt(p);return Sn(function(){t.apply(r,n)},e)}function pn(t,e,n,i){var a=-1,l=Nn,h=!0,g=t.length,v=[],S=e.length;if(!g)return v;n&&(e=j(e,Ct(n))),i?(l=Kr,h=!1):e.length>=f&&(l=on,h=!1,e=new Ae(e));t:for(;++a<g;){var x=t[a],C=n==null?x:n(x);if(x=i||x!==0?x:0,h&&C===C){for(var R=S;R--;)if(e[R]===C)continue t;v.push(x)}else l(e,C,i)||v.push(x)}return v}var ve=Ua(Jt),fa=Ua(li,!0);function Hf(t,e){var n=!0;return ve(t,function(i,a,l){return n=!!e(i,a,l),n}),n}function jn(t,e,n){for(var i=-1,a=t.length;++i<a;){var l=t[i],h=e(l);if(h!=null&&(g===r?h===h&&!Rt(h):n(h,g)))var g=h,v=l}return v}function qf(t,e,n,i){var a=t.length;for(n=G(n),n<0&&(n=-n>a?0:a+n),i=i===r||i>a?a:G(i),i<0&&(i+=a),i=n>i?0:Au(i);n<i;)t[n++]=e;return t}function ca(t,e){var n=[];return ve(t,function(i,a,l){e(i,a,l)&&n.push(i)}),n}function lt(t,e,n,i,a){var l=-1,h=t.length;for(n||(n=Oc),a||(a=[]);++l<h;){var g=t[l];e>0&&n(g)?e>1?lt(g,e-1,n,i,a):ge(a,g):i||(a[a.length]=g)}return a}var oi=Wa(),ha=Wa(!0);function Jt(t,e){return t&&oi(t,e,at)}function li(t,e){return t&&ha(t,e,at)}function tr(t,e){return de(e,function(n){return oe(t[n])})}function Ee(t,e){e=ye(e,t);for(var n=0,i=e.length;t!=null&&n<i;)t=t[Qt(e[n++])];return n&&n==i?t:r}function da(t,e,n){var i=e(t);return W(t)?i:ge(i,n(t))}function gt(t){return t==null?t===r?wo:_o:Re&&Re in X(t)?Lc(t):Gc(t)}function fi(t,e){return t>e}function zf(t,e){return t!=null&&J.call(t,e)}function Yf(t,e){return t!=null&&e in X(t)}function Kf(t,e,n){return t>=ct(e,n)&&t<st(e,n)}function ci(t,e,n){for(var i=n?Kr:Nn,a=t[0].length,l=t.length,h=l,g=y(l),v=1/0,S=[];h--;){var x=t[h];h&&e&&(x=j(x,Ct(e))),v=ct(x.length,v),g[h]=!n&&(e||a>=120&&x.length>=120)?new Ae(h&&x):r}x=t[0];var C=-1,R=g[0];t:for(;++C<a&&S.length<v;){var E=x[C],O=e?e(E):E;if(E=n||E!==0?E:0,!(R?on(R,O):i(S,O,n))){for(h=l;--h;){var B=g[h];if(!(B?on(B,O):i(t[h],O,n)))continue t}R&&R.push(O),S.push(E)}}return S}function Zf(t,e,n,i){return Jt(t,function(a,l,h){e(i,n(a),l,h)}),i}function _n(t,e,n){e=ye(e,t),t=tu(t,e);var i=t==null?t:t[Qt(Nt(e))];return i==null?r:xt(i,t,n)}function ga(t){return et(t)&&gt(t)==Pe}function Jf(t){return et(t)&&gt(t)==un}function Xf(t){return et(t)&&gt(t)==en}function vn(t,e,n,i,a){return t===e?!0:t==null||e==null||!et(t)&&!et(e)?t!==t&&e!==e:Qf(t,e,n,i,vn,a)}function Qf(t,e,n,i,a,l){var h=W(t),g=W(e),v=h?bn:ht(t),S=g?bn:ht(e);v=v==Pe?ee:v,S=S==Pe?ee:S;var x=v==ee,C=S==ee,R=v==S;if(R&&Se(t)){if(!Se(e))return!1;h=!0,x=!1}if(R&&!x)return l||(l=new kt),h||Ze(t)?Ka(t,e,n,i,a,l):Dc(t,e,v,n,i,a,l);if(!(n&ut)){var E=x&&J.call(t,"__wrapped__"),O=C&&J.call(e,"__wrapped__");if(E||O){var B=E?t.value():t,M=O?e.value():e;return l||(l=new kt),a(B,M,n,i,l)}}return R?(l||(l=new kt),Rc(t,e,n,i,a,l)):!1}function Vf(t){return et(t)&&ht(t)==Ft}function hi(t,e,n,i){var a=n.length,l=a,h=!i;if(t==null)return!l;for(t=X(t);a--;){var g=n[a];if(h&&g[2]?g[1]!==t[g[0]]:!(g[0]in t))return!1}for(;++a<l;){g=n[a];var v=g[0],S=t[v],x=g[1];if(h&&g[2]){if(S===r&&!(v in t))return!1}else{var C=new kt;if(i)var R=i(S,x,v,t,e,C);if(!(R===r?vn(x,S,ut|ce,i,C):R))return!1}}return!0}function pa(t){if(!tt(t)||Pc(t))return!1;var e=oe(t)?Ql:ko;return e.test(Te(t))}function jf(t){return et(t)&&gt(t)==rn}function tc(t){return et(t)&&ht(t)==Gt}function ec(t){return et(t)&&vr(t.length)&&!!V[gt(t)]}function _a(t){return typeof t=="function"?t:t==null?St:typeof t=="object"?W(t)?ya(t[0],t[1]):wa(t):Fu(t)}function di(t){if(!mn(t))return rf(t);var e=[];for(var n in X(t))J.call(t,n)&&n!="constructor"&&e.push(n);return e}function nc(t){if(!tt(t))return Fc(t);var e=mn(t),n=[];for(var i in t)i=="constructor"&&(e||!J.call(t,i))||n.push(i);return n}function gi(t,e){return t<e}function va(t,e){var n=-1,i=yt(t)?y(t.length):[];return ve(t,function(a,l,h){i[++n]=e(a,l,h)}),i}function wa(t){var e=Ei(t);return e.length==1&&e[0][2]?Va(e[0][0],e[0][1]):function(n){return n===t||hi(n,t,e)}}function ya(t,e){return Ti(t)&&Qa(e)?Va(Qt(t),e):function(n){var i=ki(n,t);return i===r&&i===e?$i(n,t):vn(e,i,ut|ce)}}function er(t,e,n,i,a){t!==e&&oi(e,function(l,h){if(a||(a=new kt),tt(l))rc(t,e,h,n,er,i,a);else{var g=i?i(Mi(t,h),l,h+"",t,e,a):r;g===r&&(g=l),ai(t,h,g)}},mt)}function rc(t,e,n,i,a,l,h){var g=Mi(t,n),v=Mi(e,n),S=h.get(v);if(S){ai(t,n,S);return}var x=l?l(g,v,n+"",t,e,h):r,C=x===r;if(C){var R=W(v),E=!R&&Se(v),O=!R&&!E&&Ze(v);x=v,R||E||O?W(g)?x=g:nt(g)?x=wt(g):E?(C=!1,x=Ta(v,!0)):O?(C=!1,x=Oa(v,!0)):x=[]:xn(v)||Oe(v)?(x=g,Oe(g)?x=bu(g):(!tt(g)||oe(g))&&(x=Xa(v))):C=!1}C&&(h.set(v,x),a(x,v,i,l,h),h.delete(v)),ai(t,n,x)}function ma(t,e){var n=t.length;if(n)return e+=e<0?n:0,ue(e,n)?t[e]:r}function Sa(t,e,n){e.length?e=j(e,function(l){return W(l)?function(h){return Ee(h,l.length===1?l[0]:l)}:l}):e=[St];var i=-1;e=j(e,Ct(T()));var a=va(t,function(l,h,g){var v=j(e,function(S){return S(l)});return{criteria:v,index:++i,value:l}});return El(a,function(l,h){return _c(l,h,n)})}function ic(t,e){return xa(t,e,function(n,i){return $i(t,i)})}function xa(t,e,n){for(var i=-1,a=e.length,l={};++i<a;){var h=e[i],g=Ee(t,h);n(g,h)&&wn(l,ye(h,t),g)}return l}function sc(t){return function(e){return Ee(e,t)}}function pi(t,e,n,i){var a=i?bl:We,l=-1,h=e.length,g=t;for(t===e&&(e=wt(e)),n&&(g=j(t,Ct(n)));++l<h;)for(var v=0,S=e[l],x=n?n(S):S;(v=a(g,x,v,i))>-1;)g!==t&&zn.call(g,v,1),zn.call(t,v,1);return t}function Ca(t,e){for(var n=t?e.length:0,i=n-1;n--;){var a=e[n];if(n==i||a!==l){var l=a;ue(a)?zn.call(t,a,1):yi(t,a)}}return t}function _i(t,e){return t+Zn(ra()*(e-t+1))}function ac(t,e,n,i){for(var a=-1,l=st(Kn((e-t)/(n||1)),0),h=y(l);l--;)h[i?l:++a]=t,t+=n;return h}function vi(t,e){var n="";if(!t||e<1||e>he)return n;do e%2&&(n+=t),e=Zn(e/2),e&&(t+=t);while(e);return n}function k(t,e){return Pi(ja(t,e,St),t+"")}function uc(t){return aa(Je(t))}function oc(t,e){var n=Je(t);return cr(n,be(e,0,n.length))}function wn(t,e,n,i){if(!tt(t))return t;e=ye(e,t);for(var a=-1,l=e.length,h=l-1,g=t;g!=null&&++a<l;){var v=Qt(e[a]),S=n;if(v==="__proto__"||v==="constructor"||v==="prototype")return t;if(a!=h){var x=g[v];S=i?i(x,v,g):r,S===r&&(S=tt(x)?x:ue(e[a+1])?[]:{})}gn(g,v,S),g=g[v]}return t}var Da=Jn?function(t,e){return Jn.set(t,e),t}:St,lc=Yn?function(t,e){return Yn(t,"toString",{configurable:!0,enumerable:!1,value:qi(e),writable:!0})}:St;function fc(t){return cr(Je(t))}function Pt(t,e,n){var i=-1,a=t.length;e<0&&(e=-e>a?0:a+e),n=n>a?a:n,n<0&&(n+=a),a=e>n?0:n-e>>>0,e>>>=0;for(var l=y(a);++i<a;)l[i]=t[i+e];return l}function cc(t,e){var n;return ve(t,function(i,a,l){return n=e(i,a,l),!n}),!!n}function nr(t,e,n){var i=0,a=t==null?i:t.length;if(typeof e=="number"&&e===e&&a<=co){for(;i<a;){var l=i+a>>>1,h=t[l];h!==null&&!Rt(h)&&(n?h<=e:h<e)?i=l+1:a=l}return a}return wi(t,e,St,n)}function wi(t,e,n,i){var a=0,l=t==null?0:t.length;if(l===0)return 0;e=n(e);for(var h=e!==e,g=e===null,v=Rt(e),S=e===r;a<l;){var x=Zn((a+l)/2),C=n(t[x]),R=C!==r,E=C===null,O=C===C,B=Rt(C);if(h)var M=i||O;else S?M=O&&(i||R):g?M=O&&R&&(i||!E):v?M=O&&R&&!E&&(i||!B):E||B?M=!1:M=i?C<=e:C<e;M?a=x+1:l=x}return ct(l,fo)}function Ra(t,e){for(var n=-1,i=t.length,a=0,l=[];++n<i;){var h=t[n],g=e?e(h):h;if(!n||!$t(g,v)){var v=g;l[a++]=h===0?0:h}}return l}function La(t){return typeof t=="number"?t:Rt(t)?An:+t}function Dt(t){if(typeof t=="string")return t;if(W(t))return j(t,Dt)+"";if(Rt(t))return ia?ia.call(t):"";var e=t+"";return e=="0"&&1/t==-Ce?"-0":e}function we(t,e,n){var i=-1,a=Nn,l=t.length,h=!0,g=[],v=g;if(n)h=!1,a=Kr;else if(l>=f){var S=e?null:xc(t);if(S)return Wn(S);h=!1,a=on,v=new Ae}else v=e?[]:g;t:for(;++i<l;){var x=t[i],C=e?e(x):x;if(x=n||x!==0?x:0,h&&C===C){for(var R=v.length;R--;)if(v[R]===C)continue t;e&&v.push(C),g.push(x)}else a(v,C,n)||(v!==g&&v.push(C),g.push(x))}return g}function yi(t,e){return e=ye(e,t),t=tu(t,e),t==null||delete t[Qt(Nt(e))]}function Aa(t,e,n,i){return wn(t,e,n(Ee(t,e)),i)}function rr(t,e,n,i){for(var a=t.length,l=i?a:-1;(i?l--:++l<a)&&e(t[l],l,t););return n?Pt(t,i?0:l,i?l+1:a):Pt(t,i?l+1:0,i?a:l)}function ba(t,e){var n=t;return n instanceof q&&(n=n.value()),Zr(e,function(i,a){return a.func.apply(a.thisArg,ge([i],a.args))},n)}function mi(t,e,n){var i=t.length;if(i<2)return i?we(t[0]):[];for(var a=-1,l=y(i);++a<i;)for(var h=t[a],g=-1;++g<i;)g!=a&&(l[a]=pn(l[a]||h,t[g],e,n));return we(lt(l,1),e,n)}function Ea(t,e,n){for(var i=-1,a=t.length,l=e.length,h={};++i<a;){var g=i<l?e[i]:r;n(h,t[i],g)}return h}function Si(t){return nt(t)?t:[]}function xi(t){return typeof t=="function"?t:St}function ye(t,e){return W(t)?t:Ti(t,e)?[t]:iu(K(t))}var hc=k;function me(t,e,n){var i=t.length;return n=n===r?i:n,!e&&n>=i?t:Pt(t,e,n)}var Ia=Vl||function(t){return ot.clearTimeout(t)};function Ta(t,e){if(e)return t.slice();var n=t.length,i=Vs?Vs(n):new t.constructor(n);return t.copy(i),i}function Ci(t){var e=new t.constructor(t.byteLength);return new Hn(e).set(new Hn(t)),e}function dc(t,e){var n=e?Ci(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}function gc(t){var e=new t.constructor(t.source,gs.exec(t));return e.lastIndex=t.lastIndex,e}function pc(t){return dn?X(dn.call(t)):{}}function Oa(t,e){var n=e?Ci(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Ma(t,e){if(t!==e){var n=t!==r,i=t===null,a=t===t,l=Rt(t),h=e!==r,g=e===null,v=e===e,S=Rt(e);if(!g&&!S&&!l&&t>e||l&&h&&v&&!g&&!S||i&&h&&v||!n&&v||!a)return 1;if(!i&&!l&&!S&&t<e||S&&n&&a&&!i&&!l||g&&n&&a||!h&&a||!v)return-1}return 0}function _c(t,e,n){for(var i=-1,a=t.criteria,l=e.criteria,h=a.length,g=n.length;++i<h;){var v=Ma(a[i],l[i]);if(v){if(i>=g)return v;var S=n[i];return v*(S=="desc"?-1:1)}}return t.index-e.index}function Pa(t,e,n,i){for(var a=-1,l=t.length,h=n.length,g=-1,v=e.length,S=st(l-h,0),x=y(v+S),C=!i;++g<v;)x[g]=e[g];for(;++a<h;)(C||a<l)&&(x[n[a]]=t[a]);for(;S--;)x[g++]=t[a++];return x}function Na(t,e,n,i){for(var a=-1,l=t.length,h=-1,g=n.length,v=-1,S=e.length,x=st(l-g,0),C=y(x+S),R=!i;++a<x;)C[a]=t[a];for(var E=a;++v<S;)C[E+v]=e[v];for(;++h<g;)(R||a<l)&&(C[E+n[h]]=t[a++]);return C}function wt(t,e){var n=-1,i=t.length;for(e||(e=y(i));++n<i;)e[n]=t[n];return e}function Xt(t,e,n,i){var a=!n;n||(n={});for(var l=-1,h=e.length;++l<h;){var g=e[l],v=i?i(n[g],t[g],g,n,t):r;v===r&&(v=t[g]),a?ie(n,g,v):gn(n,g,v)}return n}function vc(t,e){return Xt(t,Ii(t),e)}function wc(t,e){return Xt(t,Za(t),e)}function ir(t,e){return function(n,i){var a=W(n)?xl:Bf,l=e?e():{};return a(n,t,T(i,2),l)}}function ze(t){return k(function(e,n){var i=-1,a=n.length,l=a>1?n[a-1]:r,h=a>2?n[2]:r;for(l=t.length>3&&typeof l=="function"?(a--,l):r,h&&pt(n[0],n[1],h)&&(l=a<3?r:l,a=1),e=X(e);++i<a;){var g=n[i];g&&t(e,g,i,l)}return e})}function Ua(t,e){return function(n,i){if(n==null)return n;if(!yt(n))return t(n,i);for(var a=n.length,l=e?a:-1,h=X(n);(e?l--:++l<a)&&i(h[l],l,h)!==!1;);return n}}function Wa(t){return function(e,n,i){for(var a=-1,l=X(e),h=i(e),g=h.length;g--;){var v=h[t?g:++a];if(n(l[v],v,l)===!1)break}return e}}function yc(t,e,n){var i=e&Wt,a=yn(t);function l(){var h=this&&this!==ot&&this instanceof l?a:t;return h.apply(i?n:this,arguments)}return l}function Fa(t){return function(e){e=K(e);var n=Fe(e)?Bt(e):r,i=n?n[0]:e.charAt(0),a=n?me(n,1).join(""):e.slice(1);return i[t]()+a}}function Ye(t){return function(e){return Zr(Uu(Nu(e).replace(ol,"")),t,"")}}function yn(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=qe(t.prototype),i=t.apply(n,e);return tt(i)?i:n}}function mc(t,e,n){var i=yn(t);function a(){for(var l=arguments.length,h=y(l),g=l,v=Ke(a);g--;)h[g]=arguments[g];var S=l<3&&h[0]!==v&&h[l-1]!==v?[]:pe(h,v);if(l-=S.length,l<n)return Ha(t,e,sr,a.placeholder,r,h,S,r,r,n-l);var x=this&&this!==ot&&this instanceof a?i:t;return xt(x,this,h)}return a}function Ga(t){return function(e,n,i){var a=X(e);if(!yt(e)){var l=T(n,3);e=at(e),n=function(g){return l(a[g],g,a)}}var h=t(e,n,i);return h>-1?a[l?e[h]:h]:r}}function Ba(t){return ae(function(e){var n=e.length,i=n,a=Ot.prototype.thru;for(t&&e.reverse();i--;){var l=e[i];if(typeof l!="function")throw new Tt(p);if(a&&!h&&lr(l)=="wrapper")var h=new Ot([],!0)}for(i=h?i:n;++i<n;){l=e[i];var g=lr(l),v=g=="wrapper"?bi(l):r;v&&Oi(v[0])&&v[1]==(te|Vt|jt|je)&&!v[4].length&&v[9]==1?h=h[lr(v[0])].apply(h,v[3]):h=l.length==1&&Oi(l)?h[g]():h.thru(l)}return function(){var S=arguments,x=S[0];if(h&&S.length==1&&W(x))return h.plant(x).value();for(var C=0,R=n?e[C].apply(this,S):x;++C<n;)R=e[C].call(this,R);return R}})}function sr(t,e,n,i,a,l,h,g,v,S){var x=e&te,C=e&Wt,R=e&Me,E=e&(Vt|Qe),O=e&br,B=R?r:yn(t);function M(){for(var H=arguments.length,z=y(H),Lt=H;Lt--;)z[Lt]=arguments[Lt];if(E)var _t=Ke(M),At=Tl(z,_t);if(i&&(z=Pa(z,i,a,E)),l&&(z=Na(z,l,h,E)),H-=At,E&&H<S){var rt=pe(z,_t);return Ha(t,e,sr,M.placeholder,n,z,rt,g,v,S-H)}var Ht=C?n:this,fe=R?Ht[t]:t;return H=z.length,g?z=Bc(z,g):O&&H>1&&z.reverse(),x&&v<H&&(z.length=v),this&&this!==ot&&this instanceof M&&(fe=B||yn(fe)),fe.apply(Ht,z)}return M}function ka(t,e){return function(n,i){return Zf(n,t,e(i),{})}}function ar(t,e){return function(n,i){var a;if(n===r&&i===r)return e;if(n!==r&&(a=n),i!==r){if(a===r)return i;typeof n=="string"||typeof i=="string"?(n=Dt(n),i=Dt(i)):(n=La(n),i=La(i)),a=t(n,i)}return a}}function Di(t){return ae(function(e){return e=j(e,Ct(T())),k(function(n){var i=this;return t(e,function(a){return xt(a,i,n)})})})}function ur(t,e){e=e===r?" ":Dt(e);var n=e.length;if(n<2)return n?vi(e,t):e;var i=vi(e,Kn(t/Ge(e)));return Fe(e)?me(Bt(i),0,t).join(""):i.slice(0,t)}function Sc(t,e,n,i){var a=e&Wt,l=yn(t);function h(){for(var g=-1,v=arguments.length,S=-1,x=i.length,C=y(x+v),R=this&&this!==ot&&this instanceof h?l:t;++S<x;)C[S]=i[S];for(;v--;)C[S++]=arguments[++g];return xt(R,a?n:this,C)}return h}function $a(t){return function(e,n,i){return i&&typeof i!="number"&&pt(e,n,i)&&(n=i=r),e=le(e),n===r?(n=e,e=0):n=le(n),i=i===r?e<n?1:-1:le(i),ac(e,n,i,t)}}function or(t){return function(e,n){return typeof e=="string"&&typeof n=="string"||(e=Ut(e),n=Ut(n)),t(e,n)}}function Ha(t,e,n,i,a,l,h,g,v,S){var x=e&Vt,C=x?h:r,R=x?r:h,E=x?l:r,O=x?r:l;e|=x?jt:Ve,e&=~(x?Ve:jt),e&us||(e&=-4);var B=[t,e,a,E,C,O,R,g,v,S],M=n.apply(r,B);return Oi(t)&&eu(M,B),M.placeholder=i,nu(M,t,e)}function Ri(t){var e=it[t];return function(n,i){if(n=Ut(n),i=i==null?0:ct(G(i),292),i&&na(n)){var a=(K(n)+"e").split("e"),l=e(a[0]+"e"+(+a[1]+i));return a=(K(l)+"e").split("e"),+(a[0]+"e"+(+a[1]-i))}return e(n)}}var xc=$e&&1/Wn(new $e([,-0]))[1]==Ce?function(t){return new $e(t)}:Ki;function qa(t){return function(e){var n=ht(e);return n==Ft?ei(e):n==Gt?Fl(e):Il(e,t(e))}}function se(t,e,n,i,a,l,h,g){var v=e&Me;if(!v&&typeof t!="function")throw new Tt(p);var S=i?i.length:0;if(S||(e&=-97,i=a=r),h=h===r?h:st(G(h),0),g=g===r?g:G(g),S-=a?a.length:0,e&Ve){var x=i,C=a;i=a=r}var R=v?r:bi(t),E=[t,e,n,i,a,x,C,l,h,g];if(R&&Wc(E,R),t=E[0],e=E[1],n=E[2],i=E[3],a=E[4],g=E[9]=E[9]===r?v?0:t.length:st(E[9]-S,0),!g&&e&(Vt|Qe)&&(e&=-25),!e||e==Wt)var O=yc(t,e,n);else e==Vt||e==Qe?O=mc(t,e,g):(e==jt||e==(Wt|jt))&&!a.length?O=Sc(t,e,n,i):O=sr.apply(r,E);var B=R?Da:eu;return nu(B(O,E),t,e)}function za(t,e,n,i){return t===r||$t(t,ke[n])&&!J.call(i,n)?e:t}function Ya(t,e,n,i,a,l){return tt(t)&&tt(e)&&(l.set(e,t),er(t,e,r,Ya,l),l.delete(e)),t}function Cc(t){return xn(t)?r:t}function Ka(t,e,n,i,a,l){var h=n&ut,g=t.length,v=e.length;if(g!=v&&!(h&&v>g))return!1;var S=l.get(t),x=l.get(e);if(S&&x)return S==e&&x==t;var C=-1,R=!0,E=n&ce?new Ae:r;for(l.set(t,e),l.set(e,t);++C<g;){var O=t[C],B=e[C];if(i)var M=h?i(B,O,C,e,t,l):i(O,B,C,t,e,l);if(M!==r){if(M)continue;R=!1;break}if(E){if(!Jr(e,function(H,z){if(!on(E,z)&&(O===H||a(O,H,n,i,l)))return E.push(z)})){R=!1;break}}else if(!(O===B||a(O,B,n,i,l))){R=!1;break}}return l.delete(t),l.delete(e),R}function Dc(t,e,n,i,a,l,h){switch(n){case Ne:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case un:return!(t.byteLength!=e.byteLength||!l(new Hn(t),new Hn(e)));case tn:case en:case nn:return $t(+t,+e);case En:return t.name==e.name&&t.message==e.message;case rn:case sn:return t==e+"";case Ft:var g=ei;case Gt:var v=i&ut;if(g||(g=Wn),t.size!=e.size&&!v)return!1;var S=h.get(t);if(S)return S==e;i|=ce,h.set(t,e);var x=Ka(g(t),g(e),i,a,l,h);return h.delete(t),x;case Tn:if(dn)return dn.call(t)==dn.call(e)}return!1}function Rc(t,e,n,i,a,l){var h=n&ut,g=Li(t),v=g.length,S=Li(e),x=S.length;if(v!=x&&!h)return!1;for(var C=v;C--;){var R=g[C];if(!(h?R in e:J.call(e,R)))return!1}var E=l.get(t),O=l.get(e);if(E&&O)return E==e&&O==t;var B=!0;l.set(t,e),l.set(e,t);for(var M=h;++C<v;){R=g[C];var H=t[R],z=e[R];if(i)var Lt=h?i(z,H,R,e,t,l):i(H,z,R,t,e,l);if(!(Lt===r?H===z||a(H,z,n,i,l):Lt)){B=!1;break}M||(M=R=="constructor")}if(B&&!M){var _t=t.constructor,At=e.constructor;_t!=At&&"constructor"in t&&"constructor"in e&&!(typeof _t=="function"&&_t instanceof _t&&typeof At=="function"&&At instanceof At)&&(B=!1)}return l.delete(t),l.delete(e),B}function ae(t){return Pi(ja(t,r,ou),t+"")}function Li(t){return da(t,at,Ii)}function Ai(t){return da(t,mt,Za)}var bi=Jn?function(t){return Jn.get(t)}:Ki;function lr(t){for(var e=t.name+"",n=He[e],i=J.call(He,e)?n.length:0;i--;){var a=n[i],l=a.func;if(l==null||l==t)return a.name}return e}function Ke(t){var e=J.call(o,"placeholder")?o:t;return e.placeholder}function T(){var t=o.iteratee||zi;return t=t===zi?_a:t,arguments.length?t(arguments[0],arguments[1]):t}function fr(t,e){var n=t.__data__;return Mc(e)?n[typeof e=="string"?"string":"hash"]:n.map}function Ei(t){for(var e=at(t),n=e.length;n--;){var i=e[n],a=t[i];e[n]=[i,a,Qa(a)]}return e}function Ie(t,e){var n=Nl(t,e);return pa(n)?n:r}function Lc(t){var e=J.call(t,Re),n=t[Re];try{t[Re]=r;var i=!0}catch{}var a=kn.call(t);return i&&(e?t[Re]=n:delete t[Re]),a}var Ii=ri?function(t){return t==null?[]:(t=X(t),de(ri(t),function(e){return ta.call(t,e)}))}:Zi,Za=ri?function(t){for(var e=[];t;)ge(e,Ii(t)),t=qn(t);return e}:Zi,ht=gt;(ii&&ht(new ii(new ArrayBuffer(1)))!=Ne||fn&&ht(new fn)!=Ft||si&&ht(si.resolve())!=fs||$e&&ht(new $e)!=Gt||cn&&ht(new cn)!=an)&&(ht=function(t){var e=gt(t),n=e==ee?t.constructor:r,i=n?Te(n):"";if(i)switch(i){case of:return Ne;case lf:return Ft;case ff:return fs;case cf:return Gt;case hf:return an}return e});function Ac(t,e,n){for(var i=-1,a=n.length;++i<a;){var l=n[i],h=l.size;switch(l.type){case"drop":t+=h;break;case"dropRight":e-=h;break;case"take":e=ct(e,t+h);break;case"takeRight":t=st(t,e-h);break}}return{start:t,end:e}}function bc(t){var e=t.match(Mo);return e?e[1].split(Po):[]}function Ja(t,e,n){e=ye(e,t);for(var i=-1,a=e.length,l=!1;++i<a;){var h=Qt(e[i]);if(!(l=t!=null&&n(t,h)))break;t=t[h]}return l||++i!=a?l:(a=t==null?0:t.length,!!a&&vr(a)&&ue(h,a)&&(W(t)||Oe(t)))}function Ec(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&J.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function Xa(t){return typeof t.constructor=="function"&&!mn(t)?qe(qn(t)):{}}function Ic(t,e,n){var i=t.constructor;switch(e){case un:return Ci(t);case tn:case en:return new i(+t);case Ne:return dc(t,n);case Er:case Ir:case Tr:case Or:case Mr:case Pr:case Nr:case Ur:case Wr:return Oa(t,n);case Ft:return new i;case nn:case sn:return new i(t);case rn:return gc(t);case Gt:return new i;case Tn:return pc(t)}}function Tc(t,e){var n=e.length;if(!n)return t;var i=n-1;return e[i]=(n>1?"& ":"")+e[i],e=e.join(n>2?", ":" "),t.replace(Oo,`{
/* [wrapped with `+e+`] */
`)}function Oc(t){return W(t)||Oe(t)||!!(ea&&t&&t[ea])}function ue(t,e){var n=typeof t;return e=e??he,!!e&&(n=="number"||n!="symbol"&&Ho.test(t))&&t>-1&&t%1==0&&t<e}function pt(t,e,n){if(!tt(n))return!1;var i=typeof e;return(i=="number"?yt(n)&&ue(e,n.length):i=="string"&&e in n)?$t(n[e],t):!1}function Ti(t,e){if(W(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||Rt(t)?!0:bo.test(t)||!Ao.test(t)||e!=null&&t in X(e)}function Mc(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function Oi(t){var e=lr(t),n=o[e];if(typeof n!="function"||!(e in q.prototype))return!1;if(t===n)return!0;var i=bi(n);return!!i&&t===i[0]}function Pc(t){return!!Qs&&Qs in t}var Nc=Gn?oe:Ji;function mn(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||ke;return t===n}function Qa(t){return t===t&&!tt(t)}function Va(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==r||t in X(n))}}function Uc(t){var e=pr(t,function(i){return n.size===L&&n.clear(),i}),n=e.cache;return e}function Wc(t,e){var n=t[1],i=e[1],a=n|i,l=a<(Wt|Me|te),h=i==te&&n==Vt||i==te&&n==je&&t[7].length<=e[8]||i==(te|je)&&e[7].length<=e[8]&&n==Vt;if(!(l||h))return t;i&Wt&&(t[2]=e[2],a|=n&Wt?0:us);var g=e[3];if(g){var v=t[3];t[3]=v?Pa(v,g,e[4]):g,t[4]=v?pe(t[3],I):e[4]}return g=e[5],g&&(v=t[5],t[5]=v?Na(v,g,e[6]):g,t[6]=v?pe(t[5],I):e[6]),g=e[7],g&&(t[7]=g),i&te&&(t[8]=t[8]==null?e[8]:ct(t[8],e[8])),t[9]==null&&(t[9]=e[9]),t[0]=e[0],t[1]=a,t}function Fc(t){var e=[];if(t!=null)for(var n in X(t))e.push(n);return e}function Gc(t){return kn.call(t)}function ja(t,e,n){return e=st(e===r?t.length-1:e,0),function(){for(var i=arguments,a=-1,l=st(i.length-e,0),h=y(l);++a<l;)h[a]=i[e+a];a=-1;for(var g=y(e+1);++a<e;)g[a]=i[a];return g[e]=n(h),xt(t,this,g)}}function tu(t,e){return e.length<2?t:Ee(t,Pt(e,0,-1))}function Bc(t,e){for(var n=t.length,i=ct(e.length,n),a=wt(t);i--;){var l=e[i];t[i]=ue(l,n)?a[l]:r}return t}function Mi(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var eu=ru(Da),Sn=tf||function(t,e){return ot.setTimeout(t,e)},Pi=ru(lc);function nu(t,e,n){var i=e+"";return Pi(t,Tc(i,kc(bc(i),n)))}function ru(t){var e=0,n=0;return function(){var i=sf(),a=ao-(i-n);if(n=i,a>0){if(++e>=so)return arguments[0]}else e=0;return t.apply(r,arguments)}}function cr(t,e){var n=-1,i=t.length,a=i-1;for(e=e===r?i:e;++n<e;){var l=_i(n,a),h=t[l];t[l]=t[n],t[n]=h}return t.length=e,t}var iu=Uc(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Eo,function(n,i,a,l){e.push(a?l.replace(Wo,"$1"):i||n)}),e});function Qt(t){if(typeof t=="string"||Rt(t))return t;var e=t+"";return e=="0"&&1/t==-Ce?"-0":e}function Te(t){if(t!=null){try{return Bn.call(t)}catch{}try{return t+""}catch{}}return""}function kc(t,e){return It(ho,function(n){var i="_."+n[0];e&n[1]&&!Nn(t,i)&&t.push(i)}),t.sort()}function su(t){if(t instanceof q)return t.clone();var e=new Ot(t.__wrapped__,t.__chain__);return e.__actions__=wt(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function $c(t,e,n){(n?pt(t,e,n):e===r)?e=1:e=st(G(e),0);var i=t==null?0:t.length;if(!i||e<1)return[];for(var a=0,l=0,h=y(Kn(i/e));a<i;)h[l++]=Pt(t,a,a+=e);return h}function Hc(t){for(var e=-1,n=t==null?0:t.length,i=0,a=[];++e<n;){var l=t[e];l&&(a[i++]=l)}return a}function qc(){var t=arguments.length;if(!t)return[];for(var e=y(t-1),n=arguments[0],i=t;i--;)e[i-1]=arguments[i];return ge(W(n)?wt(n):[n],lt(e,1))}var zc=k(function(t,e){return nt(t)?pn(t,lt(e,1,nt,!0)):[]}),Yc=k(function(t,e){var n=Nt(e);return nt(n)&&(n=r),nt(t)?pn(t,lt(e,1,nt,!0),T(n,2)):[]}),Kc=k(function(t,e){var n=Nt(e);return nt(n)&&(n=r),nt(t)?pn(t,lt(e,1,nt,!0),r,n):[]});function Zc(t,e,n){var i=t==null?0:t.length;return i?(e=n||e===r?1:G(e),Pt(t,e<0?0:e,i)):[]}function Jc(t,e,n){var i=t==null?0:t.length;return i?(e=n||e===r?1:G(e),e=i-e,Pt(t,0,e<0?0:e)):[]}function Xc(t,e){return t&&t.length?rr(t,T(e,3),!0,!0):[]}function Qc(t,e){return t&&t.length?rr(t,T(e,3),!0):[]}function Vc(t,e,n,i){var a=t==null?0:t.length;return a?(n&&typeof n!="number"&&pt(t,e,n)&&(n=0,i=a),qf(t,e,n,i)):[]}function au(t,e,n){var i=t==null?0:t.length;if(!i)return-1;var a=n==null?0:G(n);return a<0&&(a=st(i+a,0)),Un(t,T(e,3),a)}function uu(t,e,n){var i=t==null?0:t.length;if(!i)return-1;var a=i-1;return n!==r&&(a=G(n),a=n<0?st(i+a,0):ct(a,i-1)),Un(t,T(e,3),a,!0)}function ou(t){var e=t==null?0:t.length;return e?lt(t,1):[]}function jc(t){var e=t==null?0:t.length;return e?lt(t,Ce):[]}function th(t,e){var n=t==null?0:t.length;return n?(e=e===r?1:G(e),lt(t,e)):[]}function eh(t){for(var e=-1,n=t==null?0:t.length,i={};++e<n;){var a=t[e];i[a[0]]=a[1]}return i}function lu(t){return t&&t.length?t[0]:r}function nh(t,e,n){var i=t==null?0:t.length;if(!i)return-1;var a=n==null?0:G(n);return a<0&&(a=st(i+a,0)),We(t,e,a)}function rh(t){var e=t==null?0:t.length;return e?Pt(t,0,-1):[]}var ih=k(function(t){var e=j(t,Si);return e.length&&e[0]===t[0]?ci(e):[]}),sh=k(function(t){var e=Nt(t),n=j(t,Si);return e===Nt(n)?e=r:n.pop(),n.length&&n[0]===t[0]?ci(n,T(e,2)):[]}),ah=k(function(t){var e=Nt(t),n=j(t,Si);return e=typeof e=="function"?e:r,e&&n.pop(),n.length&&n[0]===t[0]?ci(n,r,e):[]});function uh(t,e){return t==null?"":nf.call(t,e)}function Nt(t){var e=t==null?0:t.length;return e?t[e-1]:r}function oh(t,e,n){var i=t==null?0:t.length;if(!i)return-1;var a=i;return n!==r&&(a=G(n),a=a<0?st(i+a,0):ct(a,i-1)),e===e?Bl(t,e,a):Un(t,Hs,a,!0)}function lh(t,e){return t&&t.length?ma(t,G(e)):r}var fh=k(fu);function fu(t,e){return t&&t.length&&e&&e.length?pi(t,e):t}function ch(t,e,n){return t&&t.length&&e&&e.length?pi(t,e,T(n,2)):t}function hh(t,e,n){return t&&t.length&&e&&e.length?pi(t,e,r,n):t}var dh=ae(function(t,e){var n=t==null?0:t.length,i=ui(t,e);return Ca(t,j(e,function(a){return ue(a,n)?+a:a}).sort(Ma)),i});function gh(t,e){var n=[];if(!(t&&t.length))return n;var i=-1,a=[],l=t.length;for(e=T(e,3);++i<l;){var h=t[i];e(h,i,t)&&(n.push(h),a.push(i))}return Ca(t,a),n}function Ni(t){return t==null?t:uf.call(t)}function ph(t,e,n){var i=t==null?0:t.length;return i?(n&&typeof n!="number"&&pt(t,e,n)?(e=0,n=i):(e=e==null?0:G(e),n=n===r?i:G(n)),Pt(t,e,n)):[]}function _h(t,e){return nr(t,e)}function vh(t,e,n){return wi(t,e,T(n,2))}function wh(t,e){var n=t==null?0:t.length;if(n){var i=nr(t,e);if(i<n&&$t(t[i],e))return i}return-1}function yh(t,e){return nr(t,e,!0)}function mh(t,e,n){return wi(t,e,T(n,2),!0)}function Sh(t,e){var n=t==null?0:t.length;if(n){var i=nr(t,e,!0)-1;if($t(t[i],e))return i}return-1}function xh(t){return t&&t.length?Ra(t):[]}function Ch(t,e){return t&&t.length?Ra(t,T(e,2)):[]}function Dh(t){var e=t==null?0:t.length;return e?Pt(t,1,e):[]}function Rh(t,e,n){return t&&t.length?(e=n||e===r?1:G(e),Pt(t,0,e<0?0:e)):[]}function Lh(t,e,n){var i=t==null?0:t.length;return i?(e=n||e===r?1:G(e),e=i-e,Pt(t,e<0?0:e,i)):[]}function Ah(t,e){return t&&t.length?rr(t,T(e,3),!1,!0):[]}function bh(t,e){return t&&t.length?rr(t,T(e,3)):[]}var Eh=k(function(t){return we(lt(t,1,nt,!0))}),Ih=k(function(t){var e=Nt(t);return nt(e)&&(e=r),we(lt(t,1,nt,!0),T(e,2))}),Th=k(function(t){var e=Nt(t);return e=typeof e=="function"?e:r,we(lt(t,1,nt,!0),r,e)});function Oh(t){return t&&t.length?we(t):[]}function Mh(t,e){return t&&t.length?we(t,T(e,2)):[]}function Ph(t,e){return e=typeof e=="function"?e:r,t&&t.length?we(t,r,e):[]}function Ui(t){if(!(t&&t.length))return[];var e=0;return t=de(t,function(n){if(nt(n))return e=st(n.length,e),!0}),jr(e,function(n){return j(t,Xr(n))})}function cu(t,e){if(!(t&&t.length))return[];var n=Ui(t);return e==null?n:j(n,function(i){return xt(e,r,i)})}var Nh=k(function(t,e){return nt(t)?pn(t,e):[]}),Uh=k(function(t){return mi(de(t,nt))}),Wh=k(function(t){var e=Nt(t);return nt(e)&&(e=r),mi(de(t,nt),T(e,2))}),Fh=k(function(t){var e=Nt(t);return e=typeof e=="function"?e:r,mi(de(t,nt),r,e)}),Gh=k(Ui);function Bh(t,e){return Ea(t||[],e||[],gn)}function kh(t,e){return Ea(t||[],e||[],wn)}var $h=k(function(t){var e=t.length,n=e>1?t[e-1]:r;return n=typeof n=="function"?(t.pop(),n):r,cu(t,n)});function hu(t){var e=o(t);return e.__chain__=!0,e}function Hh(t,e){return e(t),t}function hr(t,e){return e(t)}var qh=ae(function(t){var e=t.length,n=e?t[0]:0,i=this.__wrapped__,a=function(l){return ui(l,t)};return e>1||this.__actions__.length||!(i instanceof q)||!ue(n)?this.thru(a):(i=i.slice(n,+n+(e?1:0)),i.__actions__.push({func:hr,args:[a],thisArg:r}),new Ot(i,this.__chain__).thru(function(l){return e&&!l.length&&l.push(r),l}))});function zh(){return hu(this)}function Yh(){return new Ot(this.value(),this.__chain__)}function Kh(){this.__values__===r&&(this.__values__=Lu(this.value()));var t=this.__index__>=this.__values__.length,e=t?r:this.__values__[this.__index__++];return{done:t,value:e}}function Zh(){return this}function Jh(t){for(var e,n=this;n instanceof Qn;){var i=su(n);i.__index__=0,i.__values__=r,e?a.__wrapped__=i:e=i;var a=i;n=n.__wrapped__}return a.__wrapped__=t,e}function Xh(){var t=this.__wrapped__;if(t instanceof q){var e=t;return this.__actions__.length&&(e=new q(this)),e=e.reverse(),e.__actions__.push({func:hr,args:[Ni],thisArg:r}),new Ot(e,this.__chain__)}return this.thru(Ni)}function Qh(){return ba(this.__wrapped__,this.__actions__)}var Vh=ir(function(t,e,n){J.call(t,n)?++t[n]:ie(t,n,1)});function jh(t,e,n){var i=W(t)?ks:Hf;return n&&pt(t,e,n)&&(e=r),i(t,T(e,3))}function td(t,e){var n=W(t)?de:ca;return n(t,T(e,3))}var ed=Ga(au),nd=Ga(uu);function rd(t,e){return lt(dr(t,e),1)}function id(t,e){return lt(dr(t,e),Ce)}function sd(t,e,n){return n=n===r?1:G(n),lt(dr(t,e),n)}function du(t,e){var n=W(t)?It:ve;return n(t,T(e,3))}function gu(t,e){var n=W(t)?Cl:fa;return n(t,T(e,3))}var ad=ir(function(t,e,n){J.call(t,n)?t[n].push(e):ie(t,n,[e])});function ud(t,e,n,i){t=yt(t)?t:Je(t),n=n&&!i?G(n):0;var a=t.length;return n<0&&(n=st(a+n,0)),wr(t)?n<=a&&t.indexOf(e,n)>-1:!!a&&We(t,e,n)>-1}var od=k(function(t,e,n){var i=-1,a=typeof e=="function",l=yt(t)?y(t.length):[];return ve(t,function(h){l[++i]=a?xt(e,h,n):_n(h,e,n)}),l}),ld=ir(function(t,e,n){ie(t,n,e)});function dr(t,e){var n=W(t)?j:va;return n(t,T(e,3))}function fd(t,e,n,i){return t==null?[]:(W(e)||(e=e==null?[]:[e]),n=i?r:n,W(n)||(n=n==null?[]:[n]),Sa(t,e,n))}var cd=ir(function(t,e,n){t[n?0:1].push(e)},function(){return[[],[]]});function hd(t,e,n){var i=W(t)?Zr:zs,a=arguments.length<3;return i(t,T(e,4),n,a,ve)}function dd(t,e,n){var i=W(t)?Dl:zs,a=arguments.length<3;return i(t,T(e,4),n,a,fa)}function gd(t,e){var n=W(t)?de:ca;return n(t,_r(T(e,3)))}function pd(t){var e=W(t)?aa:uc;return e(t)}function _d(t,e,n){(n?pt(t,e,n):e===r)?e=1:e=G(e);var i=W(t)?Ff:oc;return i(t,e)}function vd(t){var e=W(t)?Gf:fc;return e(t)}function wd(t){if(t==null)return 0;if(yt(t))return wr(t)?Ge(t):t.length;var e=ht(t);return e==Ft||e==Gt?t.size:di(t).length}function yd(t,e,n){var i=W(t)?Jr:cc;return n&&pt(t,e,n)&&(e=r),i(t,T(e,3))}var md=k(function(t,e){if(t==null)return[];var n=e.length;return n>1&&pt(t,e[0],e[1])?e=[]:n>2&&pt(e[0],e[1],e[2])&&(e=[e[0]]),Sa(t,lt(e,1),[])}),gr=jl||function(){return ot.Date.now()};function Sd(t,e){if(typeof e!="function")throw new Tt(p);return t=G(t),function(){if(--t<1)return e.apply(this,arguments)}}function pu(t,e,n){return e=n?r:e,e=t&&e==null?t.length:e,se(t,te,r,r,r,r,e)}function _u(t,e){var n;if(typeof e!="function")throw new Tt(p);return t=G(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=r),n}}var Wi=k(function(t,e,n){var i=Wt;if(n.length){var a=pe(n,Ke(Wi));i|=jt}return se(t,i,e,n,a)}),vu=k(function(t,e,n){var i=Wt|Me;if(n.length){var a=pe(n,Ke(vu));i|=jt}return se(e,i,t,n,a)});function wu(t,e,n){e=n?r:e;var i=se(t,Vt,r,r,r,r,r,e);return i.placeholder=wu.placeholder,i}function yu(t,e,n){e=n?r:e;var i=se(t,Qe,r,r,r,r,r,e);return i.placeholder=yu.placeholder,i}function mu(t,e,n){var i,a,l,h,g,v,S=0,x=!1,C=!1,R=!0;if(typeof t!="function")throw new Tt(p);e=Ut(e)||0,tt(n)&&(x=!!n.leading,C="maxWait"in n,l=C?st(Ut(n.maxWait)||0,e):l,R="trailing"in n?!!n.trailing:R);function E(rt){var Ht=i,fe=a;return i=a=r,S=rt,h=t.apply(fe,Ht),h}function O(rt){return S=rt,g=Sn(H,e),x?E(rt):h}function B(rt){var Ht=rt-v,fe=rt-S,Gu=e-Ht;return C?ct(Gu,l-fe):Gu}function M(rt){var Ht=rt-v,fe=rt-S;return v===r||Ht>=e||Ht<0||C&&fe>=l}function H(){var rt=gr();if(M(rt))return z(rt);g=Sn(H,B(rt))}function z(rt){return g=r,R&&i?E(rt):(i=a=r,h)}function Lt(){g!==r&&Ia(g),S=0,i=v=a=g=r}function _t(){return g===r?h:z(gr())}function At(){var rt=gr(),Ht=M(rt);if(i=arguments,a=this,v=rt,Ht){if(g===r)return O(v);if(C)return Ia(g),g=Sn(H,e),E(v)}return g===r&&(g=Sn(H,e)),h}return At.cancel=Lt,At.flush=_t,At}var xd=k(function(t,e){return la(t,1,e)}),Cd=k(function(t,e,n){return la(t,Ut(e)||0,n)});function Dd(t){return se(t,br)}function pr(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new Tt(p);var n=function(){var i=arguments,a=e?e.apply(this,i):i[0],l=n.cache;if(l.has(a))return l.get(a);var h=t.apply(this,i);return n.cache=l.set(a,h)||l,h};return n.cache=new(pr.Cache||re),n}pr.Cache=re;function _r(t){if(typeof t!="function")throw new Tt(p);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function Rd(t){return _u(2,t)}var Ld=hc(function(t,e){e=e.length==1&&W(e[0])?j(e[0],Ct(T())):j(lt(e,1),Ct(T()));var n=e.length;return k(function(i){for(var a=-1,l=ct(i.length,n);++a<l;)i[a]=e[a].call(this,i[a]);return xt(t,this,i)})}),Fi=k(function(t,e){var n=pe(e,Ke(Fi));return se(t,jt,r,e,n)}),Su=k(function(t,e){var n=pe(e,Ke(Su));return se(t,Ve,r,e,n)}),Ad=ae(function(t,e){return se(t,je,r,r,r,e)});function bd(t,e){if(typeof t!="function")throw new Tt(p);return e=e===r?e:G(e),k(t,e)}function Ed(t,e){if(typeof t!="function")throw new Tt(p);return e=e==null?0:st(G(e),0),k(function(n){var i=n[e],a=me(n,0,e);return i&&ge(a,i),xt(t,this,a)})}function Id(t,e,n){var i=!0,a=!0;if(typeof t!="function")throw new Tt(p);return tt(n)&&(i="leading"in n?!!n.leading:i,a="trailing"in n?!!n.trailing:a),mu(t,e,{leading:i,maxWait:e,trailing:a})}function Td(t){return pu(t,1)}function Od(t,e){return Fi(xi(e),t)}function Md(){if(!arguments.length)return[];var t=arguments[0];return W(t)?t:[t]}function Pd(t){return Mt(t,Z)}function Nd(t,e){return e=typeof e=="function"?e:r,Mt(t,Z,e)}function Ud(t){return Mt(t,$|Z)}function Wd(t,e){return e=typeof e=="function"?e:r,Mt(t,$|Z,e)}function Fd(t,e){return e==null||oa(t,e,at(e))}function $t(t,e){return t===e||t!==t&&e!==e}var Gd=or(fi),Bd=or(function(t,e){return t>=e}),Oe=ga(function(){return arguments}())?ga:function(t){return et(t)&&J.call(t,"callee")&&!ta.call(t,"callee")},W=y.isArray,kd=Ns?Ct(Ns):Jf;function yt(t){return t!=null&&vr(t.length)&&!oe(t)}function nt(t){return et(t)&&yt(t)}function $d(t){return t===!0||t===!1||et(t)&&gt(t)==tn}var Se=ef||Ji,Hd=Us?Ct(Us):Xf;function qd(t){return et(t)&&t.nodeType===1&&!xn(t)}function zd(t){if(t==null)return!0;if(yt(t)&&(W(t)||typeof t=="string"||typeof t.splice=="function"||Se(t)||Ze(t)||Oe(t)))return!t.length;var e=ht(t);if(e==Ft||e==Gt)return!t.size;if(mn(t))return!di(t).length;for(var n in t)if(J.call(t,n))return!1;return!0}function Yd(t,e){return vn(t,e)}function Kd(t,e,n){n=typeof n=="function"?n:r;var i=n?n(t,e):r;return i===r?vn(t,e,r,n):!!i}function Gi(t){if(!et(t))return!1;var e=gt(t);return e==En||e==po||typeof t.message=="string"&&typeof t.name=="string"&&!xn(t)}function Zd(t){return typeof t=="number"&&na(t)}function oe(t){if(!tt(t))return!1;var e=gt(t);return e==In||e==ls||e==go||e==vo}function xu(t){return typeof t=="number"&&t==G(t)}function vr(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=he}function tt(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function et(t){return t!=null&&typeof t=="object"}var Cu=Ws?Ct(Ws):Vf;function Jd(t,e){return t===e||hi(t,e,Ei(e))}function Xd(t,e,n){return n=typeof n=="function"?n:r,hi(t,e,Ei(e),n)}function Qd(t){return Du(t)&&t!=+t}function Vd(t){if(Nc(t))throw new U(c);return pa(t)}function jd(t){return t===null}function tg(t){return t==null}function Du(t){return typeof t=="number"||et(t)&&gt(t)==nn}function xn(t){if(!et(t)||gt(t)!=ee)return!1;var e=qn(t);if(e===null)return!0;var n=J.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&Bn.call(n)==Jl}var Bi=Fs?Ct(Fs):jf;function eg(t){return xu(t)&&t>=-he&&t<=he}var Ru=Gs?Ct(Gs):tc;function wr(t){return typeof t=="string"||!W(t)&&et(t)&&gt(t)==sn}function Rt(t){return typeof t=="symbol"||et(t)&&gt(t)==Tn}var Ze=Bs?Ct(Bs):ec;function ng(t){return t===r}function rg(t){return et(t)&&ht(t)==an}function ig(t){return et(t)&&gt(t)==yo}var sg=or(gi),ag=or(function(t,e){return t<=e});function Lu(t){if(!t)return[];if(yt(t))return wr(t)?Bt(t):wt(t);if(ln&&t[ln])return Wl(t[ln]());var e=ht(t),n=e==Ft?ei:e==Gt?Wn:Je;return n(t)}function le(t){if(!t)return t===0?t:0;if(t=Ut(t),t===Ce||t===-Ce){var e=t<0?-1:1;return e*lo}return t===t?t:0}function G(t){var e=le(t),n=e%1;return e===e?n?e-n:e:0}function Au(t){return t?be(G(t),0,Zt):0}function Ut(t){if(typeof t=="number")return t;if(Rt(t))return An;if(tt(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=tt(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Ys(t);var n=Bo.test(t);return n||$o.test(t)?ml(t.slice(2),n?2:8):Go.test(t)?An:+t}function bu(t){return Xt(t,mt(t))}function ug(t){return t?be(G(t),-he,he):t===0?t:0}function K(t){return t==null?"":Dt(t)}var og=ze(function(t,e){if(mn(e)||yt(e)){Xt(e,at(e),t);return}for(var n in e)J.call(e,n)&&gn(t,n,e[n])}),Eu=ze(function(t,e){Xt(e,mt(e),t)}),yr=ze(function(t,e,n,i){Xt(e,mt(e),t,i)}),lg=ze(function(t,e,n,i){Xt(e,at(e),t,i)}),fg=ae(ui);function cg(t,e){var n=qe(t);return e==null?n:ua(n,e)}var hg=k(function(t,e){t=X(t);var n=-1,i=e.length,a=i>2?e[2]:r;for(a&&pt(e[0],e[1],a)&&(i=1);++n<i;)for(var l=e[n],h=mt(l),g=-1,v=h.length;++g<v;){var S=h[g],x=t[S];(x===r||$t(x,ke[S])&&!J.call(t,S))&&(t[S]=l[S])}return t}),dg=k(function(t){return t.push(r,Ya),xt(Iu,r,t)});function gg(t,e){return $s(t,T(e,3),Jt)}function pg(t,e){return $s(t,T(e,3),li)}function _g(t,e){return t==null?t:oi(t,T(e,3),mt)}function vg(t,e){return t==null?t:ha(t,T(e,3),mt)}function wg(t,e){return t&&Jt(t,T(e,3))}function yg(t,e){return t&&li(t,T(e,3))}function mg(t){return t==null?[]:tr(t,at(t))}function Sg(t){return t==null?[]:tr(t,mt(t))}function ki(t,e,n){var i=t==null?r:Ee(t,e);return i===r?n:i}function xg(t,e){return t!=null&&Ja(t,e,zf)}function $i(t,e){return t!=null&&Ja(t,e,Yf)}var Cg=ka(function(t,e,n){e!=null&&typeof e.toString!="function"&&(e=kn.call(e)),t[e]=n},qi(St)),Dg=ka(function(t,e,n){e!=null&&typeof e.toString!="function"&&(e=kn.call(e)),J.call(t,e)?t[e].push(n):t[e]=[n]},T),Rg=k(_n);function at(t){return yt(t)?sa(t):di(t)}function mt(t){return yt(t)?sa(t,!0):nc(t)}function Lg(t,e){var n={};return e=T(e,3),Jt(t,function(i,a,l){ie(n,e(i,a,l),i)}),n}function Ag(t,e){var n={};return e=T(e,3),Jt(t,function(i,a,l){ie(n,a,e(i,a,l))}),n}var bg=ze(function(t,e,n){er(t,e,n)}),Iu=ze(function(t,e,n,i){er(t,e,n,i)}),Eg=ae(function(t,e){var n={};if(t==null)return n;var i=!1;e=j(e,function(l){return l=ye(l,t),i||(i=l.length>1),l}),Xt(t,Ai(t),n),i&&(n=Mt(n,$|dt|Z,Cc));for(var a=e.length;a--;)yi(n,e[a]);return n});function Ig(t,e){return Tu(t,_r(T(e)))}var Tg=ae(function(t,e){return t==null?{}:ic(t,e)});function Tu(t,e){if(t==null)return{};var n=j(Ai(t),function(i){return[i]});return e=T(e),xa(t,n,function(i,a){return e(i,a[0])})}function Og(t,e,n){e=ye(e,t);var i=-1,a=e.length;for(a||(a=1,t=r);++i<a;){var l=t==null?r:t[Qt(e[i])];l===r&&(i=a,l=n),t=oe(l)?l.call(t):l}return t}function Mg(t,e,n){return t==null?t:wn(t,e,n)}function Pg(t,e,n,i){return i=typeof i=="function"?i:r,t==null?t:wn(t,e,n,i)}var Ou=qa(at),Mu=qa(mt);function Ng(t,e,n){var i=W(t),a=i||Se(t)||Ze(t);if(e=T(e,4),n==null){var l=t&&t.constructor;a?n=i?new l:[]:tt(t)?n=oe(l)?qe(qn(t)):{}:n={}}return(a?It:Jt)(t,function(h,g,v){return e(n,h,g,v)}),n}function Ug(t,e){return t==null?!0:yi(t,e)}function Wg(t,e,n){return t==null?t:Aa(t,e,xi(n))}function Fg(t,e,n,i){return i=typeof i=="function"?i:r,t==null?t:Aa(t,e,xi(n),i)}function Je(t){return t==null?[]:ti(t,at(t))}function Gg(t){return t==null?[]:ti(t,mt(t))}function Bg(t,e,n){return n===r&&(n=e,e=r),n!==r&&(n=Ut(n),n=n===n?n:0),e!==r&&(e=Ut(e),e=e===e?e:0),be(Ut(t),e,n)}function kg(t,e,n){return e=le(e),n===r?(n=e,e=0):n=le(n),t=Ut(t),Kf(t,e,n)}function $g(t,e,n){if(n&&typeof n!="boolean"&&pt(t,e,n)&&(e=n=r),n===r&&(typeof e=="boolean"?(n=e,e=r):typeof t=="boolean"&&(n=t,t=r)),t===r&&e===r?(t=0,e=1):(t=le(t),e===r?(e=t,t=0):e=le(e)),t>e){var i=t;t=e,e=i}if(n||t%1||e%1){var a=ra();return ct(t+a*(e-t+yl("1e-"+((a+"").length-1))),e)}return _i(t,e)}var Hg=Ye(function(t,e,n){return e=e.toLowerCase(),t+(n?Pu(e):e)});function Pu(t){return Hi(K(t).toLowerCase())}function Nu(t){return t=K(t),t&&t.replace(qo,Ol).replace(ll,"")}function qg(t,e,n){t=K(t),e=Dt(e);var i=t.length;n=n===r?i:be(G(n),0,i);var a=n;return n-=e.length,n>=0&&t.slice(n,a)==e}function zg(t){return t=K(t),t&&Do.test(t)?t.replace(hs,Ml):t}function Yg(t){return t=K(t),t&&Io.test(t)?t.replace(Fr,"\\$&"):t}var Kg=Ye(function(t,e,n){return t+(n?"-":"")+e.toLowerCase()}),Zg=Ye(function(t,e,n){return t+(n?" ":"")+e.toLowerCase()}),Jg=Fa("toLowerCase");function Xg(t,e,n){t=K(t),e=G(e);var i=e?Ge(t):0;if(!e||i>=e)return t;var a=(e-i)/2;return ur(Zn(a),n)+t+ur(Kn(a),n)}function Qg(t,e,n){t=K(t),e=G(e);var i=e?Ge(t):0;return e&&i<e?t+ur(e-i,n):t}function Vg(t,e,n){t=K(t),e=G(e);var i=e?Ge(t):0;return e&&i<e?ur(e-i,n)+t:t}function jg(t,e,n){return n||e==null?e=0:e&&(e=+e),af(K(t).replace(Gr,""),e||0)}function tp(t,e,n){return(n?pt(t,e,n):e===r)?e=1:e=G(e),vi(K(t),e)}function ep(){var t=arguments,e=K(t[0]);return t.length<3?e:e.replace(t[1],t[2])}var np=Ye(function(t,e,n){return t+(n?"_":"")+e.toLowerCase()});function rp(t,e,n){return n&&typeof n!="number"&&pt(t,e,n)&&(e=n=r),n=n===r?Zt:n>>>0,n?(t=K(t),t&&(typeof e=="string"||e!=null&&!Bi(e))&&(e=Dt(e),!e&&Fe(t))?me(Bt(t),0,n):t.split(e,n)):[]}var ip=Ye(function(t,e,n){return t+(n?" ":"")+Hi(e)});function sp(t,e,n){return t=K(t),n=n==null?0:be(G(n),0,t.length),e=Dt(e),t.slice(n,n+e.length)==e}function ap(t,e,n){var i=o.templateSettings;n&&pt(t,e,n)&&(e=r),t=K(t),e=yr({},e,i,za);var a=yr({},e.imports,i.imports,za),l=at(a),h=ti(a,l),g,v,S=0,x=e.interpolate||On,C="__p += '",R=ni((e.escape||On).source+"|"+x.source+"|"+(x===ds?Fo:On).source+"|"+(e.evaluate||On).source+"|$","g"),E="//# sourceURL="+(J.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++gl+"]")+`
`;t.replace(R,function(M,H,z,Lt,_t,At){return z||(z=Lt),C+=t.slice(S,At).replace(zo,Pl),H&&(g=!0,C+=`' +
__e(`+H+`) +
'`),_t&&(v=!0,C+=`';
`+_t+`;
__p += '`),z&&(C+=`' +
((__t = (`+z+`)) == null ? '' : __t) +
'`),S=At+M.length,M}),C+=`';
`;var O=J.call(e,"variable")&&e.variable;if(!O)C=`with (obj) {
`+C+`
}
`;else if(Uo.test(O))throw new U(w);C=(v?C.replace(mo,""):C).replace(So,"$1").replace(xo,"$1;"),C="function("+(O||"obj")+`) {
`+(O?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(g?", __e = _.escape":"")+(v?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+C+`return __p
}`;var B=Wu(function(){return Y(l,E+"return "+C).apply(r,h)});if(B.source=C,Gi(B))throw B;return B}function up(t){return K(t).toLowerCase()}function op(t){return K(t).toUpperCase()}function lp(t,e,n){if(t=K(t),t&&(n||e===r))return Ys(t);if(!t||!(e=Dt(e)))return t;var i=Bt(t),a=Bt(e),l=Ks(i,a),h=Zs(i,a)+1;return me(i,l,h).join("")}function fp(t,e,n){if(t=K(t),t&&(n||e===r))return t.slice(0,Xs(t)+1);if(!t||!(e=Dt(e)))return t;var i=Bt(t),a=Zs(i,Bt(e))+1;return me(i,0,a).join("")}function cp(t,e,n){if(t=K(t),t&&(n||e===r))return t.replace(Gr,"");if(!t||!(e=Dt(e)))return t;var i=Bt(t),a=Ks(i,Bt(e));return me(i,a).join("")}function hp(t,e){var n=ro,i=io;if(tt(e)){var a="separator"in e?e.separator:a;n="length"in e?G(e.length):n,i="omission"in e?Dt(e.omission):i}t=K(t);var l=t.length;if(Fe(t)){var h=Bt(t);l=h.length}if(n>=l)return t;var g=n-Ge(i);if(g<1)return i;var v=h?me(h,0,g).join(""):t.slice(0,g);if(a===r)return v+i;if(h&&(g+=v.length-g),Bi(a)){if(t.slice(g).search(a)){var S,x=v;for(a.global||(a=ni(a.source,K(gs.exec(a))+"g")),a.lastIndex=0;S=a.exec(x);)var C=S.index;v=v.slice(0,C===r?g:C)}}else if(t.indexOf(Dt(a),g)!=g){var R=v.lastIndexOf(a);R>-1&&(v=v.slice(0,R))}return v+i}function dp(t){return t=K(t),t&&Co.test(t)?t.replace(cs,kl):t}var gp=Ye(function(t,e,n){return t+(n?" ":"")+e.toUpperCase()}),Hi=Fa("toUpperCase");function Uu(t,e,n){return t=K(t),e=n?r:e,e===r?Ul(t)?ql(t):Al(t):t.match(e)||[]}var Wu=k(function(t,e){try{return xt(t,r,e)}catch(n){return Gi(n)?n:new U(n)}}),pp=ae(function(t,e){return It(e,function(n){n=Qt(n),ie(t,n,Wi(t[n],t))}),t});function _p(t){var e=t==null?0:t.length,n=T();return t=e?j(t,function(i){if(typeof i[1]!="function")throw new Tt(p);return[n(i[0]),i[1]]}):[],k(function(i){for(var a=-1;++a<e;){var l=t[a];if(xt(l[0],this,i))return xt(l[1],this,i)}})}function vp(t){return $f(Mt(t,$))}function qi(t){return function(){return t}}function wp(t,e){return t==null||t!==t?e:t}var yp=Ba(),mp=Ba(!0);function St(t){return t}function zi(t){return _a(typeof t=="function"?t:Mt(t,$))}function Sp(t){return wa(Mt(t,$))}function xp(t,e){return ya(t,Mt(e,$))}var Cp=k(function(t,e){return function(n){return _n(n,t,e)}}),Dp=k(function(t,e){return function(n){return _n(t,n,e)}});function Yi(t,e,n){var i=at(e),a=tr(e,i);n==null&&!(tt(e)&&(a.length||!i.length))&&(n=e,e=t,t=this,a=tr(e,at(e)));var l=!(tt(n)&&"chain"in n)||!!n.chain,h=oe(t);return It(a,function(g){var v=e[g];t[g]=v,h&&(t.prototype[g]=function(){var S=this.__chain__;if(l||S){var x=t(this.__wrapped__),C=x.__actions__=wt(this.__actions__);return C.push({func:v,args:arguments,thisArg:t}),x.__chain__=S,x}return v.apply(t,ge([this.value()],arguments))})}),t}function Rp(){return ot._===this&&(ot._=Xl),this}function Ki(){}function Lp(t){return t=G(t),k(function(e){return ma(e,t)})}var Ap=Di(j),bp=Di(ks),Ep=Di(Jr);function Fu(t){return Ti(t)?Xr(Qt(t)):sc(t)}function Ip(t){return function(e){return t==null?r:Ee(t,e)}}var Tp=$a(),Op=$a(!0);function Zi(){return[]}function Ji(){return!1}function Mp(){return{}}function Pp(){return""}function Np(){return!0}function Up(t,e){if(t=G(t),t<1||t>he)return[];var n=Zt,i=ct(t,Zt);e=T(e),t-=Zt;for(var a=jr(i,e);++n<t;)e(n);return a}function Wp(t){return W(t)?j(t,Qt):Rt(t)?[t]:wt(iu(K(t)))}function Fp(t){var e=++Zl;return K(t)+e}var Gp=ar(function(t,e){return t+e},0),Bp=Ri("ceil"),kp=ar(function(t,e){return t/e},1),$p=Ri("floor");function Hp(t){return t&&t.length?jn(t,St,fi):r}function qp(t,e){return t&&t.length?jn(t,T(e,2),fi):r}function zp(t){return qs(t,St)}function Yp(t,e){return qs(t,T(e,2))}function Kp(t){return t&&t.length?jn(t,St,gi):r}function Zp(t,e){return t&&t.length?jn(t,T(e,2),gi):r}var Jp=ar(function(t,e){return t*e},1),Xp=Ri("round"),Qp=ar(function(t,e){return t-e},0);function Vp(t){return t&&t.length?Vr(t,St):0}function jp(t,e){return t&&t.length?Vr(t,T(e,2)):0}return o.after=Sd,o.ary=pu,o.assign=og,o.assignIn=Eu,o.assignInWith=yr,o.assignWith=lg,o.at=fg,o.before=_u,o.bind=Wi,o.bindAll=pp,o.bindKey=vu,o.castArray=Md,o.chain=hu,o.chunk=$c,o.compact=Hc,o.concat=qc,o.cond=_p,o.conforms=vp,o.constant=qi,o.countBy=Vh,o.create=cg,o.curry=wu,o.curryRight=yu,o.debounce=mu,o.defaults=hg,o.defaultsDeep=dg,o.defer=xd,o.delay=Cd,o.difference=zc,o.differenceBy=Yc,o.differenceWith=Kc,o.drop=Zc,o.dropRight=Jc,o.dropRightWhile=Xc,o.dropWhile=Qc,o.fill=Vc,o.filter=td,o.flatMap=rd,o.flatMapDeep=id,o.flatMapDepth=sd,o.flatten=ou,o.flattenDeep=jc,o.flattenDepth=th,o.flip=Dd,o.flow=yp,o.flowRight=mp,o.fromPairs=eh,o.functions=mg,o.functionsIn=Sg,o.groupBy=ad,o.initial=rh,o.intersection=ih,o.intersectionBy=sh,o.intersectionWith=ah,o.invert=Cg,o.invertBy=Dg,o.invokeMap=od,o.iteratee=zi,o.keyBy=ld,o.keys=at,o.keysIn=mt,o.map=dr,o.mapKeys=Lg,o.mapValues=Ag,o.matches=Sp,o.matchesProperty=xp,o.memoize=pr,o.merge=bg,o.mergeWith=Iu,o.method=Cp,o.methodOf=Dp,o.mixin=Yi,o.negate=_r,o.nthArg=Lp,o.omit=Eg,o.omitBy=Ig,o.once=Rd,o.orderBy=fd,o.over=Ap,o.overArgs=Ld,o.overEvery=bp,o.overSome=Ep,o.partial=Fi,o.partialRight=Su,o.partition=cd,o.pick=Tg,o.pickBy=Tu,o.property=Fu,o.propertyOf=Ip,o.pull=fh,o.pullAll=fu,o.pullAllBy=ch,o.pullAllWith=hh,o.pullAt=dh,o.range=Tp,o.rangeRight=Op,o.rearg=Ad,o.reject=gd,o.remove=gh,o.rest=bd,o.reverse=Ni,o.sampleSize=_d,o.set=Mg,o.setWith=Pg,o.shuffle=vd,o.slice=ph,o.sortBy=md,o.sortedUniq=xh,o.sortedUniqBy=Ch,o.split=rp,o.spread=Ed,o.tail=Dh,o.take=Rh,o.takeRight=Lh,o.takeRightWhile=Ah,o.takeWhile=bh,o.tap=Hh,o.throttle=Id,o.thru=hr,o.toArray=Lu,o.toPairs=Ou,o.toPairsIn=Mu,o.toPath=Wp,o.toPlainObject=bu,o.transform=Ng,o.unary=Td,o.union=Eh,o.unionBy=Ih,o.unionWith=Th,o.uniq=Oh,o.uniqBy=Mh,o.uniqWith=Ph,o.unset=Ug,o.unzip=Ui,o.unzipWith=cu,o.update=Wg,o.updateWith=Fg,o.values=Je,o.valuesIn=Gg,o.without=Nh,o.words=Uu,o.wrap=Od,o.xor=Uh,o.xorBy=Wh,o.xorWith=Fh,o.zip=Gh,o.zipObject=Bh,o.zipObjectDeep=kh,o.zipWith=$h,o.entries=Ou,o.entriesIn=Mu,o.extend=Eu,o.extendWith=yr,Yi(o,o),o.add=Gp,o.attempt=Wu,o.camelCase=Hg,o.capitalize=Pu,o.ceil=Bp,o.clamp=Bg,o.clone=Pd,o.cloneDeep=Ud,o.cloneDeepWith=Wd,o.cloneWith=Nd,o.conformsTo=Fd,o.deburr=Nu,o.defaultTo=wp,o.divide=kp,o.endsWith=qg,o.eq=$t,o.escape=zg,o.escapeRegExp=Yg,o.every=jh,o.find=ed,o.findIndex=au,o.findKey=gg,o.findLast=nd,o.findLastIndex=uu,o.findLastKey=pg,o.floor=$p,o.forEach=du,o.forEachRight=gu,o.forIn=_g,o.forInRight=vg,o.forOwn=wg,o.forOwnRight=yg,o.get=ki,o.gt=Gd,o.gte=Bd,o.has=xg,o.hasIn=$i,o.head=lu,o.identity=St,o.includes=ud,o.indexOf=nh,o.inRange=kg,o.invoke=Rg,o.isArguments=Oe,o.isArray=W,o.isArrayBuffer=kd,o.isArrayLike=yt,o.isArrayLikeObject=nt,o.isBoolean=$d,o.isBuffer=Se,o.isDate=Hd,o.isElement=qd,o.isEmpty=zd,o.isEqual=Yd,o.isEqualWith=Kd,o.isError=Gi,o.isFinite=Zd,o.isFunction=oe,o.isInteger=xu,o.isLength=vr,o.isMap=Cu,o.isMatch=Jd,o.isMatchWith=Xd,o.isNaN=Qd,o.isNative=Vd,o.isNil=tg,o.isNull=jd,o.isNumber=Du,o.isObject=tt,o.isObjectLike=et,o.isPlainObject=xn,o.isRegExp=Bi,o.isSafeInteger=eg,o.isSet=Ru,o.isString=wr,o.isSymbol=Rt,o.isTypedArray=Ze,o.isUndefined=ng,o.isWeakMap=rg,o.isWeakSet=ig,o.join=uh,o.kebabCase=Kg,o.last=Nt,o.lastIndexOf=oh,o.lowerCase=Zg,o.lowerFirst=Jg,o.lt=sg,o.lte=ag,o.max=Hp,o.maxBy=qp,o.mean=zp,o.meanBy=Yp,o.min=Kp,o.minBy=Zp,o.stubArray=Zi,o.stubFalse=Ji,o.stubObject=Mp,o.stubString=Pp,o.stubTrue=Np,o.multiply=Jp,o.nth=lh,o.noConflict=Rp,o.noop=Ki,o.now=gr,o.pad=Xg,o.padEnd=Qg,o.padStart=Vg,o.parseInt=jg,o.random=$g,o.reduce=hd,o.reduceRight=dd,o.repeat=tp,o.replace=ep,o.result=Og,o.round=Xp,o.runInContext=_,o.sample=pd,o.size=wd,o.snakeCase=np,o.some=yd,o.sortedIndex=_h,o.sortedIndexBy=vh,o.sortedIndexOf=wh,o.sortedLastIndex=yh,o.sortedLastIndexBy=mh,o.sortedLastIndexOf=Sh,o.startCase=ip,o.startsWith=sp,o.subtract=Qp,o.sum=Vp,o.sumBy=jp,o.template=ap,o.times=Up,o.toFinite=le,o.toInteger=G,o.toLength=Au,o.toLower=up,o.toNumber=Ut,o.toSafeInteger=ug,o.toString=K,o.toUpper=op,o.trim=lp,o.trimEnd=fp,o.trimStart=cp,o.truncate=hp,o.unescape=dp,o.uniqueId=Fp,o.upperCase=gp,o.upperFirst=Hi,o.each=du,o.eachRight=gu,o.first=lu,Yi(o,function(){var t={};return Jt(o,function(e,n){J.call(o.prototype,n)||(t[n]=e)}),t}(),{chain:!1}),o.VERSION=u,It(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){o[t].placeholder=o}),It(["drop","take"],function(t,e){q.prototype[t]=function(n){n=n===r?1:st(G(n),0);var i=this.__filtered__&&!e?new q(this):this.clone();return i.__filtered__?i.__takeCount__=ct(n,i.__takeCount__):i.__views__.push({size:ct(n,Zt),type:t+(i.__dir__<0?"Right":"")}),i},q.prototype[t+"Right"]=function(n){return this.reverse()[t](n).reverse()}}),It(["filter","map","takeWhile"],function(t,e){var n=e+1,i=n==os||n==oo;q.prototype[t]=function(a){var l=this.clone();return l.__iteratees__.push({iteratee:T(a,3),type:n}),l.__filtered__=l.__filtered__||i,l}}),It(["head","last"],function(t,e){var n="take"+(e?"Right":"");q.prototype[t]=function(){return this[n](1).value()[0]}}),It(["initial","tail"],function(t,e){var n="drop"+(e?"":"Right");q.prototype[t]=function(){return this.__filtered__?new q(this):this[n](1)}}),q.prototype.compact=function(){return this.filter(St)},q.prototype.find=function(t){return this.filter(t).head()},q.prototype.findLast=function(t){return this.reverse().find(t)},q.prototype.invokeMap=k(function(t,e){return typeof t=="function"?new q(this):this.map(function(n){return _n(n,t,e)})}),q.prototype.reject=function(t){return this.filter(_r(T(t)))},q.prototype.slice=function(t,e){t=G(t);var n=this;return n.__filtered__&&(t>0||e<0)?new q(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),e!==r&&(e=G(e),n=e<0?n.dropRight(-e):n.take(e-t)),n)},q.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},q.prototype.toArray=function(){return this.take(Zt)},Jt(q.prototype,function(t,e){var n=/^(?:filter|find|map|reject)|While$/.test(e),i=/^(?:head|last)$/.test(e),a=o[i?"take"+(e=="last"?"Right":""):e],l=i||/^find/.test(e);a&&(o.prototype[e]=function(){var h=this.__wrapped__,g=i?[1]:arguments,v=h instanceof q,S=g[0],x=v||W(h),C=function(H){var z=a.apply(o,ge([H],g));return i&&R?z[0]:z};x&&n&&typeof S=="function"&&S.length!=1&&(v=x=!1);var R=this.__chain__,E=!!this.__actions__.length,O=l&&!R,B=v&&!E;if(!l&&x){h=B?h:new q(this);var M=t.apply(h,g);return M.__actions__.push({func:hr,args:[C],thisArg:r}),new Ot(M,R)}return O&&B?t.apply(this,g):(M=this.thru(C),O?i?M.value()[0]:M.value():M)})}),It(["pop","push","shift","sort","splice","unshift"],function(t){var e=Fn[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",i=/^(?:pop|shift)$/.test(t);o.prototype[t]=function(){var a=arguments;if(i&&!this.__chain__){var l=this.value();return e.apply(W(l)?l:[],a)}return this[n](function(h){return e.apply(W(h)?h:[],a)})}}),Jt(q.prototype,function(t,e){var n=o[e];if(n){var i=n.name+"";J.call(He,i)||(He[i]=[]),He[i].push({name:e,func:n})}}),He[sr(r,Me).name]=[{name:"wrapper",func:r}],q.prototype.clone=df,q.prototype.reverse=gf,q.prototype.value=pf,o.prototype.at=qh,o.prototype.chain=zh,o.prototype.commit=Yh,o.prototype.next=Kh,o.prototype.plant=Jh,o.prototype.reverse=Xh,o.prototype.toJSON=o.prototype.valueOf=o.prototype.value=Qh,o.prototype.first=o.prototype.head,ln&&(o.prototype[ln]=Zh),o},Be=zl();De?((De.exports=Be)._=Be,zr._=Be):ot._=Be}).call(q_)}(Rn,Rn.exports)),Rn.exports}var Y_=z_();const zt=H_(Y_);class K_{async upload(s=[]){return new Promise(r=>{const u=document.createElement("input");u.type="file",s.length&&(u.accept=s.map(f=>`.${f}`).join(",")),u.onchange=async()=>{var w;const f=(w=u.files)==null?void 0:w[0];if(!f)return r(null);const c=f.type.startsWith("text/")||f.name.match(/\.(txt|json|csv|md)$/),p=c?await f.text():new Uint8Array(await f.arrayBuffer());r({data:p,filename:f.name,mimeType:f.type||(c?"text/plain":"application/octet-stream")})},u.click()})}async download({data:s,filename:r,mimeType:u}){const f=s instanceof Uint8Array?new Blob([s],{type:u}):new Blob([s],{type:u});if("showSaveFilePicker"in window){const w=r.includes(".")?r.slice(r.lastIndexOf(".")):"",L=await(await window.showSaveFilePicker({suggestedName:r,types:[{description:"File",accept:{[u]:[w]}}]})).createWritable();await L.write(f),await L.close();return}const c=URL.createObjectURL(f),p=document.createElement("a");p.href=c,p.download=r,p.click(),URL.revokeObjectURL(c)}}class Z_{constructor(s){P(this,"reviewCardIdsOverride");P(this,"extraStudyLastCardId");this.app=s}init(){this.reviewCardIdsOverride=void 0}registerReviewCardIdsOverride(s){this.reviewCardIdsOverride=s}isExtraStudy(){return this.reviewCardIdsOverride!==void 0}getNextCard(){if(this.reviewCardIdsOverride){if(this.reviewCardIdsOverride.length===1)return this.reviewCardIdsOverride[0];{const s=this.reviewCardIdsOverride.filter(r=>r!==this.extraStudyLastCardId);return s[Math.floor(Math.random()*s.length)]}}}getCardsCount(){var s;return((s=this.reviewCardIdsOverride)==null?void 0:s.length)??0}rateAgain(s){this.extraStudyLastCardId=s}rateGood(s){if(this.extraStudyLastCardId=s,this.reviewCardIdsOverride){const r=this.reviewCardIdsOverride.indexOf(s);r>=0&&this.reviewCardIdsOverride.splice(r,1)}}getCardIds(s,r){const u=this.app.deckData[s];if(!u)return[];switch(r.type){case bt.StudiedCards:{const f=Object.keys(u.schedule).length,c=Math.min(f,r.count),p=Object.keys(u.schedule).map(w=>+w);return zt.shuffle(p).slice(0,c)}case bt.NewCards:{const f=this.app.getNewCardsCount(s),c=Math.min(f,r.count);return this.app.getNewCards(s).slice(0,c)}case bt.YoungCards:{const c=this.app.getAllNonIgnoredIds(s).filter(w=>this.app.getWenbunCustomState(s,w)===Ln.ReviewYoung),p=Math.min(c.length,r.count);return zt.shuffle(c).slice(0,p)}case bt.MatureCards:{const c=this.app.getAllNonIgnoredIds(s).filter(w=>this.app.getWenbunCustomState(s,w)===Ln.ReviewMature),p=Math.min(c.length,r.count);return zt.shuffle(c).slice(0,p)}case bt.Group:{const f=u.groups.find(c=>c.label===r.group);return f?f.cardIds:[]}case bt.HardCards:{const f=Object.keys(u.schedule).length,c=Math.min(f,r.count);return Object.entries(u.schedule).sort((D,L)=>L[1].difficulty-D[1].difficulty).map(D=>+D[0]).slice(0,c)}}}getDescription(s,r){const u=this.app.deckData[s];if(!u)return{desc:"",subdesc:""};switch(r.type){case bt.StudiedCards:{const f=Object.keys(u.schedule).length;return{desc:`Study ${Math.min(f,r.count)} cards`,subdesc:`(out of ${f} cards that have been studied in this deck)`}}case bt.NewCards:{const f=this.app.getNewCardsCount(s);return{desc:`Study the next ${Math.min(f,r.count)} new cards`,subdesc:`(out of ${f} new cards)`}}case bt.YoungCards:{const c=this.app.getAllNonIgnoredIds(s).filter(w=>this.app.getWenbunCustomState(s,w)===Ln.ReviewYoung);return{desc:`Study ${Math.min(c.length,r.count)} young cards`,subdesc:`(out of ${c.length} young cards)`}}case bt.MatureCards:{const c=this.app.getAllNonIgnoredIds(s).filter(w=>this.app.getWenbunCustomState(s,w)===Ln.ReviewMature);return{desc:`Study ${Math.min(c.length,r.count)} mature cards`,subdesc:`(out of ${c.length} mature cards)`}}case bt.Group:{const f=u.groups.find(p=>p.label===r.group);return f?{desc:`Study ${Math.min(f.cardIds.length,r.count)} cards from ${r.group}`,subdesc:`(out of ${f.cardIds.length} cards)`}:{desc:"ERROR: Group Not Found",subdesc:""}}case bt.HardCards:{const f=Object.keys(u.schedule).length;return{desc:`Study ${Math.min(f,r.count)} hardest cards`,subdesc:`(out of ${f} cards that have been studied in this app)`}}}}}const no="https://wenbun-api.photon-ray.xyz";var qt=(d=>(d.Profile="/profile",d.ProfileData="/profiledata",d.ReviewLog="/reviewlog",d.ReviewLogMostRecent="/reviewlog/mostrecent",d.AuthGoogle="/auth/google",d.AuthLogout="/auth/logout",d))(qt||{});function xe(d,s){let r=`${no}${d}`;if(s&&Object.keys(s).length>0){const u=new URLSearchParams;for(const[f,c]of Object.entries(s))u.append(f,String(c));r+=`?${u.toString()}`}return r}function Ju(d){return`${no}${d}`}const Xu="loginStatus";class J_{constructor(s){P(this,"isLoggedIn",!1);P(this,"isSyncConflict",!1);P(this,"syncConflictInfo");P(this,"profileInfo",null);P(this,"storedLoginStatus");this.storage=s}async init(){this.storedLoginStatus=await this.storage.load(Xu);const s=await fetch(xe(qt.Profile),{credentials:"include"});if(s.ok){const r=await s.json();this.isLoggedIn=!0,this.profileInfo=r}else s.status===401?this.isLoggedIn=!1:(this.isLoggedIn=!1,console.warn(`Unexpected status: ${s.status}`));await this.checkAndUpdateLoginStatus()}async updateLoginStatus(s){await this.storage.save(Xu,s),this.storedLoginStatus=s}async checkAndUpdateLoginStatus(){if(this.storedLoginStatus===void 0){const s=this.isLoggedIn?"loggedIn":"loggedOut";await this.updateLoginStatus(s)}}async trySyncProfile(s){if(!this.isLoggedIn)return!1;try{const[r,u]=await Promise.all([this.getProfileData(),this.getLatestReviewLog()]);if(r===null)return(await Promise.all([this.updateProfileData(s.exportProfile(!1)),this.pushReviewLog(u,s.reviewLogs,!0)])).every(c=>c)&&(s.lastSyncTime=new Date().toISOString(),await s.updateLastSyncTime()),!1;{const f=new Date(s.meta.modifiedAt??0),c=new Date(r.meta.modifiedAt??0),p=new Date(s.lastSyncTime??0),w=this.getSyncDecision(f,c,p);switch(zt.isEqual(r,s.exportProfile(!1))?"none":w){case"conflict":return this.syncConflictInfo={localModifiedAt:f,remoteModifiedAt:c,lastSyncTime:p},this.isSyncConflict=!0,l_.url.pathname.startsWith("/settings")||window.confirm("Sync Failed, Conflict Detected. Do you want to go to settings?")&&u_(`${o_}/settings/`),!1;case"push":return(await Promise.all([this.updateProfileData(s.exportProfile(!1)),this.pushReviewLog(u,s.reviewLogs)])).every(I=>I)?(s.lastSyncTime=new Date().toISOString(),await s.updateLastSyncTime()):window.alert("Failed to push profile data to server"),this.isSyncConflict=!1,!1;case"pull":return(await Promise.all([s.tryImportProfile(r,!1,!0),this.pullReviewLog(s)])).every(I=>I)?(s.lastSyncTime=new Date().toISOString(),await s.updateLastSyncTime()):window.alert("Failed to pull profile data from server"),this.isSyncConflict=!1,!0;case"none":return this.isSyncConflict=!1,!1}}}catch(r){return console.error(r),!1}}async tryForcePull(s){const r=await this.getProfileData(),u=await Promise.all([this.updateProfileData(s.exportProfile(!1),"pull"),this.pullReviewLog(s,!0)]),f=await s.tryImportProfile(r,!1,!0);u.every(c=>c)&&f?(s.lastSyncTime=new Date().toISOString(),await s.updateLastSyncTime(),this.isSyncConflict=!1):window.alert("Failed to pull profile data from server")}async tryForcePush(s){(await Promise.all([this.updateProfileData(s.exportProfile(!1),"push"),this.pushReviewLog(null,s.reviewLogs,!0)])).every(u=>u)?(s.lastSyncTime=new Date().toISOString(),await s.updateLastSyncTime(),this.isSyncConflict=!1):window.alert("Failed to push profile data to server")}getSyncDecision(s,r,u){const f=s>u,c=r>u;return f&&c?"conflict":f?"push":c?"pull":"none"}getName(){var s;return((s=this.profileInfo)==null?void 0:s.name)??"(no name)"}async getProfileData(){const s=await fetch(xe(qt.ProfileData),{credentials:"include"});if(s.status===204)return null;if(s.ok)return await s.json();throw new Error(`Unexpected status: ${s.status}`)}async updateProfileData(s,r="normal"){return(await fetch(xe(qt.ProfileData,{decision:r}),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok}async getLatestReviewLog(){const s=await fetch(xe(qt.ReviewLogMostRecent),{credentials:"include"});if(s.status===204)return null;if(s.ok)return await s.json();throw new Error(`Unexpected status: ${s.status}`)}async pushReviewLog(s,r,u=!1){if(s===null||u)return(await fetch(xe(qt.ReviewLog,{force:u}),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).ok;{const f=+new Date(s.log.review),c=r.findLastIndex(D=>{const L=D.log.review;return+new Date(L)<=f}),p=r.slice(c+1);return(await fetch(xe(qt.ReviewLog),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)})).ok}}async pullReviewLog(s,r=!1){try{const u=await this.getReviewLogs(s.reviewLogs,r);return u===null||(r?s.reviewLogs=u:s.reviewLogs.push(...u),s.save(!1)),!0}catch(u){return console.error(u),!1}}async getReviewLogs(s,r=!1){var u;if(r){const f=new Date(0).toISOString(),c=await fetch(xe(qt.ReviewLog,{from:f}),{method:"GET",credentials:"include"});if(c.status===204)return null;if(c.ok)return(await c.json()).map(w=>w.review_log);throw new Error(`Unexpected status: ${c.status}`)}else{const f=s[s.length-1],c=new Date(((u=f==null?void 0:f.log)==null?void 0:u.review)??0).toISOString(),p=await fetch(xe(qt.ReviewLog,{from:c}),{method:"GET",credentials:"include"});if(p.status===204)return null;if(p.ok)return await p.json();throw new Error(`Unexpected status: ${p.status}`)}}async loginGoogle(s){window.location.assign(Ju(qt.AuthGoogle))}async logout(s){await this.updateLoginStatus(void 0),await s.updateLastSyncTime(new Date(0)),window.location.assign(Ju(qt.AuthLogout))}isAutomaticallyLoggedOut(){return!this.isLoggedIn&&this.storedLoginStatus==="loggedIn"}}const X_="__ungrouped__",Qu="profile.json",Vi="decks",ji="deckData",ts="config",es="reviewLogs",ns="autoReviewGradeLog",Vu="meta",rs="lastSyncTime",Q_=[A.Again,A.Hard,A.Good,A.Easy],V_=30,ju=3;var Ln=(d=>(d.New="New",d.WarmUp="WarmUp",d.Learning="Learning",d.ReviewYoung="Young",d.ReviewMature="Mature",d.Relearning="Relearning",d.PreviouslyStudied="Previously Studied",d.Ignored="Ignored",d))(Ln||{}),j_=(d=>(d.Mix="Mix",d.AfterReviews="After Reviews",d.BeforeReviews="Before Reviews",d))(j_||{}),bt=(d=>(d.StudiedCards="Studied Cards",d.HardCards="Hard Cards",d.NewCards="New Cards",d.YoungCards="Young Cards",d.MatureCards="Mature Cards",d.Group="Group",d))(bt||{});const Dn={newCardPerDay:5,maxReviewsPerDay:200,newCardOrder:"Mix",newPreviouslyStudiedCardPerDay:20,newPreviouslyStudiedCardOrder:"Mix",startPreviouslyStudiedCardFromTheBack:!0,gradingMethod:"auto",strokeLeniency:1,learningSteps:["1m","10m"],previouslyStudiedLearningSteps:["1m","5d"],desiredRetention:.9,enableShortTerm:!1,enableFuzz:!1,FSRSParams:i_,zh:{isColorBasedOnTone:!0,toneColors:r_.Default,alwaysShowReading:!1,mandarinReading:n_.Pinyin,playAudio:!0}};class iv{constructor(){P(this,"decks",[]);P(this,"deckData",{});P(this,"config",Dn);P(this,"reviewLogs",[]);P(this,"autoReviewGradeLog",[]);P(this,"meta",{});P(this,"lastSyncTime",new Date(0).toISOString());P(this,"isLoadDone",!1);P(this,"fsrs");P(this,"fsrsPrevStudied");P(this,"storage");P(this,"fileManager");P(this,"extraStudyHandler");P(this,"profile");this.updateFSRS(),W_()?this.storage=new B_(Qu):this.storage=new $_(Qu),this.fileManager=new K_,this.extraStudyHandler=new Z_(this),this.profile=new J_(this.storage)}updateFSRS(){const s=this.getConfig(),r=Dr({request_retention:s.desiredRetention,w:s.FSRSParams,enable_fuzz:s.enableFuzz,enable_short_term:s.enableShortTerm,learning_steps:s.learningSteps});this.fsrs=new zu(r);const u=Dr({request_retention:s.desiredRetention,w:s.FSRSParams,enable_fuzz:s.enableFuzz,enable_short_term:s.enableShortTerm,learning_steps:s.previouslyStudiedLearningSteps});this.fsrsPrevStudied=new zu(u)}async init(){await this.load(),this.extraStudyHandler.init(),this.updateFSRS(),this.isNeedToProcessTodaySchedule()&&await this.processTodaySchedule()}async initProfile(){return await this.profile.init(),this.profile.isLoggedIn?await this.profile.trySyncProfile(this):!1}async debug(){this.decks=["test"],this.deckData={},this.reviewLogs=[],this.config=Dn,await this.ensureDeckData(),await this.save()}async load(){const[s,r,u,f,c,p,w]=await Promise.all([this.storage.load(Vi),this.storage.load(ji),this.storage.load(ts),this.storage.load(es),this.storage.load(ns),this.storage.load(Vu),this.storage.load(rs)]);this.decks=s||[],this.deckData=r||{},this.config=u||Dn,this.reviewLogs=f||[],this.autoReviewGradeLog=c||[],this.meta=p||{},this.lastSyncTime=w||new Date(0).toISOString(),this.isLoadDone=!0}async save(s=!1,r=!1){await this.isDataChanged()&&(this.meta.modifiedAt=new Date().toISOString(),this.meta._profileVersion=1,await Promise.all([this.storage.save(Vi,this.decks),this.storage.save(ji,this.deckData),this.storage.save(ts,this.config),this.storage.save(es,this.reviewLogs),this.storage.save(ns,this.autoReviewGradeLog),this.storage.save(Vu,this.meta),this.storage.save(rs,this.lastSyncTime)]),s||(r?await this.profile.trySyncProfile(this):this.profile.trySyncProfile(this).catch(console.error)))}async updateLastSyncTime(s=new Date){this.lastSyncTime=s.toISOString(),await this.storage.save(rs,this.lastSyncTime)}async isDataChanged(){const[s,r,u,f,c]=await Promise.all([this.storage.load(Vi),this.storage.load(ji),this.storage.load(ts),this.storage.load(es),this.storage.load(ns)]);return!zt.isEqual(this.decks,s)||!zt.isEqual(this.deckData,r)||!zt.isEqual(this.config,u)||!zt.isEqual(this.reviewLogs,f)||!zt.isEqual(this.autoReviewGradeLog,c)}exportProfileStr(s=!0){return JSON.stringify(this.exportProfile(s))}async tryImportProfileStr(s,r=!0){try{const u=JSON.parse(s);return this.tryImportProfile(u,r)}catch{return!1}}exportProfile(s=!0){return{config:this.config,decks:this.decks,deckData:this.deckData,reviewLogs:s?this.reviewLogs:[],meta:this.meta}}async tryImportProfile(s,r=!0,u=!1){try{const{config:f,decks:c,deckData:p,reviewLogs:w,meta:D}=s;return this.config=f,this.decks=c,this.deckData=p,r&&(this.reviewLogs=w),await this.save(u),!0}catch{return!1}}isNeedToProcessTodaySchedule(){const s=new Date;for(const r of Object.keys(this.deckData)){const u=this.deckData[r];if(new Date(u.lastScheduleCheckDate).getDate()<s.getDate())return!0}return!1}async processTodaySchedule(){const s=new Date,r=mr(s);for(const u of Object.keys(this.deckData)){const f=this.deckData[u];mr(new Date(f.lastScheduleCheckDate))<r&&(f.doneTodayNewCardCount=0,f.doneTodayPreviouslyStudiedCardCount=0,f.doneTodayReviewCount=0,f.lastScheduleCheckDate=s.getTime())}await this.save()}async getInitDeckData(s){const r=s_.find(f=>f.id===s),u=await a_((r==null?void 0:r.src)??`${s}.txt`);if(u)return{deck:u,tags:(r==null?void 0:r.tags)??[],groups:[{label:X_,cardIds:Array.from(u.keys())}],ignoredIds:[],previouslyStudied:[],schedule:{},lastScheduleCheckDate:new Date(0).getTime(),doneTodayNewCardCount:0,doneTodayPreviouslyStudiedCardCount:0,doneTodayReviewCount:0}}async addDeck(s){this.decks.includes(s)||(this.decks.push(s),await this.ensureDeckDataById(s),this.splitDeckIntoGroupOfN(s,V_),await this.save())}async deleteDeck(s,r=!1){r&&(this.decks.includes(s)&&(this.decks=this.decks.filter(u=>u!=s)),delete this.deckData[s])}async ensureDeckData(){const s=this.decks.map(async r=>{await this.ensureDeckDataById(r)});await Promise.all(s)}async ensureDeckDataById(s){if(!this.deckData[s]){const r=await this.getInitDeckData(s);if(!r)return Promise.reject(new Error("loading deck failed"));this.deckData[s]=r}}getConfig(){return zt.merge({},Dn,this.config)}async resetConfigToDefault(){this.config=zt.cloneDeep(Dn),await this.save()}async saveConfig(s){this.config=s,await this.save()}rateCard(s,r,u,f){var I,$;this.stopWarmUp(s,r);const c=this.deckData[s],p=this.getCard(s,r,!0);if(!p)return;const L=((($=(I=this.deckData[s])==null?void 0:I.previouslyStudied)==null?void 0:$.includes(r))?this.fsrsPrevStudied:this.fsrs).repeat(p,f??new Date);this.setCard(s,r,L[u].card),this.pushReviewLog(s,r,L[u].log),c.previouslyStudied.includes(r)?(c.previouslyStudied.splice(c.previouslyStudied.indexOf(r),1),c.doneTodayPreviouslyStudiedCardCount++):p.state===F.New?c.doneTodayNewCardCount++:p.state===F.Review&&c.doneTodayReviewCount++}warmUpNext(s,r){var f;const u=this.deckData[s];u&&((f=u.warmUpIds)==null?void 0:f[r])!==void 0&&u.warmUpIds[r]++}getNextCard(s){if(this.extraStudyHandler.isExtraStudy())return this.extraStudyHandler.getNextCard();const r=this.getConfig(),u=this.getScheduledNewOrWarmUpCardsCount(s),f=this.getScheduledPreviouslyStudiedCardsCount(s),c=this.getScheduledReviewCardsCount(s),p=u>0?this.getNewOrWarmUpCard(s):void 0,w=f>0?this.getPreviouslyStudiedCard(s):void 0,D=c>0?this.getTodaysScheduledCards(s)[0]:void 0,L=[],I=[D],$=[];if(r.newCardOrder==="Before Reviews"&&L.push(p),r.newCardOrder==="After Reviews"&&$.push(p),r.newPreviouslyStudiedCardOrder==="Before Reviews"&&L.push(w),r.newPreviouslyStudiedCardOrder==="After Reviews"&&$.push(w),r.newCardOrder==="Mix"){const Z=u/(u+c);Math.random()<Z?I.unshift(p):I.push(p)}if(r.newPreviouslyStudiedCardOrder==="Mix"){const Z=f/(u+f+c);Math.random()<Z?I.unshift(w):I.push(w)}return[...L,...I,...$].reduce((Z,ut)=>Z??ut,void 0)}skipWarmUp(s,r){const u=this.deckData[s];u&&(this.startWarmUp(s,r),u.warmUpIds[r]=ju)}startWarmUp(s,r){const u=this.deckData[s];u&&(u.warmUpIds===void 0&&(u.warmUpIds={}),u.warmUpIds[r]=0)}stopWarmUp(s,r){var f;const u=(f=this.deckData[s])==null?void 0:f.warmUpIds;u&&delete u[r]}getWarmUpCount(s,r){var u,f;return(f=(u=this.deckData[s])==null?void 0:u.warmUpIds)==null?void 0:f[r]}getMaxWarmUpCount(){return ju}isWarmUpCard(s,r){return this.getWarmUpCount(s,r)!==void 0}getNewOrWarmUpCard(s){const u=this.getScheduledNewOrWarmUpCardsCount(s)-this.getWarmUpCardsCount(s),f=this.getNewCard(s),c=this.deckData[s];if(!c.warmUpIds)return f;const p=Object.keys(c.warmUpIds),w=+p[Math.floor(Math.random()*p.length)];if(u<=0)return w;const D=this.getNewCardsCount(s),L=p.length;if(D+L!==0)return Math.random()<D/(D+L)?f:w}getNewCard(s){return this.getNewCards(s)[0]}getNewCards(s){return this.deckData[s].groups.flatMap(p=>p.cardIds).filter(p=>this.getWenbunCustomState(s,p)==="New")}getPreviouslyStudiedCard(s){var u;const r=this.deckData[s];if(r)return this.getConfig().startPreviouslyStudiedCardFromTheBack?(u=r.previouslyStudied)==null?void 0:u[r.previouslyStudied.length-1]:r.previouslyStudied[0]}getNewCardsCount(s){return this.getNewCards(s).length}getPreviouslyStudiedCardCount(s){var r;return((r=this.deckData[s])==null?void 0:r.previouslyStudied.length)??0}getWarmUpCardsCount(s){var r;return(r=this.deckData[s])!=null&&r.warmUpIds?Object.keys(this.deckData[s].warmUpIds).length:0}pushReviewLog(s,r,u){this.reviewLogs.push({deckId:s,cardId:r,log:u})}setCard(s,r,u){const f=this.deckData[s];f&&(f.schedule[r]=u)}getCard(s,r,u=!1){const f=this.deckData[s];if(f)return u&&f.schedule[r]===void 0?Rr():f.schedule[r]}getCardWord(s,r){const u=this.deckData[s];if(!u)return"";const f=u.deck[r];return f||""}getCardDue(s,r){var u;return(u=this.getCard(s,r))==null?void 0:u.due}getCardDueFormatted(s,r){if(this.isWarmUpCard(s,r))return"Warm Up";const u=this.getCardDue(s,r);return u?Bu(new Date,new Date(u)):"Not Started"}getRatingScheduledTimeStr(s,r){var D,L;const u=this.getCard(s,r,!0);let f={1:"",2:"",3:"",4:""};if(!u)return f;const w=(((L=(D=this.deckData[s])==null?void 0:D.previouslyStudied)==null?void 0:L.includes(r))?this.fsrsPrevStudied:this.fsrs).repeat(u,new Date);for(const I of Q_){const $=w[I].log.due,dt=w[I].card.due;f[I]=Bu($,dt)}return f}getWenbunCustomState(s,r){var f,c,p,w,D,L;if(((c=(f=this.deckData[s])==null?void 0:f.warmUpIds)==null?void 0:c[r])!==void 0)return"WarmUp";if((w=(p=this.deckData[s])==null?void 0:p.previouslyStudied)!=null&&w.includes(r))return"Previously Studied";if((L=(D=this.deckData[s])==null?void 0:D.ignoredIds)!=null&&L.includes(r))return"Ignored";const u=this.getCard(s,r);switch(u==null?void 0:u.state){case F.Learning:return"Learning";case F.Review:return u.scheduled_days>=21?"Mature":"Young";case F.Relearning:return"Relearning";case F.New:default:return"New"}}getTodaysReviewCards(s){const r=this.deckData[s];return this.getTodaysScheduledCards(s).filter(c=>{var p;return((p=r.schedule[c])==null?void 0:p.state)===F.Review})}getScheduledReviewCardsCount(s){const r=this.deckData[s],u=this.getTodaysReviewCards(s),f=this.getConfig(),c=Math.min(u.length,f.maxReviewsPerDay-r.doneTodayReviewCount);return Math.max(0,c)}getScheduledNewOrWarmUpCardsCount(s){const r=this.getConfig(),u=this.deckData[s],f=this.getNewCardsCount(s),c=this.getWarmUpCardsCount(s),p=Math.min(f+c,r.newCardPerDay-u.doneTodayNewCardCount);return Math.max(0,p)}getScheduledPreviouslyStudiedCardsCount(s){const r=this.getConfig(),u=this.deckData[s],f=Math.min(this.getPreviouslyStudiedCardCount(s),r.newPreviouslyStudiedCardPerDay-u.doneTodayPreviouslyStudiedCardCount);return Math.max(0,f)}getLearningRelearningCardsCount(s){const r=this.deckData[s];return Object.entries(r.schedule).filter(([u,f])=>f.state===F.Learning||f.state===F.Relearning).length}addPreviouslyStudiedMark(s,r){const u=this.deckData[s];!u||u.previouslyStudied.includes(r)||this.getWenbunCustomState(s,r)!=="New"||u.previouslyStudied.push(r)}removePreviouslyStudiedMark(s,r){const u=this.deckData[s];if(!u)return;const f=u.previouslyStudied.indexOf(r);f<0||u.previouslyStudied.splice(f,1)}ensureIgnoreIdArray(s){const r=this.deckData[s];r&&(r.ignoredIds||(r.ignoredIds=[]))}addIgnoredMark(s,r){var f,c;const u=this.deckData[s];u&&(this.ensureIgnoreIdArray(s),!((f=u.ignoredIds)!=null&&f.includes(r))&&((c=u.ignoredIds)==null||c.push(r)))}removeIgnoredMark(s,r){var c,p;const u=this.deckData[s];if(!u)return;const f=(c=u.ignoredIds)==null?void 0:c.indexOf(r);f==null||f<0||(p=u.ignoredIds)==null||p.splice(f,1)}getTodaysScheduledCards(s){const r=this.deckData[s];if(!r)return[];const f=mr(new Date)+1,c=Object.entries(r.schedule).filter(([p,w])=>{var I;if(!!((I=r.ignoredIds)!=null&&I.includes(+p)))return!1;const L=mr(new Date(w.due));return w.state===F.Review?L<f:!0});return c.sort((p,w)=>new Date(p[1].due).getTime()-new Date(w[1].due).getTime()),c.map(p=>+p[0])}getChineseToneColor(s){if(!s)return;const r=this.getConfig();return r.zh.isColorBasedOnTone?r.zh.toneColors[s-1]:void 0}splitDeckIntoGroupOfN(s,r){const u=this.deckData[s];if(!u)return;const f=Array.from(u.deck.keys()),c=[],p=Math.ceil(f.length/r);for(let w=0;w<p;w++){const D=`group-${w+1}`;c.push({label:D,cardIds:f.slice(w*r,(w+1)*r)})}u.groups=c}getGroupLabels(s){const r=this.deckData[s];return r?r.groups.map(u=>u.label):[]}getAllNonIgnoredIds(s){const r=this.deckData[s];return r?Array.from(r.deck.keys()).filter(f=>{var c;return!((c=r.ignoredIds)!=null&&c.includes(f))}):[]}async downloadProfile(){const s=this.exportProfileStr(),r=new Date().toLocaleDateString("en-CA");await this.fileManager.download({data:s,filename:`wenbun-profile-${r}.txt`,mimeType:"text/plain"})}async tryUploadProfile(){const s=await this.fileManager.upload();return s===null||typeof s.data!="string"?!1:this.tryImportProfileStr(s.data)}getDeckProgress(s){var L;const r=this.deckData[s];if(!r)return{totalCount:1,previouslyStudiedCount:0,youngCount:0,matureCount:0,ignoredCount:0};const u=this.getAllNonIgnoredIds(s),f=r.deck.length,c=r.previouslyStudied.length,p=u.filter(I=>this.getWenbunCustomState(s,I)==="Young").length,w=u.filter(I=>this.getWenbunCustomState(s,I)==="Mature").length,D=((L=r.ignoredIds)==null?void 0:L.length)??0;return{totalCount:f,previouslyStudiedCount:c,youngCount:p,matureCount:w,ignoredCount:D}}getDeckProgressNormalized(s){const r=this.getDeckProgress(s);return{young:r.youngCount/r.totalCount*100,mature:r.matureCount/r.totalCount*100,previouslyStudied:r.previouslyStudiedCount/r.totalCount*100,ignored:r.ignoredCount/r.totalCount*100,rest:(r.totalCount-r.youngCount-r.matureCount-r.previouslyStudiedCount-r.ignoredCount)/r.totalCount*100}}isAutoGrading(){return this.getConfig().gradingMethod==="auto"}storeAutoGradeLog(s,r,u){this.autoReviewGradeLog.push({correctCount:s,mistakeCount:r,grade:u})}}export{iv as A,V_ as D,bt as E,j_ as N,Ln as W,zt as _,A as l};
