var u_=Object.defineProperty;var o_=(h,i,r)=>i in h?u_(h,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):h[i]=r;var P=(h,i,r)=>o_(h,typeof i!="symbol"?i+"":i,r);import{e as l_,f as f_,k as c_,m as Cr,D as h_,l as d_,n as xr,s as g_}from"./vMM3V1dH.js";import{a as so,b as ao}from"./eGB6Oygj.js";import{p as p_}from"./CwpHAo5A.js";var G=(h=>(h[h.New=0]="New",h[h.Learning=1]="Learning",h[h.Review=2]="Review",h[h.Relearning=3]="Relearning",h))(G||{}),R=(h=>(h[h.Manual=0]="Manual",h[h.Again=1]="Again",h[h.Hard=2]="Hard",h[h.Good=3]="Good",h[h.Easy=4]="Easy",h))(R||{});class U{static card(i){return{...i,state:U.state(i.state),due:U.time(i.due),last_review:i.last_review?U.time(i.last_review):void 0}}static rating(i){if(typeof i=="string"){const r=i.charAt(0).toUpperCase(),u=i.slice(1).toLowerCase(),f=R[`${r}${u}`];if(f===void 0)throw new Error(`Invalid rating:[${i}]`);return f}else if(typeof i=="number")return i;throw new Error(`Invalid rating:[${i}]`)}static state(i){if(typeof i=="string"){const r=i.charAt(0).toUpperCase(),u=i.slice(1).toLowerCase(),f=G[`${r}${u}`];if(f===void 0)throw new Error(`Invalid state:[${i}]`);return f}else if(typeof i=="number")return i;throw new Error(`Invalid state:[${i}]`)}static time(i){if(typeof i=="object"&&i instanceof Date)return i;if(typeof i=="string"){const r=Date.parse(i);if(isNaN(r))throw new Error(`Invalid date:[${i}]`);return new Date(r)}else if(typeof i=="number")return new Date(i);throw new Error(`Invalid date:[${i}]`)}static review_log(i){return{...i,due:U.time(i.due),rating:U.rating(i.rating),state:U.state(i.state),review:U.time(i.review)}}}Date.prototype.scheduler=function(h,i){return Kt(this,h,i)},Date.prototype.diff=function(h,i){return Xe(this,h,i)},Date.prototype.format=function(){return __(this)},Date.prototype.dueFormat=function(h,i,r){return w_(this,h,i,r)};function Kt(h,i,r){return new Date(r?U.time(h).getTime()+i*24*60*60*1e3:U.time(h).getTime()+i*60*1e3)}function Xe(h,i,r){if(!h||!i)throw new Error("Invalid date");const u=U.time(h).getTime()-U.time(i).getTime();let f=0;switch(r){case"days":f=Math.floor(u/(24*60*60*1e3));break;case"minutes":f=Math.floor(u/(60*1e3));break}return f}function __(h){const i=U.time(h),r=i.getFullYear(),u=i.getMonth()+1,f=i.getDate(),c=i.getHours(),g=i.getMinutes(),v=i.getSeconds();return`${r}-${xn(u)}-${xn(f)} ${xn(c)}:${xn(g)}:${xn(v)}`}function xn(h){return h<10?`0${h}`:`${h}`}const Vi=[60,60,24,31,12],ji=["second","min","hour","day","month","year"];function w_(h,i,r,u=ji){h=U.time(h),i=U.time(i),u.length!==ji.length&&(u=ji);let f=h.getTime()-i.getTime(),c;for(f/=1e3,c=0;c<Vi.length&&!(f<Vi[c]);c++)f/=Vi[c];return`${Math.floor(f)}${r?u[c]:""}`}const v_=Object.freeze([R.Again,R.Hard,R.Good,R.Easy]),y_=[{start:2.5,end:7,factor:.15},{start:7,end:20,factor:.1},{start:20,end:1/0,factor:.05}];function m_(h,i,r){let u=1;for(const g of y_)u+=g.factor*Math.max(Math.min(h,g.end)-g.start,0);h=Math.min(h,r);let f=Math.max(2,Math.round(h-u));const c=Math.min(Math.round(h+u),r);return h>i&&(f=Math.max(f,i+1)),f=Math.min(f,c),{min_ivl:f,max_ivl:c}}function wt(h,i,r){return Math.min(Math.max(h,i),r)}function S_(h,i){const r=Date.UTC(h.getUTCFullYear(),h.getUTCMonth(),h.getUTCDate()),u=Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate());return Math.floor((u-r)/864e5)}const C_=.9,x_=36500,D_=!1,R_=!0,L_=Object.freeze(["1m","10m"]),A_=Object.freeze(["10m"]),Yt=.001,Dr=100,Hu=.5,b_=.1542,zu=Object.freeze([.212,1.2931,2.3065,8.2956,6.4133,.8334,3.0194,.001,1.8722,.1666,.796,1.4835,.0614,.2629,1.6483,.6014,1.8729,.5425,.0912,.0658,b_]),E_=2,I_=h=>[[Yt,Dr],[Yt,Dr],[Yt,Dr],[Yt,Dr],[1,10],[.001,4],[.001,4],[.001,.75],[0,4.5],[0,.8],[.001,3.5],[.001,5],[.001,.25],[.001,.9],[0,4],[0,1],[1,6],[0,h],[0,h],[0,.8],[.1,.8]],os=(h,i)=>{let r=E_;if(Math.max(0,i)>1){const u=-(Math.log(h[11])+Math.log(Math.pow(2,h[13])-1)+h[14]*.3)/i;r=wt(+u.toFixed(8),.01,2)}return I_(r).map(([u,f],c)=>wt(h[c],u,f))},ls=h=>{if(h===void 0)return[...zu];switch(h.length){case 21:return[...h];case 19:return console.debug("[FSRS-6]auto fill w from 19 to 21 length"),[...h,0,Hu];case 17:{const i=[...h];return i[4]=+(i[5]*2+i[4]).toFixed(8),i[5]=+(Math.log(i[5]*3+1)/3).toFixed(8),i[6]=+(i[6]+.5).toFixed(8),console.debug("[FSRS-6]auto fill w from 17 to 21 length"),i.concat([0,0,0,Hu])}default:return console.warn("[FSRS]Invalid parameters length, using default parameters"),[...zu]}},Ar=h=>{const i=Array.isArray(h==null?void 0:h.learning_steps)?h.learning_steps:L_,r=Array.isArray(h==null?void 0:h.relearning_steps)?h.relearning_steps:A_,u=os(ls(h==null?void 0:h.w),r.length);return{request_retention:(h==null?void 0:h.request_retention)||C_,maximum_interval:(h==null?void 0:h.maximum_interval)||x_,w:u,enable_fuzz:(h==null?void 0:h.enable_fuzz)??D_,enable_short_term:(h==null?void 0:h.enable_short_term)??R_,learning_steps:i,relearning_steps:r}};function bn(h,i){const r={due:h?U.time(h):new Date,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:0,lapses:0,learning_steps:0,state:G.New,last_review:void 0};return i&&typeof i=="function"?i(r):r}class T_{constructor(i){P(this,"c");P(this,"s0");P(this,"s1");P(this,"s2");const r=O_();this.c=1,this.s0=r(" "),this.s1=r(" "),this.s2=r(" "),i==null&&(i=+new Date),this.s0-=r(i),this.s0<0&&(this.s0+=1),this.s1-=r(i),this.s1<0&&(this.s1+=1),this.s2-=r(i),this.s2<0&&(this.s2+=1)}next(){const i=2091639*this.s0+this.c*23283064365386963e-26;return this.s0=this.s1,this.s1=this.s2,this.s2=i-(this.c=i|0),this.s2}set state(i){this.c=i.c,this.s0=i.s0,this.s1=i.s1,this.s2=i.s2}get state(){return{c:this.c,s0:this.s0,s1:this.s1,s2:this.s2}}}function O_(){let h=4022871197;return function(i){i=String(i);for(let r=0;r<i.length;r++){h+=i.charCodeAt(r);let u=.02519603282416938*h;h=u>>>0,u-=h,u*=h,h=u>>>0,u-=h,h+=u*4294967296}return(h>>>0)*23283064365386963e-26}}function M_(h){const i=new T_(h),r=()=>i.next();return r.int32=()=>i.next()*4294967296|0,r.double=()=>r()+(r()*2097152|0)*11102230246251565e-32,r.state=()=>i.state,r.importState=u=>(i.state=u,r),r}const uo=h=>{const i=typeof h=="number"?-h:-h[20],r=Math.exp(Math.pow(i,-1)*Math.log(.9))-1;return{decay:i,factor:+r.toFixed(8)}};function us(h,i,r){const{decay:u,factor:f}=uo(h);return+Math.pow(1+f*i/r,u).toFixed(8)}class P_{constructor(i){P(this,"param");P(this,"intervalModifier");P(this,"_seed");P(this,"forgetting_curve");this.param=new Proxy(Ar(i),this.params_handler_proxy()),this.intervalModifier=this.calculate_interval_modifier(this.param.request_retention),this.forgetting_curve=us.bind(this,this.param.w)}get interval_modifier(){return this.intervalModifier}set seed(i){this._seed=i}calculate_interval_modifier(i){if(i<=0||i>1)throw new Error("Requested retention rate should be in the range (0,1]");const{decay:r,factor:u}=uo(this.param.w);return+((Math.pow(i,1/r)-1)/u).toFixed(8)}get parameters(){return this.param}set parameters(i){this.update_parameters(i)}params_handler_proxy(){const i=this;return{set:function(r,u,f){return u==="request_retention"&&Number.isFinite(f)?i.intervalModifier=i.calculate_interval_modifier(Number(f)):u==="w"&&(f=os(ls(f),r.relearning_steps.length),i.forgetting_curve=us.bind(this,f),i.intervalModifier=i.calculate_interval_modifier(Number(r.request_retention))),Reflect.set(r,u,f),!0}}}update_parameters(i){const r=Ar(i);for(const u in r)if(u in this.param){const f=u;this.param[f]=r[f]}}init_stability(i){return Math.max(this.param.w[i-1],.1)}init_difficulty(i){return+(this.param.w[4]-Math.exp((i-1)*this.param.w[5])+1).toFixed(8)}apply_fuzz(i,r){if(!this.param.enable_fuzz||i<2.5)return Math.round(i);const u=M_(this._seed)(),{min_ivl:f,max_ivl:c}=m_(i,r,this.param.maximum_interval);return Math.floor(u*(c-f+1)+f)}next_interval(i,r){const u=Math.min(Math.max(1,Math.round(i*this.intervalModifier)),this.param.maximum_interval);return this.apply_fuzz(u,r)}linear_damping(i,r){return+(i*(10-r)/9).toFixed(8)}next_difficulty(i,r){const u=-this.param.w[6]*(r-3),f=i+this.linear_damping(u,i);return wt(this.mean_reversion(this.init_difficulty(R.Easy),f),1,10)}mean_reversion(i,r){return+(this.param.w[7]*i+(1-this.param.w[7])*r).toFixed(8)}next_recall_stability(i,r,u,f){const c=R.Hard===f?this.param.w[15]:1,g=R.Easy===f?this.param.w[16]:1;return+wt(r*(1+Math.exp(this.param.w[8])*(11-i)*Math.pow(r,-this.param.w[9])*(Math.exp((1-u)*this.param.w[10])-1)*c*g),Yt,36500).toFixed(8)}next_forget_stability(i,r,u){return+wt(this.param.w[11]*Math.pow(i,-this.param.w[12])*(Math.pow(r+1,this.param.w[13])-1)*Math.exp((1-u)*this.param.w[14]),Yt,36500).toFixed(8)}next_short_term_stability(i,r){const u=Math.pow(i,-this.param.w[19])*Math.exp(this.param.w[17]*(r-3+this.param.w[18])),f=r>=3?Math.max(u,1):u;return+wt(i*f,Yt,36500).toFixed(8)}next_state(i,r,u){const{difficulty:f,stability:c}=i??{difficulty:0,stability:0};if(r<0)throw new Error(`Invalid delta_t "${r}"`);if(u<0||u>4)throw new Error(`Invalid grade "${u}"`);if(f===0&&c===0)return{difficulty:wt(this.init_difficulty(u),1,10),stability:this.init_stability(u)};if(u===0)return{difficulty:f,stability:c};if(f<1||c<Yt)throw new Error(`Invalid memory state { difficulty: ${f}, stability: ${c} }`);const g=this.forgetting_curve(r,c),v=this.next_recall_stability(f,c,g,u),D=this.next_forget_stability(f,c,g),A=this.next_short_term_stability(c,u);let I=v;if(u===1){let[N,ut]=[0,0];this.param.enable_short_term&&(N=this.param.w[17],ut=this.param.w[18]);const V=c/Math.exp(N*ut);I=wt(+V.toFixed(8),Yt,D)}return r===0&&this.param.enable_short_term&&(I=A),{difficulty:this.next_difficulty(f,u),stability:I}}}function U_(){const h=this.review_time.getTime(),i=this.current.reps,r=this.current.difficulty*this.current.stability;return`${h}_${i}_${r}`}const N_=h=>{const i=h.slice(-1),r=parseInt(h.slice(0,-1),10);if(isNaN(r)||!Number.isFinite(r)||r<0)throw new Error(`Invalid step value: ${h}`);switch(i){case"m":return r;case"h":return r*60;case"d":return r*1440;default:throw new Error(`Invalid step unit: ${h}, expected m/h/d`)}},W_=(h,i,r)=>{const u=i===G.Relearning||i===G.Review?h.relearning_steps:h.learning_steps,f=u.length;if(f===0||r>=f)return{};const c=u[0],g=N_,v=()=>g(c),D=()=>{if(f===1)return Math.round(g(c)*1.5);const V=u[1];return Math.round((g(c)+g(V))/2)},A=V=>V<0||V>=f?null:u[V],I=V=>g(V),N={},ut=A(Math.max(0,r));if(i===G.Review)return N[R.Again]={scheduled_minutes:g(ut),next_step:0},N;{N[R.Again]={scheduled_minutes:v(),next_step:0},N[R.Hard]={scheduled_minutes:D(),next_step:r};const V=A(r+1);if(V){const nt=I(V);nt&&(N[R.Good]={scheduled_minutes:Math.round(nt),next_step:r+1})}}return N};var Er=(h=>(h.SCHEDULER="Scheduler",h.LEARNING_STEPS="LearningSteps",h.SEED="Seed",h))(Er||{});class oo{constructor(i,r,u,f){P(this,"last");P(this,"current");P(this,"review_time");P(this,"next",new Map);P(this,"algorithm");P(this,"strategies");P(this,"elapsed_days",0);this.algorithm=u,this.last=U.card(i),this.current=U.card(i),this.review_time=U.time(r),this.strategies=f,this.init()}checkGrade(i){if(!Number.isFinite(i)||i<0||i>4)throw new Error(`Invalid grade "${i}",expected 1-4`)}init(){const{state:i,last_review:r}=this.current;let u=0;i!==G.New&&r&&(u=S_(r,this.review_time)),this.current.last_review=this.review_time,this.elapsed_days=u,this.current.elapsed_days=u,this.current.reps+=1;let f=U_;if(this.strategies){const c=this.strategies.get(Er.SEED);c&&(f=c)}this.algorithm.seed=f.call(this)}preview(){return{[R.Again]:this.review(R.Again),[R.Hard]:this.review(R.Hard),[R.Good]:this.review(R.Good),[R.Easy]:this.review(R.Easy),[Symbol.iterator]:this.previewIterator.bind(this)}}*previewIterator(){for(const i of v_)yield this.review(i)}review(i){const{state:r}=this.last;let u;switch(this.checkGrade(i),r){case G.New:u=this.newState(i);break;case G.Learning:case G.Relearning:u=this.learningState(i);break;case G.Review:u=this.reviewState(i);break}return u}buildLog(i){const{last_review:r,due:u,elapsed_days:f}=this.last;return{rating:i,state:this.current.state,due:r||u,stability:this.current.stability,difficulty:this.current.difficulty,elapsed_days:this.elapsed_days,last_elapsed_days:f,scheduled_days:this.current.scheduled_days,learning_steps:this.current.learning_steps,review:this.review_time}}}class qu extends oo{constructor(r,u,f,c){super(r,u,f,c);P(this,"learningStepsStrategy");let g=W_;if(this.strategies){const v=this.strategies.get(Er.LEARNING_STEPS);v&&(g=v)}this.learningStepsStrategy=g}getLearningInfo(r,u){var D,A;const f=this.algorithm.parameters;r.learning_steps=r.learning_steps||0;const c=this.learningStepsStrategy(f,r.state,this.current.state===G.Learning?r.learning_steps+1:r.learning_steps),g=Math.max(0,((D=c[u])==null?void 0:D.scheduled_minutes)??0),v=Math.max(0,((A=c[u])==null?void 0:A.next_step)??0);return{scheduled_minutes:g,next_steps:v}}applyLearningSteps(r,u,f){const{scheduled_minutes:c,next_steps:g}=this.getLearningInfo(this.current,u);if(c>0&&c<1440)r.learning_steps=g,r.scheduled_days=0,r.state=f,r.due=Kt(this.review_time,Math.round(c),!1);else if(r.state=G.Review,c>=1440)r.learning_steps=g,r.due=Kt(this.review_time,Math.round(c),!1),r.scheduled_days=Math.floor(c/1440);else{r.learning_steps=0;const v=this.algorithm.next_interval(r.stability,this.elapsed_days);r.scheduled_days=v,r.due=Kt(this.review_time,v,!0)}}newState(r){const u=this.next.get(r);if(u)return u;const f=U.card(this.current);f.difficulty=wt(this.algorithm.init_difficulty(r),1,10),f.stability=this.algorithm.init_stability(r),this.applyLearningSteps(f,r,G.Learning);const c={card:f,log:this.buildLog(r)};return this.next.set(r,c),c}learningState(r){const u=this.next.get(r);if(u)return u;const{state:f,difficulty:c,stability:g}=this.last,v=U.card(this.current);v.difficulty=this.algorithm.next_difficulty(c,r),v.stability=this.algorithm.next_short_term_stability(g,r),this.applyLearningSteps(v,r,f);const D={card:v,log:this.buildLog(r)};return this.next.set(r,D),D}reviewState(r){const u=this.next.get(r);if(u)return u;const f=this.elapsed_days,{difficulty:c,stability:g}=this.last,v=this.algorithm.forgetting_curve(f,g),D=U.card(this.current),A=U.card(this.current),I=U.card(this.current),N=U.card(this.current);this.next_ds(D,A,I,N,c,g,v),this.next_interval(A,I,N,f),this.next_state(A,I,N),this.applyLearningSteps(D,R.Again,G.Relearning),D.lapses+=1;const ut={card:D,log:this.buildLog(R.Again)},V={card:A,log:super.buildLog(R.Hard)},nt={card:I,log:super.buildLog(R.Good)},Zt={card:N,log:super.buildLog(R.Easy)};return this.next.set(R.Again,ut),this.next.set(R.Hard,V),this.next.set(R.Good,nt),this.next.set(R.Easy,Zt),this.next.get(r)}next_ds(r,u,f,c,g,v,D){r.difficulty=this.algorithm.next_difficulty(g,R.Again);const A=v/Math.exp(this.algorithm.parameters.w[17]*this.algorithm.parameters.w[18]),I=this.algorithm.next_forget_stability(g,v,D);r.stability=wt(+A.toFixed(8),Yt,I),u.difficulty=this.algorithm.next_difficulty(g,R.Hard),u.stability=this.algorithm.next_recall_stability(g,v,D,R.Hard),f.difficulty=this.algorithm.next_difficulty(g,R.Good),f.stability=this.algorithm.next_recall_stability(g,v,D,R.Good),c.difficulty=this.algorithm.next_difficulty(g,R.Easy),c.stability=this.algorithm.next_recall_stability(g,v,D,R.Easy)}next_interval(r,u,f,c){let g,v;g=this.algorithm.next_interval(r.stability,c),v=this.algorithm.next_interval(u.stability,c),g=Math.min(g,v),v=Math.max(v,g+1);const D=Math.max(this.algorithm.next_interval(f.stability,c),v+1);r.scheduled_days=g,r.due=Kt(this.review_time,g,!0),u.scheduled_days=v,u.due=Kt(this.review_time,v,!0),f.scheduled_days=D,f.due=Kt(this.review_time,D,!0)}next_state(r,u,f){r.state=G.Review,r.learning_steps=0,u.state=G.Review,u.learning_steps=0,f.state=G.Review,f.learning_steps=0}}class Ku extends oo{newState(i){const r=this.next.get(i);if(r)return r;this.current.scheduled_days=0,this.current.elapsed_days=0;const u=U.card(this.current),f=U.card(this.current),c=U.card(this.current),g=U.card(this.current);return this.init_ds(u,f,c,g),this.next_interval(u,f,c,g,0),this.next_state(u,f,c,g),this.update_next(u,f,c,g),this.next.get(i)}init_ds(i,r,u,f){i.difficulty=wt(this.algorithm.init_difficulty(R.Again),1,10),i.stability=this.algorithm.init_stability(R.Again),r.difficulty=wt(this.algorithm.init_difficulty(R.Hard),1,10),r.stability=this.algorithm.init_stability(R.Hard),u.difficulty=wt(this.algorithm.init_difficulty(R.Good),1,10),u.stability=this.algorithm.init_stability(R.Good),f.difficulty=wt(this.algorithm.init_difficulty(R.Easy),1,10),f.stability=this.algorithm.init_stability(R.Easy)}learningState(i){return this.reviewState(i)}reviewState(i){const r=this.next.get(i);if(r)return r;const u=this.elapsed_days,{difficulty:f,stability:c}=this.last,g=this.algorithm.forgetting_curve(u,c),v=U.card(this.current),D=U.card(this.current),A=U.card(this.current),I=U.card(this.current);return this.next_ds(v,D,A,I,f,c,g),this.next_interval(v,D,A,I,u),this.next_state(v,D,A,I),v.lapses+=1,this.update_next(v,D,A,I),this.next.get(i)}next_ds(i,r,u,f,c,g,v){i.difficulty=this.algorithm.next_difficulty(c,R.Again);const D=this.algorithm.next_forget_stability(c,g,v);i.stability=wt(g,Yt,D),r.difficulty=this.algorithm.next_difficulty(c,R.Hard),r.stability=this.algorithm.next_recall_stability(c,g,v,R.Hard),u.difficulty=this.algorithm.next_difficulty(c,R.Good),u.stability=this.algorithm.next_recall_stability(c,g,v,R.Good),f.difficulty=this.algorithm.next_difficulty(c,R.Easy),f.stability=this.algorithm.next_recall_stability(c,g,v,R.Easy)}next_interval(i,r,u,f,c){let g,v,D,A;g=this.algorithm.next_interval(i.stability,c),v=this.algorithm.next_interval(r.stability,c),D=this.algorithm.next_interval(u.stability,c),A=this.algorithm.next_interval(f.stability,c),g=Math.min(g,v),v=Math.max(v,g+1),D=Math.max(D,v+1),A=Math.max(A,D+1),i.scheduled_days=g,i.due=Kt(this.review_time,g,!0),r.scheduled_days=v,r.due=Kt(this.review_time,v,!0),u.scheduled_days=D,u.due=Kt(this.review_time,D,!0),f.scheduled_days=A,f.due=Kt(this.review_time,A,!0)}next_state(i,r,u,f){i.state=G.Review,i.learning_steps=0,r.state=G.Review,r.learning_steps=0,u.state=G.Review,u.learning_steps=0,f.state=G.Review,f.learning_steps=0}update_next(i,r,u,f){const c={card:i,log:this.buildLog(R.Again)},g={card:r,log:super.buildLog(R.Hard)},v={card:u,log:super.buildLog(R.Good)},D={card:f,log:super.buildLog(R.Easy)};this.next.set(R.Again,c),this.next.set(R.Hard,g),this.next.set(R.Good,v),this.next.set(R.Easy,D)}}class F_{constructor(i){P(this,"fsrs");this.fsrs=i}replay(i,r,u){return this.fsrs.next(i,r,u)}handleManualRating(i,r,u,f,c,g,v){if(typeof r>"u")throw new Error("reschedule: state is required for manual rating");let D,A;if(r===G.New)D={rating:R.Manual,state:r,due:v??u,stability:i.stability,difficulty:i.difficulty,elapsed_days:f,last_elapsed_days:i.elapsed_days,scheduled_days:i.scheduled_days,learning_steps:i.learning_steps,review:u},A=bn(u),A.last_review=u;else{if(typeof v>"u")throw new Error("reschedule: due is required for manual rating");const I=Xe(v,u,"days");D={rating:R.Manual,state:i.state,due:i.last_review||i.due,stability:i.stability,difficulty:i.difficulty,elapsed_days:f,last_elapsed_days:i.elapsed_days,scheduled_days:i.scheduled_days,learning_steps:i.learning_steps,review:u},A={...i,state:r,due:v,last_review:u,stability:c||i.stability,difficulty:g||i.difficulty,elapsed_days:f,scheduled_days:I,reps:i.reps+1}}return{card:A,log:D}}reschedule(i,r){const u=[];let f=bn(i.due);for(const c of r){let g;if(c.review=U.time(c.review),c.rating===R.Manual){let v=0;f.state!==G.New&&f.last_review&&(v=Xe(c.review,f.last_review,"days")),g=this.handleManualRating(f,c.state,c.review,v,c.stability,c.difficulty,c.due?U.time(c.due):void 0)}else g=this.replay(f,c.review,c.rating);u.push(g),f=g.card}return u}calculateManualRecord(i,r,u,f){if(!u)return null;const{card:c,log:g}=u,v=U.card(i);return v.due.getTime()===c.due.getTime()?null:(v.scheduled_days=Xe(c.due,v.due,"days"),this.handleManualRating(v,c.state,U.time(r),g.elapsed_days,f?c.stability:void 0,f?c.difficulty:void 0,c.due))}}class Yu extends P_{constructor(r){super(r);P(this,"strategyHandler",new Map);P(this,"Scheduler");const{enable_short_term:u}=this.parameters;this.Scheduler=u?qu:Ku}params_handler_proxy(){const r=this;return{set:function(u,f,c){return f==="request_retention"&&Number.isFinite(c)?r.intervalModifier=r.calculate_interval_modifier(Number(c)):f==="enable_short_term"?r.Scheduler=c===!0?qu:Ku:f==="w"&&(c=os(ls(c),u.relearning_steps.length),r.forgetting_curve=us.bind(this,c),r.intervalModifier=r.calculate_interval_modifier(Number(u.request_retention))),Reflect.set(u,f,c),!0}}}useStrategy(r,u){return this.strategyHandler.set(r,u),this}clearStrategy(r){return r?this.strategyHandler.delete(r):this.strategyHandler.clear(),this}getScheduler(r,u){const f=this.strategyHandler.get(Er.SCHEDULER)||this.Scheduler;return new f(r,u,this,this.strategyHandler)}repeat(r,u,f){const c=this.getScheduler(r,u).preview();return f&&typeof f=="function"?f(c):c}next(r,u,f,c){const g=this.getScheduler(r,u),v=U.rating(f);if(v===R.Manual)throw new Error("Cannot review a manual rating");const D=g.review(v);return c&&typeof c=="function"?c(D):D}get_retrievability(r,u,f=!0){const c=U.card(r);u=u?U.time(u):new Date;const g=c.state!==G.New?Math.max(Xe(u,c.last_review,"days"),0):0,v=c.state!==G.New?this.forgetting_curve(g,+c.stability.toFixed(8)):0;return f?`${(v*100).toFixed(2)}%`:v}rollback(r,u,f){const c=U.card(r),g=U.review_log(u);if(g.rating===R.Manual)throw new Error("Cannot rollback a manual rating");let v,D,A;switch(g.state){case G.New:v=g.due,D=void 0,A=0;break;case G.Learning:case G.Relearning:case G.Review:v=g.review,D=g.due,A=c.lapses-(g.rating===R.Again&&g.state===G.Review?1:0);break}const I={...c,due:v,stability:g.stability,difficulty:g.difficulty,elapsed_days:g.last_elapsed_days,scheduled_days:g.scheduled_days,reps:Math.max(0,c.reps-1),lapses:Math.max(0,A),learning_steps:g.learning_steps,state:g.state,last_review:D};return f&&typeof f=="function"?f(I):I}forget(r,u,f=!1,c){const g=U.card(r);u=U.time(u);const v=g.state===G.New?0:Xe(u,g.due,"days"),D={rating:R.Manual,state:g.state,due:g.due,stability:g.stability,difficulty:g.difficulty,elapsed_days:0,last_elapsed_days:g.elapsed_days,scheduled_days:v,learning_steps:g.learning_steps,review:u},A={card:{...g,due:u,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:f?0:g.reps,lapses:f?0:g.lapses,learning_steps:0,state:G.New,last_review:g.last_review},log:D};return c&&typeof c=="function"?c(A):A}reschedule(r,u=[],f={}){const{recordLogHandler:c,reviewsOrderBy:g,skipManual:v=!0,now:D=new Date,update_memory_state:A=!1}=f;g&&typeof g=="function"&&u.sort(g),v&&(u=u.filter(Zt=>Zt.rating!==R.Manual));const I=new F_(this),N=I.reschedule(f.first_card||bn(),u),ut=N.length,V=U.card(r),nt=I.calculateManualRecord(V,D,ut?N[ut-1]:void 0,A);return c&&typeof c=="function"?{collections:N.map(c),reschedule_item:nt?c(nt):null}:{collections:N,reschedule_item:nt}}}function G_(h,i,r,u){if(typeof i=="function"?h!==i||!u:!i.has(h))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?u:r==="a"?u.call(h):u?u.value:i.get(h)}function B_(h,i,r,u,f){if(typeof i=="function"?h!==i||!0:!i.has(h))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i.set(h,r),r}var Lr;function k_(h,i=!1){return window.__TAURI_INTERNALS__.transformCallback(h,i)}async function ct(h,i={},r){return window.__TAURI_INTERNALS__.invoke(h,i,r)}class $_{get rid(){return G_(this,Lr,"f")}constructor(i){Lr.set(this,void 0),B_(this,Lr,i)}async close(){return ct("plugin:resources|close",{rid:this.rid})}}Lr=new WeakMap;function ts(){return!!(globalThis||window).isTauri}var Zu;(function(h){h.WINDOW_RESIZED="tauri://resize",h.WINDOW_MOVED="tauri://move",h.WINDOW_CLOSE_REQUESTED="tauri://close-requested",h.WINDOW_DESTROYED="tauri://destroyed",h.WINDOW_FOCUS="tauri://focus",h.WINDOW_BLUR="tauri://blur",h.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",h.WINDOW_THEME_CHANGED="tauri://theme-changed",h.WINDOW_CREATED="tauri://window-created",h.WEBVIEW_CREATED="tauri://webview-created",h.DRAG_ENTER="tauri://drag-enter",h.DRAG_OVER="tauri://drag-over",h.DRAG_DROP="tauri://drag-drop",h.DRAG_LEAVE="tauri://drag-leave"})(Zu||(Zu={}));async function H_(h,i){window.__TAURI_EVENT_PLUGIN_INTERNALS__.unregisterListener(h,i),await ct("plugin:event|unlisten",{event:h,eventId:i})}async function Ju(h,i,r){var u;const f=(u=void 0)!==null&&u!==void 0?u:{kind:"Any"};return ct("plugin:event|listen",{event:h,target:f,handler:k_(i)}).then(c=>async()=>H_(h,c))}async function z_(h,i){return await br.load(h,i)}class br extends $_{constructor(i){super(i)}static async load(i,r){const u=await ct("plugin:store|load",{path:i,...r});return new br(u)}static async get(i){return await ct("plugin:store|get_store",{path:i}).then(r=>r?new br(r):null)}async set(i,r){await ct("plugin:store|set",{rid:this.rid,key:i,value:r})}async get(i){const[r,u]=await ct("plugin:store|get",{rid:this.rid,key:i});return u?r:void 0}async has(i){return await ct("plugin:store|has",{rid:this.rid,key:i})}async delete(i){return await ct("plugin:store|delete",{rid:this.rid,key:i})}async clear(){await ct("plugin:store|clear",{rid:this.rid})}async reset(){await ct("plugin:store|reset",{rid:this.rid})}async keys(){return await ct("plugin:store|keys",{rid:this.rid})}async values(){return await ct("plugin:store|values",{rid:this.rid})}async entries(){return await ct("plugin:store|entries",{rid:this.rid})}async length(){return await ct("plugin:store|length",{rid:this.rid})}async reload(){await ct("plugin:store|reload",{rid:this.rid})}async save(){await ct("plugin:store|save",{rid:this.rid})}async onKeyChange(i,r){return await Ju("store://change",u=>{u.payload.resourceId===this.rid&&u.payload.key===i&&r(u.payload.exists?u.payload.value:void 0)})}async onChange(i){return await Ju("store://change",r=>{r.payload.resourceId===this.rid&&i(r.payload.key,r.payload.exists?r.payload.value:void 0)})}}class q_{constructor(i){P(this,"storeFilename");P(this,"store",null);P(this,"isLoaded",!1);this.storeFilename=i}async ensureStoreLoaded(){this.isLoaded||(this.store=await z_(this.storeFilename,{autoSave:!1}),this.isLoaded=!0)}async load(i){if(await this.ensureStoreLoaded(),!!this.store)return await this.store.get(i)}async save(i,r){await this.ensureStoreLoaded(),this.store&&await this.store.set(i,r)}}const K_="wenbun-deck-manager";class Y_{constructor(i){P(this,"storeName");P(this,"db");this.storeName=i}async ensureDBLoaded(){return this.db?new Promise(i=>i()):new Promise((i,r)=>{const u=window.indexedDB.open(K_,1);u.onupgradeneeded=()=>{const f=u.result;f.objectStoreNames.contains(this.storeName)||f.createObjectStore(this.storeName)},u.onsuccess=()=>{this.db=u.result,i()},u.onerror=f=>{window.alert("Error opening database"),r(f)}})}async load(i){return await this.ensureDBLoaded(),new Promise((r,u)=>{if(!this.db)return r(void 0);const g=this.db.transaction(this.storeName,"readonly").objectStore(this.storeName).get(i);g.onsuccess=()=>r(g.result),g.onerror=()=>u(g.error)})}async save(i,r){return await this.ensureDBLoaded(),new Promise((u,f)=>{if(!this.db)return u();const v=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(r,i);v.onsuccess=()=>u(),v.onerror=()=>f(v.error)})}}var Rr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Z_(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var Rn={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */var J_=Rn.exports,Xu;function X_(){return Xu||(Xu=1,function(h,i){(function(){var r,u="4.17.21",f=200,c="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",g="Expected a function",v="Invalid `variable` option passed into `_.template`",D="__lodash_hash_undefined__",A=500,I="__lodash_placeholder__",N=1,ut=2,V=4,nt=1,Zt=2,Ft=1,Me=2,fs=4,jt=8,Qe=16,te=32,Ve=64,ee=128,je=256,Ir=512,fo=30,co="...",ho=800,go=16,cs=1,po=2,_o=3,xe=1/0,he=9007199254740991,wo=17976931348623157e292,En=NaN,Jt=4294967295,vo=Jt-1,yo=Jt>>>1,mo=[["ary",ee],["bind",Ft],["bindKey",Me],["curry",jt],["curryRight",Qe],["flip",Ir],["partial",te],["partialRight",Ve],["rearg",je]],Pe="[object Arguments]",In="[object Array]",So="[object AsyncFunction]",tn="[object Boolean]",en="[object Date]",Co="[object DOMException]",Tn="[object Error]",On="[object Function]",hs="[object GeneratorFunction]",Gt="[object Map]",nn="[object Number]",xo="[object Null]",ne="[object Object]",ds="[object Promise]",Do="[object Proxy]",rn="[object RegExp]",Bt="[object Set]",sn="[object String]",Mn="[object Symbol]",Ro="[object Undefined]",an="[object WeakMap]",Lo="[object WeakSet]",un="[object ArrayBuffer]",Ue="[object DataView]",Tr="[object Float32Array]",Or="[object Float64Array]",Mr="[object Int8Array]",Pr="[object Int16Array]",Ur="[object Int32Array]",Nr="[object Uint8Array]",Wr="[object Uint8ClampedArray]",Fr="[object Uint16Array]",Gr="[object Uint32Array]",Ao=/\b__p \+= '';/g,bo=/\b(__p \+=) '' \+/g,Eo=/(__e\(.*?\)|\b__t\)) \+\n'';/g,gs=/&(?:amp|lt|gt|quot|#39);/g,ps=/[&<>"']/g,Io=RegExp(gs.source),To=RegExp(ps.source),Oo=/<%-([\s\S]+?)%>/g,Mo=/<%([\s\S]+?)%>/g,_s=/<%=([\s\S]+?)%>/g,Po=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Uo=/^\w*$/,No=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Br=/[\\^$.*+?()[\]{}|]/g,Wo=RegExp(Br.source),kr=/^\s+/,Fo=/\s/,Go=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Bo=/\{\n\/\* \[wrapped with (.+)\] \*/,ko=/,? & /,$o=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ho=/[()=,{}\[\]\/\s]/,zo=/\\(\\)?/g,qo=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ws=/\w*$/,Ko=/^[-+]0x[0-9a-f]+$/i,Yo=/^0b[01]+$/i,Zo=/^\[object .+?Constructor\]$/,Jo=/^0o[0-7]+$/i,Xo=/^(?:0|[1-9]\d*)$/,Qo=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Pn=/($^)/,Vo=/['\n\r\u2028\u2029\\]/g,Un="\\ud800-\\udfff",jo="\\u0300-\\u036f",tl="\\ufe20-\\ufe2f",el="\\u20d0-\\u20ff",vs=jo+tl+el,ys="\\u2700-\\u27bf",ms="a-z\\xdf-\\xf6\\xf8-\\xff",nl="\\xac\\xb1\\xd7\\xf7",rl="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",il="\\u2000-\\u206f",sl=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ss="A-Z\\xc0-\\xd6\\xd8-\\xde",Cs="\\ufe0e\\ufe0f",xs=nl+rl+il+sl,$r="['’]",al="["+Un+"]",Ds="["+xs+"]",Nn="["+vs+"]",Rs="\\d+",ul="["+ys+"]",Ls="["+ms+"]",As="[^"+Un+xs+Rs+ys+ms+Ss+"]",Hr="\\ud83c[\\udffb-\\udfff]",ol="(?:"+Nn+"|"+Hr+")",bs="[^"+Un+"]",zr="(?:\\ud83c[\\udde6-\\uddff]){2}",qr="[\\ud800-\\udbff][\\udc00-\\udfff]",Ne="["+Ss+"]",Es="\\u200d",Is="(?:"+Ls+"|"+As+")",ll="(?:"+Ne+"|"+As+")",Ts="(?:"+$r+"(?:d|ll|m|re|s|t|ve))?",Os="(?:"+$r+"(?:D|LL|M|RE|S|T|VE))?",Ms=ol+"?",Ps="["+Cs+"]?",fl="(?:"+Es+"(?:"+[bs,zr,qr].join("|")+")"+Ps+Ms+")*",cl="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",hl="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Us=Ps+Ms+fl,dl="(?:"+[ul,zr,qr].join("|")+")"+Us,gl="(?:"+[bs+Nn+"?",Nn,zr,qr,al].join("|")+")",pl=RegExp($r,"g"),_l=RegExp(Nn,"g"),Kr=RegExp(Hr+"(?="+Hr+")|"+gl+Us,"g"),wl=RegExp([Ne+"?"+Ls+"+"+Ts+"(?="+[Ds,Ne,"$"].join("|")+")",ll+"+"+Os+"(?="+[Ds,Ne+Is,"$"].join("|")+")",Ne+"?"+Is+"+"+Ts,Ne+"+"+Os,hl,cl,Rs,dl].join("|"),"g"),vl=RegExp("["+Es+Un+vs+Cs+"]"),yl=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ml=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Sl=-1,Q={};Q[Tr]=Q[Or]=Q[Mr]=Q[Pr]=Q[Ur]=Q[Nr]=Q[Wr]=Q[Fr]=Q[Gr]=!0,Q[Pe]=Q[In]=Q[un]=Q[tn]=Q[Ue]=Q[en]=Q[Tn]=Q[On]=Q[Gt]=Q[nn]=Q[ne]=Q[rn]=Q[Bt]=Q[sn]=Q[an]=!1;var X={};X[Pe]=X[In]=X[un]=X[Ue]=X[tn]=X[en]=X[Tr]=X[Or]=X[Mr]=X[Pr]=X[Ur]=X[Gt]=X[nn]=X[ne]=X[rn]=X[Bt]=X[sn]=X[Mn]=X[Nr]=X[Wr]=X[Fr]=X[Gr]=!0,X[Tn]=X[On]=X[an]=!1;var Cl={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},xl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Dl={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Rl={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ll=parseFloat,Al=parseInt,Ns=typeof Rr=="object"&&Rr&&Rr.Object===Object&&Rr,bl=typeof self=="object"&&self&&self.Object===Object&&self,lt=Ns||bl||Function("return this")(),Yr=i&&!i.nodeType&&i,De=Yr&&!0&&h&&!h.nodeType&&h,Ws=De&&De.exports===Yr,Zr=Ws&&Ns.process,Et=function(){try{var _=De&&De.require&&De.require("util").types;return _||Zr&&Zr.binding&&Zr.binding("util")}catch{}}(),Fs=Et&&Et.isArrayBuffer,Gs=Et&&Et.isDate,Bs=Et&&Et.isMap,ks=Et&&Et.isRegExp,$s=Et&&Et.isSet,Hs=Et&&Et.isTypedArray;function Ct(_,m,y){switch(y.length){case 0:return _.call(m);case 1:return _.call(m,y[0]);case 2:return _.call(m,y[0],y[1]);case 3:return _.call(m,y[0],y[1],y[2])}return _.apply(m,y)}function El(_,m,y,b){for(var W=-1,K=_==null?0:_.length;++W<K;){var st=_[W];m(b,st,y(st),_)}return b}function It(_,m){for(var y=-1,b=_==null?0:_.length;++y<b&&m(_[y],y,_)!==!1;);return _}function Il(_,m){for(var y=_==null?0:_.length;y--&&m(_[y],y,_)!==!1;);return _}function zs(_,m){for(var y=-1,b=_==null?0:_.length;++y<b;)if(!m(_[y],y,_))return!1;return!0}function de(_,m){for(var y=-1,b=_==null?0:_.length,W=0,K=[];++y<b;){var st=_[y];m(st,y,_)&&(K[W++]=st)}return K}function Wn(_,m){var y=_==null?0:_.length;return!!y&&We(_,m,0)>-1}function Jr(_,m,y){for(var b=-1,W=_==null?0:_.length;++b<W;)if(y(m,_[b]))return!0;return!1}function j(_,m){for(var y=-1,b=_==null?0:_.length,W=Array(b);++y<b;)W[y]=m(_[y],y,_);return W}function ge(_,m){for(var y=-1,b=m.length,W=_.length;++y<b;)_[W+y]=m[y];return _}function Xr(_,m,y,b){var W=-1,K=_==null?0:_.length;for(b&&K&&(y=_[++W]);++W<K;)y=m(y,_[W],W,_);return y}function Tl(_,m,y,b){var W=_==null?0:_.length;for(b&&W&&(y=_[--W]);W--;)y=m(y,_[W],W,_);return y}function Qr(_,m){for(var y=-1,b=_==null?0:_.length;++y<b;)if(m(_[y],y,_))return!0;return!1}var Ol=Vr("length");function Ml(_){return _.split("")}function Pl(_){return _.match($o)||[]}function qs(_,m,y){var b;return y(_,function(W,K,st){if(m(W,K,st))return b=K,!1}),b}function Fn(_,m,y,b){for(var W=_.length,K=y+(b?1:-1);b?K--:++K<W;)if(m(_[K],K,_))return K;return-1}function We(_,m,y){return m===m?Kl(_,m,y):Fn(_,Ks,y)}function Ul(_,m,y,b){for(var W=y-1,K=_.length;++W<K;)if(b(_[W],m))return W;return-1}function Ks(_){return _!==_}function Ys(_,m){var y=_==null?0:_.length;return y?ti(_,m)/y:En}function Vr(_){return function(m){return m==null?r:m[_]}}function jr(_){return function(m){return _==null?r:_[m]}}function Zs(_,m,y,b,W){return W(_,function(K,st,J){y=b?(b=!1,K):m(y,K,st,J)}),y}function Nl(_,m){var y=_.length;for(_.sort(m);y--;)_[y]=_[y].value;return _}function ti(_,m){for(var y,b=-1,W=_.length;++b<W;){var K=m(_[b]);K!==r&&(y=y===r?K:y+K)}return y}function ei(_,m){for(var y=-1,b=Array(_);++y<_;)b[y]=m(y);return b}function Wl(_,m){return j(m,function(y){return[y,_[y]]})}function Js(_){return _&&_.slice(0,js(_)+1).replace(kr,"")}function xt(_){return function(m){return _(m)}}function ni(_,m){return j(m,function(y){return _[y]})}function on(_,m){return _.has(m)}function Xs(_,m){for(var y=-1,b=_.length;++y<b&&We(m,_[y],0)>-1;);return y}function Qs(_,m){for(var y=_.length;y--&&We(m,_[y],0)>-1;);return y}function Fl(_,m){for(var y=_.length,b=0;y--;)_[y]===m&&++b;return b}var Gl=jr(Cl),Bl=jr(xl);function kl(_){return"\\"+Rl[_]}function $l(_,m){return _==null?r:_[m]}function Fe(_){return vl.test(_)}function Hl(_){return yl.test(_)}function zl(_){for(var m,y=[];!(m=_.next()).done;)y.push(m.value);return y}function ri(_){var m=-1,y=Array(_.size);return _.forEach(function(b,W){y[++m]=[W,b]}),y}function Vs(_,m){return function(y){return _(m(y))}}function pe(_,m){for(var y=-1,b=_.length,W=0,K=[];++y<b;){var st=_[y];(st===m||st===I)&&(_[y]=I,K[W++]=y)}return K}function Gn(_){var m=-1,y=Array(_.size);return _.forEach(function(b){y[++m]=b}),y}function ql(_){var m=-1,y=Array(_.size);return _.forEach(function(b){y[++m]=[b,b]}),y}function Kl(_,m,y){for(var b=y-1,W=_.length;++b<W;)if(_[b]===m)return b;return-1}function Yl(_,m,y){for(var b=y+1;b--;)if(_[b]===m)return b;return b}function Ge(_){return Fe(_)?Jl(_):Ol(_)}function kt(_){return Fe(_)?Xl(_):Ml(_)}function js(_){for(var m=_.length;m--&&Fo.test(_.charAt(m)););return m}var Zl=jr(Dl);function Jl(_){for(var m=Kr.lastIndex=0;Kr.test(_);)++m;return m}function Xl(_){return _.match(Kr)||[]}function Ql(_){return _.match(wl)||[]}var Vl=function _(m){m=m==null?lt:Be.defaults(lt.Object(),m,Be.pick(lt,ml));var y=m.Array,b=m.Date,W=m.Error,K=m.Function,st=m.Math,J=m.Object,ii=m.RegExp,jl=m.String,Tt=m.TypeError,Bn=y.prototype,tf=K.prototype,ke=J.prototype,kn=m["__core-js_shared__"],$n=tf.toString,Z=ke.hasOwnProperty,ef=0,ta=function(){var t=/[^.]+$/.exec(kn&&kn.keys&&kn.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Hn=ke.toString,nf=$n.call(J),rf=lt._,sf=ii("^"+$n.call(Z).replace(Br,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),zn=Ws?m.Buffer:r,_e=m.Symbol,qn=m.Uint8Array,ea=zn?zn.allocUnsafe:r,Kn=Vs(J.getPrototypeOf,J),na=J.create,ra=ke.propertyIsEnumerable,Yn=Bn.splice,ia=_e?_e.isConcatSpreadable:r,ln=_e?_e.iterator:r,Re=_e?_e.toStringTag:r,Zn=function(){try{var t=Ie(J,"defineProperty");return t({},"",{}),t}catch{}}(),af=m.clearTimeout!==lt.clearTimeout&&m.clearTimeout,uf=b&&b.now!==lt.Date.now&&b.now,of=m.setTimeout!==lt.setTimeout&&m.setTimeout,Jn=st.ceil,Xn=st.floor,si=J.getOwnPropertySymbols,lf=zn?zn.isBuffer:r,sa=m.isFinite,ff=Bn.join,cf=Vs(J.keys,J),at=st.max,ht=st.min,hf=b.now,df=m.parseInt,aa=st.random,gf=Bn.reverse,ai=Ie(m,"DataView"),fn=Ie(m,"Map"),ui=Ie(m,"Promise"),$e=Ie(m,"Set"),cn=Ie(m,"WeakMap"),hn=Ie(J,"create"),Qn=cn&&new cn,He={},pf=Te(ai),_f=Te(fn),wf=Te(ui),vf=Te($e),yf=Te(cn),Vn=_e?_e.prototype:r,dn=Vn?Vn.valueOf:r,ua=Vn?Vn.toString:r;function o(t){if(et(t)&&!F(t)&&!(t instanceof z)){if(t instanceof Ot)return t;if(Z.call(t,"__wrapped__"))return ou(t)}return new Ot(t)}var ze=function(){function t(){}return function(e){if(!tt(e))return{};if(na)return na(e);t.prototype=e;var n=new t;return t.prototype=r,n}}();function jn(){}function Ot(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=r}o.templateSettings={escape:Oo,evaluate:Mo,interpolate:_s,variable:"",imports:{_:o}},o.prototype=jn.prototype,o.prototype.constructor=o,Ot.prototype=ze(jn.prototype),Ot.prototype.constructor=Ot;function z(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Jt,this.__views__=[]}function mf(){var t=new z(this.__wrapped__);return t.__actions__=vt(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=vt(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=vt(this.__views__),t}function Sf(){if(this.__filtered__){var t=new z(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function Cf(){var t=this.__wrapped__.value(),e=this.__dir__,n=F(t),s=e<0,a=n?t.length:0,l=Pc(0,a,this.__views__),d=l.start,p=l.end,w=p-d,S=s?p:d-1,C=this.__iteratees__,x=C.length,L=0,E=ht(w,this.__takeCount__);if(!n||!s&&a==w&&E==w)return Ta(t,this.__actions__);var O=[];t:for(;w--&&L<E;){S+=e;for(var k=-1,M=t[S];++k<x;){var H=C[k],q=H.iteratee,Lt=H.type,_t=q(M);if(Lt==po)M=_t;else if(!_t){if(Lt==cs)continue t;break t}}O[L++]=M}return O}z.prototype=ze(jn.prototype),z.prototype.constructor=z;function Le(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var s=t[e];this.set(s[0],s[1])}}function xf(){this.__data__=hn?hn(null):{},this.size=0}function Df(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function Rf(t){var e=this.__data__;if(hn){var n=e[t];return n===D?r:n}return Z.call(e,t)?e[t]:r}function Lf(t){var e=this.__data__;return hn?e[t]!==r:Z.call(e,t)}function Af(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=hn&&e===r?D:e,this}Le.prototype.clear=xf,Le.prototype.delete=Df,Le.prototype.get=Rf,Le.prototype.has=Lf,Le.prototype.set=Af;function re(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var s=t[e];this.set(s[0],s[1])}}function bf(){this.__data__=[],this.size=0}function Ef(t){var e=this.__data__,n=tr(e,t);if(n<0)return!1;var s=e.length-1;return n==s?e.pop():Yn.call(e,n,1),--this.size,!0}function If(t){var e=this.__data__,n=tr(e,t);return n<0?r:e[n][1]}function Tf(t){return tr(this.__data__,t)>-1}function Of(t,e){var n=this.__data__,s=tr(n,t);return s<0?(++this.size,n.push([t,e])):n[s][1]=e,this}re.prototype.clear=bf,re.prototype.delete=Ef,re.prototype.get=If,re.prototype.has=Tf,re.prototype.set=Of;function ie(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var s=t[e];this.set(s[0],s[1])}}function Mf(){this.size=0,this.__data__={hash:new Le,map:new(fn||re),string:new Le}}function Pf(t){var e=hr(this,t).delete(t);return this.size-=e?1:0,e}function Uf(t){return hr(this,t).get(t)}function Nf(t){return hr(this,t).has(t)}function Wf(t,e){var n=hr(this,t),s=n.size;return n.set(t,e),this.size+=n.size==s?0:1,this}ie.prototype.clear=Mf,ie.prototype.delete=Pf,ie.prototype.get=Uf,ie.prototype.has=Nf,ie.prototype.set=Wf;function Ae(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new ie;++e<n;)this.add(t[e])}function Ff(t){return this.__data__.set(t,D),this}function Gf(t){return this.__data__.has(t)}Ae.prototype.add=Ae.prototype.push=Ff,Ae.prototype.has=Gf;function $t(t){var e=this.__data__=new re(t);this.size=e.size}function Bf(){this.__data__=new re,this.size=0}function kf(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function $f(t){return this.__data__.get(t)}function Hf(t){return this.__data__.has(t)}function zf(t,e){var n=this.__data__;if(n instanceof re){var s=n.__data__;if(!fn||s.length<f-1)return s.push([t,e]),this.size=++n.size,this;n=this.__data__=new ie(s)}return n.set(t,e),this.size=n.size,this}$t.prototype.clear=Bf,$t.prototype.delete=kf,$t.prototype.get=$f,$t.prototype.has=Hf,$t.prototype.set=zf;function oa(t,e){var n=F(t),s=!n&&Oe(t),a=!n&&!s&&Se(t),l=!n&&!s&&!a&&Ze(t),d=n||s||a||l,p=d?ei(t.length,jl):[],w=p.length;for(var S in t)(e||Z.call(t,S))&&!(d&&(S=="length"||a&&(S=="offset"||S=="parent")||l&&(S=="buffer"||S=="byteLength"||S=="byteOffset")||oe(S,w)))&&p.push(S);return p}function la(t){var e=t.length;return e?t[vi(0,e-1)]:r}function qf(t,e){return dr(vt(t),be(e,0,t.length))}function Kf(t){return dr(vt(t))}function oi(t,e,n){(n!==r&&!Ht(t[e],n)||n===r&&!(e in t))&&se(t,e,n)}function gn(t,e,n){var s=t[e];(!(Z.call(t,e)&&Ht(s,n))||n===r&&!(e in t))&&se(t,e,n)}function tr(t,e){for(var n=t.length;n--;)if(Ht(t[n][0],e))return n;return-1}function Yf(t,e,n,s){return we(t,function(a,l,d){e(s,a,n(a),d)}),s}function fa(t,e){return t&&Qt(e,ot(e),t)}function Zf(t,e){return t&&Qt(e,mt(e),t)}function se(t,e,n){e=="__proto__"&&Zn?Zn(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function li(t,e){for(var n=-1,s=e.length,a=y(s),l=t==null;++n<s;)a[n]=l?r:Hi(t,e[n]);return a}function be(t,e,n){return t===t&&(n!==r&&(t=t<=n?t:n),e!==r&&(t=t>=e?t:e)),t}function Mt(t,e,n,s,a,l){var d,p=e&N,w=e&ut,S=e&V;if(n&&(d=a?n(t,s,a,l):n(t)),d!==r)return d;if(!tt(t))return t;var C=F(t);if(C){if(d=Nc(t),!p)return vt(t,d)}else{var x=dt(t),L=x==On||x==hs;if(Se(t))return Pa(t,p);if(x==ne||x==Pe||L&&!a){if(d=w||L?{}:ja(t),!p)return w?Rc(t,Zf(d,t)):Dc(t,fa(d,t))}else{if(!X[x])return a?t:{};d=Wc(t,x,p)}}l||(l=new $t);var E=l.get(t);if(E)return E;l.set(t,d),bu(t)?t.forEach(function(M){d.add(Mt(M,e,n,M,t,l))}):Lu(t)&&t.forEach(function(M,H){d.set(H,Mt(M,e,n,H,t,l))});var O=S?w?Ei:bi:w?mt:ot,k=C?r:O(t);return It(k||t,function(M,H){k&&(H=M,M=t[H]),gn(d,H,Mt(M,e,n,H,t,l))}),d}function Jf(t){var e=ot(t);return function(n){return ca(n,t,e)}}function ca(t,e,n){var s=n.length;if(t==null)return!s;for(t=J(t);s--;){var a=n[s],l=e[a],d=t[a];if(d===r&&!(a in t)||!l(d))return!1}return!0}function ha(t,e,n){if(typeof t!="function")throw new Tt(g);return Sn(function(){t.apply(r,n)},e)}function pn(t,e,n,s){var a=-1,l=Wn,d=!0,p=t.length,w=[],S=e.length;if(!p)return w;n&&(e=j(e,xt(n))),s?(l=Jr,d=!1):e.length>=f&&(l=on,d=!1,e=new Ae(e));t:for(;++a<p;){var C=t[a],x=n==null?C:n(C);if(C=s||C!==0?C:0,d&&x===x){for(var L=S;L--;)if(e[L]===x)continue t;w.push(C)}else l(e,x,s)||w.push(C)}return w}var we=Ga(Xt),da=Ga(ci,!0);function Xf(t,e){var n=!0;return we(t,function(s,a,l){return n=!!e(s,a,l),n}),n}function er(t,e,n){for(var s=-1,a=t.length;++s<a;){var l=t[s],d=e(l);if(d!=null&&(p===r?d===d&&!Rt(d):n(d,p)))var p=d,w=l}return w}function Qf(t,e,n,s){var a=t.length;for(n=B(n),n<0&&(n=-n>a?0:a+n),s=s===r||s>a?a:B(s),s<0&&(s+=a),s=n>s?0:Iu(s);n<s;)t[n++]=e;return t}function ga(t,e){var n=[];return we(t,function(s,a,l){e(s,a,l)&&n.push(s)}),n}function ft(t,e,n,s,a){var l=-1,d=t.length;for(n||(n=Gc),a||(a=[]);++l<d;){var p=t[l];e>0&&n(p)?e>1?ft(p,e-1,n,s,a):ge(a,p):s||(a[a.length]=p)}return a}var fi=Ba(),pa=Ba(!0);function Xt(t,e){return t&&fi(t,e,ot)}function ci(t,e){return t&&pa(t,e,ot)}function nr(t,e){return de(e,function(n){return le(t[n])})}function Ee(t,e){e=ye(e,t);for(var n=0,s=e.length;t!=null&&n<s;)t=t[Vt(e[n++])];return n&&n==s?t:r}function _a(t,e,n){var s=e(t);return F(t)?s:ge(s,n(t))}function gt(t){return t==null?t===r?Ro:xo:Re&&Re in J(t)?Mc(t):Kc(t)}function hi(t,e){return t>e}function Vf(t,e){return t!=null&&Z.call(t,e)}function jf(t,e){return t!=null&&e in J(t)}function tc(t,e,n){return t>=ht(e,n)&&t<at(e,n)}function di(t,e,n){for(var s=n?Jr:Wn,a=t[0].length,l=t.length,d=l,p=y(l),w=1/0,S=[];d--;){var C=t[d];d&&e&&(C=j(C,xt(e))),w=ht(C.length,w),p[d]=!n&&(e||a>=120&&C.length>=120)?new Ae(d&&C):r}C=t[0];var x=-1,L=p[0];t:for(;++x<a&&S.length<w;){var E=C[x],O=e?e(E):E;if(E=n||E!==0?E:0,!(L?on(L,O):s(S,O,n))){for(d=l;--d;){var k=p[d];if(!(k?on(k,O):s(t[d],O,n)))continue t}L&&L.push(O),S.push(E)}}return S}function ec(t,e,n,s){return Xt(t,function(a,l,d){e(s,n(a),l,d)}),s}function _n(t,e,n){e=ye(e,t),t=ru(t,e);var s=t==null?t:t[Vt(Ut(e))];return s==null?r:Ct(s,t,n)}function wa(t){return et(t)&&gt(t)==Pe}function nc(t){return et(t)&&gt(t)==un}function rc(t){return et(t)&&gt(t)==en}function wn(t,e,n,s,a){return t===e?!0:t==null||e==null||!et(t)&&!et(e)?t!==t&&e!==e:ic(t,e,n,s,wn,a)}function ic(t,e,n,s,a,l){var d=F(t),p=F(e),w=d?In:dt(t),S=p?In:dt(e);w=w==Pe?ne:w,S=S==Pe?ne:S;var C=w==ne,x=S==ne,L=w==S;if(L&&Se(t)){if(!Se(e))return!1;d=!0,C=!1}if(L&&!C)return l||(l=new $t),d||Ze(t)?Xa(t,e,n,s,a,l):Tc(t,e,w,n,s,a,l);if(!(n&nt)){var E=C&&Z.call(t,"__wrapped__"),O=x&&Z.call(e,"__wrapped__");if(E||O){var k=E?t.value():t,M=O?e.value():e;return l||(l=new $t),a(k,M,n,s,l)}}return L?(l||(l=new $t),Oc(t,e,n,s,a,l)):!1}function sc(t){return et(t)&&dt(t)==Gt}function gi(t,e,n,s){var a=n.length,l=a,d=!s;if(t==null)return!l;for(t=J(t);a--;){var p=n[a];if(d&&p[2]?p[1]!==t[p[0]]:!(p[0]in t))return!1}for(;++a<l;){p=n[a];var w=p[0],S=t[w],C=p[1];if(d&&p[2]){if(S===r&&!(w in t))return!1}else{var x=new $t;if(s)var L=s(S,C,w,t,e,x);if(!(L===r?wn(C,S,nt|Zt,s,x):L))return!1}}return!0}function va(t){if(!tt(t)||kc(t))return!1;var e=le(t)?sf:Zo;return e.test(Te(t))}function ac(t){return et(t)&&gt(t)==rn}function uc(t){return et(t)&&dt(t)==Bt}function oc(t){return et(t)&&yr(t.length)&&!!Q[gt(t)]}function ya(t){return typeof t=="function"?t:t==null?St:typeof t=="object"?F(t)?Ca(t[0],t[1]):Sa(t):ku(t)}function pi(t){if(!mn(t))return cf(t);var e=[];for(var n in J(t))Z.call(t,n)&&n!="constructor"&&e.push(n);return e}function lc(t){if(!tt(t))return qc(t);var e=mn(t),n=[];for(var s in t)s=="constructor"&&(e||!Z.call(t,s))||n.push(s);return n}function _i(t,e){return t<e}function ma(t,e){var n=-1,s=yt(t)?y(t.length):[];return we(t,function(a,l,d){s[++n]=e(a,l,d)}),s}function Sa(t){var e=Ti(t);return e.length==1&&e[0][2]?eu(e[0][0],e[0][1]):function(n){return n===t||gi(n,t,e)}}function Ca(t,e){return Mi(t)&&tu(e)?eu(Vt(t),e):function(n){var s=Hi(n,t);return s===r&&s===e?zi(n,t):wn(e,s,nt|Zt)}}function rr(t,e,n,s,a){t!==e&&fi(e,function(l,d){if(a||(a=new $t),tt(l))fc(t,e,d,n,rr,s,a);else{var p=s?s(Ui(t,d),l,d+"",t,e,a):r;p===r&&(p=l),oi(t,d,p)}},mt)}function fc(t,e,n,s,a,l,d){var p=Ui(t,n),w=Ui(e,n),S=d.get(w);if(S){oi(t,n,S);return}var C=l?l(p,w,n+"",t,e,d):r,x=C===r;if(x){var L=F(w),E=!L&&Se(w),O=!L&&!E&&Ze(w);C=w,L||E||O?F(p)?C=p:rt(p)?C=vt(p):E?(x=!1,C=Pa(w,!0)):O?(x=!1,C=Ua(w,!0)):C=[]:Cn(w)||Oe(w)?(C=p,Oe(p)?C=Tu(p):(!tt(p)||le(p))&&(C=ja(w))):x=!1}x&&(d.set(w,C),a(C,w,s,l,d),d.delete(w)),oi(t,n,C)}function xa(t,e){var n=t.length;if(n)return e+=e<0?n:0,oe(e,n)?t[e]:r}function Da(t,e,n){e.length?e=j(e,function(l){return F(l)?function(d){return Ee(d,l.length===1?l[0]:l)}:l}):e=[St];var s=-1;e=j(e,xt(T()));var a=ma(t,function(l,d,p){var w=j(e,function(S){return S(l)});return{criteria:w,index:++s,value:l}});return Nl(a,function(l,d){return xc(l,d,n)})}function cc(t,e){return Ra(t,e,function(n,s){return zi(t,s)})}function Ra(t,e,n){for(var s=-1,a=e.length,l={};++s<a;){var d=e[s],p=Ee(t,d);n(p,d)&&vn(l,ye(d,t),p)}return l}function hc(t){return function(e){return Ee(e,t)}}function wi(t,e,n,s){var a=s?Ul:We,l=-1,d=e.length,p=t;for(t===e&&(e=vt(e)),n&&(p=j(t,xt(n)));++l<d;)for(var w=0,S=e[l],C=n?n(S):S;(w=a(p,C,w,s))>-1;)p!==t&&Yn.call(p,w,1),Yn.call(t,w,1);return t}function La(t,e){for(var n=t?e.length:0,s=n-1;n--;){var a=e[n];if(n==s||a!==l){var l=a;oe(a)?Yn.call(t,a,1):Si(t,a)}}return t}function vi(t,e){return t+Xn(aa()*(e-t+1))}function dc(t,e,n,s){for(var a=-1,l=at(Jn((e-t)/(n||1)),0),d=y(l);l--;)d[s?l:++a]=t,t+=n;return d}function yi(t,e){var n="";if(!t||e<1||e>he)return n;do e%2&&(n+=t),e=Xn(e/2),e&&(t+=t);while(e);return n}function $(t,e){return Ni(nu(t,e,St),t+"")}function gc(t){return la(Je(t))}function pc(t,e){var n=Je(t);return dr(n,be(e,0,n.length))}function vn(t,e,n,s){if(!tt(t))return t;e=ye(e,t);for(var a=-1,l=e.length,d=l-1,p=t;p!=null&&++a<l;){var w=Vt(e[a]),S=n;if(w==="__proto__"||w==="constructor"||w==="prototype")return t;if(a!=d){var C=p[w];S=s?s(C,w,p):r,S===r&&(S=tt(C)?C:oe(e[a+1])?[]:{})}gn(p,w,S),p=p[w]}return t}var Aa=Qn?function(t,e){return Qn.set(t,e),t}:St,_c=Zn?function(t,e){return Zn(t,"toString",{configurable:!0,enumerable:!1,value:Ki(e),writable:!0})}:St;function wc(t){return dr(Je(t))}function Pt(t,e,n){var s=-1,a=t.length;e<0&&(e=-e>a?0:a+e),n=n>a?a:n,n<0&&(n+=a),a=e>n?0:n-e>>>0,e>>>=0;for(var l=y(a);++s<a;)l[s]=t[s+e];return l}function vc(t,e){var n;return we(t,function(s,a,l){return n=e(s,a,l),!n}),!!n}function ir(t,e,n){var s=0,a=t==null?s:t.length;if(typeof e=="number"&&e===e&&a<=yo){for(;s<a;){var l=s+a>>>1,d=t[l];d!==null&&!Rt(d)&&(n?d<=e:d<e)?s=l+1:a=l}return a}return mi(t,e,St,n)}function mi(t,e,n,s){var a=0,l=t==null?0:t.length;if(l===0)return 0;e=n(e);for(var d=e!==e,p=e===null,w=Rt(e),S=e===r;a<l;){var C=Xn((a+l)/2),x=n(t[C]),L=x!==r,E=x===null,O=x===x,k=Rt(x);if(d)var M=s||O;else S?M=O&&(s||L):p?M=O&&L&&(s||!E):w?M=O&&L&&!E&&(s||!k):E||k?M=!1:M=s?x<=e:x<e;M?a=C+1:l=C}return ht(l,vo)}function ba(t,e){for(var n=-1,s=t.length,a=0,l=[];++n<s;){var d=t[n],p=e?e(d):d;if(!n||!Ht(p,w)){var w=p;l[a++]=d===0?0:d}}return l}function Ea(t){return typeof t=="number"?t:Rt(t)?En:+t}function Dt(t){if(typeof t=="string")return t;if(F(t))return j(t,Dt)+"";if(Rt(t))return ua?ua.call(t):"";var e=t+"";return e=="0"&&1/t==-xe?"-0":e}function ve(t,e,n){var s=-1,a=Wn,l=t.length,d=!0,p=[],w=p;if(n)d=!1,a=Jr;else if(l>=f){var S=e?null:Ec(t);if(S)return Gn(S);d=!1,a=on,w=new Ae}else w=e?[]:p;t:for(;++s<l;){var C=t[s],x=e?e(C):C;if(C=n||C!==0?C:0,d&&x===x){for(var L=w.length;L--;)if(w[L]===x)continue t;e&&w.push(x),p.push(C)}else a(w,x,n)||(w!==p&&w.push(x),p.push(C))}return p}function Si(t,e){return e=ye(e,t),t=ru(t,e),t==null||delete t[Vt(Ut(e))]}function Ia(t,e,n,s){return vn(t,e,n(Ee(t,e)),s)}function sr(t,e,n,s){for(var a=t.length,l=s?a:-1;(s?l--:++l<a)&&e(t[l],l,t););return n?Pt(t,s?0:l,s?l+1:a):Pt(t,s?l+1:0,s?a:l)}function Ta(t,e){var n=t;return n instanceof z&&(n=n.value()),Xr(e,function(s,a){return a.func.apply(a.thisArg,ge([s],a.args))},n)}function Ci(t,e,n){var s=t.length;if(s<2)return s?ve(t[0]):[];for(var a=-1,l=y(s);++a<s;)for(var d=t[a],p=-1;++p<s;)p!=a&&(l[a]=pn(l[a]||d,t[p],e,n));return ve(ft(l,1),e,n)}function Oa(t,e,n){for(var s=-1,a=t.length,l=e.length,d={};++s<a;){var p=s<l?e[s]:r;n(d,t[s],p)}return d}function xi(t){return rt(t)?t:[]}function Di(t){return typeof t=="function"?t:St}function ye(t,e){return F(t)?t:Mi(t,e)?[t]:uu(Y(t))}var yc=$;function me(t,e,n){var s=t.length;return n=n===r?s:n,!e&&n>=s?t:Pt(t,e,n)}var Ma=af||function(t){return lt.clearTimeout(t)};function Pa(t,e){if(e)return t.slice();var n=t.length,s=ea?ea(n):new t.constructor(n);return t.copy(s),s}function Ri(t){var e=new t.constructor(t.byteLength);return new qn(e).set(new qn(t)),e}function mc(t,e){var n=e?Ri(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}function Sc(t){var e=new t.constructor(t.source,ws.exec(t));return e.lastIndex=t.lastIndex,e}function Cc(t){return dn?J(dn.call(t)):{}}function Ua(t,e){var n=e?Ri(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Na(t,e){if(t!==e){var n=t!==r,s=t===null,a=t===t,l=Rt(t),d=e!==r,p=e===null,w=e===e,S=Rt(e);if(!p&&!S&&!l&&t>e||l&&d&&w&&!p&&!S||s&&d&&w||!n&&w||!a)return 1;if(!s&&!l&&!S&&t<e||S&&n&&a&&!s&&!l||p&&n&&a||!d&&a||!w)return-1}return 0}function xc(t,e,n){for(var s=-1,a=t.criteria,l=e.criteria,d=a.length,p=n.length;++s<d;){var w=Na(a[s],l[s]);if(w){if(s>=p)return w;var S=n[s];return w*(S=="desc"?-1:1)}}return t.index-e.index}function Wa(t,e,n,s){for(var a=-1,l=t.length,d=n.length,p=-1,w=e.length,S=at(l-d,0),C=y(w+S),x=!s;++p<w;)C[p]=e[p];for(;++a<d;)(x||a<l)&&(C[n[a]]=t[a]);for(;S--;)C[p++]=t[a++];return C}function Fa(t,e,n,s){for(var a=-1,l=t.length,d=-1,p=n.length,w=-1,S=e.length,C=at(l-p,0),x=y(C+S),L=!s;++a<C;)x[a]=t[a];for(var E=a;++w<S;)x[E+w]=e[w];for(;++d<p;)(L||a<l)&&(x[E+n[d]]=t[a++]);return x}function vt(t,e){var n=-1,s=t.length;for(e||(e=y(s));++n<s;)e[n]=t[n];return e}function Qt(t,e,n,s){var a=!n;n||(n={});for(var l=-1,d=e.length;++l<d;){var p=e[l],w=s?s(n[p],t[p],p,n,t):r;w===r&&(w=t[p]),a?se(n,p,w):gn(n,p,w)}return n}function Dc(t,e){return Qt(t,Oi(t),e)}function Rc(t,e){return Qt(t,Qa(t),e)}function ar(t,e){return function(n,s){var a=F(n)?El:Yf,l=e?e():{};return a(n,t,T(s,2),l)}}function qe(t){return $(function(e,n){var s=-1,a=n.length,l=a>1?n[a-1]:r,d=a>2?n[2]:r;for(l=t.length>3&&typeof l=="function"?(a--,l):r,d&&pt(n[0],n[1],d)&&(l=a<3?r:l,a=1),e=J(e);++s<a;){var p=n[s];p&&t(e,p,s,l)}return e})}function Ga(t,e){return function(n,s){if(n==null)return n;if(!yt(n))return t(n,s);for(var a=n.length,l=e?a:-1,d=J(n);(e?l--:++l<a)&&s(d[l],l,d)!==!1;);return n}}function Ba(t){return function(e,n,s){for(var a=-1,l=J(e),d=s(e),p=d.length;p--;){var w=d[t?p:++a];if(n(l[w],w,l)===!1)break}return e}}function Lc(t,e,n){var s=e&Ft,a=yn(t);function l(){var d=this&&this!==lt&&this instanceof l?a:t;return d.apply(s?n:this,arguments)}return l}function ka(t){return function(e){e=Y(e);var n=Fe(e)?kt(e):r,s=n?n[0]:e.charAt(0),a=n?me(n,1).join(""):e.slice(1);return s[t]()+a}}function Ke(t){return function(e){return Xr(Gu(Fu(e).replace(pl,"")),t,"")}}function yn(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=ze(t.prototype),s=t.apply(n,e);return tt(s)?s:n}}function Ac(t,e,n){var s=yn(t);function a(){for(var l=arguments.length,d=y(l),p=l,w=Ye(a);p--;)d[p]=arguments[p];var S=l<3&&d[0]!==w&&d[l-1]!==w?[]:pe(d,w);if(l-=S.length,l<n)return Ka(t,e,ur,a.placeholder,r,d,S,r,r,n-l);var C=this&&this!==lt&&this instanceof a?s:t;return Ct(C,this,d)}return a}function $a(t){return function(e,n,s){var a=J(e);if(!yt(e)){var l=T(n,3);e=ot(e),n=function(p){return l(a[p],p,a)}}var d=t(e,n,s);return d>-1?a[l?e[d]:d]:r}}function Ha(t){return ue(function(e){var n=e.length,s=n,a=Ot.prototype.thru;for(t&&e.reverse();s--;){var l=e[s];if(typeof l!="function")throw new Tt(g);if(a&&!d&&cr(l)=="wrapper")var d=new Ot([],!0)}for(s=d?s:n;++s<n;){l=e[s];var p=cr(l),w=p=="wrapper"?Ii(l):r;w&&Pi(w[0])&&w[1]==(ee|jt|te|je)&&!w[4].length&&w[9]==1?d=d[cr(w[0])].apply(d,w[3]):d=l.length==1&&Pi(l)?d[p]():d.thru(l)}return function(){var S=arguments,C=S[0];if(d&&S.length==1&&F(C))return d.plant(C).value();for(var x=0,L=n?e[x].apply(this,S):C;++x<n;)L=e[x].call(this,L);return L}})}function ur(t,e,n,s,a,l,d,p,w,S){var C=e&ee,x=e&Ft,L=e&Me,E=e&(jt|Qe),O=e&Ir,k=L?r:yn(t);function M(){for(var H=arguments.length,q=y(H),Lt=H;Lt--;)q[Lt]=arguments[Lt];if(E)var _t=Ye(M),At=Fl(q,_t);if(s&&(q=Wa(q,s,a,E)),l&&(q=Fa(q,l,d,E)),H-=At,E&&H<S){var it=pe(q,_t);return Ka(t,e,ur,M.placeholder,n,q,it,p,w,S-H)}var zt=x?n:this,ce=L?zt[t]:t;return H=q.length,p?q=Yc(q,p):O&&H>1&&q.reverse(),C&&w<H&&(q.length=w),this&&this!==lt&&this instanceof M&&(ce=k||yn(ce)),ce.apply(zt,q)}return M}function za(t,e){return function(n,s){return ec(n,t,e(s),{})}}function or(t,e){return function(n,s){var a;if(n===r&&s===r)return e;if(n!==r&&(a=n),s!==r){if(a===r)return s;typeof n=="string"||typeof s=="string"?(n=Dt(n),s=Dt(s)):(n=Ea(n),s=Ea(s)),a=t(n,s)}return a}}function Li(t){return ue(function(e){return e=j(e,xt(T())),$(function(n){var s=this;return t(e,function(a){return Ct(a,s,n)})})})}function lr(t,e){e=e===r?" ":Dt(e);var n=e.length;if(n<2)return n?yi(e,t):e;var s=yi(e,Jn(t/Ge(e)));return Fe(e)?me(kt(s),0,t).join(""):s.slice(0,t)}function bc(t,e,n,s){var a=e&Ft,l=yn(t);function d(){for(var p=-1,w=arguments.length,S=-1,C=s.length,x=y(C+w),L=this&&this!==lt&&this instanceof d?l:t;++S<C;)x[S]=s[S];for(;w--;)x[S++]=arguments[++p];return Ct(L,a?n:this,x)}return d}function qa(t){return function(e,n,s){return s&&typeof s!="number"&&pt(e,n,s)&&(n=s=r),e=fe(e),n===r?(n=e,e=0):n=fe(n),s=s===r?e<n?1:-1:fe(s),dc(e,n,s,t)}}function fr(t){return function(e,n){return typeof e=="string"&&typeof n=="string"||(e=Nt(e),n=Nt(n)),t(e,n)}}function Ka(t,e,n,s,a,l,d,p,w,S){var C=e&jt,x=C?d:r,L=C?r:d,E=C?l:r,O=C?r:l;e|=C?te:Ve,e&=~(C?Ve:te),e&fs||(e&=-4);var k=[t,e,a,E,x,O,L,p,w,S],M=n.apply(r,k);return Pi(t)&&iu(M,k),M.placeholder=s,su(M,t,e)}function Ai(t){var e=st[t];return function(n,s){if(n=Nt(n),s=s==null?0:ht(B(s),292),s&&sa(n)){var a=(Y(n)+"e").split("e"),l=e(a[0]+"e"+(+a[1]+s));return a=(Y(l)+"e").split("e"),+(a[0]+"e"+(+a[1]-s))}return e(n)}}var Ec=$e&&1/Gn(new $e([,-0]))[1]==xe?function(t){return new $e(t)}:Ji;function Ya(t){return function(e){var n=dt(e);return n==Gt?ri(e):n==Bt?ql(e):Wl(e,t(e))}}function ae(t,e,n,s,a,l,d,p){var w=e&Me;if(!w&&typeof t!="function")throw new Tt(g);var S=s?s.length:0;if(S||(e&=-97,s=a=r),d=d===r?d:at(B(d),0),p=p===r?p:B(p),S-=a?a.length:0,e&Ve){var C=s,x=a;s=a=r}var L=w?r:Ii(t),E=[t,e,n,s,a,C,x,l,d,p];if(L&&zc(E,L),t=E[0],e=E[1],n=E[2],s=E[3],a=E[4],p=E[9]=E[9]===r?w?0:t.length:at(E[9]-S,0),!p&&e&(jt|Qe)&&(e&=-25),!e||e==Ft)var O=Lc(t,e,n);else e==jt||e==Qe?O=Ac(t,e,p):(e==te||e==(Ft|te))&&!a.length?O=bc(t,e,n,s):O=ur.apply(r,E);var k=L?Aa:iu;return su(k(O,E),t,e)}function Za(t,e,n,s){return t===r||Ht(t,ke[n])&&!Z.call(s,n)?e:t}function Ja(t,e,n,s,a,l){return tt(t)&&tt(e)&&(l.set(e,t),rr(t,e,r,Ja,l),l.delete(e)),t}function Ic(t){return Cn(t)?r:t}function Xa(t,e,n,s,a,l){var d=n&nt,p=t.length,w=e.length;if(p!=w&&!(d&&w>p))return!1;var S=l.get(t),C=l.get(e);if(S&&C)return S==e&&C==t;var x=-1,L=!0,E=n&Zt?new Ae:r;for(l.set(t,e),l.set(e,t);++x<p;){var O=t[x],k=e[x];if(s)var M=d?s(k,O,x,e,t,l):s(O,k,x,t,e,l);if(M!==r){if(M)continue;L=!1;break}if(E){if(!Qr(e,function(H,q){if(!on(E,q)&&(O===H||a(O,H,n,s,l)))return E.push(q)})){L=!1;break}}else if(!(O===k||a(O,k,n,s,l))){L=!1;break}}return l.delete(t),l.delete(e),L}function Tc(t,e,n,s,a,l,d){switch(n){case Ue:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case un:return!(t.byteLength!=e.byteLength||!l(new qn(t),new qn(e)));case tn:case en:case nn:return Ht(+t,+e);case Tn:return t.name==e.name&&t.message==e.message;case rn:case sn:return t==e+"";case Gt:var p=ri;case Bt:var w=s&nt;if(p||(p=Gn),t.size!=e.size&&!w)return!1;var S=d.get(t);if(S)return S==e;s|=Zt,d.set(t,e);var C=Xa(p(t),p(e),s,a,l,d);return d.delete(t),C;case Mn:if(dn)return dn.call(t)==dn.call(e)}return!1}function Oc(t,e,n,s,a,l){var d=n&nt,p=bi(t),w=p.length,S=bi(e),C=S.length;if(w!=C&&!d)return!1;for(var x=w;x--;){var L=p[x];if(!(d?L in e:Z.call(e,L)))return!1}var E=l.get(t),O=l.get(e);if(E&&O)return E==e&&O==t;var k=!0;l.set(t,e),l.set(e,t);for(var M=d;++x<w;){L=p[x];var H=t[L],q=e[L];if(s)var Lt=d?s(q,H,L,e,t,l):s(H,q,L,t,e,l);if(!(Lt===r?H===q||a(H,q,n,s,l):Lt)){k=!1;break}M||(M=L=="constructor")}if(k&&!M){var _t=t.constructor,At=e.constructor;_t!=At&&"constructor"in t&&"constructor"in e&&!(typeof _t=="function"&&_t instanceof _t&&typeof At=="function"&&At instanceof At)&&(k=!1)}return l.delete(t),l.delete(e),k}function ue(t){return Ni(nu(t,r,cu),t+"")}function bi(t){return _a(t,ot,Oi)}function Ei(t){return _a(t,mt,Qa)}var Ii=Qn?function(t){return Qn.get(t)}:Ji;function cr(t){for(var e=t.name+"",n=He[e],s=Z.call(He,e)?n.length:0;s--;){var a=n[s],l=a.func;if(l==null||l==t)return a.name}return e}function Ye(t){var e=Z.call(o,"placeholder")?o:t;return e.placeholder}function T(){var t=o.iteratee||Yi;return t=t===Yi?ya:t,arguments.length?t(arguments[0],arguments[1]):t}function hr(t,e){var n=t.__data__;return Bc(e)?n[typeof e=="string"?"string":"hash"]:n.map}function Ti(t){for(var e=ot(t),n=e.length;n--;){var s=e[n],a=t[s];e[n]=[s,a,tu(a)]}return e}function Ie(t,e){var n=$l(t,e);return va(n)?n:r}function Mc(t){var e=Z.call(t,Re),n=t[Re];try{t[Re]=r;var s=!0}catch{}var a=Hn.call(t);return s&&(e?t[Re]=n:delete t[Re]),a}var Oi=si?function(t){return t==null?[]:(t=J(t),de(si(t),function(e){return ra.call(t,e)}))}:Xi,Qa=si?function(t){for(var e=[];t;)ge(e,Oi(t)),t=Kn(t);return e}:Xi,dt=gt;(ai&&dt(new ai(new ArrayBuffer(1)))!=Ue||fn&&dt(new fn)!=Gt||ui&&dt(ui.resolve())!=ds||$e&&dt(new $e)!=Bt||cn&&dt(new cn)!=an)&&(dt=function(t){var e=gt(t),n=e==ne?t.constructor:r,s=n?Te(n):"";if(s)switch(s){case pf:return Ue;case _f:return Gt;case wf:return ds;case vf:return Bt;case yf:return an}return e});function Pc(t,e,n){for(var s=-1,a=n.length;++s<a;){var l=n[s],d=l.size;switch(l.type){case"drop":t+=d;break;case"dropRight":e-=d;break;case"take":e=ht(e,t+d);break;case"takeRight":t=at(t,e-d);break}}return{start:t,end:e}}function Uc(t){var e=t.match(Bo);return e?e[1].split(ko):[]}function Va(t,e,n){e=ye(e,t);for(var s=-1,a=e.length,l=!1;++s<a;){var d=Vt(e[s]);if(!(l=t!=null&&n(t,d)))break;t=t[d]}return l||++s!=a?l:(a=t==null?0:t.length,!!a&&yr(a)&&oe(d,a)&&(F(t)||Oe(t)))}function Nc(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&Z.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function ja(t){return typeof t.constructor=="function"&&!mn(t)?ze(Kn(t)):{}}function Wc(t,e,n){var s=t.constructor;switch(e){case un:return Ri(t);case tn:case en:return new s(+t);case Ue:return mc(t,n);case Tr:case Or:case Mr:case Pr:case Ur:case Nr:case Wr:case Fr:case Gr:return Ua(t,n);case Gt:return new s;case nn:case sn:return new s(t);case rn:return Sc(t);case Bt:return new s;case Mn:return Cc(t)}}function Fc(t,e){var n=e.length;if(!n)return t;var s=n-1;return e[s]=(n>1?"& ":"")+e[s],e=e.join(n>2?", ":" "),t.replace(Go,`{
/* [wrapped with `+e+`] */
`)}function Gc(t){return F(t)||Oe(t)||!!(ia&&t&&t[ia])}function oe(t,e){var n=typeof t;return e=e??he,!!e&&(n=="number"||n!="symbol"&&Xo.test(t))&&t>-1&&t%1==0&&t<e}function pt(t,e,n){if(!tt(n))return!1;var s=typeof e;return(s=="number"?yt(n)&&oe(e,n.length):s=="string"&&e in n)?Ht(n[e],t):!1}function Mi(t,e){if(F(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||Rt(t)?!0:Uo.test(t)||!Po.test(t)||e!=null&&t in J(e)}function Bc(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function Pi(t){var e=cr(t),n=o[e];if(typeof n!="function"||!(e in z.prototype))return!1;if(t===n)return!0;var s=Ii(n);return!!s&&t===s[0]}function kc(t){return!!ta&&ta in t}var $c=kn?le:Qi;function mn(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||ke;return t===n}function tu(t){return t===t&&!tt(t)}function eu(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==r||t in J(n))}}function Hc(t){var e=wr(t,function(s){return n.size===A&&n.clear(),s}),n=e.cache;return e}function zc(t,e){var n=t[1],s=e[1],a=n|s,l=a<(Ft|Me|ee),d=s==ee&&n==jt||s==ee&&n==je&&t[7].length<=e[8]||s==(ee|je)&&e[7].length<=e[8]&&n==jt;if(!(l||d))return t;s&Ft&&(t[2]=e[2],a|=n&Ft?0:fs);var p=e[3];if(p){var w=t[3];t[3]=w?Wa(w,p,e[4]):p,t[4]=w?pe(t[3],I):e[4]}return p=e[5],p&&(w=t[5],t[5]=w?Fa(w,p,e[6]):p,t[6]=w?pe(t[5],I):e[6]),p=e[7],p&&(t[7]=p),s&ee&&(t[8]=t[8]==null?e[8]:ht(t[8],e[8])),t[9]==null&&(t[9]=e[9]),t[0]=e[0],t[1]=a,t}function qc(t){var e=[];if(t!=null)for(var n in J(t))e.push(n);return e}function Kc(t){return Hn.call(t)}function nu(t,e,n){return e=at(e===r?t.length-1:e,0),function(){for(var s=arguments,a=-1,l=at(s.length-e,0),d=y(l);++a<l;)d[a]=s[e+a];a=-1;for(var p=y(e+1);++a<e;)p[a]=s[a];return p[e]=n(d),Ct(t,this,p)}}function ru(t,e){return e.length<2?t:Ee(t,Pt(e,0,-1))}function Yc(t,e){for(var n=t.length,s=ht(e.length,n),a=vt(t);s--;){var l=e[s];t[s]=oe(l,n)?a[l]:r}return t}function Ui(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var iu=au(Aa),Sn=of||function(t,e){return lt.setTimeout(t,e)},Ni=au(_c);function su(t,e,n){var s=e+"";return Ni(t,Fc(s,Zc(Uc(s),n)))}function au(t){var e=0,n=0;return function(){var s=hf(),a=go-(s-n);if(n=s,a>0){if(++e>=ho)return arguments[0]}else e=0;return t.apply(r,arguments)}}function dr(t,e){var n=-1,s=t.length,a=s-1;for(e=e===r?s:e;++n<e;){var l=vi(n,a),d=t[l];t[l]=t[n],t[n]=d}return t.length=e,t}var uu=Hc(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(No,function(n,s,a,l){e.push(a?l.replace(zo,"$1"):s||n)}),e});function Vt(t){if(typeof t=="string"||Rt(t))return t;var e=t+"";return e=="0"&&1/t==-xe?"-0":e}function Te(t){if(t!=null){try{return $n.call(t)}catch{}try{return t+""}catch{}}return""}function Zc(t,e){return It(mo,function(n){var s="_."+n[0];e&n[1]&&!Wn(t,s)&&t.push(s)}),t.sort()}function ou(t){if(t instanceof z)return t.clone();var e=new Ot(t.__wrapped__,t.__chain__);return e.__actions__=vt(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function Jc(t,e,n){(n?pt(t,e,n):e===r)?e=1:e=at(B(e),0);var s=t==null?0:t.length;if(!s||e<1)return[];for(var a=0,l=0,d=y(Jn(s/e));a<s;)d[l++]=Pt(t,a,a+=e);return d}function Xc(t){for(var e=-1,n=t==null?0:t.length,s=0,a=[];++e<n;){var l=t[e];l&&(a[s++]=l)}return a}function Qc(){var t=arguments.length;if(!t)return[];for(var e=y(t-1),n=arguments[0],s=t;s--;)e[s-1]=arguments[s];return ge(F(n)?vt(n):[n],ft(e,1))}var Vc=$(function(t,e){return rt(t)?pn(t,ft(e,1,rt,!0)):[]}),jc=$(function(t,e){var n=Ut(e);return rt(n)&&(n=r),rt(t)?pn(t,ft(e,1,rt,!0),T(n,2)):[]}),th=$(function(t,e){var n=Ut(e);return rt(n)&&(n=r),rt(t)?pn(t,ft(e,1,rt,!0),r,n):[]});function eh(t,e,n){var s=t==null?0:t.length;return s?(e=n||e===r?1:B(e),Pt(t,e<0?0:e,s)):[]}function nh(t,e,n){var s=t==null?0:t.length;return s?(e=n||e===r?1:B(e),e=s-e,Pt(t,0,e<0?0:e)):[]}function rh(t,e){return t&&t.length?sr(t,T(e,3),!0,!0):[]}function ih(t,e){return t&&t.length?sr(t,T(e,3),!0):[]}function sh(t,e,n,s){var a=t==null?0:t.length;return a?(n&&typeof n!="number"&&pt(t,e,n)&&(n=0,s=a),Qf(t,e,n,s)):[]}function lu(t,e,n){var s=t==null?0:t.length;if(!s)return-1;var a=n==null?0:B(n);return a<0&&(a=at(s+a,0)),Fn(t,T(e,3),a)}function fu(t,e,n){var s=t==null?0:t.length;if(!s)return-1;var a=s-1;return n!==r&&(a=B(n),a=n<0?at(s+a,0):ht(a,s-1)),Fn(t,T(e,3),a,!0)}function cu(t){var e=t==null?0:t.length;return e?ft(t,1):[]}function ah(t){var e=t==null?0:t.length;return e?ft(t,xe):[]}function uh(t,e){var n=t==null?0:t.length;return n?(e=e===r?1:B(e),ft(t,e)):[]}function oh(t){for(var e=-1,n=t==null?0:t.length,s={};++e<n;){var a=t[e];s[a[0]]=a[1]}return s}function hu(t){return t&&t.length?t[0]:r}function lh(t,e,n){var s=t==null?0:t.length;if(!s)return-1;var a=n==null?0:B(n);return a<0&&(a=at(s+a,0)),We(t,e,a)}function fh(t){var e=t==null?0:t.length;return e?Pt(t,0,-1):[]}var ch=$(function(t){var e=j(t,xi);return e.length&&e[0]===t[0]?di(e):[]}),hh=$(function(t){var e=Ut(t),n=j(t,xi);return e===Ut(n)?e=r:n.pop(),n.length&&n[0]===t[0]?di(n,T(e,2)):[]}),dh=$(function(t){var e=Ut(t),n=j(t,xi);return e=typeof e=="function"?e:r,e&&n.pop(),n.length&&n[0]===t[0]?di(n,r,e):[]});function gh(t,e){return t==null?"":ff.call(t,e)}function Ut(t){var e=t==null?0:t.length;return e?t[e-1]:r}function ph(t,e,n){var s=t==null?0:t.length;if(!s)return-1;var a=s;return n!==r&&(a=B(n),a=a<0?at(s+a,0):ht(a,s-1)),e===e?Yl(t,e,a):Fn(t,Ks,a,!0)}function _h(t,e){return t&&t.length?xa(t,B(e)):r}var wh=$(du);function du(t,e){return t&&t.length&&e&&e.length?wi(t,e):t}function vh(t,e,n){return t&&t.length&&e&&e.length?wi(t,e,T(n,2)):t}function yh(t,e,n){return t&&t.length&&e&&e.length?wi(t,e,r,n):t}var mh=ue(function(t,e){var n=t==null?0:t.length,s=li(t,e);return La(t,j(e,function(a){return oe(a,n)?+a:a}).sort(Na)),s});function Sh(t,e){var n=[];if(!(t&&t.length))return n;var s=-1,a=[],l=t.length;for(e=T(e,3);++s<l;){var d=t[s];e(d,s,t)&&(n.push(d),a.push(s))}return La(t,a),n}function Wi(t){return t==null?t:gf.call(t)}function Ch(t,e,n){var s=t==null?0:t.length;return s?(n&&typeof n!="number"&&pt(t,e,n)?(e=0,n=s):(e=e==null?0:B(e),n=n===r?s:B(n)),Pt(t,e,n)):[]}function xh(t,e){return ir(t,e)}function Dh(t,e,n){return mi(t,e,T(n,2))}function Rh(t,e){var n=t==null?0:t.length;if(n){var s=ir(t,e);if(s<n&&Ht(t[s],e))return s}return-1}function Lh(t,e){return ir(t,e,!0)}function Ah(t,e,n){return mi(t,e,T(n,2),!0)}function bh(t,e){var n=t==null?0:t.length;if(n){var s=ir(t,e,!0)-1;if(Ht(t[s],e))return s}return-1}function Eh(t){return t&&t.length?ba(t):[]}function Ih(t,e){return t&&t.length?ba(t,T(e,2)):[]}function Th(t){var e=t==null?0:t.length;return e?Pt(t,1,e):[]}function Oh(t,e,n){return t&&t.length?(e=n||e===r?1:B(e),Pt(t,0,e<0?0:e)):[]}function Mh(t,e,n){var s=t==null?0:t.length;return s?(e=n||e===r?1:B(e),e=s-e,Pt(t,e<0?0:e,s)):[]}function Ph(t,e){return t&&t.length?sr(t,T(e,3),!1,!0):[]}function Uh(t,e){return t&&t.length?sr(t,T(e,3)):[]}var Nh=$(function(t){return ve(ft(t,1,rt,!0))}),Wh=$(function(t){var e=Ut(t);return rt(e)&&(e=r),ve(ft(t,1,rt,!0),T(e,2))}),Fh=$(function(t){var e=Ut(t);return e=typeof e=="function"?e:r,ve(ft(t,1,rt,!0),r,e)});function Gh(t){return t&&t.length?ve(t):[]}function Bh(t,e){return t&&t.length?ve(t,T(e,2)):[]}function kh(t,e){return e=typeof e=="function"?e:r,t&&t.length?ve(t,r,e):[]}function Fi(t){if(!(t&&t.length))return[];var e=0;return t=de(t,function(n){if(rt(n))return e=at(n.length,e),!0}),ei(e,function(n){return j(t,Vr(n))})}function gu(t,e){if(!(t&&t.length))return[];var n=Fi(t);return e==null?n:j(n,function(s){return Ct(e,r,s)})}var $h=$(function(t,e){return rt(t)?pn(t,e):[]}),Hh=$(function(t){return Ci(de(t,rt))}),zh=$(function(t){var e=Ut(t);return rt(e)&&(e=r),Ci(de(t,rt),T(e,2))}),qh=$(function(t){var e=Ut(t);return e=typeof e=="function"?e:r,Ci(de(t,rt),r,e)}),Kh=$(Fi);function Yh(t,e){return Oa(t||[],e||[],gn)}function Zh(t,e){return Oa(t||[],e||[],vn)}var Jh=$(function(t){var e=t.length,n=e>1?t[e-1]:r;return n=typeof n=="function"?(t.pop(),n):r,gu(t,n)});function pu(t){var e=o(t);return e.__chain__=!0,e}function Xh(t,e){return e(t),t}function gr(t,e){return e(t)}var Qh=ue(function(t){var e=t.length,n=e?t[0]:0,s=this.__wrapped__,a=function(l){return li(l,t)};return e>1||this.__actions__.length||!(s instanceof z)||!oe(n)?this.thru(a):(s=s.slice(n,+n+(e?1:0)),s.__actions__.push({func:gr,args:[a],thisArg:r}),new Ot(s,this.__chain__).thru(function(l){return e&&!l.length&&l.push(r),l}))});function Vh(){return pu(this)}function jh(){return new Ot(this.value(),this.__chain__)}function td(){this.__values__===r&&(this.__values__=Eu(this.value()));var t=this.__index__>=this.__values__.length,e=t?r:this.__values__[this.__index__++];return{done:t,value:e}}function ed(){return this}function nd(t){for(var e,n=this;n instanceof jn;){var s=ou(n);s.__index__=0,s.__values__=r,e?a.__wrapped__=s:e=s;var a=s;n=n.__wrapped__}return a.__wrapped__=t,e}function rd(){var t=this.__wrapped__;if(t instanceof z){var e=t;return this.__actions__.length&&(e=new z(this)),e=e.reverse(),e.__actions__.push({func:gr,args:[Wi],thisArg:r}),new Ot(e,this.__chain__)}return this.thru(Wi)}function id(){return Ta(this.__wrapped__,this.__actions__)}var sd=ar(function(t,e,n){Z.call(t,n)?++t[n]:se(t,n,1)});function ad(t,e,n){var s=F(t)?zs:Xf;return n&&pt(t,e,n)&&(e=r),s(t,T(e,3))}function ud(t,e){var n=F(t)?de:ga;return n(t,T(e,3))}var od=$a(lu),ld=$a(fu);function fd(t,e){return ft(pr(t,e),1)}function cd(t,e){return ft(pr(t,e),xe)}function hd(t,e,n){return n=n===r?1:B(n),ft(pr(t,e),n)}function _u(t,e){var n=F(t)?It:we;return n(t,T(e,3))}function wu(t,e){var n=F(t)?Il:da;return n(t,T(e,3))}var dd=ar(function(t,e,n){Z.call(t,n)?t[n].push(e):se(t,n,[e])});function gd(t,e,n,s){t=yt(t)?t:Je(t),n=n&&!s?B(n):0;var a=t.length;return n<0&&(n=at(a+n,0)),mr(t)?n<=a&&t.indexOf(e,n)>-1:!!a&&We(t,e,n)>-1}var pd=$(function(t,e,n){var s=-1,a=typeof e=="function",l=yt(t)?y(t.length):[];return we(t,function(d){l[++s]=a?Ct(e,d,n):_n(d,e,n)}),l}),_d=ar(function(t,e,n){se(t,n,e)});function pr(t,e){var n=F(t)?j:ma;return n(t,T(e,3))}function wd(t,e,n,s){return t==null?[]:(F(e)||(e=e==null?[]:[e]),n=s?r:n,F(n)||(n=n==null?[]:[n]),Da(t,e,n))}var vd=ar(function(t,e,n){t[n?0:1].push(e)},function(){return[[],[]]});function yd(t,e,n){var s=F(t)?Xr:Zs,a=arguments.length<3;return s(t,T(e,4),n,a,we)}function md(t,e,n){var s=F(t)?Tl:Zs,a=arguments.length<3;return s(t,T(e,4),n,a,da)}function Sd(t,e){var n=F(t)?de:ga;return n(t,vr(T(e,3)))}function Cd(t){var e=F(t)?la:gc;return e(t)}function xd(t,e,n){(n?pt(t,e,n):e===r)?e=1:e=B(e);var s=F(t)?qf:pc;return s(t,e)}function Dd(t){var e=F(t)?Kf:wc;return e(t)}function Rd(t){if(t==null)return 0;if(yt(t))return mr(t)?Ge(t):t.length;var e=dt(t);return e==Gt||e==Bt?t.size:pi(t).length}function Ld(t,e,n){var s=F(t)?Qr:vc;return n&&pt(t,e,n)&&(e=r),s(t,T(e,3))}var Ad=$(function(t,e){if(t==null)return[];var n=e.length;return n>1&&pt(t,e[0],e[1])?e=[]:n>2&&pt(e[0],e[1],e[2])&&(e=[e[0]]),Da(t,ft(e,1),[])}),_r=uf||function(){return lt.Date.now()};function bd(t,e){if(typeof e!="function")throw new Tt(g);return t=B(t),function(){if(--t<1)return e.apply(this,arguments)}}function vu(t,e,n){return e=n?r:e,e=t&&e==null?t.length:e,ae(t,ee,r,r,r,r,e)}function yu(t,e){var n;if(typeof e!="function")throw new Tt(g);return t=B(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=r),n}}var Gi=$(function(t,e,n){var s=Ft;if(n.length){var a=pe(n,Ye(Gi));s|=te}return ae(t,s,e,n,a)}),mu=$(function(t,e,n){var s=Ft|Me;if(n.length){var a=pe(n,Ye(mu));s|=te}return ae(e,s,t,n,a)});function Su(t,e,n){e=n?r:e;var s=ae(t,jt,r,r,r,r,r,e);return s.placeholder=Su.placeholder,s}function Cu(t,e,n){e=n?r:e;var s=ae(t,Qe,r,r,r,r,r,e);return s.placeholder=Cu.placeholder,s}function xu(t,e,n){var s,a,l,d,p,w,S=0,C=!1,x=!1,L=!0;if(typeof t!="function")throw new Tt(g);e=Nt(e)||0,tt(n)&&(C=!!n.leading,x="maxWait"in n,l=x?at(Nt(n.maxWait)||0,e):l,L="trailing"in n?!!n.trailing:L);function E(it){var zt=s,ce=a;return s=a=r,S=it,d=t.apply(ce,zt),d}function O(it){return S=it,p=Sn(H,e),C?E(it):d}function k(it){var zt=it-w,ce=it-S,$u=e-zt;return x?ht($u,l-ce):$u}function M(it){var zt=it-w,ce=it-S;return w===r||zt>=e||zt<0||x&&ce>=l}function H(){var it=_r();if(M(it))return q(it);p=Sn(H,k(it))}function q(it){return p=r,L&&s?E(it):(s=a=r,d)}function Lt(){p!==r&&Ma(p),S=0,s=w=a=p=r}function _t(){return p===r?d:q(_r())}function At(){var it=_r(),zt=M(it);if(s=arguments,a=this,w=it,zt){if(p===r)return O(w);if(x)return Ma(p),p=Sn(H,e),E(w)}return p===r&&(p=Sn(H,e)),d}return At.cancel=Lt,At.flush=_t,At}var Ed=$(function(t,e){return ha(t,1,e)}),Id=$(function(t,e,n){return ha(t,Nt(e)||0,n)});function Td(t){return ae(t,Ir)}function wr(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new Tt(g);var n=function(){var s=arguments,a=e?e.apply(this,s):s[0],l=n.cache;if(l.has(a))return l.get(a);var d=t.apply(this,s);return n.cache=l.set(a,d)||l,d};return n.cache=new(wr.Cache||ie),n}wr.Cache=ie;function vr(t){if(typeof t!="function")throw new Tt(g);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function Od(t){return yu(2,t)}var Md=yc(function(t,e){e=e.length==1&&F(e[0])?j(e[0],xt(T())):j(ft(e,1),xt(T()));var n=e.length;return $(function(s){for(var a=-1,l=ht(s.length,n);++a<l;)s[a]=e[a].call(this,s[a]);return Ct(t,this,s)})}),Bi=$(function(t,e){var n=pe(e,Ye(Bi));return ae(t,te,r,e,n)}),Du=$(function(t,e){var n=pe(e,Ye(Du));return ae(t,Ve,r,e,n)}),Pd=ue(function(t,e){return ae(t,je,r,r,r,e)});function Ud(t,e){if(typeof t!="function")throw new Tt(g);return e=e===r?e:B(e),$(t,e)}function Nd(t,e){if(typeof t!="function")throw new Tt(g);return e=e==null?0:at(B(e),0),$(function(n){var s=n[e],a=me(n,0,e);return s&&ge(a,s),Ct(t,this,a)})}function Wd(t,e,n){var s=!0,a=!0;if(typeof t!="function")throw new Tt(g);return tt(n)&&(s="leading"in n?!!n.leading:s,a="trailing"in n?!!n.trailing:a),xu(t,e,{leading:s,maxWait:e,trailing:a})}function Fd(t){return vu(t,1)}function Gd(t,e){return Bi(Di(e),t)}function Bd(){if(!arguments.length)return[];var t=arguments[0];return F(t)?t:[t]}function kd(t){return Mt(t,V)}function $d(t,e){return e=typeof e=="function"?e:r,Mt(t,V,e)}function Hd(t){return Mt(t,N|V)}function zd(t,e){return e=typeof e=="function"?e:r,Mt(t,N|V,e)}function qd(t,e){return e==null||ca(t,e,ot(e))}function Ht(t,e){return t===e||t!==t&&e!==e}var Kd=fr(hi),Yd=fr(function(t,e){return t>=e}),Oe=wa(function(){return arguments}())?wa:function(t){return et(t)&&Z.call(t,"callee")&&!ra.call(t,"callee")},F=y.isArray,Zd=Fs?xt(Fs):nc;function yt(t){return t!=null&&yr(t.length)&&!le(t)}function rt(t){return et(t)&&yt(t)}function Jd(t){return t===!0||t===!1||et(t)&&gt(t)==tn}var Se=lf||Qi,Xd=Gs?xt(Gs):rc;function Qd(t){return et(t)&&t.nodeType===1&&!Cn(t)}function Vd(t){if(t==null)return!0;if(yt(t)&&(F(t)||typeof t=="string"||typeof t.splice=="function"||Se(t)||Ze(t)||Oe(t)))return!t.length;var e=dt(t);if(e==Gt||e==Bt)return!t.size;if(mn(t))return!pi(t).length;for(var n in t)if(Z.call(t,n))return!1;return!0}function jd(t,e){return wn(t,e)}function tg(t,e,n){n=typeof n=="function"?n:r;var s=n?n(t,e):r;return s===r?wn(t,e,r,n):!!s}function ki(t){if(!et(t))return!1;var e=gt(t);return e==Tn||e==Co||typeof t.message=="string"&&typeof t.name=="string"&&!Cn(t)}function eg(t){return typeof t=="number"&&sa(t)}function le(t){if(!tt(t))return!1;var e=gt(t);return e==On||e==hs||e==So||e==Do}function Ru(t){return typeof t=="number"&&t==B(t)}function yr(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=he}function tt(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function et(t){return t!=null&&typeof t=="object"}var Lu=Bs?xt(Bs):sc;function ng(t,e){return t===e||gi(t,e,Ti(e))}function rg(t,e,n){return n=typeof n=="function"?n:r,gi(t,e,Ti(e),n)}function ig(t){return Au(t)&&t!=+t}function sg(t){if($c(t))throw new W(c);return va(t)}function ag(t){return t===null}function ug(t){return t==null}function Au(t){return typeof t=="number"||et(t)&&gt(t)==nn}function Cn(t){if(!et(t)||gt(t)!=ne)return!1;var e=Kn(t);if(e===null)return!0;var n=Z.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&$n.call(n)==nf}var $i=ks?xt(ks):ac;function og(t){return Ru(t)&&t>=-he&&t<=he}var bu=$s?xt($s):uc;function mr(t){return typeof t=="string"||!F(t)&&et(t)&&gt(t)==sn}function Rt(t){return typeof t=="symbol"||et(t)&&gt(t)==Mn}var Ze=Hs?xt(Hs):oc;function lg(t){return t===r}function fg(t){return et(t)&&dt(t)==an}function cg(t){return et(t)&&gt(t)==Lo}var hg=fr(_i),dg=fr(function(t,e){return t<=e});function Eu(t){if(!t)return[];if(yt(t))return mr(t)?kt(t):vt(t);if(ln&&t[ln])return zl(t[ln]());var e=dt(t),n=e==Gt?ri:e==Bt?Gn:Je;return n(t)}function fe(t){if(!t)return t===0?t:0;if(t=Nt(t),t===xe||t===-xe){var e=t<0?-1:1;return e*wo}return t===t?t:0}function B(t){var e=fe(t),n=e%1;return e===e?n?e-n:e:0}function Iu(t){return t?be(B(t),0,Jt):0}function Nt(t){if(typeof t=="number")return t;if(Rt(t))return En;if(tt(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=tt(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Js(t);var n=Yo.test(t);return n||Jo.test(t)?Al(t.slice(2),n?2:8):Ko.test(t)?En:+t}function Tu(t){return Qt(t,mt(t))}function gg(t){return t?be(B(t),-he,he):t===0?t:0}function Y(t){return t==null?"":Dt(t)}var pg=qe(function(t,e){if(mn(e)||yt(e)){Qt(e,ot(e),t);return}for(var n in e)Z.call(e,n)&&gn(t,n,e[n])}),Ou=qe(function(t,e){Qt(e,mt(e),t)}),Sr=qe(function(t,e,n,s){Qt(e,mt(e),t,s)}),_g=qe(function(t,e,n,s){Qt(e,ot(e),t,s)}),wg=ue(li);function vg(t,e){var n=ze(t);return e==null?n:fa(n,e)}var yg=$(function(t,e){t=J(t);var n=-1,s=e.length,a=s>2?e[2]:r;for(a&&pt(e[0],e[1],a)&&(s=1);++n<s;)for(var l=e[n],d=mt(l),p=-1,w=d.length;++p<w;){var S=d[p],C=t[S];(C===r||Ht(C,ke[S])&&!Z.call(t,S))&&(t[S]=l[S])}return t}),mg=$(function(t){return t.push(r,Ja),Ct(Mu,r,t)});function Sg(t,e){return qs(t,T(e,3),Xt)}function Cg(t,e){return qs(t,T(e,3),ci)}function xg(t,e){return t==null?t:fi(t,T(e,3),mt)}function Dg(t,e){return t==null?t:pa(t,T(e,3),mt)}function Rg(t,e){return t&&Xt(t,T(e,3))}function Lg(t,e){return t&&ci(t,T(e,3))}function Ag(t){return t==null?[]:nr(t,ot(t))}function bg(t){return t==null?[]:nr(t,mt(t))}function Hi(t,e,n){var s=t==null?r:Ee(t,e);return s===r?n:s}function Eg(t,e){return t!=null&&Va(t,e,Vf)}function zi(t,e){return t!=null&&Va(t,e,jf)}var Ig=za(function(t,e,n){e!=null&&typeof e.toString!="function"&&(e=Hn.call(e)),t[e]=n},Ki(St)),Tg=za(function(t,e,n){e!=null&&typeof e.toString!="function"&&(e=Hn.call(e)),Z.call(t,e)?t[e].push(n):t[e]=[n]},T),Og=$(_n);function ot(t){return yt(t)?oa(t):pi(t)}function mt(t){return yt(t)?oa(t,!0):lc(t)}function Mg(t,e){var n={};return e=T(e,3),Xt(t,function(s,a,l){se(n,e(s,a,l),s)}),n}function Pg(t,e){var n={};return e=T(e,3),Xt(t,function(s,a,l){se(n,a,e(s,a,l))}),n}var Ug=qe(function(t,e,n){rr(t,e,n)}),Mu=qe(function(t,e,n,s){rr(t,e,n,s)}),Ng=ue(function(t,e){var n={};if(t==null)return n;var s=!1;e=j(e,function(l){return l=ye(l,t),s||(s=l.length>1),l}),Qt(t,Ei(t),n),s&&(n=Mt(n,N|ut|V,Ic));for(var a=e.length;a--;)Si(n,e[a]);return n});function Wg(t,e){return Pu(t,vr(T(e)))}var Fg=ue(function(t,e){return t==null?{}:cc(t,e)});function Pu(t,e){if(t==null)return{};var n=j(Ei(t),function(s){return[s]});return e=T(e),Ra(t,n,function(s,a){return e(s,a[0])})}function Gg(t,e,n){e=ye(e,t);var s=-1,a=e.length;for(a||(a=1,t=r);++s<a;){var l=t==null?r:t[Vt(e[s])];l===r&&(s=a,l=n),t=le(l)?l.call(t):l}return t}function Bg(t,e,n){return t==null?t:vn(t,e,n)}function kg(t,e,n,s){return s=typeof s=="function"?s:r,t==null?t:vn(t,e,n,s)}var Uu=Ya(ot),Nu=Ya(mt);function $g(t,e,n){var s=F(t),a=s||Se(t)||Ze(t);if(e=T(e,4),n==null){var l=t&&t.constructor;a?n=s?new l:[]:tt(t)?n=le(l)?ze(Kn(t)):{}:n={}}return(a?It:Xt)(t,function(d,p,w){return e(n,d,p,w)}),n}function Hg(t,e){return t==null?!0:Si(t,e)}function zg(t,e,n){return t==null?t:Ia(t,e,Di(n))}function qg(t,e,n,s){return s=typeof s=="function"?s:r,t==null?t:Ia(t,e,Di(n),s)}function Je(t){return t==null?[]:ni(t,ot(t))}function Kg(t){return t==null?[]:ni(t,mt(t))}function Yg(t,e,n){return n===r&&(n=e,e=r),n!==r&&(n=Nt(n),n=n===n?n:0),e!==r&&(e=Nt(e),e=e===e?e:0),be(Nt(t),e,n)}function Zg(t,e,n){return e=fe(e),n===r?(n=e,e=0):n=fe(n),t=Nt(t),tc(t,e,n)}function Jg(t,e,n){if(n&&typeof n!="boolean"&&pt(t,e,n)&&(e=n=r),n===r&&(typeof e=="boolean"?(n=e,e=r):typeof t=="boolean"&&(n=t,t=r)),t===r&&e===r?(t=0,e=1):(t=fe(t),e===r?(e=t,t=0):e=fe(e)),t>e){var s=t;t=e,e=s}if(n||t%1||e%1){var a=aa();return ht(t+a*(e-t+Ll("1e-"+((a+"").length-1))),e)}return vi(t,e)}var Xg=Ke(function(t,e,n){return e=e.toLowerCase(),t+(n?Wu(e):e)});function Wu(t){return qi(Y(t).toLowerCase())}function Fu(t){return t=Y(t),t&&t.replace(Qo,Gl).replace(_l,"")}function Qg(t,e,n){t=Y(t),e=Dt(e);var s=t.length;n=n===r?s:be(B(n),0,s);var a=n;return n-=e.length,n>=0&&t.slice(n,a)==e}function Vg(t){return t=Y(t),t&&To.test(t)?t.replace(ps,Bl):t}function jg(t){return t=Y(t),t&&Wo.test(t)?t.replace(Br,"\\$&"):t}var tp=Ke(function(t,e,n){return t+(n?"-":"")+e.toLowerCase()}),ep=Ke(function(t,e,n){return t+(n?" ":"")+e.toLowerCase()}),np=ka("toLowerCase");function rp(t,e,n){t=Y(t),e=B(e);var s=e?Ge(t):0;if(!e||s>=e)return t;var a=(e-s)/2;return lr(Xn(a),n)+t+lr(Jn(a),n)}function ip(t,e,n){t=Y(t),e=B(e);var s=e?Ge(t):0;return e&&s<e?t+lr(e-s,n):t}function sp(t,e,n){t=Y(t),e=B(e);var s=e?Ge(t):0;return e&&s<e?lr(e-s,n)+t:t}function ap(t,e,n){return n||e==null?e=0:e&&(e=+e),df(Y(t).replace(kr,""),e||0)}function up(t,e,n){return(n?pt(t,e,n):e===r)?e=1:e=B(e),yi(Y(t),e)}function op(){var t=arguments,e=Y(t[0]);return t.length<3?e:e.replace(t[1],t[2])}var lp=Ke(function(t,e,n){return t+(n?"_":"")+e.toLowerCase()});function fp(t,e,n){return n&&typeof n!="number"&&pt(t,e,n)&&(e=n=r),n=n===r?Jt:n>>>0,n?(t=Y(t),t&&(typeof e=="string"||e!=null&&!$i(e))&&(e=Dt(e),!e&&Fe(t))?me(kt(t),0,n):t.split(e,n)):[]}var cp=Ke(function(t,e,n){return t+(n?" ":"")+qi(e)});function hp(t,e,n){return t=Y(t),n=n==null?0:be(B(n),0,t.length),e=Dt(e),t.slice(n,n+e.length)==e}function dp(t,e,n){var s=o.templateSettings;n&&pt(t,e,n)&&(e=r),t=Y(t),e=Sr({},e,s,Za);var a=Sr({},e.imports,s.imports,Za),l=ot(a),d=ni(a,l),p,w,S=0,C=e.interpolate||Pn,x="__p += '",L=ii((e.escape||Pn).source+"|"+C.source+"|"+(C===_s?qo:Pn).source+"|"+(e.evaluate||Pn).source+"|$","g"),E="//# sourceURL="+(Z.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Sl+"]")+`
`;t.replace(L,function(M,H,q,Lt,_t,At){return q||(q=Lt),x+=t.slice(S,At).replace(Vo,kl),H&&(p=!0,x+=`' +
__e(`+H+`) +
'`),_t&&(w=!0,x+=`';
`+_t+`;
__p += '`),q&&(x+=`' +
((__t = (`+q+`)) == null ? '' : __t) +
'`),S=At+M.length,M}),x+=`';
`;var O=Z.call(e,"variable")&&e.variable;if(!O)x=`with (obj) {
`+x+`
}
`;else if(Ho.test(O))throw new W(v);x=(w?x.replace(Ao,""):x).replace(bo,"$1").replace(Eo,"$1;"),x="function("+(O||"obj")+`) {
`+(O?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(p?", __e = _.escape":"")+(w?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+x+`return __p
}`;var k=Bu(function(){return K(l,E+"return "+x).apply(r,d)});if(k.source=x,ki(k))throw k;return k}function gp(t){return Y(t).toLowerCase()}function pp(t){return Y(t).toUpperCase()}function _p(t,e,n){if(t=Y(t),t&&(n||e===r))return Js(t);if(!t||!(e=Dt(e)))return t;var s=kt(t),a=kt(e),l=Xs(s,a),d=Qs(s,a)+1;return me(s,l,d).join("")}function wp(t,e,n){if(t=Y(t),t&&(n||e===r))return t.slice(0,js(t)+1);if(!t||!(e=Dt(e)))return t;var s=kt(t),a=Qs(s,kt(e))+1;return me(s,0,a).join("")}function vp(t,e,n){if(t=Y(t),t&&(n||e===r))return t.replace(kr,"");if(!t||!(e=Dt(e)))return t;var s=kt(t),a=Xs(s,kt(e));return me(s,a).join("")}function yp(t,e){var n=fo,s=co;if(tt(e)){var a="separator"in e?e.separator:a;n="length"in e?B(e.length):n,s="omission"in e?Dt(e.omission):s}t=Y(t);var l=t.length;if(Fe(t)){var d=kt(t);l=d.length}if(n>=l)return t;var p=n-Ge(s);if(p<1)return s;var w=d?me(d,0,p).join(""):t.slice(0,p);if(a===r)return w+s;if(d&&(p+=w.length-p),$i(a)){if(t.slice(p).search(a)){var S,C=w;for(a.global||(a=ii(a.source,Y(ws.exec(a))+"g")),a.lastIndex=0;S=a.exec(C);)var x=S.index;w=w.slice(0,x===r?p:x)}}else if(t.indexOf(Dt(a),p)!=p){var L=w.lastIndexOf(a);L>-1&&(w=w.slice(0,L))}return w+s}function mp(t){return t=Y(t),t&&Io.test(t)?t.replace(gs,Zl):t}var Sp=Ke(function(t,e,n){return t+(n?" ":"")+e.toUpperCase()}),qi=ka("toUpperCase");function Gu(t,e,n){return t=Y(t),e=n?r:e,e===r?Hl(t)?Ql(t):Pl(t):t.match(e)||[]}var Bu=$(function(t,e){try{return Ct(t,r,e)}catch(n){return ki(n)?n:new W(n)}}),Cp=ue(function(t,e){return It(e,function(n){n=Vt(n),se(t,n,Gi(t[n],t))}),t});function xp(t){var e=t==null?0:t.length,n=T();return t=e?j(t,function(s){if(typeof s[1]!="function")throw new Tt(g);return[n(s[0]),s[1]]}):[],$(function(s){for(var a=-1;++a<e;){var l=t[a];if(Ct(l[0],this,s))return Ct(l[1],this,s)}})}function Dp(t){return Jf(Mt(t,N))}function Ki(t){return function(){return t}}function Rp(t,e){return t==null||t!==t?e:t}var Lp=Ha(),Ap=Ha(!0);function St(t){return t}function Yi(t){return ya(typeof t=="function"?t:Mt(t,N))}function bp(t){return Sa(Mt(t,N))}function Ep(t,e){return Ca(t,Mt(e,N))}var Ip=$(function(t,e){return function(n){return _n(n,t,e)}}),Tp=$(function(t,e){return function(n){return _n(t,n,e)}});function Zi(t,e,n){var s=ot(e),a=nr(e,s);n==null&&!(tt(e)&&(a.length||!s.length))&&(n=e,e=t,t=this,a=nr(e,ot(e)));var l=!(tt(n)&&"chain"in n)||!!n.chain,d=le(t);return It(a,function(p){var w=e[p];t[p]=w,d&&(t.prototype[p]=function(){var S=this.__chain__;if(l||S){var C=t(this.__wrapped__),x=C.__actions__=vt(this.__actions__);return x.push({func:w,args:arguments,thisArg:t}),C.__chain__=S,C}return w.apply(t,ge([this.value()],arguments))})}),t}function Op(){return lt._===this&&(lt._=rf),this}function Ji(){}function Mp(t){return t=B(t),$(function(e){return xa(e,t)})}var Pp=Li(j),Up=Li(zs),Np=Li(Qr);function ku(t){return Mi(t)?Vr(Vt(t)):hc(t)}function Wp(t){return function(e){return t==null?r:Ee(t,e)}}var Fp=qa(),Gp=qa(!0);function Xi(){return[]}function Qi(){return!1}function Bp(){return{}}function kp(){return""}function $p(){return!0}function Hp(t,e){if(t=B(t),t<1||t>he)return[];var n=Jt,s=ht(t,Jt);e=T(e),t-=Jt;for(var a=ei(s,e);++n<t;)e(n);return a}function zp(t){return F(t)?j(t,Vt):Rt(t)?[t]:vt(uu(Y(t)))}function qp(t){var e=++ef;return Y(t)+e}var Kp=or(function(t,e){return t+e},0),Yp=Ai("ceil"),Zp=or(function(t,e){return t/e},1),Jp=Ai("floor");function Xp(t){return t&&t.length?er(t,St,hi):r}function Qp(t,e){return t&&t.length?er(t,T(e,2),hi):r}function Vp(t){return Ys(t,St)}function jp(t,e){return Ys(t,T(e,2))}function t_(t){return t&&t.length?er(t,St,_i):r}function e_(t,e){return t&&t.length?er(t,T(e,2),_i):r}var n_=or(function(t,e){return t*e},1),r_=Ai("round"),i_=or(function(t,e){return t-e},0);function s_(t){return t&&t.length?ti(t,St):0}function a_(t,e){return t&&t.length?ti(t,T(e,2)):0}return o.after=bd,o.ary=vu,o.assign=pg,o.assignIn=Ou,o.assignInWith=Sr,o.assignWith=_g,o.at=wg,o.before=yu,o.bind=Gi,o.bindAll=Cp,o.bindKey=mu,o.castArray=Bd,o.chain=pu,o.chunk=Jc,o.compact=Xc,o.concat=Qc,o.cond=xp,o.conforms=Dp,o.constant=Ki,o.countBy=sd,o.create=vg,o.curry=Su,o.curryRight=Cu,o.debounce=xu,o.defaults=yg,o.defaultsDeep=mg,o.defer=Ed,o.delay=Id,o.difference=Vc,o.differenceBy=jc,o.differenceWith=th,o.drop=eh,o.dropRight=nh,o.dropRightWhile=rh,o.dropWhile=ih,o.fill=sh,o.filter=ud,o.flatMap=fd,o.flatMapDeep=cd,o.flatMapDepth=hd,o.flatten=cu,o.flattenDeep=ah,o.flattenDepth=uh,o.flip=Td,o.flow=Lp,o.flowRight=Ap,o.fromPairs=oh,o.functions=Ag,o.functionsIn=bg,o.groupBy=dd,o.initial=fh,o.intersection=ch,o.intersectionBy=hh,o.intersectionWith=dh,o.invert=Ig,o.invertBy=Tg,o.invokeMap=pd,o.iteratee=Yi,o.keyBy=_d,o.keys=ot,o.keysIn=mt,o.map=pr,o.mapKeys=Mg,o.mapValues=Pg,o.matches=bp,o.matchesProperty=Ep,o.memoize=wr,o.merge=Ug,o.mergeWith=Mu,o.method=Ip,o.methodOf=Tp,o.mixin=Zi,o.negate=vr,o.nthArg=Mp,o.omit=Ng,o.omitBy=Wg,o.once=Od,o.orderBy=wd,o.over=Pp,o.overArgs=Md,o.overEvery=Up,o.overSome=Np,o.partial=Bi,o.partialRight=Du,o.partition=vd,o.pick=Fg,o.pickBy=Pu,o.property=ku,o.propertyOf=Wp,o.pull=wh,o.pullAll=du,o.pullAllBy=vh,o.pullAllWith=yh,o.pullAt=mh,o.range=Fp,o.rangeRight=Gp,o.rearg=Pd,o.reject=Sd,o.remove=Sh,o.rest=Ud,o.reverse=Wi,o.sampleSize=xd,o.set=Bg,o.setWith=kg,o.shuffle=Dd,o.slice=Ch,o.sortBy=Ad,o.sortedUniq=Eh,o.sortedUniqBy=Ih,o.split=fp,o.spread=Nd,o.tail=Th,o.take=Oh,o.takeRight=Mh,o.takeRightWhile=Ph,o.takeWhile=Uh,o.tap=Xh,o.throttle=Wd,o.thru=gr,o.toArray=Eu,o.toPairs=Uu,o.toPairsIn=Nu,o.toPath=zp,o.toPlainObject=Tu,o.transform=$g,o.unary=Fd,o.union=Nh,o.unionBy=Wh,o.unionWith=Fh,o.uniq=Gh,o.uniqBy=Bh,o.uniqWith=kh,o.unset=Hg,o.unzip=Fi,o.unzipWith=gu,o.update=zg,o.updateWith=qg,o.values=Je,o.valuesIn=Kg,o.without=$h,o.words=Gu,o.wrap=Gd,o.xor=Hh,o.xorBy=zh,o.xorWith=qh,o.zip=Kh,o.zipObject=Yh,o.zipObjectDeep=Zh,o.zipWith=Jh,o.entries=Uu,o.entriesIn=Nu,o.extend=Ou,o.extendWith=Sr,Zi(o,o),o.add=Kp,o.attempt=Bu,o.camelCase=Xg,o.capitalize=Wu,o.ceil=Yp,o.clamp=Yg,o.clone=kd,o.cloneDeep=Hd,o.cloneDeepWith=zd,o.cloneWith=$d,o.conformsTo=qd,o.deburr=Fu,o.defaultTo=Rp,o.divide=Zp,o.endsWith=Qg,o.eq=Ht,o.escape=Vg,o.escapeRegExp=jg,o.every=ad,o.find=od,o.findIndex=lu,o.findKey=Sg,o.findLast=ld,o.findLastIndex=fu,o.findLastKey=Cg,o.floor=Jp,o.forEach=_u,o.forEachRight=wu,o.forIn=xg,o.forInRight=Dg,o.forOwn=Rg,o.forOwnRight=Lg,o.get=Hi,o.gt=Kd,o.gte=Yd,o.has=Eg,o.hasIn=zi,o.head=hu,o.identity=St,o.includes=gd,o.indexOf=lh,o.inRange=Zg,o.invoke=Og,o.isArguments=Oe,o.isArray=F,o.isArrayBuffer=Zd,o.isArrayLike=yt,o.isArrayLikeObject=rt,o.isBoolean=Jd,o.isBuffer=Se,o.isDate=Xd,o.isElement=Qd,o.isEmpty=Vd,o.isEqual=jd,o.isEqualWith=tg,o.isError=ki,o.isFinite=eg,o.isFunction=le,o.isInteger=Ru,o.isLength=yr,o.isMap=Lu,o.isMatch=ng,o.isMatchWith=rg,o.isNaN=ig,o.isNative=sg,o.isNil=ug,o.isNull=ag,o.isNumber=Au,o.isObject=tt,o.isObjectLike=et,o.isPlainObject=Cn,o.isRegExp=$i,o.isSafeInteger=og,o.isSet=bu,o.isString=mr,o.isSymbol=Rt,o.isTypedArray=Ze,o.isUndefined=lg,o.isWeakMap=fg,o.isWeakSet=cg,o.join=gh,o.kebabCase=tp,o.last=Ut,o.lastIndexOf=ph,o.lowerCase=ep,o.lowerFirst=np,o.lt=hg,o.lte=dg,o.max=Xp,o.maxBy=Qp,o.mean=Vp,o.meanBy=jp,o.min=t_,o.minBy=e_,o.stubArray=Xi,o.stubFalse=Qi,o.stubObject=Bp,o.stubString=kp,o.stubTrue=$p,o.multiply=n_,o.nth=_h,o.noConflict=Op,o.noop=Ji,o.now=_r,o.pad=rp,o.padEnd=ip,o.padStart=sp,o.parseInt=ap,o.random=Jg,o.reduce=yd,o.reduceRight=md,o.repeat=up,o.replace=op,o.result=Gg,o.round=r_,o.runInContext=_,o.sample=Cd,o.size=Rd,o.snakeCase=lp,o.some=Ld,o.sortedIndex=xh,o.sortedIndexBy=Dh,o.sortedIndexOf=Rh,o.sortedLastIndex=Lh,o.sortedLastIndexBy=Ah,o.sortedLastIndexOf=bh,o.startCase=cp,o.startsWith=hp,o.subtract=i_,o.sum=s_,o.sumBy=a_,o.template=dp,o.times=Hp,o.toFinite=fe,o.toInteger=B,o.toLength=Iu,o.toLower=gp,o.toNumber=Nt,o.toSafeInteger=gg,o.toString=Y,o.toUpper=pp,o.trim=_p,o.trimEnd=wp,o.trimStart=vp,o.truncate=yp,o.unescape=mp,o.uniqueId=qp,o.upperCase=Sp,o.upperFirst=qi,o.each=_u,o.eachRight=wu,o.first=hu,Zi(o,function(){var t={};return Xt(o,function(e,n){Z.call(o.prototype,n)||(t[n]=e)}),t}(),{chain:!1}),o.VERSION=u,It(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){o[t].placeholder=o}),It(["drop","take"],function(t,e){z.prototype[t]=function(n){n=n===r?1:at(B(n),0);var s=this.__filtered__&&!e?new z(this):this.clone();return s.__filtered__?s.__takeCount__=ht(n,s.__takeCount__):s.__views__.push({size:ht(n,Jt),type:t+(s.__dir__<0?"Right":"")}),s},z.prototype[t+"Right"]=function(n){return this.reverse()[t](n).reverse()}}),It(["filter","map","takeWhile"],function(t,e){var n=e+1,s=n==cs||n==_o;z.prototype[t]=function(a){var l=this.clone();return l.__iteratees__.push({iteratee:T(a,3),type:n}),l.__filtered__=l.__filtered__||s,l}}),It(["head","last"],function(t,e){var n="take"+(e?"Right":"");z.prototype[t]=function(){return this[n](1).value()[0]}}),It(["initial","tail"],function(t,e){var n="drop"+(e?"":"Right");z.prototype[t]=function(){return this.__filtered__?new z(this):this[n](1)}}),z.prototype.compact=function(){return this.filter(St)},z.prototype.find=function(t){return this.filter(t).head()},z.prototype.findLast=function(t){return this.reverse().find(t)},z.prototype.invokeMap=$(function(t,e){return typeof t=="function"?new z(this):this.map(function(n){return _n(n,t,e)})}),z.prototype.reject=function(t){return this.filter(vr(T(t)))},z.prototype.slice=function(t,e){t=B(t);var n=this;return n.__filtered__&&(t>0||e<0)?new z(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),e!==r&&(e=B(e),n=e<0?n.dropRight(-e):n.take(e-t)),n)},z.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},z.prototype.toArray=function(){return this.take(Jt)},Xt(z.prototype,function(t,e){var n=/^(?:filter|find|map|reject)|While$/.test(e),s=/^(?:head|last)$/.test(e),a=o[s?"take"+(e=="last"?"Right":""):e],l=s||/^find/.test(e);a&&(o.prototype[e]=function(){var d=this.__wrapped__,p=s?[1]:arguments,w=d instanceof z,S=p[0],C=w||F(d),x=function(H){var q=a.apply(o,ge([H],p));return s&&L?q[0]:q};C&&n&&typeof S=="function"&&S.length!=1&&(w=C=!1);var L=this.__chain__,E=!!this.__actions__.length,O=l&&!L,k=w&&!E;if(!l&&C){d=k?d:new z(this);var M=t.apply(d,p);return M.__actions__.push({func:gr,args:[x],thisArg:r}),new Ot(M,L)}return O&&k?t.apply(this,p):(M=this.thru(x),O?s?M.value()[0]:M.value():M)})}),It(["pop","push","shift","sort","splice","unshift"],function(t){var e=Bn[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",s=/^(?:pop|shift)$/.test(t);o.prototype[t]=function(){var a=arguments;if(s&&!this.__chain__){var l=this.value();return e.apply(F(l)?l:[],a)}return this[n](function(d){return e.apply(F(d)?d:[],a)})}}),Xt(z.prototype,function(t,e){var n=o[e];if(n){var s=n.name+"";Z.call(He,s)||(He[s]=[]),He[s].push({name:e,func:n})}}),He[ur(r,Me).name]=[{name:"wrapper",func:r}],z.prototype.clone=mf,z.prototype.reverse=Sf,z.prototype.value=Cf,o.prototype.at=Qh,o.prototype.chain=Vh,o.prototype.commit=jh,o.prototype.next=td,o.prototype.plant=nd,o.prototype.reverse=rd,o.prototype.toJSON=o.prototype.valueOf=o.prototype.value=id,o.prototype.first=o.prototype.head,ln&&(o.prototype[ln]=ed),o},Be=Vl();De?((De.exports=Be)._=Be,Yr._=Be):lt._=Be}).call(J_)}(Rn,Rn.exports)),Rn.exports}var Q_=X_();const Wt=Z_(Q_);class V_{async upload(i=[]){return new Promise(r=>{const u=document.createElement("input");u.type="file",i.length&&(u.accept=i.map(f=>`.${f}`).join(",")),u.onchange=async()=>{var v;const f=(v=u.files)==null?void 0:v[0];if(!f)return r(null);const c=f.type.startsWith("text/")||f.name.match(/\.(txt|json|csv|md)$/),g=c?await f.text():new Uint8Array(await f.arrayBuffer());r({data:g,filename:f.name,mimeType:f.type||(c?"text/plain":"application/octet-stream")})},u.click()})}async download({data:i,filename:r,mimeType:u}){const f=i instanceof Uint8Array?new Blob([i],{type:u}):new Blob([i],{type:u});if("showSaveFilePicker"in window){const v=r.includes(".")?r.slice(r.lastIndexOf(".")):"",A=await(await window.showSaveFilePicker({suggestedName:r,types:[{description:"File",accept:{[u]:[v]}}]})).createWritable();await A.write(f),await A.close();return}const c=URL.createObjectURL(f),g=document.createElement("a");g.href=c,g.download=r,g.click(),URL.revokeObjectURL(c)}}class j_{constructor(i){P(this,"reviewCardIdsOverride");P(this,"extraStudyLastCardId");this.app=i}init(){this.reviewCardIdsOverride=void 0}startExtraStudy(i,r){const u=encodeURIComponent(JSON.stringify(r));so(`${ao}/review?id=${i}&isExtraStudy=true&cardIds=${u}`)}registerReviewCardIdsOverride(i){this.reviewCardIdsOverride=i}isExtraStudy(){return this.reviewCardIdsOverride!==void 0}getNextCard(){if(this.reviewCardIdsOverride){if(this.reviewCardIdsOverride.length===1)return this.reviewCardIdsOverride[0];{const i=this.reviewCardIdsOverride.filter(r=>r!==this.extraStudyLastCardId);return i[Math.floor(Math.random()*i.length)]}}}getCardsCount(){var i;return((i=this.reviewCardIdsOverride)==null?void 0:i.length)??0}rateAgain(i){this.extraStudyLastCardId=i}rateGood(i){if(this.extraStudyLastCardId=i,this.reviewCardIdsOverride){const r=this.reviewCardIdsOverride.indexOf(i);r>=0&&this.reviewCardIdsOverride.splice(r,1)}}getCardIds(i,r){const u=this.app.deckData[i];if(!u)return[];switch(r.type){case bt.StudiedCards:{const f=Object.keys(u.schedule).length,c=Math.min(f,r.count),g=Object.keys(u.schedule).map(v=>+v);return Wt.shuffle(g).slice(0,c)}case bt.NewCards:{const f=this.app.getNewCardsCount(i),c=Math.min(f,r.count);return this.app.getNewCards(i).slice(0,c)}case bt.YoungCards:{const c=this.app.getAllNonIgnoredIds(i).filter(v=>this.app.getWenbunCustomState(i,v)===An.ReviewYoung),g=Math.min(c.length,r.count);return Wt.shuffle(c).slice(0,g)}case bt.MatureCards:{const c=this.app.getAllNonIgnoredIds(i).filter(v=>this.app.getWenbunCustomState(i,v)===An.ReviewMature),g=Math.min(c.length,r.count);return Wt.shuffle(c).slice(0,g)}case bt.Group:{const f=u.groups.find(c=>c.label===r.group);return f?f.cardIds:[]}case bt.HardCards:{const f=Object.keys(u.schedule).length,c=Math.min(f,r.count);return Object.entries(u.schedule).sort((D,A)=>A[1].difficulty-D[1].difficulty).map(D=>+D[0]).slice(0,c)}}}getDescription(i,r){const u=this.app.deckData[i];if(!u)return{desc:"",subdesc:""};switch(r.type){case bt.StudiedCards:{const f=Object.keys(u.schedule).length;return{desc:`Study ${Math.min(f,r.count)} cards`,subdesc:`(out of ${f} cards that have been studied in this deck)`}}case bt.NewCards:{const f=this.app.getNewCardsCount(i);return{desc:`Study the next ${Math.min(f,r.count)} new cards`,subdesc:`(out of ${f} new cards)`}}case bt.YoungCards:{const c=this.app.getAllNonIgnoredIds(i).filter(v=>this.app.getWenbunCustomState(i,v)===An.ReviewYoung);return{desc:`Study ${Math.min(c.length,r.count)} young cards`,subdesc:`(out of ${c.length} young cards)`}}case bt.MatureCards:{const c=this.app.getAllNonIgnoredIds(i).filter(v=>this.app.getWenbunCustomState(i,v)===An.ReviewMature);return{desc:`Study ${Math.min(c.length,r.count)} mature cards`,subdesc:`(out of ${c.length} mature cards)`}}case bt.Group:{const f=u.groups.find(g=>g.label===r.group);return f?{desc:`Study ${Math.min(f.cardIds.length,r.count)} cards from ${r.group}`,subdesc:`(out of ${f.cardIds.length} cards)`}:{desc:"ERROR: Group Not Found",subdesc:""}}case bt.HardCards:{const f=Object.keys(u.schedule).length;return{desc:`Study ${Math.min(f,r.count)} hardest cards`,subdesc:`(out of ${f} cards that have been studied in this app)`}}}}}const lo="https://wenbun-api.photon-ray.xyz";var qt=(h=>(h.Profile="/profile",h.ProfileData="/profiledata",h.ReviewLog="/reviewlog",h.ReviewLogMostRecent="/reviewlog/mostrecent",h.AuthGoogle="/auth/google",h.AuthLogout="/auth/logout",h))(qt||{});function Ce(h,i){let r=`${lo}${h}`;if(i&&Object.keys(i).length>0){const u=new URLSearchParams;for(const[f,c]of Object.entries(i))u.append(f,String(c));r+=`?${u.toString()}`}return r}function Qu(h){return`${lo}${h}`}const Vu="loginStatus";var Ln=(h=>(h.ask="ask",h.forcePull="forcePull",h.forcePush="forcePush",h.normalPull="normalPull",h.normalPush="normalPush",h))(Ln||{});class tw{constructor(i){P(this,"isLoggedIn",!1);P(this,"isSyncConflict",!1);P(this,"syncConflictInfo");P(this,"profileInfo",null);P(this,"storedLoginStatus");this.storage=i}async init(){this.storedLoginStatus=await this.storage.load(Vu);const i=await fetch(Ce(qt.Profile),{credentials:"include"});if(i.ok){const r=await i.json();this.isLoggedIn=!0,this.profileInfo=r}else i.status===401?this.isLoggedIn=!1:(this.isLoggedIn=!1,console.warn(`Unexpected status: ${i.status}`));await this.checkAndUpdateLoginStatus()}async updateLoginStatus(i){await this.storage.save(Vu,i),this.storedLoginStatus=i}async checkAndUpdateLoginStatus(){if(this.storedLoginStatus===void 0){const i=this.isLoggedIn?"loggedIn":"loggedOut";await this.updateLoginStatus(i)}}async trySyncProfile(i,r="ask"){if(!this.isLoggedIn)return!1;try{const[u,f]=await Promise.all([this.getProfileData(),this.getLatestReviewLog()]);if(u===null)return(await Promise.all([this.updateProfileData(i.exportProfile(!1)),this.pushReviewLog(f,i.reviewLogs,!0)])).every(g=>g)&&(i.lastSyncTime=new Date().toISOString(),await i.updateLastSyncTime()),!1;{const c=new Date(i.meta.modifiedAt??0),g=new Date(u.meta.modifiedAt??0),v=new Date(i.lastSyncTime??0),D=this.getSyncDecision(c,g,v);let A=Wt.isEqual(u,i.exportProfile(!1))?"none":D;switch(A=await this.autoResolveSyncConflict(A,r,i),A){case"conflict":return this.syncConflictInfo={localModifiedAt:c,remoteModifiedAt:g,lastSyncTime:v},this.isSyncConflict=!0,p_.url.pathname.startsWith("/settings")||window.confirm("Sync Failed, Conflict Detected. Do you want to go to settings?")&&so(`${ao}/settings/`),!1;case"push":return(await Promise.all([this.updateProfileData(i.exportProfile(!1)),this.pushReviewLog(f,i.reviewLogs)])).every(N=>N)?(i.lastSyncTime=new Date().toISOString(),await i.updateLastSyncTime()):window.alert("Failed to push profile data to server"),this.isSyncConflict=!1,!1;case"pull":return(await Promise.all([i.tryImportProfile(u,!1,!0),this.pullReviewLog(i)])).every(N=>N)?(i.lastSyncTime=new Date().toISOString(),await i.updateLastSyncTime()):window.alert("Failed to pull profile data from server"),this.isSyncConflict=!1,!0;case"none":return this.isSyncConflict=!1,!1}}}catch(u){return console.error(u),!1}}async autoResolveSyncConflict(i,r,u){if(i!=="conflict")return i;switch(r){case"ask":return"conflict";case"normalPull":return"pull";case"normalPush":return"push";case"forcePull":return await this.tryForcePull(u),"pull";case"forcePush":return await this.tryForcePush(u),"push"}}async tryForcePull(i){const r=await this.getProfileData(),u=await Promise.all([this.updateProfileData(i.exportProfile(!1),"pull"),this.pullReviewLog(i,!0)]),f=await i.tryImportProfile(r,!1,!0);u.every(c=>c)&&f?(i.lastSyncTime=new Date().toISOString(),await i.updateLastSyncTime(),this.isSyncConflict=!1):window.alert("Failed to pull profile data from server")}async tryForcePush(i){(await Promise.all([this.updateProfileData(i.exportProfile(!1),"push"),this.pushReviewLog(null,i.reviewLogs,!0)])).every(u=>u)?(i.lastSyncTime=new Date().toISOString(),await i.updateLastSyncTime(),this.isSyncConflict=!1):window.alert("Failed to push profile data to server")}getSyncDecision(i,r,u){const f=i>u,c=r>u;return f&&c?"conflict":f?"push":c?"pull":"none"}getName(){var i;return((i=this.profileInfo)==null?void 0:i.name)??"(no name)"}async getProfileData(){const i=await fetch(Ce(qt.ProfileData),{credentials:"include"});if(i.status===204)return null;if(i.ok)return await i.json();throw new Error(`Unexpected status: ${i.status}`)}async updateProfileData(i,r="normal"){return(await fetch(Ce(qt.ProfileData,{decision:r}),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).ok}async getLatestReviewLog(){const i=await fetch(Ce(qt.ReviewLogMostRecent),{credentials:"include"});if(i.status===204)return null;if(i.ok)return await i.json();throw new Error(`Unexpected status: ${i.status}`)}async pushReviewLog(i,r,u=!1){if(i===null||u)return(await fetch(Ce(qt.ReviewLog,{force:u}),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).ok;{const f=+new Date(i.log.review),c=r.findLastIndex(D=>{const A=D.log.review;return+new Date(A)<=f}),g=r.slice(c+1);return(await fetch(Ce(qt.ReviewLog),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)})).ok}}async pullReviewLog(i,r=!1){try{const u=await this.getReviewLogs(i.reviewLogs,r);return u===null||(r?i.reviewLogs=u:i.reviewLogs.push(...u),i.save(!1)),!0}catch(u){return console.error(u),!1}}async getReviewLogs(i,r=!1){var u;if(r){const f=new Date(0).toISOString(),c=await fetch(Ce(qt.ReviewLog,{from:f}),{method:"GET",credentials:"include"});if(c.status===204)return null;if(c.ok)return(await c.json()).map(v=>v.review_log);throw new Error(`Unexpected status: ${c.status}`)}else{const f=i[i.length-1],c=new Date(((u=f==null?void 0:f.log)==null?void 0:u.review)??0).toISOString(),g=await fetch(Ce(qt.ReviewLog,{from:c}),{method:"GET",credentials:"include"});if(g.status===204)return null;if(g.ok)return await g.json();throw new Error(`Unexpected status: ${g.status}`)}}async loginGoogle(i){window.location.assign(Qu(qt.AuthGoogle))}async logout(i){await this.updateLoginStatus(void 0),await i.updateLastSyncTime(new Date(0)),window.location.assign(Qu(qt.AuthLogout))}isAutomaticallyLoggedOut(){return!this.isLoggedIn&&this.storedLoginStatus==="loggedIn"}}const ew="__ungrouped__",ju="profile.json",es="decks",ns="deckData",rs="config",is="reviewLogs",ss="autoReviewGradeLog",to="meta",as="lastSyncTime",eo="strokeSpeed",no="deckView",ro=[R.Again,R.Hard,R.Good,R.Easy],nw=30,io=3;var An=(h=>(h.New="New",h.WarmUp="WarmUp",h.Learning="Learning",h.ReviewYoung="Young",h.ReviewMature="Mature",h.Relearning="Relearning",h.PreviouslyStudied="Previously Studied",h.Ignored="Ignored",h))(An||{}),rw=(h=>(h.Mix="Mix",h.AfterReviews="After Reviews",h.BeforeReviews="Before Reviews",h))(rw||{}),bt=(h=>(h.StudiedCards="Studied Cards",h.HardCards="Hard Cards",h.NewCards="New Cards",h.YoungCards="Young Cards",h.MatureCards="Mature Cards",h.Group="Group",h))(bt||{});const Dn={newCardPerDay:5,maxReviewsPerDay:200,newCardOrder:"Mix",newPreviouslyStudiedCardPerDay:20,newPreviouslyStudiedCardOrder:"Mix",startPreviouslyStudiedCardFromTheBack:!0,gradeWarmUpCards:!1,uiScale:"normal",customFontSize:16,gradingMethod:"auto",strokeLeniency:1.5,learningSteps:["1m","10m"],previouslyStudiedLearningSteps:["1m","5d"],desiredRetention:.9,enableShortTerm:!1,enableFuzz:!1,FSRSParams:c_,zh:{isColorBasedOnTone:!0,toneColors:f_.Default,alwaysShowReading:!1,mandarinReading:l_.Pinyin,playAudio:!0}};var iw=(h=>(h.Normal="Normal",h.Small="Small",h))(iw||{});class lw{constructor(){P(this,"decks",[]);P(this,"deckData",{});P(this,"config",Dn);P(this,"reviewLogs",[]);P(this,"autoReviewGradeLog",[]);P(this,"meta",{});P(this,"lastSyncTime",new Date(0).toISOString());P(this,"isLoadDone",!1);P(this,"fsrs");P(this,"fsrsPrevStudied");P(this,"storage");P(this,"fileManager");P(this,"extraStudyHandler");P(this,"profile");this.updateFSRS(),ts()?this.storage=new q_(ju):this.storage=new Y_(ju),this.fileManager=new V_,this.extraStudyHandler=new j_(this),this.profile=new tw(this.storage)}updateFSRS(){const i=this.getConfig(),r=Ar({request_retention:i.desiredRetention,w:i.FSRSParams,enable_fuzz:i.enableFuzz,enable_short_term:i.enableShortTerm,learning_steps:i.learningSteps});this.fsrs=new Yu(r);const u=Ar({request_retention:i.desiredRetention,w:i.FSRSParams,enable_fuzz:i.enableFuzz,enable_short_term:i.enableShortTerm,learning_steps:i.previouslyStudiedLearningSteps});this.fsrsPrevStudied=new Yu(u)}async init(){await this.load(),this.updateFontSize(),this.extraStudyHandler.init(),this.updateFSRS(),await this.processTodaySchedule()}async initProfile(){if(await this.profile.init(),this.profile.isLoggedIn){const i=ts()?Ln.ask:Ln.normalPull;return await this.profile.trySyncProfile(this,i)}else return!1}async debug(){this.decks=["test"],this.deckData={},this.reviewLogs=[],this.config=Dn,await this.save()}debugSimulate(){let i=bn();const r=this.fsrs,u=f=>{const c=r.repeat(i,i.due);let g={1:"",2:"",3:"",4:""};for(const v of ro){const D=c[v].log.review,A=c[v].card.due;g[v]=xr(D,A)}console.log(f,g),i=c[f].card};u(R.Again),u(R.Again),u(R.Good),u(R.Good),u(R.Good),u(R.Again)}updateFontSize(){const i=`${this.getFontSizePx()}px`;document.body.style.fontSize=i}getCurrentUIScale(){return this.getFontSizePx()/16}getFontSizePx(){const i=this.getConfig();switch(i.uiScale){case"small":return 10;case"normal":return 16;case"custom":return Wt.clamp(i.customFontSize,8,32)}}async load(){const[i,r,u,f,c,g,v]=await Promise.all([this.storage.load(es),this.storage.load(ns),this.storage.load(rs),this.storage.load(is),this.storage.load(ss),this.storage.load(to),this.storage.load(as)]);this.decks=i||[],this.deckData=r||{},this.config=u||Dn,this.reviewLogs=f||[],this.autoReviewGradeLog=c||[],this.meta=g||{clientVersion:"0.9.0"},this.lastSyncTime=v||new Date(0).toISOString(),this.isLoadDone=!0}async save(i=!1,r=!1,u=!0){if(await this.isDataChanged()&&(this.updateFontSize(),this.meta.modifiedAt=new Date().toISOString(),this.meta._profileVersion=1,u&&(this.meta.clientVersion="0.9.0"),await Promise.all([this.storage.save(es,this.decks),this.storage.save(ns,this.deckData),this.storage.save(rs,this.config),this.storage.save(is,this.reviewLogs),this.storage.save(ss,this.autoReviewGradeLog),this.storage.save(to,this.meta),this.storage.save(as,this.lastSyncTime)]),!i)){const c=ts()?Ln.ask:Ln.normalPush;r?await this.profile.trySyncProfile(this,c):this.profile.trySyncProfile(this,c).catch(console.error)}}async updateLastSyncTime(i=new Date){this.lastSyncTime=i.toISOString(),await this.storage.save(as,this.lastSyncTime)}async isDataChanged(){const[i,r,u,f,c]=await Promise.all([this.storage.load(es),this.storage.load(ns),this.storage.load(rs),this.storage.load(is),this.storage.load(ss)]);return!Wt.isEqual(this.decks,i)||!Wt.isEqual(this.deckData,r)||!Wt.isEqual(this.config,u)||!Wt.isEqual(this.reviewLogs,f)||!Wt.isEqual(this.autoReviewGradeLog,c)}exportProfileStr(i=!0){return JSON.stringify(this.exportProfile(i))}async tryImportProfileStr(i,r=!0){try{const u=JSON.parse(i);return this.tryImportProfile(u,r)}catch{return!1}}exportProfile(i=!0){return{config:this.config,decks:this.decks,deckData:this.deckData,reviewLogs:i?this.reviewLogs:[],meta:this.meta}}async tryImportProfile(i,r=!0,u=!1){try{const{config:f,decks:c,deckData:g,reviewLogs:v,meta:D}=i;return this.config=f,this.decks=c,this.deckData=g,r&&(this.reviewLogs=v),this.meta=D,await this.save(u,void 0,!1),!0}catch{return!1}}async processTodaySchedule(){const i=new Date,r=Cr(i);let u=!1;for(const f of Object.keys(this.deckData)){const c=this.deckData[f];Cr(new Date(c.lastScheduleCheckDate))<r&&(c.doneTodayNewCardCount=0,c.doneTodayPreviouslyStudiedCardCount=0,c.doneTodayReviewCount=0,c.lastScheduleCheckDate=i.getTime(),u=!0)}u&&await this.save()}async getInitDeckDataById(i){const r=h_.find(f=>f.id===i),u=await d_((r==null?void 0:r.src)??`${i}.txt`);if(u)return this.getInitDeckData(u,(r==null?void 0:r.tags)??[])}getInitDeckData(i,r){return{deck:i,tags:r,groups:[{label:ew,cardIds:Array.from(i.keys())}],ignoredIds:[],previouslyStudied:[],schedule:{},lastScheduleCheckDate:new Date(0).getTime(),doneTodayNewCardCount:0,doneTodayPreviouslyStudiedCardCount:0,doneTodayReviewCount:0}}async addDeckById(i){const r=await this.getInitDeckDataById(i);if(!r)return Promise.reject(new Error("loading deck failed"));await this.addDeck(i,r)}async addDeck(i,r){this.deckData[i]||(this.deckData[i]=r,!this.decks.includes(i)&&(this.decks.push(i),this.splitDeckIntoGroupOfN(i,nw),await this.save()))}async deleteDeck(i,r=!1){r&&(this.decks.includes(i)&&(this.decks=this.decks.filter(u=>u!=i)),delete this.deckData[i])}isDeckIdExists(i){return this.decks.includes(i)}getConfig(){return Wt.merge({},Dn,this.config)}async resetConfigToDefault(){this.config=Wt.cloneDeep(Dn),await this.save()}async saveConfig(i){this.config=i,await this.save()}rateCard(i,r,u,f){var I,N;this.stopWarmUp(i,r);const c=this.deckData[i],g=this.getCard(i,r,!0);if(!g)return;const A=(((N=(I=this.deckData[i])==null?void 0:I.previouslyStudied)==null?void 0:N.includes(r))?this.fsrsPrevStudied:this.fsrs).repeat(g,f??new Date);this.setCard(i,r,A[u].card),this.pushReviewLog(i,r,A[u].log),c.previouslyStudied.includes(r)?(c.previouslyStudied.splice(c.previouslyStudied.indexOf(r),1),c.doneTodayPreviouslyStudiedCardCount++):g.state===G.New?c.doneTodayNewCardCount++:g.state===G.Review&&c.doneTodayReviewCount++}warmUpNext(i,r){var f;const u=this.deckData[i];u&&((f=u.warmUpIds)==null?void 0:f[r])!==void 0&&u.warmUpIds[r]++}getNextCard(i){if(this.extraStudyHandler.isExtraStudy())return this.extraStudyHandler.getNextCard();const r=this.getConfig(),u=this.getScheduledNewOrWarmUpCardsCount(i),f=this.getScheduledPreviouslyStudiedCardsCount(i),c=this.getScheduledReviewCardsCount(i),g=this.getTotalScheduledNewOrWarmUpTotalCount(i),v=u>0?this.getNewOrWarmUpCard(i):void 0,D=f>0?this.getPreviouslyStudiedCard(i):void 0,A=c>0?this.getTodaysScheduledCards(i)[0]:void 0,I=[],N=[A],ut=[];if(r.newCardOrder==="Before Reviews"&&I.push(v),r.newCardOrder==="After Reviews"&&ut.push(v),r.newPreviouslyStudiedCardOrder==="Before Reviews"&&I.push(D),r.newPreviouslyStudiedCardOrder==="After Reviews"&&ut.push(D),r.newCardOrder==="Mix"){const nt=g/(g+c);Math.random()<nt?N.unshift(v):N.push(v)}if(r.newPreviouslyStudiedCardOrder==="Mix"){const nt=f/(g+f+c);Math.random()<nt?N.unshift(D):N.push(D)}return[...I,...N,...ut].reduce((nt,Zt)=>nt??Zt,void 0)}skipWarmUp(i,r){const u=this.deckData[i];u&&(this.startWarmUp(i,r),u.warmUpIds[r]=io)}startWarmUp(i,r){const u=this.deckData[i];u&&(u.warmUpIds===void 0&&(u.warmUpIds={}),u.warmUpIds[r]=0)}stopWarmUp(i,r){var f;const u=(f=this.deckData[i])==null?void 0:f.warmUpIds;u&&delete u[r]}getWarmUpCount(i,r){var u,f;return(f=(u=this.deckData[i])==null?void 0:u.warmUpIds)==null?void 0:f[r]}getMaxWarmUpCount(){return io}isWarmUpCard(i,r){return this.getWarmUpCount(i,r)!==void 0}getNewOrWarmUpCard(i){const u=this.getScheduledNewOrWarmUpCardsCount(i)-this.getWarmUpCardsCount(i),f=this.getNewCard(i),c=this.deckData[i];if(!c.warmUpIds)return f;const g=Object.keys(c.warmUpIds),v=+g[Math.floor(Math.random()*g.length)];if(u<=0)return v;const D=this.getNewCardsCount(i),A=g.length;if(D+A!==0)return Math.random()<D/(D+A)?f:v}getNewCard(i){return this.getNewCards(i)[0]}getNewCards(i){return this.deckData[i].groups.flatMap(g=>g.cardIds).filter(g=>this.getWenbunCustomState(i,g)==="New")}getPreviouslyStudiedCard(i){var u;const r=this.deckData[i];if(r)return this.getConfig().startPreviouslyStudiedCardFromTheBack?(u=r.previouslyStudied)==null?void 0:u[r.previouslyStudied.length-1]:r.previouslyStudied[0]}getNewCardsCount(i){return this.getNewCards(i).length}getPreviouslyStudiedCardCount(i){var r;return((r=this.deckData[i])==null?void 0:r.previouslyStudied.length)??0}getWarmUpCardsCount(i){var r;return(r=this.deckData[i])!=null&&r.warmUpIds?Object.keys(this.deckData[i].warmUpIds).length:0}pushReviewLog(i,r,u){this.reviewLogs.push({deckId:i,cardId:r,log:u})}setCard(i,r,u){const f=this.deckData[i];f&&(f.schedule[r]=u)}getCard(i,r,u=!1){const f=this.deckData[i];if(f)return u&&f.schedule[r]===void 0?bn():f.schedule[r]}getCardWord(i,r){const u=this.deckData[i];if(!u)return"";const f=u.deck[r];return f||""}getCardDue(i,r){var u;return(u=this.getCard(i,r))==null?void 0:u.due}getCardDueFormatted(i,r){if(this.isWarmUpCard(i,r))return"Warm Up";const u=this.getCardDue(i,r);return u?xr(new Date,new Date(u)):"Not Started"}getShortCardDueFormatted(i,r){if(this.isWarmUpCard(i,r))return"";const u=this.getCardDue(i,r);return u?xr(new Date,new Date(u)):""}getRatingScheduledTimeStr(i,r){var D,A;const u=this.getCard(i,r,!0);let f={1:"",2:"",3:"",4:""};if(!u)return f;const v=(((A=(D=this.deckData[i])==null?void 0:D.previouslyStudied)==null?void 0:A.includes(r))?this.fsrsPrevStudied:this.fsrs).repeat(u,new Date);for(const I of ro){const N=v[I].log.review,ut=v[I].card.due;f[I]=xr(N,ut)}return f}getWenbunCustomState(i,r){var f,c,g,v,D,A;if(((c=(f=this.deckData[i])==null?void 0:f.warmUpIds)==null?void 0:c[r])!==void 0)return"WarmUp";if((v=(g=this.deckData[i])==null?void 0:g.previouslyStudied)!=null&&v.includes(r))return"Previously Studied";if((A=(D=this.deckData[i])==null?void 0:D.ignoredIds)!=null&&A.includes(r))return"Ignored";const u=this.getCard(i,r);switch(u==null?void 0:u.state){case G.Learning:return"Learning";case G.Review:return u.scheduled_days>=21?"Mature":"Young";case G.Relearning:return"Relearning";case G.New:default:return"New"}}getTodaysReviewCards(i){const r=this.deckData[i];return this.getTodaysScheduledCards(i).filter(c=>{var g;return((g=r.schedule[c])==null?void 0:g.state)===G.Review})}getScheduledReviewCardsCount(i){const r=this.deckData[i],u=this.getTodaysReviewCards(i),f=this.getConfig(),c=Math.min(u.length,f.maxReviewsPerDay-r.doneTodayReviewCount);return Math.max(0,c)}getScheduledNewOrWarmUpCardsCount(i){const r=this.getConfig(),u=this.deckData[i],f=this.getNewCardsCount(i),c=this.getWarmUpCardsCount(i),g=Math.min(f+c,r.newCardPerDay-u.doneTodayNewCardCount);return Math.max(0,g)}getScheduledNewCardsCount(i){return this.getScheduledNewOrWarmUpCardsCount(i)-this.getWarmUpCardsCount(i)}getScheduledPreviouslyStudiedCardsCount(i){const r=this.getConfig(),u=this.deckData[i],f=Math.min(this.getPreviouslyStudiedCardCount(i),r.newPreviouslyStudiedCardPerDay-u.doneTodayPreviouslyStudiedCardCount);return Math.max(0,f)}getLearningRelearningCardsCount(i){const r=this.deckData[i];return Object.entries(r.schedule).filter(([u,f])=>f.state===G.Learning||f.state===G.Relearning).length}getTotalScheduledNewOrWarmUpTotalCount(i){var c;let r=0;const u=this.getMaxWarmUpCount(),f=this.getScheduledNewCardsCount(i);return r+=f*(u+1),(c=this.deckData[i])!=null&&c.warmUpIds&&Object.values(this.deckData[i].warmUpIds).forEach(g=>{const v=u-g+1;r+=v}),r}addPreviouslyStudiedMark(i,r){const u=this.deckData[i];!u||u.previouslyStudied.includes(r)||this.getWenbunCustomState(i,r)!=="New"||u.previouslyStudied.push(r)}removePreviouslyStudiedMark(i,r){const u=this.deckData[i];if(!u)return;const f=u.previouslyStudied.indexOf(r);f<0||u.previouslyStudied.splice(f,1)}ensureIgnoreIdArray(i){const r=this.deckData[i];r&&(r.ignoredIds||(r.ignoredIds=[]))}addIgnoredMark(i,r){var f,c;const u=this.deckData[i];u&&(this.ensureIgnoreIdArray(i),!((f=u.ignoredIds)!=null&&f.includes(r))&&((c=u.ignoredIds)==null||c.push(r)))}removeIgnoredMark(i,r){var c,g;const u=this.deckData[i];if(!u)return;const f=(c=u.ignoredIds)==null?void 0:c.indexOf(r);f==null||f<0||(g=u.ignoredIds)==null||g.splice(f,1)}getTodaysScheduledCards(i){const r=this.deckData[i];if(!r)return[];const f=Cr(new Date)+1,c=Object.entries(r.schedule).filter(([g,v])=>{var I;if(!!((I=r.ignoredIds)!=null&&I.includes(+g)))return!1;const A=Cr(new Date(v.due));return v.state===G.Review?A<f:!0});return c.sort((g,v)=>new Date(g[1].due).getTime()-new Date(v[1].due).getTime()),c.map(g=>+g[0])}getChineseToneColor(i){if(!i)return;const r=this.getConfig();return r.zh.isColorBasedOnTone?r.zh.toneColors[i-1]:void 0}splitDeckIntoGroupOfN(i,r){const u=this.deckData[i];if(!u)return;const f=Array.from(u.deck.keys()),c=[],g=Math.ceil(f.length/r);for(let v=0;v<g;v++){const D=`group-${v+1}`;c.push({label:D,cardIds:f.slice(v*r,(v+1)*r)})}u.groups=c}getGroupLabels(i){const r=this.deckData[i];return r?r.groups.map(u=>u.label):[]}getAllNonIgnoredIds(i){const r=this.deckData[i];return r?Array.from(r.deck.keys()).filter(f=>{var c;return!((c=r.ignoredIds)!=null&&c.includes(f))}):[]}async downloadProfile(){const i=this.exportProfileStr(),r=new Date().toLocaleDateString("en-CA");await this.fileManager.download({data:i,filename:`wenbun-profile-${r}.txt`,mimeType:"text/plain"})}async tryUploadProfile(){const i=await this.fileManager.upload();return i===null||typeof i.data!="string"?!1:this.tryImportProfileStr(i.data)}getDeckProgress(i){var A;const r=this.deckData[i];if(!r)return{totalCount:1,previouslyStudiedCount:0,youngCount:0,matureCount:0,ignoredCount:0};const u=this.getAllNonIgnoredIds(i),f=r.deck.length,c=r.previouslyStudied.length,g=u.filter(I=>this.getWenbunCustomState(i,I)==="Young").length,v=u.filter(I=>this.getWenbunCustomState(i,I)==="Mature").length,D=((A=r.ignoredIds)==null?void 0:A.length)??0;return{totalCount:f,previouslyStudiedCount:c,youngCount:g,matureCount:v,ignoredCount:D}}getDeckProgressNormalized(i){const r=this.getDeckProgress(i);return{young:r.youngCount/r.totalCount*100,mature:r.matureCount/r.totalCount*100,previouslyStudied:r.previouslyStudiedCount/r.totalCount*100,ignored:r.ignoredCount/r.totalCount*100,rest:(r.totalCount-r.youngCount-r.matureCount-r.previouslyStudiedCount-r.ignoredCount)/r.totalCount*100}}isAutoGrading(){return this.getConfig().gradingMethod==="auto"}storeAutoGradeLog(i,r,u){this.autoReviewGradeLog.push({correctCount:i,mistakeCount:r,grade:u})}getStrokeSpeed(){return+(window.localStorage.getItem(eo)??1)}setStrokeSpeed(i){window.localStorage.setItem(eo,i.toString())}getDeckView(){return window.localStorage.getItem(no)??"Normal"}setDeckView(i){window.localStorage.setItem(no,i)}adjustCardLimit(i,r,u,f){const c=this.deckData[i];c&&(c.doneTodayNewCardCount-=r,c.doneTodayPreviouslyStudiedCardCount-=u,c.doneTodayReviewCount-=f)}getCurrentAppVersion(){return"0.9.0"}isNewUpdateExist(){return g_("0.9.0",this.meta.clientVersion??"0.0.0")}}export{lw as A,iw as D,bt as E,rw as N,An as W,Wt as _,nw as a,R as l};
