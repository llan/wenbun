var o_=Object.defineProperty;var l_=(h,i,r)=>i in h?o_(h,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):h[i]=r;var P=(h,i,r)=>l_(h,typeof i!="symbol"?i+"":i,r);import{b as f_,h as c_,o as h_,q as Cr,D as Hu,l as d_,r as g_,u as xr,v as p_}from"./BSb8eFOk.js";import{g as ao,b as uo}from"./DcoJXAFg.js";import{p as __}from"./QqqP5j9C.js";var G=(h=>(h[h.New=0]="New",h[h.Learning=1]="Learning",h[h.Review=2]="Review",h[h.Relearning=3]="Relearning",h))(G||{}),R=(h=>(h[h.Manual=0]="Manual",h[h.Again=1]="Again",h[h.Hard=2]="Hard",h[h.Good=3]="Good",h[h.Easy=4]="Easy",h))(R||{});class N{static card(i){return{...i,state:N.state(i.state),due:N.time(i.due),last_review:i.last_review?N.time(i.last_review):void 0}}static rating(i){if(typeof i=="string"){const r=i.charAt(0).toUpperCase(),a=i.slice(1).toLowerCase(),f=R[`${r}${a}`];if(f===void 0)throw new Error(`Invalid rating:[${i}]`);return f}else if(typeof i=="number")return i;throw new Error(`Invalid rating:[${i}]`)}static state(i){if(typeof i=="string"){const r=i.charAt(0).toUpperCase(),a=i.slice(1).toLowerCase(),f=G[`${r}${a}`];if(f===void 0)throw new Error(`Invalid state:[${i}]`);return f}else if(typeof i=="number")return i;throw new Error(`Invalid state:[${i}]`)}static time(i){if(typeof i=="object"&&i instanceof Date)return i;if(typeof i=="string"){const r=Date.parse(i);if(isNaN(r))throw new Error(`Invalid date:[${i}]`);return new Date(r)}else if(typeof i=="number")return new Date(i);throw new Error(`Invalid date:[${i}]`)}static review_log(i){return{...i,due:N.time(i.due),rating:N.rating(i.rating),state:N.state(i.state),review:N.time(i.review)}}}Date.prototype.scheduler=function(h,i){return Kt(this,h,i)},Date.prototype.diff=function(h,i){return Xe(this,h,i)},Date.prototype.format=function(){return w_(this)},Date.prototype.dueFormat=function(h,i,r){return v_(this,h,i,r)};function Kt(h,i,r){return new Date(r?N.time(h).getTime()+i*24*60*60*1e3:N.time(h).getTime()+i*60*1e3)}function Xe(h,i,r){if(!h||!i)throw new Error("Invalid date");const a=N.time(h).getTime()-N.time(i).getTime();let f=0;switch(r){case"days":f=Math.floor(a/(24*60*60*1e3));break;case"minutes":f=Math.floor(a/(60*1e3));break}return f}function w_(h){const i=N.time(h),r=i.getFullYear(),a=i.getMonth()+1,f=i.getDate(),c=i.getHours(),g=i.getMinutes(),v=i.getSeconds();return`${r}-${xn(a)}-${xn(f)} ${xn(c)}:${xn(g)}:${xn(v)}`}function xn(h){return h<10?`0${h}`:`${h}`}const Vi=[60,60,24,31,12],ji=["second","min","hour","day","month","year"];function v_(h,i,r,a=ji){h=N.time(h),i=N.time(i),a.length!==ji.length&&(a=ji);let f=h.getTime()-i.getTime(),c;for(f/=1e3,c=0;c<Vi.length&&!(f<Vi[c]);c++)f/=Vi[c];return`${Math.floor(f)}${r?a[c]:""}`}const y_=Object.freeze([R.Again,R.Hard,R.Good,R.Easy]),m_=[{start:2.5,end:7,factor:.15},{start:7,end:20,factor:.1},{start:20,end:1/0,factor:.05}];function S_(h,i,r){let a=1;for(const g of m_)a+=g.factor*Math.max(Math.min(h,g.end)-g.start,0);h=Math.min(h,r);let f=Math.max(2,Math.round(h-a));const c=Math.min(Math.round(h+a),r);return h>i&&(f=Math.max(f,i+1)),f=Math.min(f,c),{min_ivl:f,max_ivl:c}}function wt(h,i,r){return Math.min(Math.max(h,i),r)}function C_(h,i){const r=Date.UTC(h.getUTCFullYear(),h.getUTCMonth(),h.getUTCDate()),a=Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate());return Math.floor((a-r)/864e5)}const x_=.9,D_=36500,R_=!1,A_=!0,L_=Object.freeze(["1m","10m"]),b_=Object.freeze(["10m"]),Yt=.001,Dr=100,zu=.5,E_=.1542,qu=Object.freeze([.212,1.2931,2.3065,8.2956,6.4133,.8334,3.0194,.001,1.8722,.1666,.796,1.4835,.0614,.2629,1.6483,.6014,1.8729,.5425,.0912,.0658,E_]),I_=2,T_=h=>[[Yt,Dr],[Yt,Dr],[Yt,Dr],[Yt,Dr],[1,10],[.001,4],[.001,4],[.001,.75],[0,4.5],[0,.8],[.001,3.5],[.001,5],[.001,.25],[.001,.9],[0,4],[0,1],[1,6],[0,h],[0,h],[0,.8],[.1,.8]],os=(h,i)=>{let r=I_;if(Math.max(0,i)>1){const a=-(Math.log(h[11])+Math.log(Math.pow(2,h[13])-1)+h[14]*.3)/i;r=wt(+a.toFixed(8),.01,2)}return T_(r).map(([a,f],c)=>wt(h[c],a,f))},ls=h=>{if(h===void 0)return[...qu];switch(h.length){case 21:return[...h];case 19:return console.debug("[FSRS-6]auto fill w from 19 to 21 length"),[...h,0,zu];case 17:{const i=[...h];return i[4]=+(i[5]*2+i[4]).toFixed(8),i[5]=+(Math.log(i[5]*3+1)/3).toFixed(8),i[6]=+(i[6]+.5).toFixed(8),console.debug("[FSRS-6]auto fill w from 17 to 21 length"),i.concat([0,0,0,zu])}default:return console.warn("[FSRS]Invalid parameters length, using default parameters"),[...qu]}},Lr=h=>{const i=Array.isArray(h==null?void 0:h.learning_steps)?h.learning_steps:L_,r=Array.isArray(h==null?void 0:h.relearning_steps)?h.relearning_steps:b_,a=os(ls(h==null?void 0:h.w),r.length);return{request_retention:(h==null?void 0:h.request_retention)||x_,maximum_interval:(h==null?void 0:h.maximum_interval)||D_,w:a,enable_fuzz:(h==null?void 0:h.enable_fuzz)??R_,enable_short_term:(h==null?void 0:h.enable_short_term)??A_,learning_steps:i,relearning_steps:r}};function bn(h,i){const r={due:h?N.time(h):new Date,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:0,lapses:0,learning_steps:0,state:G.New,last_review:void 0};return i&&typeof i=="function"?i(r):r}class O_{constructor(i){P(this,"c");P(this,"s0");P(this,"s1");P(this,"s2");const r=M_();this.c=1,this.s0=r(" "),this.s1=r(" "),this.s2=r(" "),i==null&&(i=+new Date),this.s0-=r(i),this.s0<0&&(this.s0+=1),this.s1-=r(i),this.s1<0&&(this.s1+=1),this.s2-=r(i),this.s2<0&&(this.s2+=1)}next(){const i=2091639*this.s0+this.c*23283064365386963e-26;return this.s0=this.s1,this.s1=this.s2,this.s2=i-(this.c=i|0),this.s2}set state(i){this.c=i.c,this.s0=i.s0,this.s1=i.s1,this.s2=i.s2}get state(){return{c:this.c,s0:this.s0,s1:this.s1,s2:this.s2}}}function M_(){let h=4022871197;return function(i){i=String(i);for(let r=0;r<i.length;r++){h+=i.charCodeAt(r);let a=.02519603282416938*h;h=a>>>0,a-=h,a*=h,h=a>>>0,a-=h,h+=a*4294967296}return(h>>>0)*23283064365386963e-26}}function P_(h){const i=new O_(h),r=()=>i.next();return r.int32=()=>i.next()*4294967296|0,r.double=()=>r()+(r()*2097152|0)*11102230246251565e-32,r.state=()=>i.state,r.importState=a=>(i.state=a,r),r}const oo=h=>{const i=typeof h=="number"?-h:-h[20],r=Math.exp(Math.pow(i,-1)*Math.log(.9))-1;return{decay:i,factor:+r.toFixed(8)}};function us(h,i,r){const{decay:a,factor:f}=oo(h);return+Math.pow(1+f*i/r,a).toFixed(8)}class N_{constructor(i){P(this,"param");P(this,"intervalModifier");P(this,"_seed");P(this,"forgetting_curve");this.param=new Proxy(Lr(i),this.params_handler_proxy()),this.intervalModifier=this.calculate_interval_modifier(this.param.request_retention),this.forgetting_curve=us.bind(this,this.param.w)}get interval_modifier(){return this.intervalModifier}set seed(i){this._seed=i}calculate_interval_modifier(i){if(i<=0||i>1)throw new Error("Requested retention rate should be in the range (0,1]");const{decay:r,factor:a}=oo(this.param.w);return+((Math.pow(i,1/r)-1)/a).toFixed(8)}get parameters(){return this.param}set parameters(i){this.update_parameters(i)}params_handler_proxy(){const i=this;return{set:function(r,a,f){return a==="request_retention"&&Number.isFinite(f)?i.intervalModifier=i.calculate_interval_modifier(Number(f)):a==="w"&&(f=os(ls(f),r.relearning_steps.length),i.forgetting_curve=us.bind(this,f),i.intervalModifier=i.calculate_interval_modifier(Number(r.request_retention))),Reflect.set(r,a,f),!0}}}update_parameters(i){const r=Lr(i);for(const a in r)if(a in this.param){const f=a;this.param[f]=r[f]}}init_stability(i){return Math.max(this.param.w[i-1],.1)}init_difficulty(i){return+(this.param.w[4]-Math.exp((i-1)*this.param.w[5])+1).toFixed(8)}apply_fuzz(i,r){if(!this.param.enable_fuzz||i<2.5)return Math.round(i);const a=P_(this._seed)(),{min_ivl:f,max_ivl:c}=S_(i,r,this.param.maximum_interval);return Math.floor(a*(c-f+1)+f)}next_interval(i,r){const a=Math.min(Math.max(1,Math.round(i*this.intervalModifier)),this.param.maximum_interval);return this.apply_fuzz(a,r)}linear_damping(i,r){return+(i*(10-r)/9).toFixed(8)}next_difficulty(i,r){const a=-this.param.w[6]*(r-3),f=i+this.linear_damping(a,i);return wt(this.mean_reversion(this.init_difficulty(R.Easy),f),1,10)}mean_reversion(i,r){return+(this.param.w[7]*i+(1-this.param.w[7])*r).toFixed(8)}next_recall_stability(i,r,a,f){const c=R.Hard===f?this.param.w[15]:1,g=R.Easy===f?this.param.w[16]:1;return+wt(r*(1+Math.exp(this.param.w[8])*(11-i)*Math.pow(r,-this.param.w[9])*(Math.exp((1-a)*this.param.w[10])-1)*c*g),Yt,36500).toFixed(8)}next_forget_stability(i,r,a){return+wt(this.param.w[11]*Math.pow(i,-this.param.w[12])*(Math.pow(r+1,this.param.w[13])-1)*Math.exp((1-a)*this.param.w[14]),Yt,36500).toFixed(8)}next_short_term_stability(i,r){const a=Math.pow(i,-this.param.w[19])*Math.exp(this.param.w[17]*(r-3+this.param.w[18])),f=r>=3?Math.max(a,1):a;return+wt(i*f,Yt,36500).toFixed(8)}next_state(i,r,a){const{difficulty:f,stability:c}=i??{difficulty:0,stability:0};if(r<0)throw new Error(`Invalid delta_t "${r}"`);if(a<0||a>4)throw new Error(`Invalid grade "${a}"`);if(f===0&&c===0)return{difficulty:wt(this.init_difficulty(a),1,10),stability:this.init_stability(a)};if(a===0)return{difficulty:f,stability:c};if(f<1||c<Yt)throw new Error(`Invalid memory state { difficulty: ${f}, stability: ${c} }`);const g=this.forgetting_curve(r,c),v=this.next_recall_stability(f,c,g,a),D=this.next_forget_stability(f,c,g),L=this.next_short_term_stability(c,a);let I=v;if(a===1){let[U,ut]=[0,0];this.param.enable_short_term&&(U=this.param.w[17],ut=this.param.w[18]);const V=c/Math.exp(U*ut);I=wt(+V.toFixed(8),Yt,D)}return r===0&&this.param.enable_short_term&&(I=L),{difficulty:this.next_difficulty(f,a),stability:I}}}function U_(){const h=this.review_time.getTime(),i=this.current.reps,r=this.current.difficulty*this.current.stability;return`${h}_${i}_${r}`}const W_=h=>{const i=h.slice(-1),r=parseInt(h.slice(0,-1),10);if(isNaN(r)||!Number.isFinite(r)||r<0)throw new Error(`Invalid step value: ${h}`);switch(i){case"m":return r;case"h":return r*60;case"d":return r*1440;default:throw new Error(`Invalid step unit: ${h}, expected m/h/d`)}},F_=(h,i,r)=>{const a=i===G.Relearning||i===G.Review?h.relearning_steps:h.learning_steps,f=a.length;if(f===0||r>=f)return{};const c=a[0],g=W_,v=()=>g(c),D=()=>{if(f===1)return Math.round(g(c)*1.5);const V=a[1];return Math.round((g(c)+g(V))/2)},L=V=>V<0||V>=f?null:a[V],I=V=>g(V),U={},ut=L(Math.max(0,r));if(i===G.Review)return U[R.Again]={scheduled_minutes:g(ut),next_step:0},U;{U[R.Again]={scheduled_minutes:v(),next_step:0},U[R.Hard]={scheduled_minutes:D(),next_step:r};const V=L(r+1);if(V){const nt=I(V);nt&&(U[R.Good]={scheduled_minutes:Math.round(nt),next_step:r+1})}}return U};var Er=(h=>(h.SCHEDULER="Scheduler",h.LEARNING_STEPS="LearningSteps",h.SEED="Seed",h))(Er||{});class lo{constructor(i,r,a,f){P(this,"last");P(this,"current");P(this,"review_time");P(this,"next",new Map);P(this,"algorithm");P(this,"strategies");P(this,"elapsed_days",0);this.algorithm=a,this.last=N.card(i),this.current=N.card(i),this.review_time=N.time(r),this.strategies=f,this.init()}checkGrade(i){if(!Number.isFinite(i)||i<0||i>4)throw new Error(`Invalid grade "${i}",expected 1-4`)}init(){const{state:i,last_review:r}=this.current;let a=0;i!==G.New&&r&&(a=C_(r,this.review_time)),this.current.last_review=this.review_time,this.elapsed_days=a,this.current.elapsed_days=a,this.current.reps+=1;let f=U_;if(this.strategies){const c=this.strategies.get(Er.SEED);c&&(f=c)}this.algorithm.seed=f.call(this)}preview(){return{[R.Again]:this.review(R.Again),[R.Hard]:this.review(R.Hard),[R.Good]:this.review(R.Good),[R.Easy]:this.review(R.Easy),[Symbol.iterator]:this.previewIterator.bind(this)}}*previewIterator(){for(const i of y_)yield this.review(i)}review(i){const{state:r}=this.last;let a;switch(this.checkGrade(i),r){case G.New:a=this.newState(i);break;case G.Learning:case G.Relearning:a=this.learningState(i);break;case G.Review:a=this.reviewState(i);break}return a}buildLog(i){const{last_review:r,due:a,elapsed_days:f}=this.last;return{rating:i,state:this.current.state,due:r||a,stability:this.current.stability,difficulty:this.current.difficulty,elapsed_days:this.elapsed_days,last_elapsed_days:f,scheduled_days:this.current.scheduled_days,learning_steps:this.current.learning_steps,review:this.review_time}}}class Ku extends lo{constructor(r,a,f,c){super(r,a,f,c);P(this,"learningStepsStrategy");let g=F_;if(this.strategies){const v=this.strategies.get(Er.LEARNING_STEPS);v&&(g=v)}this.learningStepsStrategy=g}getLearningInfo(r,a){var D,L;const f=this.algorithm.parameters;r.learning_steps=r.learning_steps||0;const c=this.learningStepsStrategy(f,r.state,this.current.state===G.Learning?r.learning_steps+1:r.learning_steps),g=Math.max(0,((D=c[a])==null?void 0:D.scheduled_minutes)??0),v=Math.max(0,((L=c[a])==null?void 0:L.next_step)??0);return{scheduled_minutes:g,next_steps:v}}applyLearningSteps(r,a,f){const{scheduled_minutes:c,next_steps:g}=this.getLearningInfo(this.current,a);if(c>0&&c<1440)r.learning_steps=g,r.scheduled_days=0,r.state=f,r.due=Kt(this.review_time,Math.round(c),!1);else if(r.state=G.Review,c>=1440)r.learning_steps=g,r.due=Kt(this.review_time,Math.round(c),!1),r.scheduled_days=Math.floor(c/1440);else{r.learning_steps=0;const v=this.algorithm.next_interval(r.stability,this.elapsed_days);r.scheduled_days=v,r.due=Kt(this.review_time,v,!0)}}newState(r){const a=this.next.get(r);if(a)return a;const f=N.card(this.current);f.difficulty=wt(this.algorithm.init_difficulty(r),1,10),f.stability=this.algorithm.init_stability(r),this.applyLearningSteps(f,r,G.Learning);const c={card:f,log:this.buildLog(r)};return this.next.set(r,c),c}learningState(r){const a=this.next.get(r);if(a)return a;const{state:f,difficulty:c,stability:g}=this.last,v=N.card(this.current);v.difficulty=this.algorithm.next_difficulty(c,r),v.stability=this.algorithm.next_short_term_stability(g,r),this.applyLearningSteps(v,r,f);const D={card:v,log:this.buildLog(r)};return this.next.set(r,D),D}reviewState(r){const a=this.next.get(r);if(a)return a;const f=this.elapsed_days,{difficulty:c,stability:g}=this.last,v=this.algorithm.forgetting_curve(f,g),D=N.card(this.current),L=N.card(this.current),I=N.card(this.current),U=N.card(this.current);this.next_ds(D,L,I,U,c,g,v),this.next_interval(L,I,U,f),this.next_state(L,I,U),this.applyLearningSteps(D,R.Again,G.Relearning),D.lapses+=1;const ut={card:D,log:this.buildLog(R.Again)},V={card:L,log:super.buildLog(R.Hard)},nt={card:I,log:super.buildLog(R.Good)},Zt={card:U,log:super.buildLog(R.Easy)};return this.next.set(R.Again,ut),this.next.set(R.Hard,V),this.next.set(R.Good,nt),this.next.set(R.Easy,Zt),this.next.get(r)}next_ds(r,a,f,c,g,v,D){r.difficulty=this.algorithm.next_difficulty(g,R.Again);const L=v/Math.exp(this.algorithm.parameters.w[17]*this.algorithm.parameters.w[18]),I=this.algorithm.next_forget_stability(g,v,D);r.stability=wt(+L.toFixed(8),Yt,I),a.difficulty=this.algorithm.next_difficulty(g,R.Hard),a.stability=this.algorithm.next_recall_stability(g,v,D,R.Hard),f.difficulty=this.algorithm.next_difficulty(g,R.Good),f.stability=this.algorithm.next_recall_stability(g,v,D,R.Good),c.difficulty=this.algorithm.next_difficulty(g,R.Easy),c.stability=this.algorithm.next_recall_stability(g,v,D,R.Easy)}next_interval(r,a,f,c){let g,v;g=this.algorithm.next_interval(r.stability,c),v=this.algorithm.next_interval(a.stability,c),g=Math.min(g,v),v=Math.max(v,g+1);const D=Math.max(this.algorithm.next_interval(f.stability,c),v+1);r.scheduled_days=g,r.due=Kt(this.review_time,g,!0),a.scheduled_days=v,a.due=Kt(this.review_time,v,!0),f.scheduled_days=D,f.due=Kt(this.review_time,D,!0)}next_state(r,a,f){r.state=G.Review,r.learning_steps=0,a.state=G.Review,a.learning_steps=0,f.state=G.Review,f.learning_steps=0}}class Yu extends lo{newState(i){const r=this.next.get(i);if(r)return r;this.current.scheduled_days=0,this.current.elapsed_days=0;const a=N.card(this.current),f=N.card(this.current),c=N.card(this.current),g=N.card(this.current);return this.init_ds(a,f,c,g),this.next_interval(a,f,c,g,0),this.next_state(a,f,c,g),this.update_next(a,f,c,g),this.next.get(i)}init_ds(i,r,a,f){i.difficulty=wt(this.algorithm.init_difficulty(R.Again),1,10),i.stability=this.algorithm.init_stability(R.Again),r.difficulty=wt(this.algorithm.init_difficulty(R.Hard),1,10),r.stability=this.algorithm.init_stability(R.Hard),a.difficulty=wt(this.algorithm.init_difficulty(R.Good),1,10),a.stability=this.algorithm.init_stability(R.Good),f.difficulty=wt(this.algorithm.init_difficulty(R.Easy),1,10),f.stability=this.algorithm.init_stability(R.Easy)}learningState(i){return this.reviewState(i)}reviewState(i){const r=this.next.get(i);if(r)return r;const a=this.elapsed_days,{difficulty:f,stability:c}=this.last,g=this.algorithm.forgetting_curve(a,c),v=N.card(this.current),D=N.card(this.current),L=N.card(this.current),I=N.card(this.current);return this.next_ds(v,D,L,I,f,c,g),this.next_interval(v,D,L,I,a),this.next_state(v,D,L,I),v.lapses+=1,this.update_next(v,D,L,I),this.next.get(i)}next_ds(i,r,a,f,c,g,v){i.difficulty=this.algorithm.next_difficulty(c,R.Again);const D=this.algorithm.next_forget_stability(c,g,v);i.stability=wt(g,Yt,D),r.difficulty=this.algorithm.next_difficulty(c,R.Hard),r.stability=this.algorithm.next_recall_stability(c,g,v,R.Hard),a.difficulty=this.algorithm.next_difficulty(c,R.Good),a.stability=this.algorithm.next_recall_stability(c,g,v,R.Good),f.difficulty=this.algorithm.next_difficulty(c,R.Easy),f.stability=this.algorithm.next_recall_stability(c,g,v,R.Easy)}next_interval(i,r,a,f,c){let g,v,D,L;g=this.algorithm.next_interval(i.stability,c),v=this.algorithm.next_interval(r.stability,c),D=this.algorithm.next_interval(a.stability,c),L=this.algorithm.next_interval(f.stability,c),g=Math.min(g,v),v=Math.max(v,g+1),D=Math.max(D,v+1),L=Math.max(L,D+1),i.scheduled_days=g,i.due=Kt(this.review_time,g,!0),r.scheduled_days=v,r.due=Kt(this.review_time,v,!0),a.scheduled_days=D,a.due=Kt(this.review_time,D,!0),f.scheduled_days=L,f.due=Kt(this.review_time,L,!0)}next_state(i,r,a,f){i.state=G.Review,i.learning_steps=0,r.state=G.Review,r.learning_steps=0,a.state=G.Review,a.learning_steps=0,f.state=G.Review,f.learning_steps=0}update_next(i,r,a,f){const c={card:i,log:this.buildLog(R.Again)},g={card:r,log:super.buildLog(R.Hard)},v={card:a,log:super.buildLog(R.Good)},D={card:f,log:super.buildLog(R.Easy)};this.next.set(R.Again,c),this.next.set(R.Hard,g),this.next.set(R.Good,v),this.next.set(R.Easy,D)}}class G_{constructor(i){P(this,"fsrs");this.fsrs=i}replay(i,r,a){return this.fsrs.next(i,r,a)}handleManualRating(i,r,a,f,c,g,v){if(typeof r>"u")throw new Error("reschedule: state is required for manual rating");let D,L;if(r===G.New)D={rating:R.Manual,state:r,due:v??a,stability:i.stability,difficulty:i.difficulty,elapsed_days:f,last_elapsed_days:i.elapsed_days,scheduled_days:i.scheduled_days,learning_steps:i.learning_steps,review:a},L=bn(a),L.last_review=a;else{if(typeof v>"u")throw new Error("reschedule: due is required for manual rating");const I=Xe(v,a,"days");D={rating:R.Manual,state:i.state,due:i.last_review||i.due,stability:i.stability,difficulty:i.difficulty,elapsed_days:f,last_elapsed_days:i.elapsed_days,scheduled_days:i.scheduled_days,learning_steps:i.learning_steps,review:a},L={...i,state:r,due:v,last_review:a,stability:c||i.stability,difficulty:g||i.difficulty,elapsed_days:f,scheduled_days:I,reps:i.reps+1}}return{card:L,log:D}}reschedule(i,r){const a=[];let f=bn(i.due);for(const c of r){let g;if(c.review=N.time(c.review),c.rating===R.Manual){let v=0;f.state!==G.New&&f.last_review&&(v=Xe(c.review,f.last_review,"days")),g=this.handleManualRating(f,c.state,c.review,v,c.stability,c.difficulty,c.due?N.time(c.due):void 0)}else g=this.replay(f,c.review,c.rating);a.push(g),f=g.card}return a}calculateManualRecord(i,r,a,f){if(!a)return null;const{card:c,log:g}=a,v=N.card(i);return v.due.getTime()===c.due.getTime()?null:(v.scheduled_days=Xe(c.due,v.due,"days"),this.handleManualRating(v,c.state,N.time(r),g.elapsed_days,f?c.stability:void 0,f?c.difficulty:void 0,c.due))}}class Zu extends N_{constructor(r){super(r);P(this,"strategyHandler",new Map);P(this,"Scheduler");const{enable_short_term:a}=this.parameters;this.Scheduler=a?Ku:Yu}params_handler_proxy(){const r=this;return{set:function(a,f,c){return f==="request_retention"&&Number.isFinite(c)?r.intervalModifier=r.calculate_interval_modifier(Number(c)):f==="enable_short_term"?r.Scheduler=c===!0?Ku:Yu:f==="w"&&(c=os(ls(c),a.relearning_steps.length),r.forgetting_curve=us.bind(this,c),r.intervalModifier=r.calculate_interval_modifier(Number(a.request_retention))),Reflect.set(a,f,c),!0}}}useStrategy(r,a){return this.strategyHandler.set(r,a),this}clearStrategy(r){return r?this.strategyHandler.delete(r):this.strategyHandler.clear(),this}getScheduler(r,a){const f=this.strategyHandler.get(Er.SCHEDULER)||this.Scheduler;return new f(r,a,this,this.strategyHandler)}repeat(r,a,f){const c=this.getScheduler(r,a).preview();return f&&typeof f=="function"?f(c):c}next(r,a,f,c){const g=this.getScheduler(r,a),v=N.rating(f);if(v===R.Manual)throw new Error("Cannot review a manual rating");const D=g.review(v);return c&&typeof c=="function"?c(D):D}get_retrievability(r,a,f=!0){const c=N.card(r);a=a?N.time(a):new Date;const g=c.state!==G.New?Math.max(Xe(a,c.last_review,"days"),0):0,v=c.state!==G.New?this.forgetting_curve(g,+c.stability.toFixed(8)):0;return f?`${(v*100).toFixed(2)}%`:v}rollback(r,a,f){const c=N.card(r),g=N.review_log(a);if(g.rating===R.Manual)throw new Error("Cannot rollback a manual rating");let v,D,L;switch(g.state){case G.New:v=g.due,D=void 0,L=0;break;case G.Learning:case G.Relearning:case G.Review:v=g.review,D=g.due,L=c.lapses-(g.rating===R.Again&&g.state===G.Review?1:0);break}const I={...c,due:v,stability:g.stability,difficulty:g.difficulty,elapsed_days:g.last_elapsed_days,scheduled_days:g.scheduled_days,reps:Math.max(0,c.reps-1),lapses:Math.max(0,L),learning_steps:g.learning_steps,state:g.state,last_review:D};return f&&typeof f=="function"?f(I):I}forget(r,a,f=!1,c){const g=N.card(r);a=N.time(a);const v=g.state===G.New?0:Xe(a,g.due,"days"),D={rating:R.Manual,state:g.state,due:g.due,stability:g.stability,difficulty:g.difficulty,elapsed_days:0,last_elapsed_days:g.elapsed_days,scheduled_days:v,learning_steps:g.learning_steps,review:a},L={card:{...g,due:a,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:f?0:g.reps,lapses:f?0:g.lapses,learning_steps:0,state:G.New,last_review:g.last_review},log:D};return c&&typeof c=="function"?c(L):L}reschedule(r,a=[],f={}){const{recordLogHandler:c,reviewsOrderBy:g,skipManual:v=!0,now:D=new Date,update_memory_state:L=!1}=f;g&&typeof g=="function"&&a.sort(g),v&&(a=a.filter(Zt=>Zt.rating!==R.Manual));const I=new G_(this),U=I.reschedule(f.first_card||bn(),a),ut=U.length,V=N.card(r),nt=I.calculateManualRecord(V,D,ut?U[ut-1]:void 0,L);return c&&typeof c=="function"?{collections:U.map(c),reschedule_item:nt?c(nt):null}:{collections:U,reschedule_item:nt}}}function k_(h,i,r,a){if(typeof i=="function"?h!==i||!a:!i.has(h))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?a:r==="a"?a.call(h):a?a.value:i.get(h)}function B_(h,i,r,a,f){if(typeof i=="function"?h!==i||!0:!i.has(h))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i.set(h,r),r}var Ar;function $_(h,i=!1){return window.__TAURI_INTERNALS__.transformCallback(h,i)}async function ct(h,i={},r){return window.__TAURI_INTERNALS__.invoke(h,i,r)}class H_{get rid(){return k_(this,Ar,"f")}constructor(i){Ar.set(this,void 0),B_(this,Ar,i)}async close(){return ct("plugin:resources|close",{rid:this.rid})}}Ar=new WeakMap;function ts(){return!!(globalThis||window).isTauri}var Ju;(function(h){h.WINDOW_RESIZED="tauri://resize",h.WINDOW_MOVED="tauri://move",h.WINDOW_CLOSE_REQUESTED="tauri://close-requested",h.WINDOW_DESTROYED="tauri://destroyed",h.WINDOW_FOCUS="tauri://focus",h.WINDOW_BLUR="tauri://blur",h.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",h.WINDOW_THEME_CHANGED="tauri://theme-changed",h.WINDOW_CREATED="tauri://window-created",h.WEBVIEW_CREATED="tauri://webview-created",h.DRAG_ENTER="tauri://drag-enter",h.DRAG_OVER="tauri://drag-over",h.DRAG_DROP="tauri://drag-drop",h.DRAG_LEAVE="tauri://drag-leave"})(Ju||(Ju={}));async function z_(h,i){window.__TAURI_EVENT_PLUGIN_INTERNALS__.unregisterListener(h,i),await ct("plugin:event|unlisten",{event:h,eventId:i})}async function Xu(h,i,r){var a;const f=(a=void 0)!==null&&a!==void 0?a:{kind:"Any"};return ct("plugin:event|listen",{event:h,target:f,handler:$_(i)}).then(c=>async()=>z_(h,c))}async function q_(h,i){return await br.load(h,i)}class br extends H_{constructor(i){super(i)}static async load(i,r){const a=await ct("plugin:store|load",{path:i,...r});return new br(a)}static async get(i){return await ct("plugin:store|get_store",{path:i}).then(r=>r?new br(r):null)}async set(i,r){await ct("plugin:store|set",{rid:this.rid,key:i,value:r})}async get(i){const[r,a]=await ct("plugin:store|get",{rid:this.rid,key:i});return a?r:void 0}async has(i){return await ct("plugin:store|has",{rid:this.rid,key:i})}async delete(i){return await ct("plugin:store|delete",{rid:this.rid,key:i})}async clear(){await ct("plugin:store|clear",{rid:this.rid})}async reset(){await ct("plugin:store|reset",{rid:this.rid})}async keys(){return await ct("plugin:store|keys",{rid:this.rid})}async values(){return await ct("plugin:store|values",{rid:this.rid})}async entries(){return await ct("plugin:store|entries",{rid:this.rid})}async length(){return await ct("plugin:store|length",{rid:this.rid})}async reload(){await ct("plugin:store|reload",{rid:this.rid})}async save(){await ct("plugin:store|save",{rid:this.rid})}async onKeyChange(i,r){return await Xu("store://change",a=>{a.payload.resourceId===this.rid&&a.payload.key===i&&r(a.payload.exists?a.payload.value:void 0)})}async onChange(i){return await Xu("store://change",r=>{r.payload.resourceId===this.rid&&i(r.payload.key,r.payload.exists?r.payload.value:void 0)})}}class K_{constructor(i){P(this,"storeFilename");P(this,"store",null);P(this,"isLoaded",!1);this.storeFilename=i}async ensureStoreLoaded(){this.isLoaded||(this.store=await q_(this.storeFilename,{autoSave:!1}),this.isLoaded=!0)}async load(i){if(await this.ensureStoreLoaded(),!!this.store)return await this.store.get(i)}async save(i,r){await this.ensureStoreLoaded(),this.store&&await this.store.set(i,r)}}const Y_="wenbun-deck-manager";class Z_{constructor(i){P(this,"storeName");P(this,"db");this.storeName=i}async ensureDBLoaded(){return this.db?new Promise(i=>i()):new Promise((i,r)=>{const a=window.indexedDB.open(Y_,1);a.onupgradeneeded=()=>{const f=a.result;f.objectStoreNames.contains(this.storeName)||f.createObjectStore(this.storeName)},a.onsuccess=()=>{this.db=a.result,i()},a.onerror=f=>{window.alert("Error opening database"),r(f)}})}async load(i){return await this.ensureDBLoaded(),new Promise((r,a)=>{if(!this.db)return r(void 0);const g=this.db.transaction(this.storeName,"readonly").objectStore(this.storeName).get(i);g.onsuccess=()=>r(g.result),g.onerror=()=>a(g.error)})}async save(i,r){return await this.ensureDBLoaded(),new Promise((a,f)=>{if(!this.db)return a();const v=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(r,i);v.onsuccess=()=>a(),v.onerror=()=>f(v.error)})}}var Rr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function J_(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var Rn={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */var X_=Rn.exports,Qu;function Q_(){return Qu||(Qu=1,function(h,i){(function(){var r,a="4.17.21",f=200,c="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",g="Expected a function",v="Invalid `variable` option passed into `_.template`",D="__lodash_hash_undefined__",L=500,I="__lodash_placeholder__",U=1,ut=2,V=4,nt=1,Zt=2,Ft=1,Me=2,fs=4,jt=8,Qe=16,te=32,Ve=64,ee=128,je=256,Ir=512,co=30,ho="...",go=800,po=16,cs=1,_o=2,wo=3,xe=1/0,he=9007199254740991,vo=17976931348623157e292,En=NaN,Jt=4294967295,yo=Jt-1,mo=Jt>>>1,So=[["ary",ee],["bind",Ft],["bindKey",Me],["curry",jt],["curryRight",Qe],["flip",Ir],["partial",te],["partialRight",Ve],["rearg",je]],Pe="[object Arguments]",In="[object Array]",Co="[object AsyncFunction]",tn="[object Boolean]",en="[object Date]",xo="[object DOMException]",Tn="[object Error]",On="[object Function]",hs="[object GeneratorFunction]",Gt="[object Map]",nn="[object Number]",Do="[object Null]",ne="[object Object]",ds="[object Promise]",Ro="[object Proxy]",rn="[object RegExp]",kt="[object Set]",sn="[object String]",Mn="[object Symbol]",Ao="[object Undefined]",an="[object WeakMap]",Lo="[object WeakSet]",un="[object ArrayBuffer]",Ne="[object DataView]",Tr="[object Float32Array]",Or="[object Float64Array]",Mr="[object Int8Array]",Pr="[object Int16Array]",Nr="[object Int32Array]",Ur="[object Uint8Array]",Wr="[object Uint8ClampedArray]",Fr="[object Uint16Array]",Gr="[object Uint32Array]",bo=/\b__p \+= '';/g,Eo=/\b(__p \+=) '' \+/g,Io=/(__e\(.*?\)|\b__t\)) \+\n'';/g,gs=/&(?:amp|lt|gt|quot|#39);/g,ps=/[&<>"']/g,To=RegExp(gs.source),Oo=RegExp(ps.source),Mo=/<%-([\s\S]+?)%>/g,Po=/<%([\s\S]+?)%>/g,_s=/<%=([\s\S]+?)%>/g,No=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Uo=/^\w*$/,Wo=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,kr=/[\\^$.*+?()[\]{}|]/g,Fo=RegExp(kr.source),Br=/^\s+/,Go=/\s/,ko=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Bo=/\{\n\/\* \[wrapped with (.+)\] \*/,$o=/,? & /,Ho=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,zo=/[()=,{}\[\]\/\s]/,qo=/\\(\\)?/g,Ko=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ws=/\w*$/,Yo=/^[-+]0x[0-9a-f]+$/i,Zo=/^0b[01]+$/i,Jo=/^\[object .+?Constructor\]$/,Xo=/^0o[0-7]+$/i,Qo=/^(?:0|[1-9]\d*)$/,Vo=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Pn=/($^)/,jo=/['\n\r\u2028\u2029\\]/g,Nn="\\ud800-\\udfff",tl="\\u0300-\\u036f",el="\\ufe20-\\ufe2f",nl="\\u20d0-\\u20ff",vs=tl+el+nl,ys="\\u2700-\\u27bf",ms="a-z\\xdf-\\xf6\\xf8-\\xff",rl="\\xac\\xb1\\xd7\\xf7",il="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",sl="\\u2000-\\u206f",al=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ss="A-Z\\xc0-\\xd6\\xd8-\\xde",Cs="\\ufe0e\\ufe0f",xs=rl+il+sl+al,$r="['’]",ul="["+Nn+"]",Ds="["+xs+"]",Un="["+vs+"]",Rs="\\d+",ol="["+ys+"]",As="["+ms+"]",Ls="[^"+Nn+xs+Rs+ys+ms+Ss+"]",Hr="\\ud83c[\\udffb-\\udfff]",ll="(?:"+Un+"|"+Hr+")",bs="[^"+Nn+"]",zr="(?:\\ud83c[\\udde6-\\uddff]){2}",qr="[\\ud800-\\udbff][\\udc00-\\udfff]",Ue="["+Ss+"]",Es="\\u200d",Is="(?:"+As+"|"+Ls+")",fl="(?:"+Ue+"|"+Ls+")",Ts="(?:"+$r+"(?:d|ll|m|re|s|t|ve))?",Os="(?:"+$r+"(?:D|LL|M|RE|S|T|VE))?",Ms=ll+"?",Ps="["+Cs+"]?",cl="(?:"+Es+"(?:"+[bs,zr,qr].join("|")+")"+Ps+Ms+")*",hl="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",dl="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ns=Ps+Ms+cl,gl="(?:"+[ol,zr,qr].join("|")+")"+Ns,pl="(?:"+[bs+Un+"?",Un,zr,qr,ul].join("|")+")",_l=RegExp($r,"g"),wl=RegExp(Un,"g"),Kr=RegExp(Hr+"(?="+Hr+")|"+pl+Ns,"g"),vl=RegExp([Ue+"?"+As+"+"+Ts+"(?="+[Ds,Ue,"$"].join("|")+")",fl+"+"+Os+"(?="+[Ds,Ue+Is,"$"].join("|")+")",Ue+"?"+Is+"+"+Ts,Ue+"+"+Os,dl,hl,Rs,gl].join("|"),"g"),yl=RegExp("["+Es+Nn+vs+Cs+"]"),ml=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Sl=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Cl=-1,Q={};Q[Tr]=Q[Or]=Q[Mr]=Q[Pr]=Q[Nr]=Q[Ur]=Q[Wr]=Q[Fr]=Q[Gr]=!0,Q[Pe]=Q[In]=Q[un]=Q[tn]=Q[Ne]=Q[en]=Q[Tn]=Q[On]=Q[Gt]=Q[nn]=Q[ne]=Q[rn]=Q[kt]=Q[sn]=Q[an]=!1;var X={};X[Pe]=X[In]=X[un]=X[Ne]=X[tn]=X[en]=X[Tr]=X[Or]=X[Mr]=X[Pr]=X[Nr]=X[Gt]=X[nn]=X[ne]=X[rn]=X[kt]=X[sn]=X[Mn]=X[Ur]=X[Wr]=X[Fr]=X[Gr]=!0,X[Tn]=X[On]=X[an]=!1;var xl={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},Dl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Rl={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Al={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ll=parseFloat,bl=parseInt,Us=typeof Rr=="object"&&Rr&&Rr.Object===Object&&Rr,El=typeof self=="object"&&self&&self.Object===Object&&self,lt=Us||El||Function("return this")(),Yr=i&&!i.nodeType&&i,De=Yr&&!0&&h&&!h.nodeType&&h,Ws=De&&De.exports===Yr,Zr=Ws&&Us.process,Et=function(){try{var _=De&&De.require&&De.require("util").types;return _||Zr&&Zr.binding&&Zr.binding("util")}catch{}}(),Fs=Et&&Et.isArrayBuffer,Gs=Et&&Et.isDate,ks=Et&&Et.isMap,Bs=Et&&Et.isRegExp,$s=Et&&Et.isSet,Hs=Et&&Et.isTypedArray;function Ct(_,m,y){switch(y.length){case 0:return _.call(m);case 1:return _.call(m,y[0]);case 2:return _.call(m,y[0],y[1]);case 3:return _.call(m,y[0],y[1],y[2])}return _.apply(m,y)}function Il(_,m,y,b){for(var W=-1,K=_==null?0:_.length;++W<K;){var st=_[W];m(b,st,y(st),_)}return b}function It(_,m){for(var y=-1,b=_==null?0:_.length;++y<b&&m(_[y],y,_)!==!1;);return _}function Tl(_,m){for(var y=_==null?0:_.length;y--&&m(_[y],y,_)!==!1;);return _}function zs(_,m){for(var y=-1,b=_==null?0:_.length;++y<b;)if(!m(_[y],y,_))return!1;return!0}function de(_,m){for(var y=-1,b=_==null?0:_.length,W=0,K=[];++y<b;){var st=_[y];m(st,y,_)&&(K[W++]=st)}return K}function Wn(_,m){var y=_==null?0:_.length;return!!y&&We(_,m,0)>-1}function Jr(_,m,y){for(var b=-1,W=_==null?0:_.length;++b<W;)if(y(m,_[b]))return!0;return!1}function j(_,m){for(var y=-1,b=_==null?0:_.length,W=Array(b);++y<b;)W[y]=m(_[y],y,_);return W}function ge(_,m){for(var y=-1,b=m.length,W=_.length;++y<b;)_[W+y]=m[y];return _}function Xr(_,m,y,b){var W=-1,K=_==null?0:_.length;for(b&&K&&(y=_[++W]);++W<K;)y=m(y,_[W],W,_);return y}function Ol(_,m,y,b){var W=_==null?0:_.length;for(b&&W&&(y=_[--W]);W--;)y=m(y,_[W],W,_);return y}function Qr(_,m){for(var y=-1,b=_==null?0:_.length;++y<b;)if(m(_[y],y,_))return!0;return!1}var Ml=Vr("length");function Pl(_){return _.split("")}function Nl(_){return _.match(Ho)||[]}function qs(_,m,y){var b;return y(_,function(W,K,st){if(m(W,K,st))return b=K,!1}),b}function Fn(_,m,y,b){for(var W=_.length,K=y+(b?1:-1);b?K--:++K<W;)if(m(_[K],K,_))return K;return-1}function We(_,m,y){return m===m?Yl(_,m,y):Fn(_,Ks,y)}function Ul(_,m,y,b){for(var W=y-1,K=_.length;++W<K;)if(b(_[W],m))return W;return-1}function Ks(_){return _!==_}function Ys(_,m){var y=_==null?0:_.length;return y?ti(_,m)/y:En}function Vr(_){return function(m){return m==null?r:m[_]}}function jr(_){return function(m){return _==null?r:_[m]}}function Zs(_,m,y,b,W){return W(_,function(K,st,J){y=b?(b=!1,K):m(y,K,st,J)}),y}function Wl(_,m){var y=_.length;for(_.sort(m);y--;)_[y]=_[y].value;return _}function ti(_,m){for(var y,b=-1,W=_.length;++b<W;){var K=m(_[b]);K!==r&&(y=y===r?K:y+K)}return y}function ei(_,m){for(var y=-1,b=Array(_);++y<_;)b[y]=m(y);return b}function Fl(_,m){return j(m,function(y){return[y,_[y]]})}function Js(_){return _&&_.slice(0,js(_)+1).replace(Br,"")}function xt(_){return function(m){return _(m)}}function ni(_,m){return j(m,function(y){return _[y]})}function on(_,m){return _.has(m)}function Xs(_,m){for(var y=-1,b=_.length;++y<b&&We(m,_[y],0)>-1;);return y}function Qs(_,m){for(var y=_.length;y--&&We(m,_[y],0)>-1;);return y}function Gl(_,m){for(var y=_.length,b=0;y--;)_[y]===m&&++b;return b}var kl=jr(xl),Bl=jr(Dl);function $l(_){return"\\"+Al[_]}function Hl(_,m){return _==null?r:_[m]}function Fe(_){return yl.test(_)}function zl(_){return ml.test(_)}function ql(_){for(var m,y=[];!(m=_.next()).done;)y.push(m.value);return y}function ri(_){var m=-1,y=Array(_.size);return _.forEach(function(b,W){y[++m]=[W,b]}),y}function Vs(_,m){return function(y){return _(m(y))}}function pe(_,m){for(var y=-1,b=_.length,W=0,K=[];++y<b;){var st=_[y];(st===m||st===I)&&(_[y]=I,K[W++]=y)}return K}function Gn(_){var m=-1,y=Array(_.size);return _.forEach(function(b){y[++m]=b}),y}function Kl(_){var m=-1,y=Array(_.size);return _.forEach(function(b){y[++m]=[b,b]}),y}function Yl(_,m,y){for(var b=y-1,W=_.length;++b<W;)if(_[b]===m)return b;return-1}function Zl(_,m,y){for(var b=y+1;b--;)if(_[b]===m)return b;return b}function Ge(_){return Fe(_)?Xl(_):Ml(_)}function Bt(_){return Fe(_)?Ql(_):Pl(_)}function js(_){for(var m=_.length;m--&&Go.test(_.charAt(m)););return m}var Jl=jr(Rl);function Xl(_){for(var m=Kr.lastIndex=0;Kr.test(_);)++m;return m}function Ql(_){return _.match(Kr)||[]}function Vl(_){return _.match(vl)||[]}var jl=function _(m){m=m==null?lt:ke.defaults(lt.Object(),m,ke.pick(lt,Sl));var y=m.Array,b=m.Date,W=m.Error,K=m.Function,st=m.Math,J=m.Object,ii=m.RegExp,tf=m.String,Tt=m.TypeError,kn=y.prototype,ef=K.prototype,Be=J.prototype,Bn=m["__core-js_shared__"],$n=ef.toString,Z=Be.hasOwnProperty,nf=0,ta=function(){var t=/[^.]+$/.exec(Bn&&Bn.keys&&Bn.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Hn=Be.toString,rf=$n.call(J),sf=lt._,af=ii("^"+$n.call(Z).replace(kr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),zn=Ws?m.Buffer:r,_e=m.Symbol,qn=m.Uint8Array,ea=zn?zn.allocUnsafe:r,Kn=Vs(J.getPrototypeOf,J),na=J.create,ra=Be.propertyIsEnumerable,Yn=kn.splice,ia=_e?_e.isConcatSpreadable:r,ln=_e?_e.iterator:r,Re=_e?_e.toStringTag:r,Zn=function(){try{var t=Ie(J,"defineProperty");return t({},"",{}),t}catch{}}(),uf=m.clearTimeout!==lt.clearTimeout&&m.clearTimeout,of=b&&b.now!==lt.Date.now&&b.now,lf=m.setTimeout!==lt.setTimeout&&m.setTimeout,Jn=st.ceil,Xn=st.floor,si=J.getOwnPropertySymbols,ff=zn?zn.isBuffer:r,sa=m.isFinite,cf=kn.join,hf=Vs(J.keys,J),at=st.max,ht=st.min,df=b.now,gf=m.parseInt,aa=st.random,pf=kn.reverse,ai=Ie(m,"DataView"),fn=Ie(m,"Map"),ui=Ie(m,"Promise"),$e=Ie(m,"Set"),cn=Ie(m,"WeakMap"),hn=Ie(J,"create"),Qn=cn&&new cn,He={},_f=Te(ai),wf=Te(fn),vf=Te(ui),yf=Te($e),mf=Te(cn),Vn=_e?_e.prototype:r,dn=Vn?Vn.valueOf:r,ua=Vn?Vn.toString:r;function o(t){if(et(t)&&!F(t)&&!(t instanceof z)){if(t instanceof Ot)return t;if(Z.call(t,"__wrapped__"))return ou(t)}return new Ot(t)}var ze=function(){function t(){}return function(e){if(!tt(e))return{};if(na)return na(e);t.prototype=e;var n=new t;return t.prototype=r,n}}();function jn(){}function Ot(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=r}o.templateSettings={escape:Mo,evaluate:Po,interpolate:_s,variable:"",imports:{_:o}},o.prototype=jn.prototype,o.prototype.constructor=o,Ot.prototype=ze(jn.prototype),Ot.prototype.constructor=Ot;function z(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Jt,this.__views__=[]}function Sf(){var t=new z(this.__wrapped__);return t.__actions__=vt(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=vt(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=vt(this.__views__),t}function Cf(){if(this.__filtered__){var t=new z(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function xf(){var t=this.__wrapped__.value(),e=this.__dir__,n=F(t),s=e<0,u=n?t.length:0,l=Nc(0,u,this.__views__),d=l.start,p=l.end,w=p-d,S=s?p:d-1,C=this.__iteratees__,x=C.length,A=0,E=ht(w,this.__takeCount__);if(!n||!s&&u==w&&E==w)return Ta(t,this.__actions__);var O=[];t:for(;w--&&A<E;){S+=e;for(var B=-1,M=t[S];++B<x;){var H=C[B],q=H.iteratee,At=H.type,_t=q(M);if(At==_o)M=_t;else if(!_t){if(At==cs)continue t;break t}}O[A++]=M}return O}z.prototype=ze(jn.prototype),z.prototype.constructor=z;function Ae(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var s=t[e];this.set(s[0],s[1])}}function Df(){this.__data__=hn?hn(null):{},this.size=0}function Rf(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function Af(t){var e=this.__data__;if(hn){var n=e[t];return n===D?r:n}return Z.call(e,t)?e[t]:r}function Lf(t){var e=this.__data__;return hn?e[t]!==r:Z.call(e,t)}function bf(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=hn&&e===r?D:e,this}Ae.prototype.clear=Df,Ae.prototype.delete=Rf,Ae.prototype.get=Af,Ae.prototype.has=Lf,Ae.prototype.set=bf;function re(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var s=t[e];this.set(s[0],s[1])}}function Ef(){this.__data__=[],this.size=0}function If(t){var e=this.__data__,n=tr(e,t);if(n<0)return!1;var s=e.length-1;return n==s?e.pop():Yn.call(e,n,1),--this.size,!0}function Tf(t){var e=this.__data__,n=tr(e,t);return n<0?r:e[n][1]}function Of(t){return tr(this.__data__,t)>-1}function Mf(t,e){var n=this.__data__,s=tr(n,t);return s<0?(++this.size,n.push([t,e])):n[s][1]=e,this}re.prototype.clear=Ef,re.prototype.delete=If,re.prototype.get=Tf,re.prototype.has=Of,re.prototype.set=Mf;function ie(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var s=t[e];this.set(s[0],s[1])}}function Pf(){this.size=0,this.__data__={hash:new Ae,map:new(fn||re),string:new Ae}}function Nf(t){var e=hr(this,t).delete(t);return this.size-=e?1:0,e}function Uf(t){return hr(this,t).get(t)}function Wf(t){return hr(this,t).has(t)}function Ff(t,e){var n=hr(this,t),s=n.size;return n.set(t,e),this.size+=n.size==s?0:1,this}ie.prototype.clear=Pf,ie.prototype.delete=Nf,ie.prototype.get=Uf,ie.prototype.has=Wf,ie.prototype.set=Ff;function Le(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new ie;++e<n;)this.add(t[e])}function Gf(t){return this.__data__.set(t,D),this}function kf(t){return this.__data__.has(t)}Le.prototype.add=Le.prototype.push=Gf,Le.prototype.has=kf;function $t(t){var e=this.__data__=new re(t);this.size=e.size}function Bf(){this.__data__=new re,this.size=0}function $f(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function Hf(t){return this.__data__.get(t)}function zf(t){return this.__data__.has(t)}function qf(t,e){var n=this.__data__;if(n instanceof re){var s=n.__data__;if(!fn||s.length<f-1)return s.push([t,e]),this.size=++n.size,this;n=this.__data__=new ie(s)}return n.set(t,e),this.size=n.size,this}$t.prototype.clear=Bf,$t.prototype.delete=$f,$t.prototype.get=Hf,$t.prototype.has=zf,$t.prototype.set=qf;function oa(t,e){var n=F(t),s=!n&&Oe(t),u=!n&&!s&&Se(t),l=!n&&!s&&!u&&Ze(t),d=n||s||u||l,p=d?ei(t.length,tf):[],w=p.length;for(var S in t)(e||Z.call(t,S))&&!(d&&(S=="length"||u&&(S=="offset"||S=="parent")||l&&(S=="buffer"||S=="byteLength"||S=="byteOffset")||oe(S,w)))&&p.push(S);return p}function la(t){var e=t.length;return e?t[vi(0,e-1)]:r}function Kf(t,e){return dr(vt(t),be(e,0,t.length))}function Yf(t){return dr(vt(t))}function oi(t,e,n){(n!==r&&!Ht(t[e],n)||n===r&&!(e in t))&&se(t,e,n)}function gn(t,e,n){var s=t[e];(!(Z.call(t,e)&&Ht(s,n))||n===r&&!(e in t))&&se(t,e,n)}function tr(t,e){for(var n=t.length;n--;)if(Ht(t[n][0],e))return n;return-1}function Zf(t,e,n,s){return we(t,function(u,l,d){e(s,u,n(u),d)}),s}function fa(t,e){return t&&Qt(e,ot(e),t)}function Jf(t,e){return t&&Qt(e,mt(e),t)}function se(t,e,n){e=="__proto__"&&Zn?Zn(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function li(t,e){for(var n=-1,s=e.length,u=y(s),l=t==null;++n<s;)u[n]=l?r:Hi(t,e[n]);return u}function be(t,e,n){return t===t&&(n!==r&&(t=t<=n?t:n),e!==r&&(t=t>=e?t:e)),t}function Mt(t,e,n,s,u,l){var d,p=e&U,w=e&ut,S=e&V;if(n&&(d=u?n(t,s,u,l):n(t)),d!==r)return d;if(!tt(t))return t;var C=F(t);if(C){if(d=Wc(t),!p)return vt(t,d)}else{var x=dt(t),A=x==On||x==hs;if(Se(t))return Pa(t,p);if(x==ne||x==Pe||A&&!u){if(d=w||A?{}:ja(t),!p)return w?Ac(t,Jf(d,t)):Rc(t,fa(d,t))}else{if(!X[x])return u?t:{};d=Fc(t,x,p)}}l||(l=new $t);var E=l.get(t);if(E)return E;l.set(t,d),bu(t)?t.forEach(function(M){d.add(Mt(M,e,n,M,t,l))}):Au(t)&&t.forEach(function(M,H){d.set(H,Mt(M,e,n,H,t,l))});var O=S?w?Ei:bi:w?mt:ot,B=C?r:O(t);return It(B||t,function(M,H){B&&(H=M,M=t[H]),gn(d,H,Mt(M,e,n,H,t,l))}),d}function Xf(t){var e=ot(t);return function(n){return ca(n,t,e)}}function ca(t,e,n){var s=n.length;if(t==null)return!s;for(t=J(t);s--;){var u=n[s],l=e[u],d=t[u];if(d===r&&!(u in t)||!l(d))return!1}return!0}function ha(t,e,n){if(typeof t!="function")throw new Tt(g);return Sn(function(){t.apply(r,n)},e)}function pn(t,e,n,s){var u=-1,l=Wn,d=!0,p=t.length,w=[],S=e.length;if(!p)return w;n&&(e=j(e,xt(n))),s?(l=Jr,d=!1):e.length>=f&&(l=on,d=!1,e=new Le(e));t:for(;++u<p;){var C=t[u],x=n==null?C:n(C);if(C=s||C!==0?C:0,d&&x===x){for(var A=S;A--;)if(e[A]===x)continue t;w.push(C)}else l(e,x,s)||w.push(C)}return w}var we=Ga(Xt),da=Ga(ci,!0);function Qf(t,e){var n=!0;return we(t,function(s,u,l){return n=!!e(s,u,l),n}),n}function er(t,e,n){for(var s=-1,u=t.length;++s<u;){var l=t[s],d=e(l);if(d!=null&&(p===r?d===d&&!Rt(d):n(d,p)))var p=d,w=l}return w}function Vf(t,e,n,s){var u=t.length;for(n=k(n),n<0&&(n=-n>u?0:u+n),s=s===r||s>u?u:k(s),s<0&&(s+=u),s=n>s?0:Iu(s);n<s;)t[n++]=e;return t}function ga(t,e){var n=[];return we(t,function(s,u,l){e(s,u,l)&&n.push(s)}),n}function ft(t,e,n,s,u){var l=-1,d=t.length;for(n||(n=kc),u||(u=[]);++l<d;){var p=t[l];e>0&&n(p)?e>1?ft(p,e-1,n,s,u):ge(u,p):s||(u[u.length]=p)}return u}var fi=ka(),pa=ka(!0);function Xt(t,e){return t&&fi(t,e,ot)}function ci(t,e){return t&&pa(t,e,ot)}function nr(t,e){return de(e,function(n){return le(t[n])})}function Ee(t,e){e=ye(e,t);for(var n=0,s=e.length;t!=null&&n<s;)t=t[Vt(e[n++])];return n&&n==s?t:r}function _a(t,e,n){var s=e(t);return F(t)?s:ge(s,n(t))}function gt(t){return t==null?t===r?Ao:Do:Re&&Re in J(t)?Pc(t):Yc(t)}function hi(t,e){return t>e}function jf(t,e){return t!=null&&Z.call(t,e)}function tc(t,e){return t!=null&&e in J(t)}function ec(t,e,n){return t>=ht(e,n)&&t<at(e,n)}function di(t,e,n){for(var s=n?Jr:Wn,u=t[0].length,l=t.length,d=l,p=y(l),w=1/0,S=[];d--;){var C=t[d];d&&e&&(C=j(C,xt(e))),w=ht(C.length,w),p[d]=!n&&(e||u>=120&&C.length>=120)?new Le(d&&C):r}C=t[0];var x=-1,A=p[0];t:for(;++x<u&&S.length<w;){var E=C[x],O=e?e(E):E;if(E=n||E!==0?E:0,!(A?on(A,O):s(S,O,n))){for(d=l;--d;){var B=p[d];if(!(B?on(B,O):s(t[d],O,n)))continue t}A&&A.push(O),S.push(E)}}return S}function nc(t,e,n,s){return Xt(t,function(u,l,d){e(s,n(u),l,d)}),s}function _n(t,e,n){e=ye(e,t),t=ru(t,e);var s=t==null?t:t[Vt(Nt(e))];return s==null?r:Ct(s,t,n)}function wa(t){return et(t)&&gt(t)==Pe}function rc(t){return et(t)&&gt(t)==un}function ic(t){return et(t)&&gt(t)==en}function wn(t,e,n,s,u){return t===e?!0:t==null||e==null||!et(t)&&!et(e)?t!==t&&e!==e:sc(t,e,n,s,wn,u)}function sc(t,e,n,s,u,l){var d=F(t),p=F(e),w=d?In:dt(t),S=p?In:dt(e);w=w==Pe?ne:w,S=S==Pe?ne:S;var C=w==ne,x=S==ne,A=w==S;if(A&&Se(t)){if(!Se(e))return!1;d=!0,C=!1}if(A&&!C)return l||(l=new $t),d||Ze(t)?Xa(t,e,n,s,u,l):Oc(t,e,w,n,s,u,l);if(!(n&nt)){var E=C&&Z.call(t,"__wrapped__"),O=x&&Z.call(e,"__wrapped__");if(E||O){var B=E?t.value():t,M=O?e.value():e;return l||(l=new $t),u(B,M,n,s,l)}}return A?(l||(l=new $t),Mc(t,e,n,s,u,l)):!1}function ac(t){return et(t)&&dt(t)==Gt}function gi(t,e,n,s){var u=n.length,l=u,d=!s;if(t==null)return!l;for(t=J(t);u--;){var p=n[u];if(d&&p[2]?p[1]!==t[p[0]]:!(p[0]in t))return!1}for(;++u<l;){p=n[u];var w=p[0],S=t[w],C=p[1];if(d&&p[2]){if(S===r&&!(w in t))return!1}else{var x=new $t;if(s)var A=s(S,C,w,t,e,x);if(!(A===r?wn(C,S,nt|Zt,s,x):A))return!1}}return!0}function va(t){if(!tt(t)||$c(t))return!1;var e=le(t)?af:Jo;return e.test(Te(t))}function uc(t){return et(t)&&gt(t)==rn}function oc(t){return et(t)&&dt(t)==kt}function lc(t){return et(t)&&yr(t.length)&&!!Q[gt(t)]}function ya(t){return typeof t=="function"?t:t==null?St:typeof t=="object"?F(t)?Ca(t[0],t[1]):Sa(t):Bu(t)}function pi(t){if(!mn(t))return hf(t);var e=[];for(var n in J(t))Z.call(t,n)&&n!="constructor"&&e.push(n);return e}function fc(t){if(!tt(t))return Kc(t);var e=mn(t),n=[];for(var s in t)s=="constructor"&&(e||!Z.call(t,s))||n.push(s);return n}function _i(t,e){return t<e}function ma(t,e){var n=-1,s=yt(t)?y(t.length):[];return we(t,function(u,l,d){s[++n]=e(u,l,d)}),s}function Sa(t){var e=Ti(t);return e.length==1&&e[0][2]?eu(e[0][0],e[0][1]):function(n){return n===t||gi(n,t,e)}}function Ca(t,e){return Mi(t)&&tu(e)?eu(Vt(t),e):function(n){var s=Hi(n,t);return s===r&&s===e?zi(n,t):wn(e,s,nt|Zt)}}function rr(t,e,n,s,u){t!==e&&fi(e,function(l,d){if(u||(u=new $t),tt(l))cc(t,e,d,n,rr,s,u);else{var p=s?s(Ni(t,d),l,d+"",t,e,u):r;p===r&&(p=l),oi(t,d,p)}},mt)}function cc(t,e,n,s,u,l,d){var p=Ni(t,n),w=Ni(e,n),S=d.get(w);if(S){oi(t,n,S);return}var C=l?l(p,w,n+"",t,e,d):r,x=C===r;if(x){var A=F(w),E=!A&&Se(w),O=!A&&!E&&Ze(w);C=w,A||E||O?F(p)?C=p:rt(p)?C=vt(p):E?(x=!1,C=Pa(w,!0)):O?(x=!1,C=Na(w,!0)):C=[]:Cn(w)||Oe(w)?(C=p,Oe(p)?C=Tu(p):(!tt(p)||le(p))&&(C=ja(w))):x=!1}x&&(d.set(w,C),u(C,w,s,l,d),d.delete(w)),oi(t,n,C)}function xa(t,e){var n=t.length;if(n)return e+=e<0?n:0,oe(e,n)?t[e]:r}function Da(t,e,n){e.length?e=j(e,function(l){return F(l)?function(d){return Ee(d,l.length===1?l[0]:l)}:l}):e=[St];var s=-1;e=j(e,xt(T()));var u=ma(t,function(l,d,p){var w=j(e,function(S){return S(l)});return{criteria:w,index:++s,value:l}});return Wl(u,function(l,d){return Dc(l,d,n)})}function hc(t,e){return Ra(t,e,function(n,s){return zi(t,s)})}function Ra(t,e,n){for(var s=-1,u=e.length,l={};++s<u;){var d=e[s],p=Ee(t,d);n(p,d)&&vn(l,ye(d,t),p)}return l}function dc(t){return function(e){return Ee(e,t)}}function wi(t,e,n,s){var u=s?Ul:We,l=-1,d=e.length,p=t;for(t===e&&(e=vt(e)),n&&(p=j(t,xt(n)));++l<d;)for(var w=0,S=e[l],C=n?n(S):S;(w=u(p,C,w,s))>-1;)p!==t&&Yn.call(p,w,1),Yn.call(t,w,1);return t}function Aa(t,e){for(var n=t?e.length:0,s=n-1;n--;){var u=e[n];if(n==s||u!==l){var l=u;oe(u)?Yn.call(t,u,1):Si(t,u)}}return t}function vi(t,e){return t+Xn(aa()*(e-t+1))}function gc(t,e,n,s){for(var u=-1,l=at(Jn((e-t)/(n||1)),0),d=y(l);l--;)d[s?l:++u]=t,t+=n;return d}function yi(t,e){var n="";if(!t||e<1||e>he)return n;do e%2&&(n+=t),e=Xn(e/2),e&&(t+=t);while(e);return n}function $(t,e){return Ui(nu(t,e,St),t+"")}function pc(t){return la(Je(t))}function _c(t,e){var n=Je(t);return dr(n,be(e,0,n.length))}function vn(t,e,n,s){if(!tt(t))return t;e=ye(e,t);for(var u=-1,l=e.length,d=l-1,p=t;p!=null&&++u<l;){var w=Vt(e[u]),S=n;if(w==="__proto__"||w==="constructor"||w==="prototype")return t;if(u!=d){var C=p[w];S=s?s(C,w,p):r,S===r&&(S=tt(C)?C:oe(e[u+1])?[]:{})}gn(p,w,S),p=p[w]}return t}var La=Qn?function(t,e){return Qn.set(t,e),t}:St,wc=Zn?function(t,e){return Zn(t,"toString",{configurable:!0,enumerable:!1,value:Ki(e),writable:!0})}:St;function vc(t){return dr(Je(t))}function Pt(t,e,n){var s=-1,u=t.length;e<0&&(e=-e>u?0:u+e),n=n>u?u:n,n<0&&(n+=u),u=e>n?0:n-e>>>0,e>>>=0;for(var l=y(u);++s<u;)l[s]=t[s+e];return l}function yc(t,e){var n;return we(t,function(s,u,l){return n=e(s,u,l),!n}),!!n}function ir(t,e,n){var s=0,u=t==null?s:t.length;if(typeof e=="number"&&e===e&&u<=mo){for(;s<u;){var l=s+u>>>1,d=t[l];d!==null&&!Rt(d)&&(n?d<=e:d<e)?s=l+1:u=l}return u}return mi(t,e,St,n)}function mi(t,e,n,s){var u=0,l=t==null?0:t.length;if(l===0)return 0;e=n(e);for(var d=e!==e,p=e===null,w=Rt(e),S=e===r;u<l;){var C=Xn((u+l)/2),x=n(t[C]),A=x!==r,E=x===null,O=x===x,B=Rt(x);if(d)var M=s||O;else S?M=O&&(s||A):p?M=O&&A&&(s||!E):w?M=O&&A&&!E&&(s||!B):E||B?M=!1:M=s?x<=e:x<e;M?u=C+1:l=C}return ht(l,yo)}function ba(t,e){for(var n=-1,s=t.length,u=0,l=[];++n<s;){var d=t[n],p=e?e(d):d;if(!n||!Ht(p,w)){var w=p;l[u++]=d===0?0:d}}return l}function Ea(t){return typeof t=="number"?t:Rt(t)?En:+t}function Dt(t){if(typeof t=="string")return t;if(F(t))return j(t,Dt)+"";if(Rt(t))return ua?ua.call(t):"";var e=t+"";return e=="0"&&1/t==-xe?"-0":e}function ve(t,e,n){var s=-1,u=Wn,l=t.length,d=!0,p=[],w=p;if(n)d=!1,u=Jr;else if(l>=f){var S=e?null:Ic(t);if(S)return Gn(S);d=!1,u=on,w=new Le}else w=e?[]:p;t:for(;++s<l;){var C=t[s],x=e?e(C):C;if(C=n||C!==0?C:0,d&&x===x){for(var A=w.length;A--;)if(w[A]===x)continue t;e&&w.push(x),p.push(C)}else u(w,x,n)||(w!==p&&w.push(x),p.push(C))}return p}function Si(t,e){return e=ye(e,t),t=ru(t,e),t==null||delete t[Vt(Nt(e))]}function Ia(t,e,n,s){return vn(t,e,n(Ee(t,e)),s)}function sr(t,e,n,s){for(var u=t.length,l=s?u:-1;(s?l--:++l<u)&&e(t[l],l,t););return n?Pt(t,s?0:l,s?l+1:u):Pt(t,s?l+1:0,s?u:l)}function Ta(t,e){var n=t;return n instanceof z&&(n=n.value()),Xr(e,function(s,u){return u.func.apply(u.thisArg,ge([s],u.args))},n)}function Ci(t,e,n){var s=t.length;if(s<2)return s?ve(t[0]):[];for(var u=-1,l=y(s);++u<s;)for(var d=t[u],p=-1;++p<s;)p!=u&&(l[u]=pn(l[u]||d,t[p],e,n));return ve(ft(l,1),e,n)}function Oa(t,e,n){for(var s=-1,u=t.length,l=e.length,d={};++s<u;){var p=s<l?e[s]:r;n(d,t[s],p)}return d}function xi(t){return rt(t)?t:[]}function Di(t){return typeof t=="function"?t:St}function ye(t,e){return F(t)?t:Mi(t,e)?[t]:uu(Y(t))}var mc=$;function me(t,e,n){var s=t.length;return n=n===r?s:n,!e&&n>=s?t:Pt(t,e,n)}var Ma=uf||function(t){return lt.clearTimeout(t)};function Pa(t,e){if(e)return t.slice();var n=t.length,s=ea?ea(n):new t.constructor(n);return t.copy(s),s}function Ri(t){var e=new t.constructor(t.byteLength);return new qn(e).set(new qn(t)),e}function Sc(t,e){var n=e?Ri(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}function Cc(t){var e=new t.constructor(t.source,ws.exec(t));return e.lastIndex=t.lastIndex,e}function xc(t){return dn?J(dn.call(t)):{}}function Na(t,e){var n=e?Ri(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Ua(t,e){if(t!==e){var n=t!==r,s=t===null,u=t===t,l=Rt(t),d=e!==r,p=e===null,w=e===e,S=Rt(e);if(!p&&!S&&!l&&t>e||l&&d&&w&&!p&&!S||s&&d&&w||!n&&w||!u)return 1;if(!s&&!l&&!S&&t<e||S&&n&&u&&!s&&!l||p&&n&&u||!d&&u||!w)return-1}return 0}function Dc(t,e,n){for(var s=-1,u=t.criteria,l=e.criteria,d=u.length,p=n.length;++s<d;){var w=Ua(u[s],l[s]);if(w){if(s>=p)return w;var S=n[s];return w*(S=="desc"?-1:1)}}return t.index-e.index}function Wa(t,e,n,s){for(var u=-1,l=t.length,d=n.length,p=-1,w=e.length,S=at(l-d,0),C=y(w+S),x=!s;++p<w;)C[p]=e[p];for(;++u<d;)(x||u<l)&&(C[n[u]]=t[u]);for(;S--;)C[p++]=t[u++];return C}function Fa(t,e,n,s){for(var u=-1,l=t.length,d=-1,p=n.length,w=-1,S=e.length,C=at(l-p,0),x=y(C+S),A=!s;++u<C;)x[u]=t[u];for(var E=u;++w<S;)x[E+w]=e[w];for(;++d<p;)(A||u<l)&&(x[E+n[d]]=t[u++]);return x}function vt(t,e){var n=-1,s=t.length;for(e||(e=y(s));++n<s;)e[n]=t[n];return e}function Qt(t,e,n,s){var u=!n;n||(n={});for(var l=-1,d=e.length;++l<d;){var p=e[l],w=s?s(n[p],t[p],p,n,t):r;w===r&&(w=t[p]),u?se(n,p,w):gn(n,p,w)}return n}function Rc(t,e){return Qt(t,Oi(t),e)}function Ac(t,e){return Qt(t,Qa(t),e)}function ar(t,e){return function(n,s){var u=F(n)?Il:Zf,l=e?e():{};return u(n,t,T(s,2),l)}}function qe(t){return $(function(e,n){var s=-1,u=n.length,l=u>1?n[u-1]:r,d=u>2?n[2]:r;for(l=t.length>3&&typeof l=="function"?(u--,l):r,d&&pt(n[0],n[1],d)&&(l=u<3?r:l,u=1),e=J(e);++s<u;){var p=n[s];p&&t(e,p,s,l)}return e})}function Ga(t,e){return function(n,s){if(n==null)return n;if(!yt(n))return t(n,s);for(var u=n.length,l=e?u:-1,d=J(n);(e?l--:++l<u)&&s(d[l],l,d)!==!1;);return n}}function ka(t){return function(e,n,s){for(var u=-1,l=J(e),d=s(e),p=d.length;p--;){var w=d[t?p:++u];if(n(l[w],w,l)===!1)break}return e}}function Lc(t,e,n){var s=e&Ft,u=yn(t);function l(){var d=this&&this!==lt&&this instanceof l?u:t;return d.apply(s?n:this,arguments)}return l}function Ba(t){return function(e){e=Y(e);var n=Fe(e)?Bt(e):r,s=n?n[0]:e.charAt(0),u=n?me(n,1).join(""):e.slice(1);return s[t]()+u}}function Ke(t){return function(e){return Xr(Gu(Fu(e).replace(_l,"")),t,"")}}function yn(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=ze(t.prototype),s=t.apply(n,e);return tt(s)?s:n}}function bc(t,e,n){var s=yn(t);function u(){for(var l=arguments.length,d=y(l),p=l,w=Ye(u);p--;)d[p]=arguments[p];var S=l<3&&d[0]!==w&&d[l-1]!==w?[]:pe(d,w);if(l-=S.length,l<n)return Ka(t,e,ur,u.placeholder,r,d,S,r,r,n-l);var C=this&&this!==lt&&this instanceof u?s:t;return Ct(C,this,d)}return u}function $a(t){return function(e,n,s){var u=J(e);if(!yt(e)){var l=T(n,3);e=ot(e),n=function(p){return l(u[p],p,u)}}var d=t(e,n,s);return d>-1?u[l?e[d]:d]:r}}function Ha(t){return ue(function(e){var n=e.length,s=n,u=Ot.prototype.thru;for(t&&e.reverse();s--;){var l=e[s];if(typeof l!="function")throw new Tt(g);if(u&&!d&&cr(l)=="wrapper")var d=new Ot([],!0)}for(s=d?s:n;++s<n;){l=e[s];var p=cr(l),w=p=="wrapper"?Ii(l):r;w&&Pi(w[0])&&w[1]==(ee|jt|te|je)&&!w[4].length&&w[9]==1?d=d[cr(w[0])].apply(d,w[3]):d=l.length==1&&Pi(l)?d[p]():d.thru(l)}return function(){var S=arguments,C=S[0];if(d&&S.length==1&&F(C))return d.plant(C).value();for(var x=0,A=n?e[x].apply(this,S):C;++x<n;)A=e[x].call(this,A);return A}})}function ur(t,e,n,s,u,l,d,p,w,S){var C=e&ee,x=e&Ft,A=e&Me,E=e&(jt|Qe),O=e&Ir,B=A?r:yn(t);function M(){for(var H=arguments.length,q=y(H),At=H;At--;)q[At]=arguments[At];if(E)var _t=Ye(M),Lt=Gl(q,_t);if(s&&(q=Wa(q,s,u,E)),l&&(q=Fa(q,l,d,E)),H-=Lt,E&&H<S){var it=pe(q,_t);return Ka(t,e,ur,M.placeholder,n,q,it,p,w,S-H)}var zt=x?n:this,ce=A?zt[t]:t;return H=q.length,p?q=Zc(q,p):O&&H>1&&q.reverse(),C&&w<H&&(q.length=w),this&&this!==lt&&this instanceof M&&(ce=B||yn(ce)),ce.apply(zt,q)}return M}function za(t,e){return function(n,s){return nc(n,t,e(s),{})}}function or(t,e){return function(n,s){var u;if(n===r&&s===r)return e;if(n!==r&&(u=n),s!==r){if(u===r)return s;typeof n=="string"||typeof s=="string"?(n=Dt(n),s=Dt(s)):(n=Ea(n),s=Ea(s)),u=t(n,s)}return u}}function Ai(t){return ue(function(e){return e=j(e,xt(T())),$(function(n){var s=this;return t(e,function(u){return Ct(u,s,n)})})})}function lr(t,e){e=e===r?" ":Dt(e);var n=e.length;if(n<2)return n?yi(e,t):e;var s=yi(e,Jn(t/Ge(e)));return Fe(e)?me(Bt(s),0,t).join(""):s.slice(0,t)}function Ec(t,e,n,s){var u=e&Ft,l=yn(t);function d(){for(var p=-1,w=arguments.length,S=-1,C=s.length,x=y(C+w),A=this&&this!==lt&&this instanceof d?l:t;++S<C;)x[S]=s[S];for(;w--;)x[S++]=arguments[++p];return Ct(A,u?n:this,x)}return d}function qa(t){return function(e,n,s){return s&&typeof s!="number"&&pt(e,n,s)&&(n=s=r),e=fe(e),n===r?(n=e,e=0):n=fe(n),s=s===r?e<n?1:-1:fe(s),gc(e,n,s,t)}}function fr(t){return function(e,n){return typeof e=="string"&&typeof n=="string"||(e=Ut(e),n=Ut(n)),t(e,n)}}function Ka(t,e,n,s,u,l,d,p,w,S){var C=e&jt,x=C?d:r,A=C?r:d,E=C?l:r,O=C?r:l;e|=C?te:Ve,e&=~(C?Ve:te),e&fs||(e&=-4);var B=[t,e,u,E,x,O,A,p,w,S],M=n.apply(r,B);return Pi(t)&&iu(M,B),M.placeholder=s,su(M,t,e)}function Li(t){var e=st[t];return function(n,s){if(n=Ut(n),s=s==null?0:ht(k(s),292),s&&sa(n)){var u=(Y(n)+"e").split("e"),l=e(u[0]+"e"+(+u[1]+s));return u=(Y(l)+"e").split("e"),+(u[0]+"e"+(+u[1]-s))}return e(n)}}var Ic=$e&&1/Gn(new $e([,-0]))[1]==xe?function(t){return new $e(t)}:Ji;function Ya(t){return function(e){var n=dt(e);return n==Gt?ri(e):n==kt?Kl(e):Fl(e,t(e))}}function ae(t,e,n,s,u,l,d,p){var w=e&Me;if(!w&&typeof t!="function")throw new Tt(g);var S=s?s.length:0;if(S||(e&=-97,s=u=r),d=d===r?d:at(k(d),0),p=p===r?p:k(p),S-=u?u.length:0,e&Ve){var C=s,x=u;s=u=r}var A=w?r:Ii(t),E=[t,e,n,s,u,C,x,l,d,p];if(A&&qc(E,A),t=E[0],e=E[1],n=E[2],s=E[3],u=E[4],p=E[9]=E[9]===r?w?0:t.length:at(E[9]-S,0),!p&&e&(jt|Qe)&&(e&=-25),!e||e==Ft)var O=Lc(t,e,n);else e==jt||e==Qe?O=bc(t,e,p):(e==te||e==(Ft|te))&&!u.length?O=Ec(t,e,n,s):O=ur.apply(r,E);var B=A?La:iu;return su(B(O,E),t,e)}function Za(t,e,n,s){return t===r||Ht(t,Be[n])&&!Z.call(s,n)?e:t}function Ja(t,e,n,s,u,l){return tt(t)&&tt(e)&&(l.set(e,t),rr(t,e,r,Ja,l),l.delete(e)),t}function Tc(t){return Cn(t)?r:t}function Xa(t,e,n,s,u,l){var d=n&nt,p=t.length,w=e.length;if(p!=w&&!(d&&w>p))return!1;var S=l.get(t),C=l.get(e);if(S&&C)return S==e&&C==t;var x=-1,A=!0,E=n&Zt?new Le:r;for(l.set(t,e),l.set(e,t);++x<p;){var O=t[x],B=e[x];if(s)var M=d?s(B,O,x,e,t,l):s(O,B,x,t,e,l);if(M!==r){if(M)continue;A=!1;break}if(E){if(!Qr(e,function(H,q){if(!on(E,q)&&(O===H||u(O,H,n,s,l)))return E.push(q)})){A=!1;break}}else if(!(O===B||u(O,B,n,s,l))){A=!1;break}}return l.delete(t),l.delete(e),A}function Oc(t,e,n,s,u,l,d){switch(n){case Ne:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case un:return!(t.byteLength!=e.byteLength||!l(new qn(t),new qn(e)));case tn:case en:case nn:return Ht(+t,+e);case Tn:return t.name==e.name&&t.message==e.message;case rn:case sn:return t==e+"";case Gt:var p=ri;case kt:var w=s&nt;if(p||(p=Gn),t.size!=e.size&&!w)return!1;var S=d.get(t);if(S)return S==e;s|=Zt,d.set(t,e);var C=Xa(p(t),p(e),s,u,l,d);return d.delete(t),C;case Mn:if(dn)return dn.call(t)==dn.call(e)}return!1}function Mc(t,e,n,s,u,l){var d=n&nt,p=bi(t),w=p.length,S=bi(e),C=S.length;if(w!=C&&!d)return!1;for(var x=w;x--;){var A=p[x];if(!(d?A in e:Z.call(e,A)))return!1}var E=l.get(t),O=l.get(e);if(E&&O)return E==e&&O==t;var B=!0;l.set(t,e),l.set(e,t);for(var M=d;++x<w;){A=p[x];var H=t[A],q=e[A];if(s)var At=d?s(q,H,A,e,t,l):s(H,q,A,t,e,l);if(!(At===r?H===q||u(H,q,n,s,l):At)){B=!1;break}M||(M=A=="constructor")}if(B&&!M){var _t=t.constructor,Lt=e.constructor;_t!=Lt&&"constructor"in t&&"constructor"in e&&!(typeof _t=="function"&&_t instanceof _t&&typeof Lt=="function"&&Lt instanceof Lt)&&(B=!1)}return l.delete(t),l.delete(e),B}function ue(t){return Ui(nu(t,r,cu),t+"")}function bi(t){return _a(t,ot,Oi)}function Ei(t){return _a(t,mt,Qa)}var Ii=Qn?function(t){return Qn.get(t)}:Ji;function cr(t){for(var e=t.name+"",n=He[e],s=Z.call(He,e)?n.length:0;s--;){var u=n[s],l=u.func;if(l==null||l==t)return u.name}return e}function Ye(t){var e=Z.call(o,"placeholder")?o:t;return e.placeholder}function T(){var t=o.iteratee||Yi;return t=t===Yi?ya:t,arguments.length?t(arguments[0],arguments[1]):t}function hr(t,e){var n=t.__data__;return Bc(e)?n[typeof e=="string"?"string":"hash"]:n.map}function Ti(t){for(var e=ot(t),n=e.length;n--;){var s=e[n],u=t[s];e[n]=[s,u,tu(u)]}return e}function Ie(t,e){var n=Hl(t,e);return va(n)?n:r}function Pc(t){var e=Z.call(t,Re),n=t[Re];try{t[Re]=r;var s=!0}catch{}var u=Hn.call(t);return s&&(e?t[Re]=n:delete t[Re]),u}var Oi=si?function(t){return t==null?[]:(t=J(t),de(si(t),function(e){return ra.call(t,e)}))}:Xi,Qa=si?function(t){for(var e=[];t;)ge(e,Oi(t)),t=Kn(t);return e}:Xi,dt=gt;(ai&&dt(new ai(new ArrayBuffer(1)))!=Ne||fn&&dt(new fn)!=Gt||ui&&dt(ui.resolve())!=ds||$e&&dt(new $e)!=kt||cn&&dt(new cn)!=an)&&(dt=function(t){var e=gt(t),n=e==ne?t.constructor:r,s=n?Te(n):"";if(s)switch(s){case _f:return Ne;case wf:return Gt;case vf:return ds;case yf:return kt;case mf:return an}return e});function Nc(t,e,n){for(var s=-1,u=n.length;++s<u;){var l=n[s],d=l.size;switch(l.type){case"drop":t+=d;break;case"dropRight":e-=d;break;case"take":e=ht(e,t+d);break;case"takeRight":t=at(t,e-d);break}}return{start:t,end:e}}function Uc(t){var e=t.match(Bo);return e?e[1].split($o):[]}function Va(t,e,n){e=ye(e,t);for(var s=-1,u=e.length,l=!1;++s<u;){var d=Vt(e[s]);if(!(l=t!=null&&n(t,d)))break;t=t[d]}return l||++s!=u?l:(u=t==null?0:t.length,!!u&&yr(u)&&oe(d,u)&&(F(t)||Oe(t)))}function Wc(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&Z.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function ja(t){return typeof t.constructor=="function"&&!mn(t)?ze(Kn(t)):{}}function Fc(t,e,n){var s=t.constructor;switch(e){case un:return Ri(t);case tn:case en:return new s(+t);case Ne:return Sc(t,n);case Tr:case Or:case Mr:case Pr:case Nr:case Ur:case Wr:case Fr:case Gr:return Na(t,n);case Gt:return new s;case nn:case sn:return new s(t);case rn:return Cc(t);case kt:return new s;case Mn:return xc(t)}}function Gc(t,e){var n=e.length;if(!n)return t;var s=n-1;return e[s]=(n>1?"& ":"")+e[s],e=e.join(n>2?", ":" "),t.replace(ko,`{
/* [wrapped with `+e+`] */
`)}function kc(t){return F(t)||Oe(t)||!!(ia&&t&&t[ia])}function oe(t,e){var n=typeof t;return e=e??he,!!e&&(n=="number"||n!="symbol"&&Qo.test(t))&&t>-1&&t%1==0&&t<e}function pt(t,e,n){if(!tt(n))return!1;var s=typeof e;return(s=="number"?yt(n)&&oe(e,n.length):s=="string"&&e in n)?Ht(n[e],t):!1}function Mi(t,e){if(F(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||Rt(t)?!0:Uo.test(t)||!No.test(t)||e!=null&&t in J(e)}function Bc(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function Pi(t){var e=cr(t),n=o[e];if(typeof n!="function"||!(e in z.prototype))return!1;if(t===n)return!0;var s=Ii(n);return!!s&&t===s[0]}function $c(t){return!!ta&&ta in t}var Hc=Bn?le:Qi;function mn(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||Be;return t===n}function tu(t){return t===t&&!tt(t)}function eu(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==r||t in J(n))}}function zc(t){var e=wr(t,function(s){return n.size===L&&n.clear(),s}),n=e.cache;return e}function qc(t,e){var n=t[1],s=e[1],u=n|s,l=u<(Ft|Me|ee),d=s==ee&&n==jt||s==ee&&n==je&&t[7].length<=e[8]||s==(ee|je)&&e[7].length<=e[8]&&n==jt;if(!(l||d))return t;s&Ft&&(t[2]=e[2],u|=n&Ft?0:fs);var p=e[3];if(p){var w=t[3];t[3]=w?Wa(w,p,e[4]):p,t[4]=w?pe(t[3],I):e[4]}return p=e[5],p&&(w=t[5],t[5]=w?Fa(w,p,e[6]):p,t[6]=w?pe(t[5],I):e[6]),p=e[7],p&&(t[7]=p),s&ee&&(t[8]=t[8]==null?e[8]:ht(t[8],e[8])),t[9]==null&&(t[9]=e[9]),t[0]=e[0],t[1]=u,t}function Kc(t){var e=[];if(t!=null)for(var n in J(t))e.push(n);return e}function Yc(t){return Hn.call(t)}function nu(t,e,n){return e=at(e===r?t.length-1:e,0),function(){for(var s=arguments,u=-1,l=at(s.length-e,0),d=y(l);++u<l;)d[u]=s[e+u];u=-1;for(var p=y(e+1);++u<e;)p[u]=s[u];return p[e]=n(d),Ct(t,this,p)}}function ru(t,e){return e.length<2?t:Ee(t,Pt(e,0,-1))}function Zc(t,e){for(var n=t.length,s=ht(e.length,n),u=vt(t);s--;){var l=e[s];t[s]=oe(l,n)?u[l]:r}return t}function Ni(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var iu=au(La),Sn=lf||function(t,e){return lt.setTimeout(t,e)},Ui=au(wc);function su(t,e,n){var s=e+"";return Ui(t,Gc(s,Jc(Uc(s),n)))}function au(t){var e=0,n=0;return function(){var s=df(),u=po-(s-n);if(n=s,u>0){if(++e>=go)return arguments[0]}else e=0;return t.apply(r,arguments)}}function dr(t,e){var n=-1,s=t.length,u=s-1;for(e=e===r?s:e;++n<e;){var l=vi(n,u),d=t[l];t[l]=t[n],t[n]=d}return t.length=e,t}var uu=zc(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Wo,function(n,s,u,l){e.push(u?l.replace(qo,"$1"):s||n)}),e});function Vt(t){if(typeof t=="string"||Rt(t))return t;var e=t+"";return e=="0"&&1/t==-xe?"-0":e}function Te(t){if(t!=null){try{return $n.call(t)}catch{}try{return t+""}catch{}}return""}function Jc(t,e){return It(So,function(n){var s="_."+n[0];e&n[1]&&!Wn(t,s)&&t.push(s)}),t.sort()}function ou(t){if(t instanceof z)return t.clone();var e=new Ot(t.__wrapped__,t.__chain__);return e.__actions__=vt(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function Xc(t,e,n){(n?pt(t,e,n):e===r)?e=1:e=at(k(e),0);var s=t==null?0:t.length;if(!s||e<1)return[];for(var u=0,l=0,d=y(Jn(s/e));u<s;)d[l++]=Pt(t,u,u+=e);return d}function Qc(t){for(var e=-1,n=t==null?0:t.length,s=0,u=[];++e<n;){var l=t[e];l&&(u[s++]=l)}return u}function Vc(){var t=arguments.length;if(!t)return[];for(var e=y(t-1),n=arguments[0],s=t;s--;)e[s-1]=arguments[s];return ge(F(n)?vt(n):[n],ft(e,1))}var jc=$(function(t,e){return rt(t)?pn(t,ft(e,1,rt,!0)):[]}),th=$(function(t,e){var n=Nt(e);return rt(n)&&(n=r),rt(t)?pn(t,ft(e,1,rt,!0),T(n,2)):[]}),eh=$(function(t,e){var n=Nt(e);return rt(n)&&(n=r),rt(t)?pn(t,ft(e,1,rt,!0),r,n):[]});function nh(t,e,n){var s=t==null?0:t.length;return s?(e=n||e===r?1:k(e),Pt(t,e<0?0:e,s)):[]}function rh(t,e,n){var s=t==null?0:t.length;return s?(e=n||e===r?1:k(e),e=s-e,Pt(t,0,e<0?0:e)):[]}function ih(t,e){return t&&t.length?sr(t,T(e,3),!0,!0):[]}function sh(t,e){return t&&t.length?sr(t,T(e,3),!0):[]}function ah(t,e,n,s){var u=t==null?0:t.length;return u?(n&&typeof n!="number"&&pt(t,e,n)&&(n=0,s=u),Vf(t,e,n,s)):[]}function lu(t,e,n){var s=t==null?0:t.length;if(!s)return-1;var u=n==null?0:k(n);return u<0&&(u=at(s+u,0)),Fn(t,T(e,3),u)}function fu(t,e,n){var s=t==null?0:t.length;if(!s)return-1;var u=s-1;return n!==r&&(u=k(n),u=n<0?at(s+u,0):ht(u,s-1)),Fn(t,T(e,3),u,!0)}function cu(t){var e=t==null?0:t.length;return e?ft(t,1):[]}function uh(t){var e=t==null?0:t.length;return e?ft(t,xe):[]}function oh(t,e){var n=t==null?0:t.length;return n?(e=e===r?1:k(e),ft(t,e)):[]}function lh(t){for(var e=-1,n=t==null?0:t.length,s={};++e<n;){var u=t[e];s[u[0]]=u[1]}return s}function hu(t){return t&&t.length?t[0]:r}function fh(t,e,n){var s=t==null?0:t.length;if(!s)return-1;var u=n==null?0:k(n);return u<0&&(u=at(s+u,0)),We(t,e,u)}function ch(t){var e=t==null?0:t.length;return e?Pt(t,0,-1):[]}var hh=$(function(t){var e=j(t,xi);return e.length&&e[0]===t[0]?di(e):[]}),dh=$(function(t){var e=Nt(t),n=j(t,xi);return e===Nt(n)?e=r:n.pop(),n.length&&n[0]===t[0]?di(n,T(e,2)):[]}),gh=$(function(t){var e=Nt(t),n=j(t,xi);return e=typeof e=="function"?e:r,e&&n.pop(),n.length&&n[0]===t[0]?di(n,r,e):[]});function ph(t,e){return t==null?"":cf.call(t,e)}function Nt(t){var e=t==null?0:t.length;return e?t[e-1]:r}function _h(t,e,n){var s=t==null?0:t.length;if(!s)return-1;var u=s;return n!==r&&(u=k(n),u=u<0?at(s+u,0):ht(u,s-1)),e===e?Zl(t,e,u):Fn(t,Ks,u,!0)}function wh(t,e){return t&&t.length?xa(t,k(e)):r}var vh=$(du);function du(t,e){return t&&t.length&&e&&e.length?wi(t,e):t}function yh(t,e,n){return t&&t.length&&e&&e.length?wi(t,e,T(n,2)):t}function mh(t,e,n){return t&&t.length&&e&&e.length?wi(t,e,r,n):t}var Sh=ue(function(t,e){var n=t==null?0:t.length,s=li(t,e);return Aa(t,j(e,function(u){return oe(u,n)?+u:u}).sort(Ua)),s});function Ch(t,e){var n=[];if(!(t&&t.length))return n;var s=-1,u=[],l=t.length;for(e=T(e,3);++s<l;){var d=t[s];e(d,s,t)&&(n.push(d),u.push(s))}return Aa(t,u),n}function Wi(t){return t==null?t:pf.call(t)}function xh(t,e,n){var s=t==null?0:t.length;return s?(n&&typeof n!="number"&&pt(t,e,n)?(e=0,n=s):(e=e==null?0:k(e),n=n===r?s:k(n)),Pt(t,e,n)):[]}function Dh(t,e){return ir(t,e)}function Rh(t,e,n){return mi(t,e,T(n,2))}function Ah(t,e){var n=t==null?0:t.length;if(n){var s=ir(t,e);if(s<n&&Ht(t[s],e))return s}return-1}function Lh(t,e){return ir(t,e,!0)}function bh(t,e,n){return mi(t,e,T(n,2),!0)}function Eh(t,e){var n=t==null?0:t.length;if(n){var s=ir(t,e,!0)-1;if(Ht(t[s],e))return s}return-1}function Ih(t){return t&&t.length?ba(t):[]}function Th(t,e){return t&&t.length?ba(t,T(e,2)):[]}function Oh(t){var e=t==null?0:t.length;return e?Pt(t,1,e):[]}function Mh(t,e,n){return t&&t.length?(e=n||e===r?1:k(e),Pt(t,0,e<0?0:e)):[]}function Ph(t,e,n){var s=t==null?0:t.length;return s?(e=n||e===r?1:k(e),e=s-e,Pt(t,e<0?0:e,s)):[]}function Nh(t,e){return t&&t.length?sr(t,T(e,3),!1,!0):[]}function Uh(t,e){return t&&t.length?sr(t,T(e,3)):[]}var Wh=$(function(t){return ve(ft(t,1,rt,!0))}),Fh=$(function(t){var e=Nt(t);return rt(e)&&(e=r),ve(ft(t,1,rt,!0),T(e,2))}),Gh=$(function(t){var e=Nt(t);return e=typeof e=="function"?e:r,ve(ft(t,1,rt,!0),r,e)});function kh(t){return t&&t.length?ve(t):[]}function Bh(t,e){return t&&t.length?ve(t,T(e,2)):[]}function $h(t,e){return e=typeof e=="function"?e:r,t&&t.length?ve(t,r,e):[]}function Fi(t){if(!(t&&t.length))return[];var e=0;return t=de(t,function(n){if(rt(n))return e=at(n.length,e),!0}),ei(e,function(n){return j(t,Vr(n))})}function gu(t,e){if(!(t&&t.length))return[];var n=Fi(t);return e==null?n:j(n,function(s){return Ct(e,r,s)})}var Hh=$(function(t,e){return rt(t)?pn(t,e):[]}),zh=$(function(t){return Ci(de(t,rt))}),qh=$(function(t){var e=Nt(t);return rt(e)&&(e=r),Ci(de(t,rt),T(e,2))}),Kh=$(function(t){var e=Nt(t);return e=typeof e=="function"?e:r,Ci(de(t,rt),r,e)}),Yh=$(Fi);function Zh(t,e){return Oa(t||[],e||[],gn)}function Jh(t,e){return Oa(t||[],e||[],vn)}var Xh=$(function(t){var e=t.length,n=e>1?t[e-1]:r;return n=typeof n=="function"?(t.pop(),n):r,gu(t,n)});function pu(t){var e=o(t);return e.__chain__=!0,e}function Qh(t,e){return e(t),t}function gr(t,e){return e(t)}var Vh=ue(function(t){var e=t.length,n=e?t[0]:0,s=this.__wrapped__,u=function(l){return li(l,t)};return e>1||this.__actions__.length||!(s instanceof z)||!oe(n)?this.thru(u):(s=s.slice(n,+n+(e?1:0)),s.__actions__.push({func:gr,args:[u],thisArg:r}),new Ot(s,this.__chain__).thru(function(l){return e&&!l.length&&l.push(r),l}))});function jh(){return pu(this)}function td(){return new Ot(this.value(),this.__chain__)}function ed(){this.__values__===r&&(this.__values__=Eu(this.value()));var t=this.__index__>=this.__values__.length,e=t?r:this.__values__[this.__index__++];return{done:t,value:e}}function nd(){return this}function rd(t){for(var e,n=this;n instanceof jn;){var s=ou(n);s.__index__=0,s.__values__=r,e?u.__wrapped__=s:e=s;var u=s;n=n.__wrapped__}return u.__wrapped__=t,e}function id(){var t=this.__wrapped__;if(t instanceof z){var e=t;return this.__actions__.length&&(e=new z(this)),e=e.reverse(),e.__actions__.push({func:gr,args:[Wi],thisArg:r}),new Ot(e,this.__chain__)}return this.thru(Wi)}function sd(){return Ta(this.__wrapped__,this.__actions__)}var ad=ar(function(t,e,n){Z.call(t,n)?++t[n]:se(t,n,1)});function ud(t,e,n){var s=F(t)?zs:Qf;return n&&pt(t,e,n)&&(e=r),s(t,T(e,3))}function od(t,e){var n=F(t)?de:ga;return n(t,T(e,3))}var ld=$a(lu),fd=$a(fu);function cd(t,e){return ft(pr(t,e),1)}function hd(t,e){return ft(pr(t,e),xe)}function dd(t,e,n){return n=n===r?1:k(n),ft(pr(t,e),n)}function _u(t,e){var n=F(t)?It:we;return n(t,T(e,3))}function wu(t,e){var n=F(t)?Tl:da;return n(t,T(e,3))}var gd=ar(function(t,e,n){Z.call(t,n)?t[n].push(e):se(t,n,[e])});function pd(t,e,n,s){t=yt(t)?t:Je(t),n=n&&!s?k(n):0;var u=t.length;return n<0&&(n=at(u+n,0)),mr(t)?n<=u&&t.indexOf(e,n)>-1:!!u&&We(t,e,n)>-1}var _d=$(function(t,e,n){var s=-1,u=typeof e=="function",l=yt(t)?y(t.length):[];return we(t,function(d){l[++s]=u?Ct(e,d,n):_n(d,e,n)}),l}),wd=ar(function(t,e,n){se(t,n,e)});function pr(t,e){var n=F(t)?j:ma;return n(t,T(e,3))}function vd(t,e,n,s){return t==null?[]:(F(e)||(e=e==null?[]:[e]),n=s?r:n,F(n)||(n=n==null?[]:[n]),Da(t,e,n))}var yd=ar(function(t,e,n){t[n?0:1].push(e)},function(){return[[],[]]});function md(t,e,n){var s=F(t)?Xr:Zs,u=arguments.length<3;return s(t,T(e,4),n,u,we)}function Sd(t,e,n){var s=F(t)?Ol:Zs,u=arguments.length<3;return s(t,T(e,4),n,u,da)}function Cd(t,e){var n=F(t)?de:ga;return n(t,vr(T(e,3)))}function xd(t){var e=F(t)?la:pc;return e(t)}function Dd(t,e,n){(n?pt(t,e,n):e===r)?e=1:e=k(e);var s=F(t)?Kf:_c;return s(t,e)}function Rd(t){var e=F(t)?Yf:vc;return e(t)}function Ad(t){if(t==null)return 0;if(yt(t))return mr(t)?Ge(t):t.length;var e=dt(t);return e==Gt||e==kt?t.size:pi(t).length}function Ld(t,e,n){var s=F(t)?Qr:yc;return n&&pt(t,e,n)&&(e=r),s(t,T(e,3))}var bd=$(function(t,e){if(t==null)return[];var n=e.length;return n>1&&pt(t,e[0],e[1])?e=[]:n>2&&pt(e[0],e[1],e[2])&&(e=[e[0]]),Da(t,ft(e,1),[])}),_r=of||function(){return lt.Date.now()};function Ed(t,e){if(typeof e!="function")throw new Tt(g);return t=k(t),function(){if(--t<1)return e.apply(this,arguments)}}function vu(t,e,n){return e=n?r:e,e=t&&e==null?t.length:e,ae(t,ee,r,r,r,r,e)}function yu(t,e){var n;if(typeof e!="function")throw new Tt(g);return t=k(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=r),n}}var Gi=$(function(t,e,n){var s=Ft;if(n.length){var u=pe(n,Ye(Gi));s|=te}return ae(t,s,e,n,u)}),mu=$(function(t,e,n){var s=Ft|Me;if(n.length){var u=pe(n,Ye(mu));s|=te}return ae(e,s,t,n,u)});function Su(t,e,n){e=n?r:e;var s=ae(t,jt,r,r,r,r,r,e);return s.placeholder=Su.placeholder,s}function Cu(t,e,n){e=n?r:e;var s=ae(t,Qe,r,r,r,r,r,e);return s.placeholder=Cu.placeholder,s}function xu(t,e,n){var s,u,l,d,p,w,S=0,C=!1,x=!1,A=!0;if(typeof t!="function")throw new Tt(g);e=Ut(e)||0,tt(n)&&(C=!!n.leading,x="maxWait"in n,l=x?at(Ut(n.maxWait)||0,e):l,A="trailing"in n?!!n.trailing:A);function E(it){var zt=s,ce=u;return s=u=r,S=it,d=t.apply(ce,zt),d}function O(it){return S=it,p=Sn(H,e),C?E(it):d}function B(it){var zt=it-w,ce=it-S,$u=e-zt;return x?ht($u,l-ce):$u}function M(it){var zt=it-w,ce=it-S;return w===r||zt>=e||zt<0||x&&ce>=l}function H(){var it=_r();if(M(it))return q(it);p=Sn(H,B(it))}function q(it){return p=r,A&&s?E(it):(s=u=r,d)}function At(){p!==r&&Ma(p),S=0,s=w=u=p=r}function _t(){return p===r?d:q(_r())}function Lt(){var it=_r(),zt=M(it);if(s=arguments,u=this,w=it,zt){if(p===r)return O(w);if(x)return Ma(p),p=Sn(H,e),E(w)}return p===r&&(p=Sn(H,e)),d}return Lt.cancel=At,Lt.flush=_t,Lt}var Id=$(function(t,e){return ha(t,1,e)}),Td=$(function(t,e,n){return ha(t,Ut(e)||0,n)});function Od(t){return ae(t,Ir)}function wr(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new Tt(g);var n=function(){var s=arguments,u=e?e.apply(this,s):s[0],l=n.cache;if(l.has(u))return l.get(u);var d=t.apply(this,s);return n.cache=l.set(u,d)||l,d};return n.cache=new(wr.Cache||ie),n}wr.Cache=ie;function vr(t){if(typeof t!="function")throw new Tt(g);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function Md(t){return yu(2,t)}var Pd=mc(function(t,e){e=e.length==1&&F(e[0])?j(e[0],xt(T())):j(ft(e,1),xt(T()));var n=e.length;return $(function(s){for(var u=-1,l=ht(s.length,n);++u<l;)s[u]=e[u].call(this,s[u]);return Ct(t,this,s)})}),ki=$(function(t,e){var n=pe(e,Ye(ki));return ae(t,te,r,e,n)}),Du=$(function(t,e){var n=pe(e,Ye(Du));return ae(t,Ve,r,e,n)}),Nd=ue(function(t,e){return ae(t,je,r,r,r,e)});function Ud(t,e){if(typeof t!="function")throw new Tt(g);return e=e===r?e:k(e),$(t,e)}function Wd(t,e){if(typeof t!="function")throw new Tt(g);return e=e==null?0:at(k(e),0),$(function(n){var s=n[e],u=me(n,0,e);return s&&ge(u,s),Ct(t,this,u)})}function Fd(t,e,n){var s=!0,u=!0;if(typeof t!="function")throw new Tt(g);return tt(n)&&(s="leading"in n?!!n.leading:s,u="trailing"in n?!!n.trailing:u),xu(t,e,{leading:s,maxWait:e,trailing:u})}function Gd(t){return vu(t,1)}function kd(t,e){return ki(Di(e),t)}function Bd(){if(!arguments.length)return[];var t=arguments[0];return F(t)?t:[t]}function $d(t){return Mt(t,V)}function Hd(t,e){return e=typeof e=="function"?e:r,Mt(t,V,e)}function zd(t){return Mt(t,U|V)}function qd(t,e){return e=typeof e=="function"?e:r,Mt(t,U|V,e)}function Kd(t,e){return e==null||ca(t,e,ot(e))}function Ht(t,e){return t===e||t!==t&&e!==e}var Yd=fr(hi),Zd=fr(function(t,e){return t>=e}),Oe=wa(function(){return arguments}())?wa:function(t){return et(t)&&Z.call(t,"callee")&&!ra.call(t,"callee")},F=y.isArray,Jd=Fs?xt(Fs):rc;function yt(t){return t!=null&&yr(t.length)&&!le(t)}function rt(t){return et(t)&&yt(t)}function Xd(t){return t===!0||t===!1||et(t)&&gt(t)==tn}var Se=ff||Qi,Qd=Gs?xt(Gs):ic;function Vd(t){return et(t)&&t.nodeType===1&&!Cn(t)}function jd(t){if(t==null)return!0;if(yt(t)&&(F(t)||typeof t=="string"||typeof t.splice=="function"||Se(t)||Ze(t)||Oe(t)))return!t.length;var e=dt(t);if(e==Gt||e==kt)return!t.size;if(mn(t))return!pi(t).length;for(var n in t)if(Z.call(t,n))return!1;return!0}function tg(t,e){return wn(t,e)}function eg(t,e,n){n=typeof n=="function"?n:r;var s=n?n(t,e):r;return s===r?wn(t,e,r,n):!!s}function Bi(t){if(!et(t))return!1;var e=gt(t);return e==Tn||e==xo||typeof t.message=="string"&&typeof t.name=="string"&&!Cn(t)}function ng(t){return typeof t=="number"&&sa(t)}function le(t){if(!tt(t))return!1;var e=gt(t);return e==On||e==hs||e==Co||e==Ro}function Ru(t){return typeof t=="number"&&t==k(t)}function yr(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=he}function tt(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function et(t){return t!=null&&typeof t=="object"}var Au=ks?xt(ks):ac;function rg(t,e){return t===e||gi(t,e,Ti(e))}function ig(t,e,n){return n=typeof n=="function"?n:r,gi(t,e,Ti(e),n)}function sg(t){return Lu(t)&&t!=+t}function ag(t){if(Hc(t))throw new W(c);return va(t)}function ug(t){return t===null}function og(t){return t==null}function Lu(t){return typeof t=="number"||et(t)&&gt(t)==nn}function Cn(t){if(!et(t)||gt(t)!=ne)return!1;var e=Kn(t);if(e===null)return!0;var n=Z.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&$n.call(n)==rf}var $i=Bs?xt(Bs):uc;function lg(t){return Ru(t)&&t>=-he&&t<=he}var bu=$s?xt($s):oc;function mr(t){return typeof t=="string"||!F(t)&&et(t)&&gt(t)==sn}function Rt(t){return typeof t=="symbol"||et(t)&&gt(t)==Mn}var Ze=Hs?xt(Hs):lc;function fg(t){return t===r}function cg(t){return et(t)&&dt(t)==an}function hg(t){return et(t)&&gt(t)==Lo}var dg=fr(_i),gg=fr(function(t,e){return t<=e});function Eu(t){if(!t)return[];if(yt(t))return mr(t)?Bt(t):vt(t);if(ln&&t[ln])return ql(t[ln]());var e=dt(t),n=e==Gt?ri:e==kt?Gn:Je;return n(t)}function fe(t){if(!t)return t===0?t:0;if(t=Ut(t),t===xe||t===-xe){var e=t<0?-1:1;return e*vo}return t===t?t:0}function k(t){var e=fe(t),n=e%1;return e===e?n?e-n:e:0}function Iu(t){return t?be(k(t),0,Jt):0}function Ut(t){if(typeof t=="number")return t;if(Rt(t))return En;if(tt(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=tt(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Js(t);var n=Zo.test(t);return n||Xo.test(t)?bl(t.slice(2),n?2:8):Yo.test(t)?En:+t}function Tu(t){return Qt(t,mt(t))}function pg(t){return t?be(k(t),-he,he):t===0?t:0}function Y(t){return t==null?"":Dt(t)}var _g=qe(function(t,e){if(mn(e)||yt(e)){Qt(e,ot(e),t);return}for(var n in e)Z.call(e,n)&&gn(t,n,e[n])}),Ou=qe(function(t,e){Qt(e,mt(e),t)}),Sr=qe(function(t,e,n,s){Qt(e,mt(e),t,s)}),wg=qe(function(t,e,n,s){Qt(e,ot(e),t,s)}),vg=ue(li);function yg(t,e){var n=ze(t);return e==null?n:fa(n,e)}var mg=$(function(t,e){t=J(t);var n=-1,s=e.length,u=s>2?e[2]:r;for(u&&pt(e[0],e[1],u)&&(s=1);++n<s;)for(var l=e[n],d=mt(l),p=-1,w=d.length;++p<w;){var S=d[p],C=t[S];(C===r||Ht(C,Be[S])&&!Z.call(t,S))&&(t[S]=l[S])}return t}),Sg=$(function(t){return t.push(r,Ja),Ct(Mu,r,t)});function Cg(t,e){return qs(t,T(e,3),Xt)}function xg(t,e){return qs(t,T(e,3),ci)}function Dg(t,e){return t==null?t:fi(t,T(e,3),mt)}function Rg(t,e){return t==null?t:pa(t,T(e,3),mt)}function Ag(t,e){return t&&Xt(t,T(e,3))}function Lg(t,e){return t&&ci(t,T(e,3))}function bg(t){return t==null?[]:nr(t,ot(t))}function Eg(t){return t==null?[]:nr(t,mt(t))}function Hi(t,e,n){var s=t==null?r:Ee(t,e);return s===r?n:s}function Ig(t,e){return t!=null&&Va(t,e,jf)}function zi(t,e){return t!=null&&Va(t,e,tc)}var Tg=za(function(t,e,n){e!=null&&typeof e.toString!="function"&&(e=Hn.call(e)),t[e]=n},Ki(St)),Og=za(function(t,e,n){e!=null&&typeof e.toString!="function"&&(e=Hn.call(e)),Z.call(t,e)?t[e].push(n):t[e]=[n]},T),Mg=$(_n);function ot(t){return yt(t)?oa(t):pi(t)}function mt(t){return yt(t)?oa(t,!0):fc(t)}function Pg(t,e){var n={};return e=T(e,3),Xt(t,function(s,u,l){se(n,e(s,u,l),s)}),n}function Ng(t,e){var n={};return e=T(e,3),Xt(t,function(s,u,l){se(n,u,e(s,u,l))}),n}var Ug=qe(function(t,e,n){rr(t,e,n)}),Mu=qe(function(t,e,n,s){rr(t,e,n,s)}),Wg=ue(function(t,e){var n={};if(t==null)return n;var s=!1;e=j(e,function(l){return l=ye(l,t),s||(s=l.length>1),l}),Qt(t,Ei(t),n),s&&(n=Mt(n,U|ut|V,Tc));for(var u=e.length;u--;)Si(n,e[u]);return n});function Fg(t,e){return Pu(t,vr(T(e)))}var Gg=ue(function(t,e){return t==null?{}:hc(t,e)});function Pu(t,e){if(t==null)return{};var n=j(Ei(t),function(s){return[s]});return e=T(e),Ra(t,n,function(s,u){return e(s,u[0])})}function kg(t,e,n){e=ye(e,t);var s=-1,u=e.length;for(u||(u=1,t=r);++s<u;){var l=t==null?r:t[Vt(e[s])];l===r&&(s=u,l=n),t=le(l)?l.call(t):l}return t}function Bg(t,e,n){return t==null?t:vn(t,e,n)}function $g(t,e,n,s){return s=typeof s=="function"?s:r,t==null?t:vn(t,e,n,s)}var Nu=Ya(ot),Uu=Ya(mt);function Hg(t,e,n){var s=F(t),u=s||Se(t)||Ze(t);if(e=T(e,4),n==null){var l=t&&t.constructor;u?n=s?new l:[]:tt(t)?n=le(l)?ze(Kn(t)):{}:n={}}return(u?It:Xt)(t,function(d,p,w){return e(n,d,p,w)}),n}function zg(t,e){return t==null?!0:Si(t,e)}function qg(t,e,n){return t==null?t:Ia(t,e,Di(n))}function Kg(t,e,n,s){return s=typeof s=="function"?s:r,t==null?t:Ia(t,e,Di(n),s)}function Je(t){return t==null?[]:ni(t,ot(t))}function Yg(t){return t==null?[]:ni(t,mt(t))}function Zg(t,e,n){return n===r&&(n=e,e=r),n!==r&&(n=Ut(n),n=n===n?n:0),e!==r&&(e=Ut(e),e=e===e?e:0),be(Ut(t),e,n)}function Jg(t,e,n){return e=fe(e),n===r?(n=e,e=0):n=fe(n),t=Ut(t),ec(t,e,n)}function Xg(t,e,n){if(n&&typeof n!="boolean"&&pt(t,e,n)&&(e=n=r),n===r&&(typeof e=="boolean"?(n=e,e=r):typeof t=="boolean"&&(n=t,t=r)),t===r&&e===r?(t=0,e=1):(t=fe(t),e===r?(e=t,t=0):e=fe(e)),t>e){var s=t;t=e,e=s}if(n||t%1||e%1){var u=aa();return ht(t+u*(e-t+Ll("1e-"+((u+"").length-1))),e)}return vi(t,e)}var Qg=Ke(function(t,e,n){return e=e.toLowerCase(),t+(n?Wu(e):e)});function Wu(t){return qi(Y(t).toLowerCase())}function Fu(t){return t=Y(t),t&&t.replace(Vo,kl).replace(wl,"")}function Vg(t,e,n){t=Y(t),e=Dt(e);var s=t.length;n=n===r?s:be(k(n),0,s);var u=n;return n-=e.length,n>=0&&t.slice(n,u)==e}function jg(t){return t=Y(t),t&&Oo.test(t)?t.replace(ps,Bl):t}function tp(t){return t=Y(t),t&&Fo.test(t)?t.replace(kr,"\\$&"):t}var ep=Ke(function(t,e,n){return t+(n?"-":"")+e.toLowerCase()}),np=Ke(function(t,e,n){return t+(n?" ":"")+e.toLowerCase()}),rp=Ba("toLowerCase");function ip(t,e,n){t=Y(t),e=k(e);var s=e?Ge(t):0;if(!e||s>=e)return t;var u=(e-s)/2;return lr(Xn(u),n)+t+lr(Jn(u),n)}function sp(t,e,n){t=Y(t),e=k(e);var s=e?Ge(t):0;return e&&s<e?t+lr(e-s,n):t}function ap(t,e,n){t=Y(t),e=k(e);var s=e?Ge(t):0;return e&&s<e?lr(e-s,n)+t:t}function up(t,e,n){return n||e==null?e=0:e&&(e=+e),gf(Y(t).replace(Br,""),e||0)}function op(t,e,n){return(n?pt(t,e,n):e===r)?e=1:e=k(e),yi(Y(t),e)}function lp(){var t=arguments,e=Y(t[0]);return t.length<3?e:e.replace(t[1],t[2])}var fp=Ke(function(t,e,n){return t+(n?"_":"")+e.toLowerCase()});function cp(t,e,n){return n&&typeof n!="number"&&pt(t,e,n)&&(e=n=r),n=n===r?Jt:n>>>0,n?(t=Y(t),t&&(typeof e=="string"||e!=null&&!$i(e))&&(e=Dt(e),!e&&Fe(t))?me(Bt(t),0,n):t.split(e,n)):[]}var hp=Ke(function(t,e,n){return t+(n?" ":"")+qi(e)});function dp(t,e,n){return t=Y(t),n=n==null?0:be(k(n),0,t.length),e=Dt(e),t.slice(n,n+e.length)==e}function gp(t,e,n){var s=o.templateSettings;n&&pt(t,e,n)&&(e=r),t=Y(t),e=Sr({},e,s,Za);var u=Sr({},e.imports,s.imports,Za),l=ot(u),d=ni(u,l),p,w,S=0,C=e.interpolate||Pn,x="__p += '",A=ii((e.escape||Pn).source+"|"+C.source+"|"+(C===_s?Ko:Pn).source+"|"+(e.evaluate||Pn).source+"|$","g"),E="//# sourceURL="+(Z.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Cl+"]")+`
`;t.replace(A,function(M,H,q,At,_t,Lt){return q||(q=At),x+=t.slice(S,Lt).replace(jo,$l),H&&(p=!0,x+=`' +
__e(`+H+`) +
'`),_t&&(w=!0,x+=`';
`+_t+`;
__p += '`),q&&(x+=`' +
((__t = (`+q+`)) == null ? '' : __t) +
'`),S=Lt+M.length,M}),x+=`';
`;var O=Z.call(e,"variable")&&e.variable;if(!O)x=`with (obj) {
`+x+`
}
`;else if(zo.test(O))throw new W(v);x=(w?x.replace(bo,""):x).replace(Eo,"$1").replace(Io,"$1;"),x="function("+(O||"obj")+`) {
`+(O?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(p?", __e = _.escape":"")+(w?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+x+`return __p
}`;var B=ku(function(){return K(l,E+"return "+x).apply(r,d)});if(B.source=x,Bi(B))throw B;return B}function pp(t){return Y(t).toLowerCase()}function _p(t){return Y(t).toUpperCase()}function wp(t,e,n){if(t=Y(t),t&&(n||e===r))return Js(t);if(!t||!(e=Dt(e)))return t;var s=Bt(t),u=Bt(e),l=Xs(s,u),d=Qs(s,u)+1;return me(s,l,d).join("")}function vp(t,e,n){if(t=Y(t),t&&(n||e===r))return t.slice(0,js(t)+1);if(!t||!(e=Dt(e)))return t;var s=Bt(t),u=Qs(s,Bt(e))+1;return me(s,0,u).join("")}function yp(t,e,n){if(t=Y(t),t&&(n||e===r))return t.replace(Br,"");if(!t||!(e=Dt(e)))return t;var s=Bt(t),u=Xs(s,Bt(e));return me(s,u).join("")}function mp(t,e){var n=co,s=ho;if(tt(e)){var u="separator"in e?e.separator:u;n="length"in e?k(e.length):n,s="omission"in e?Dt(e.omission):s}t=Y(t);var l=t.length;if(Fe(t)){var d=Bt(t);l=d.length}if(n>=l)return t;var p=n-Ge(s);if(p<1)return s;var w=d?me(d,0,p).join(""):t.slice(0,p);if(u===r)return w+s;if(d&&(p+=w.length-p),$i(u)){if(t.slice(p).search(u)){var S,C=w;for(u.global||(u=ii(u.source,Y(ws.exec(u))+"g")),u.lastIndex=0;S=u.exec(C);)var x=S.index;w=w.slice(0,x===r?p:x)}}else if(t.indexOf(Dt(u),p)!=p){var A=w.lastIndexOf(u);A>-1&&(w=w.slice(0,A))}return w+s}function Sp(t){return t=Y(t),t&&To.test(t)?t.replace(gs,Jl):t}var Cp=Ke(function(t,e,n){return t+(n?" ":"")+e.toUpperCase()}),qi=Ba("toUpperCase");function Gu(t,e,n){return t=Y(t),e=n?r:e,e===r?zl(t)?Vl(t):Nl(t):t.match(e)||[]}var ku=$(function(t,e){try{return Ct(t,r,e)}catch(n){return Bi(n)?n:new W(n)}}),xp=ue(function(t,e){return It(e,function(n){n=Vt(n),se(t,n,Gi(t[n],t))}),t});function Dp(t){var e=t==null?0:t.length,n=T();return t=e?j(t,function(s){if(typeof s[1]!="function")throw new Tt(g);return[n(s[0]),s[1]]}):[],$(function(s){for(var u=-1;++u<e;){var l=t[u];if(Ct(l[0],this,s))return Ct(l[1],this,s)}})}function Rp(t){return Xf(Mt(t,U))}function Ki(t){return function(){return t}}function Ap(t,e){return t==null||t!==t?e:t}var Lp=Ha(),bp=Ha(!0);function St(t){return t}function Yi(t){return ya(typeof t=="function"?t:Mt(t,U))}function Ep(t){return Sa(Mt(t,U))}function Ip(t,e){return Ca(t,Mt(e,U))}var Tp=$(function(t,e){return function(n){return _n(n,t,e)}}),Op=$(function(t,e){return function(n){return _n(t,n,e)}});function Zi(t,e,n){var s=ot(e),u=nr(e,s);n==null&&!(tt(e)&&(u.length||!s.length))&&(n=e,e=t,t=this,u=nr(e,ot(e)));var l=!(tt(n)&&"chain"in n)||!!n.chain,d=le(t);return It(u,function(p){var w=e[p];t[p]=w,d&&(t.prototype[p]=function(){var S=this.__chain__;if(l||S){var C=t(this.__wrapped__),x=C.__actions__=vt(this.__actions__);return x.push({func:w,args:arguments,thisArg:t}),C.__chain__=S,C}return w.apply(t,ge([this.value()],arguments))})}),t}function Mp(){return lt._===this&&(lt._=sf),this}function Ji(){}function Pp(t){return t=k(t),$(function(e){return xa(e,t)})}var Np=Ai(j),Up=Ai(zs),Wp=Ai(Qr);function Bu(t){return Mi(t)?Vr(Vt(t)):dc(t)}function Fp(t){return function(e){return t==null?r:Ee(t,e)}}var Gp=qa(),kp=qa(!0);function Xi(){return[]}function Qi(){return!1}function Bp(){return{}}function $p(){return""}function Hp(){return!0}function zp(t,e){if(t=k(t),t<1||t>he)return[];var n=Jt,s=ht(t,Jt);e=T(e),t-=Jt;for(var u=ei(s,e);++n<t;)e(n);return u}function qp(t){return F(t)?j(t,Vt):Rt(t)?[t]:vt(uu(Y(t)))}function Kp(t){var e=++nf;return Y(t)+e}var Yp=or(function(t,e){return t+e},0),Zp=Li("ceil"),Jp=or(function(t,e){return t/e},1),Xp=Li("floor");function Qp(t){return t&&t.length?er(t,St,hi):r}function Vp(t,e){return t&&t.length?er(t,T(e,2),hi):r}function jp(t){return Ys(t,St)}function t_(t,e){return Ys(t,T(e,2))}function e_(t){return t&&t.length?er(t,St,_i):r}function n_(t,e){return t&&t.length?er(t,T(e,2),_i):r}var r_=or(function(t,e){return t*e},1),i_=Li("round"),s_=or(function(t,e){return t-e},0);function a_(t){return t&&t.length?ti(t,St):0}function u_(t,e){return t&&t.length?ti(t,T(e,2)):0}return o.after=Ed,o.ary=vu,o.assign=_g,o.assignIn=Ou,o.assignInWith=Sr,o.assignWith=wg,o.at=vg,o.before=yu,o.bind=Gi,o.bindAll=xp,o.bindKey=mu,o.castArray=Bd,o.chain=pu,o.chunk=Xc,o.compact=Qc,o.concat=Vc,o.cond=Dp,o.conforms=Rp,o.constant=Ki,o.countBy=ad,o.create=yg,o.curry=Su,o.curryRight=Cu,o.debounce=xu,o.defaults=mg,o.defaultsDeep=Sg,o.defer=Id,o.delay=Td,o.difference=jc,o.differenceBy=th,o.differenceWith=eh,o.drop=nh,o.dropRight=rh,o.dropRightWhile=ih,o.dropWhile=sh,o.fill=ah,o.filter=od,o.flatMap=cd,o.flatMapDeep=hd,o.flatMapDepth=dd,o.flatten=cu,o.flattenDeep=uh,o.flattenDepth=oh,o.flip=Od,o.flow=Lp,o.flowRight=bp,o.fromPairs=lh,o.functions=bg,o.functionsIn=Eg,o.groupBy=gd,o.initial=ch,o.intersection=hh,o.intersectionBy=dh,o.intersectionWith=gh,o.invert=Tg,o.invertBy=Og,o.invokeMap=_d,o.iteratee=Yi,o.keyBy=wd,o.keys=ot,o.keysIn=mt,o.map=pr,o.mapKeys=Pg,o.mapValues=Ng,o.matches=Ep,o.matchesProperty=Ip,o.memoize=wr,o.merge=Ug,o.mergeWith=Mu,o.method=Tp,o.methodOf=Op,o.mixin=Zi,o.negate=vr,o.nthArg=Pp,o.omit=Wg,o.omitBy=Fg,o.once=Md,o.orderBy=vd,o.over=Np,o.overArgs=Pd,o.overEvery=Up,o.overSome=Wp,o.partial=ki,o.partialRight=Du,o.partition=yd,o.pick=Gg,o.pickBy=Pu,o.property=Bu,o.propertyOf=Fp,o.pull=vh,o.pullAll=du,o.pullAllBy=yh,o.pullAllWith=mh,o.pullAt=Sh,o.range=Gp,o.rangeRight=kp,o.rearg=Nd,o.reject=Cd,o.remove=Ch,o.rest=Ud,o.reverse=Wi,o.sampleSize=Dd,o.set=Bg,o.setWith=$g,o.shuffle=Rd,o.slice=xh,o.sortBy=bd,o.sortedUniq=Ih,o.sortedUniqBy=Th,o.split=cp,o.spread=Wd,o.tail=Oh,o.take=Mh,o.takeRight=Ph,o.takeRightWhile=Nh,o.takeWhile=Uh,o.tap=Qh,o.throttle=Fd,o.thru=gr,o.toArray=Eu,o.toPairs=Nu,o.toPairsIn=Uu,o.toPath=qp,o.toPlainObject=Tu,o.transform=Hg,o.unary=Gd,o.union=Wh,o.unionBy=Fh,o.unionWith=Gh,o.uniq=kh,o.uniqBy=Bh,o.uniqWith=$h,o.unset=zg,o.unzip=Fi,o.unzipWith=gu,o.update=qg,o.updateWith=Kg,o.values=Je,o.valuesIn=Yg,o.without=Hh,o.words=Gu,o.wrap=kd,o.xor=zh,o.xorBy=qh,o.xorWith=Kh,o.zip=Yh,o.zipObject=Zh,o.zipObjectDeep=Jh,o.zipWith=Xh,o.entries=Nu,o.entriesIn=Uu,o.extend=Ou,o.extendWith=Sr,Zi(o,o),o.add=Yp,o.attempt=ku,o.camelCase=Qg,o.capitalize=Wu,o.ceil=Zp,o.clamp=Zg,o.clone=$d,o.cloneDeep=zd,o.cloneDeepWith=qd,o.cloneWith=Hd,o.conformsTo=Kd,o.deburr=Fu,o.defaultTo=Ap,o.divide=Jp,o.endsWith=Vg,o.eq=Ht,o.escape=jg,o.escapeRegExp=tp,o.every=ud,o.find=ld,o.findIndex=lu,o.findKey=Cg,o.findLast=fd,o.findLastIndex=fu,o.findLastKey=xg,o.floor=Xp,o.forEach=_u,o.forEachRight=wu,o.forIn=Dg,o.forInRight=Rg,o.forOwn=Ag,o.forOwnRight=Lg,o.get=Hi,o.gt=Yd,o.gte=Zd,o.has=Ig,o.hasIn=zi,o.head=hu,o.identity=St,o.includes=pd,o.indexOf=fh,o.inRange=Jg,o.invoke=Mg,o.isArguments=Oe,o.isArray=F,o.isArrayBuffer=Jd,o.isArrayLike=yt,o.isArrayLikeObject=rt,o.isBoolean=Xd,o.isBuffer=Se,o.isDate=Qd,o.isElement=Vd,o.isEmpty=jd,o.isEqual=tg,o.isEqualWith=eg,o.isError=Bi,o.isFinite=ng,o.isFunction=le,o.isInteger=Ru,o.isLength=yr,o.isMap=Au,o.isMatch=rg,o.isMatchWith=ig,o.isNaN=sg,o.isNative=ag,o.isNil=og,o.isNull=ug,o.isNumber=Lu,o.isObject=tt,o.isObjectLike=et,o.isPlainObject=Cn,o.isRegExp=$i,o.isSafeInteger=lg,o.isSet=bu,o.isString=mr,o.isSymbol=Rt,o.isTypedArray=Ze,o.isUndefined=fg,o.isWeakMap=cg,o.isWeakSet=hg,o.join=ph,o.kebabCase=ep,o.last=Nt,o.lastIndexOf=_h,o.lowerCase=np,o.lowerFirst=rp,o.lt=dg,o.lte=gg,o.max=Qp,o.maxBy=Vp,o.mean=jp,o.meanBy=t_,o.min=e_,o.minBy=n_,o.stubArray=Xi,o.stubFalse=Qi,o.stubObject=Bp,o.stubString=$p,o.stubTrue=Hp,o.multiply=r_,o.nth=wh,o.noConflict=Mp,o.noop=Ji,o.now=_r,o.pad=ip,o.padEnd=sp,o.padStart=ap,o.parseInt=up,o.random=Xg,o.reduce=md,o.reduceRight=Sd,o.repeat=op,o.replace=lp,o.result=kg,o.round=i_,o.runInContext=_,o.sample=xd,o.size=Ad,o.snakeCase=fp,o.some=Ld,o.sortedIndex=Dh,o.sortedIndexBy=Rh,o.sortedIndexOf=Ah,o.sortedLastIndex=Lh,o.sortedLastIndexBy=bh,o.sortedLastIndexOf=Eh,o.startCase=hp,o.startsWith=dp,o.subtract=s_,o.sum=a_,o.sumBy=u_,o.template=gp,o.times=zp,o.toFinite=fe,o.toInteger=k,o.toLength=Iu,o.toLower=pp,o.toNumber=Ut,o.toSafeInteger=pg,o.toString=Y,o.toUpper=_p,o.trim=wp,o.trimEnd=vp,o.trimStart=yp,o.truncate=mp,o.unescape=Sp,o.uniqueId=Kp,o.upperCase=Cp,o.upperFirst=qi,o.each=_u,o.eachRight=wu,o.first=hu,Zi(o,function(){var t={};return Xt(o,function(e,n){Z.call(o.prototype,n)||(t[n]=e)}),t}(),{chain:!1}),o.VERSION=a,It(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){o[t].placeholder=o}),It(["drop","take"],function(t,e){z.prototype[t]=function(n){n=n===r?1:at(k(n),0);var s=this.__filtered__&&!e?new z(this):this.clone();return s.__filtered__?s.__takeCount__=ht(n,s.__takeCount__):s.__views__.push({size:ht(n,Jt),type:t+(s.__dir__<0?"Right":"")}),s},z.prototype[t+"Right"]=function(n){return this.reverse()[t](n).reverse()}}),It(["filter","map","takeWhile"],function(t,e){var n=e+1,s=n==cs||n==wo;z.prototype[t]=function(u){var l=this.clone();return l.__iteratees__.push({iteratee:T(u,3),type:n}),l.__filtered__=l.__filtered__||s,l}}),It(["head","last"],function(t,e){var n="take"+(e?"Right":"");z.prototype[t]=function(){return this[n](1).value()[0]}}),It(["initial","tail"],function(t,e){var n="drop"+(e?"":"Right");z.prototype[t]=function(){return this.__filtered__?new z(this):this[n](1)}}),z.prototype.compact=function(){return this.filter(St)},z.prototype.find=function(t){return this.filter(t).head()},z.prototype.findLast=function(t){return this.reverse().find(t)},z.prototype.invokeMap=$(function(t,e){return typeof t=="function"?new z(this):this.map(function(n){return _n(n,t,e)})}),z.prototype.reject=function(t){return this.filter(vr(T(t)))},z.prototype.slice=function(t,e){t=k(t);var n=this;return n.__filtered__&&(t>0||e<0)?new z(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),e!==r&&(e=k(e),n=e<0?n.dropRight(-e):n.take(e-t)),n)},z.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},z.prototype.toArray=function(){return this.take(Jt)},Xt(z.prototype,function(t,e){var n=/^(?:filter|find|map|reject)|While$/.test(e),s=/^(?:head|last)$/.test(e),u=o[s?"take"+(e=="last"?"Right":""):e],l=s||/^find/.test(e);u&&(o.prototype[e]=function(){var d=this.__wrapped__,p=s?[1]:arguments,w=d instanceof z,S=p[0],C=w||F(d),x=function(H){var q=u.apply(o,ge([H],p));return s&&A?q[0]:q};C&&n&&typeof S=="function"&&S.length!=1&&(w=C=!1);var A=this.__chain__,E=!!this.__actions__.length,O=l&&!A,B=w&&!E;if(!l&&C){d=B?d:new z(this);var M=t.apply(d,p);return M.__actions__.push({func:gr,args:[x],thisArg:r}),new Ot(M,A)}return O&&B?t.apply(this,p):(M=this.thru(x),O?s?M.value()[0]:M.value():M)})}),It(["pop","push","shift","sort","splice","unshift"],function(t){var e=kn[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",s=/^(?:pop|shift)$/.test(t);o.prototype[t]=function(){var u=arguments;if(s&&!this.__chain__){var l=this.value();return e.apply(F(l)?l:[],u)}return this[n](function(d){return e.apply(F(d)?d:[],u)})}}),Xt(z.prototype,function(t,e){var n=o[e];if(n){var s=n.name+"";Z.call(He,s)||(He[s]=[]),He[s].push({name:e,func:n})}}),He[ur(r,Me).name]=[{name:"wrapper",func:r}],z.prototype.clone=Sf,z.prototype.reverse=Cf,z.prototype.value=xf,o.prototype.at=Vh,o.prototype.chain=jh,o.prototype.commit=td,o.prototype.next=ed,o.prototype.plant=rd,o.prototype.reverse=id,o.prototype.toJSON=o.prototype.valueOf=o.prototype.value=sd,o.prototype.first=o.prototype.head,ln&&(o.prototype[ln]=nd),o},ke=jl();De?((De.exports=ke)._=ke,Yr._=ke):lt._=ke}).call(X_)}(Rn,Rn.exports)),Rn.exports}var V_=Q_();const Wt=J_(V_);class j_{async upload(i=[]){return new Promise(r=>{const a=document.createElement("input");a.type="file",i.length&&(a.accept=i.map(f=>`.${f}`).join(",")),a.onchange=async()=>{var v;const f=(v=a.files)==null?void 0:v[0];if(!f)return r(null);const c=f.type.startsWith("text/")||f.name.match(/\.(txt|json|csv|md)$/),g=c?await f.text():new Uint8Array(await f.arrayBuffer());r({data:g,filename:f.name,mimeType:f.type||(c?"text/plain":"application/octet-stream")})},a.click()})}async download({data:i,filename:r,mimeType:a}){const f=i instanceof Uint8Array?new Blob([i],{type:a}):new Blob([i],{type:a});if("showSaveFilePicker"in window){const v=r.includes(".")?r.slice(r.lastIndexOf(".")):"",L=await(await window.showSaveFilePicker({suggestedName:r,types:[{description:"File",accept:{[a]:[v]}}]})).createWritable();await L.write(f),await L.close();return}const c=URL.createObjectURL(f),g=document.createElement("a");g.href=c,g.download=r,g.click(),URL.revokeObjectURL(c)}}class tw{constructor(i){P(this,"reviewCardIdsOverride");P(this,"extraStudyLastCardId");this.app=i}init(){this.reviewCardIdsOverride=void 0}startExtraStudy(i,r){const a=encodeURIComponent(JSON.stringify(r));ao(`${uo}/review?id=${i}&isExtraStudy=true&cardIds=${a}`)}registerReviewCardIdsOverride(i){this.reviewCardIdsOverride=i}isExtraStudy(){return this.reviewCardIdsOverride!==void 0}getNextCard(){if(this.reviewCardIdsOverride){if(this.reviewCardIdsOverride.length===1)return this.reviewCardIdsOverride[0];{const i=this.reviewCardIdsOverride.filter(r=>r!==this.extraStudyLastCardId);return i[Math.floor(Math.random()*i.length)]}}}getCardsCount(){var i;return((i=this.reviewCardIdsOverride)==null?void 0:i.length)??0}rateAgain(i){this.extraStudyLastCardId=i}rateGood(i){if(this.extraStudyLastCardId=i,this.reviewCardIdsOverride){const r=this.reviewCardIdsOverride.indexOf(i);r>=0&&this.reviewCardIdsOverride.splice(r,1)}}getCardIds(i,r){const a=this.app.deckData[i];if(!a)return[];switch(r.type){case bt.StudiedCards:{const f=Object.keys(a.schedule).length,c=Math.min(f,r.count),g=Object.keys(a.schedule).map(v=>+v);return Wt.shuffle(g).slice(0,c)}case bt.NewCards:{const f=this.app.getNewCardsCount(i),c=Math.min(f,r.count);return this.app.getNewCards(i).slice(0,c)}case bt.YoungCards:{const c=this.app.getAllNonIgnoredIds(i).filter(v=>this.app.getWenbunCustomState(i,v)===Ln.ReviewYoung),g=Math.min(c.length,r.count);return Wt.shuffle(c).slice(0,g)}case bt.MatureCards:{const c=this.app.getAllNonIgnoredIds(i).filter(v=>this.app.getWenbunCustomState(i,v)===Ln.ReviewMature),g=Math.min(c.length,r.count);return Wt.shuffle(c).slice(0,g)}case bt.Group:{const f=a.groups.find(c=>c.label===r.group);return f?f.cardIds:[]}case bt.HardCards:{const f=Object.keys(a.schedule).length,c=Math.min(f,r.count);return Object.entries(a.schedule).sort((D,L)=>L[1].difficulty-D[1].difficulty).map(D=>+D[0]).slice(0,c)}}}getDescription(i,r){const a=this.app.deckData[i];if(!a)return{desc:"",subdesc:""};switch(r.type){case bt.StudiedCards:{const f=Object.keys(a.schedule).length;return{desc:`Study ${Math.min(f,r.count)} cards`,subdesc:`(out of ${f} cards that have been studied in this deck)`}}case bt.NewCards:{const f=this.app.getNewCardsCount(i);return{desc:`Study the next ${Math.min(f,r.count)} new cards`,subdesc:`(out of ${f} new cards)`}}case bt.YoungCards:{const c=this.app.getAllNonIgnoredIds(i).filter(v=>this.app.getWenbunCustomState(i,v)===Ln.ReviewYoung);return{desc:`Study ${Math.min(c.length,r.count)} young cards`,subdesc:`(out of ${c.length} young cards)`}}case bt.MatureCards:{const c=this.app.getAllNonIgnoredIds(i).filter(v=>this.app.getWenbunCustomState(i,v)===Ln.ReviewMature);return{desc:`Study ${Math.min(c.length,r.count)} mature cards`,subdesc:`(out of ${c.length} mature cards)`}}case bt.Group:{const f=a.groups.find(g=>g.label===r.group);return f?{desc:`Study ${Math.min(f.cardIds.length,r.count)} cards from ${r.group}`,subdesc:`(out of ${f.cardIds.length} cards)`}:{desc:"ERROR: Group Not Found",subdesc:""}}case bt.HardCards:{const f=Object.keys(a.schedule).length;return{desc:`Study ${Math.min(f,r.count)} hardest cards`,subdesc:`(out of ${f} cards that have been studied in this app)`}}}}}const fo="https://wenbun-api.photon-ray.xyz";var qt=(h=>(h.Profile="/profile",h.ProfileData="/profiledata",h.ReviewLog="/reviewlog",h.ReviewLogMostRecent="/reviewlog/mostrecent",h.AuthGoogle="/auth/google",h.AuthLogout="/auth/logout",h))(qt||{});function Ce(h,i){let r=`${fo}${h}`;if(i&&Object.keys(i).length>0){const a=new URLSearchParams;for(const[f,c]of Object.entries(i))a.append(f,String(c));r+=`?${a.toString()}`}return r}function Vu(h){return`${fo}${h}`}const ju="loginStatus";var An=(h=>(h.ask="ask",h.forcePull="forcePull",h.forcePush="forcePush",h.normalPull="normalPull",h.normalPush="normalPush",h))(An||{});class ew{constructor(i){P(this,"isLoggedIn",!1);P(this,"isSyncConflict",!1);P(this,"syncConflictInfo");P(this,"profileInfo",null);P(this,"storedLoginStatus");this.storage=i}async init(){this.storedLoginStatus=await this.storage.load(ju);const i=await fetch(Ce(qt.Profile),{credentials:"include"});if(i.ok){const r=await i.json();this.isLoggedIn=!0,this.profileInfo=r}else i.status===401?this.isLoggedIn=!1:(this.isLoggedIn=!1,console.warn(`Unexpected status: ${i.status}`));await this.checkAndUpdateLoginStatus()}async updateLoginStatus(i){await this.storage.save(ju,i),this.storedLoginStatus=i}async checkAndUpdateLoginStatus(){if(this.storedLoginStatus===void 0){const i=this.isLoggedIn?"loggedIn":"loggedOut";await this.updateLoginStatus(i)}}async trySyncProfile(i,r="ask"){if(!this.isLoggedIn)return!1;try{const[a,f]=await Promise.all([this.getProfileData(),this.getLatestReviewLog()]);if(a===null)return(await Promise.all([this.updateProfileData(i.exportProfile(!1)),this.pushReviewLog(f,i.reviewLogs,!0)])).every(g=>g)&&(i.lastSyncTime=new Date().toISOString(),await i.updateLastSyncTime()),!1;{const c=new Date(i.meta.modifiedAt??0),g=new Date(a.meta.modifiedAt??0),v=new Date(i.lastSyncTime??0),D=this.getSyncDecision(c,g,v);let L=Wt.isEqual(a,i.exportProfile(!1))?"none":D;switch(L=await this.autoResolveSyncConflict(L,r,i),L){case"conflict":return this.syncConflictInfo={localModifiedAt:c,remoteModifiedAt:g,lastSyncTime:v},this.isSyncConflict=!0,__.url.pathname.startsWith("/settings")||window.confirm("Sync Failed, Conflict Detected. Do you want to go to settings?")&&ao(`${uo}/settings/`),!1;case"push":return(await Promise.all([this.updateProfileData(i.exportProfile(!1)),this.pushReviewLog(f,i.reviewLogs)])).every(U=>U)?(i.lastSyncTime=new Date().toISOString(),await i.updateLastSyncTime()):window.alert("Failed to push profile data to server"),this.isSyncConflict=!1,!1;case"pull":return(await Promise.all([i.tryImportProfile(a,!1,!0),this.pullReviewLog(i)])).every(U=>U)?(i.lastSyncTime=new Date().toISOString(),await i.updateLastSyncTime()):window.alert("Failed to pull profile data from server"),this.isSyncConflict=!1,!0;case"none":return this.isSyncConflict=!1,!1}}}catch(a){return console.error(a),!1}}async autoResolveSyncConflict(i,r,a){if(i!=="conflict")return i;switch(r){case"ask":return"conflict";case"normalPull":return"pull";case"normalPush":return"push";case"forcePull":return await this.tryForcePull(a),"pull";case"forcePush":return await this.tryForcePush(a),"push"}}async tryForcePull(i){const r=await this.getProfileData(),a=await Promise.all([this.updateProfileData(i.exportProfile(!1),"pull"),this.pullReviewLog(i,!0)]),f=await i.tryImportProfile(r,!1,!0);a.every(c=>c)&&f?(i.lastSyncTime=new Date().toISOString(),await i.updateLastSyncTime(),this.isSyncConflict=!1):window.alert("Failed to pull profile data from server")}async tryForcePush(i){(await Promise.all([this.updateProfileData(i.exportProfile(!1),"push"),this.pushReviewLog(null,i.reviewLogs,!0)])).every(a=>a)?(i.lastSyncTime=new Date().toISOString(),await i.updateLastSyncTime(),this.isSyncConflict=!1):window.alert("Failed to push profile data to server")}getSyncDecision(i,r,a){const f=i>a,c=r>a;return f&&c?"conflict":f?"push":c?"pull":"none"}getName(){var i;return((i=this.profileInfo)==null?void 0:i.name)??"(no name)"}async getProfileData(){const i=await fetch(Ce(qt.ProfileData),{credentials:"include"});if(i.status===204)return null;if(i.ok)return await i.json();throw new Error(`Unexpected status: ${i.status}`)}async updateProfileData(i,r="normal"){return(await fetch(Ce(qt.ProfileData,{decision:r}),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).ok}async getLatestReviewLog(){const i=await fetch(Ce(qt.ReviewLogMostRecent),{credentials:"include"});if(i.status===204)return null;if(i.ok)return await i.json();throw new Error(`Unexpected status: ${i.status}`)}async pushReviewLog(i,r,a=!1){if(i===null||a)return(await fetch(Ce(qt.ReviewLog,{force:a}),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).ok;{const f=+new Date(i.log.review),c=r.findLastIndex(D=>{const L=D.log.review;return+new Date(L)<=f}),g=r.slice(c+1);return(await fetch(Ce(qt.ReviewLog),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)})).ok}}async pullReviewLog(i,r=!1){try{const a=await this.getReviewLogs(i.reviewLogs,r);return a===null||(r?i.reviewLogs=a:i.reviewLogs.push(...a),i.save(!1)),!0}catch(a){return console.error(a),!1}}async getReviewLogs(i,r=!1){var a;if(r){const f=new Date(0).toISOString(),c=await fetch(Ce(qt.ReviewLog,{from:f}),{method:"GET",credentials:"include"});if(c.status===204)return null;if(c.ok)return(await c.json()).map(v=>v.review_log);throw new Error(`Unexpected status: ${c.status}`)}else{const f=i[i.length-1],c=new Date(((a=f==null?void 0:f.log)==null?void 0:a.review)??0).toISOString(),g=await fetch(Ce(qt.ReviewLog,{from:c}),{method:"GET",credentials:"include"});if(g.status===204)return null;if(g.ok)return await g.json();throw new Error(`Unexpected status: ${g.status}`)}}async loginGoogle(i){window.location.assign(Vu(qt.AuthGoogle))}async logout(i){await this.updateLoginStatus(void 0),await i.updateLastSyncTime(new Date(0)),window.location.assign(Vu(qt.AuthLogout))}isAutomaticallyLoggedOut(){return!this.isLoggedIn&&this.storedLoginStatus==="loggedIn"}}const nw="__ungrouped__",to="profile.json",es="decks",ns="deckData",rs="config",is="reviewLogs",ss="autoReviewGradeLog",eo="meta",as="lastSyncTime",no="strokeSpeed",ro="deckView",io=[R.Again,R.Hard,R.Good,R.Easy],rw=30,so=3,iw=8;var Ln=(h=>(h.New="New",h.WarmUp="WarmUp",h.Learning="Learning",h.ReviewYoung="Young",h.ReviewMature="Mature",h.Relearning="Relearning",h.PreviouslyStudied="Previously Studied",h.Ignored="Ignored",h))(Ln||{}),sw=(h=>(h.Mix="Mix",h.AfterReviews="After Reviews",h.BeforeReviews="Before Reviews",h))(sw||{}),bt=(h=>(h.StudiedCards="Studied Cards",h.HardCards="Hard Cards",h.NewCards="New Cards",h.YoungCards="Young Cards",h.MatureCards="Mature Cards",h.Group="Group",h))(bt||{});const Dn={newCardPerDay:5,maxReviewsPerDay:200,newCardOrder:"Mix",newPreviouslyStudiedCardPerDay:20,newPreviouslyStudiedCardOrder:"Mix",startPreviouslyStudiedCardFromTheBack:!0,gradeWarmUpCards:!1,uiScale:"normal",customFontSize:16,gradingMethod:"auto",strokeLeniency:1.5,learningSteps:["1m","10m"],previouslyStudiedLearningSteps:["1m","5d"],desiredRetention:.9,enableShortTerm:!1,enableFuzz:!1,FSRSParams:h_,zh:{isColorBasedOnTone:!0,toneColors:c_.Default,alwaysShowReading:!1,mandarinReading:f_.Pinyin,playAudio:!0}};var aw=(h=>(h.Normal="Normal",h.Small="Small",h))(aw||{});class cw{constructor(){P(this,"decks",[]);P(this,"deckData",{});P(this,"config",Dn);P(this,"reviewLogs",[]);P(this,"autoReviewGradeLog",[]);P(this,"meta",{});P(this,"lastSyncTime",new Date(0).toISOString());P(this,"isLoadDone",!1);P(this,"fsrs");P(this,"fsrsPrevStudied");P(this,"storage");P(this,"fileManager");P(this,"extraStudyHandler");P(this,"profile");this.updateFSRS(),ts()?this.storage=new K_(to):this.storage=new Z_(to),this.fileManager=new j_,this.extraStudyHandler=new tw(this),this.profile=new ew(this.storage)}updateFSRS(){const i=this.getConfig(),r=Lr({request_retention:i.desiredRetention,w:i.FSRSParams,enable_fuzz:i.enableFuzz,enable_short_term:i.enableShortTerm,learning_steps:i.learningSteps});this.fsrs=new Zu(r);const a=Lr({request_retention:i.desiredRetention,w:i.FSRSParams,enable_fuzz:i.enableFuzz,enable_short_term:i.enableShortTerm,learning_steps:i.previouslyStudiedLearningSteps});this.fsrsPrevStudied=new Zu(a)}async init(){await this.load(),this.updateFontSize(),this.extraStudyHandler.init(),await this.afterInitRoutine()}async afterInitRoutine(){this.updateFSRS(),await this.processTodaySchedule()}async initProfile(){if(await this.profile.init(),this.profile.isLoggedIn){const i=ts()?An.ask:An.normalPull,r=await this.profile.trySyncProfile(this,i);return r&&await this.afterInitRoutine(),r}else return!1}async debug(){this.decks=["test"],this.deckData={},this.reviewLogs=[],this.config=Dn,await this.save()}debugSimulate(){let i=bn();const r=this.fsrs,a=f=>{const c=r.repeat(i,i.due);let g={1:"",2:"",3:"",4:""};for(const v of io){const D=c[v].log.review,L=c[v].card.due;g[v]=xr(D,L)}console.log(f,g),i=c[f].card};a(R.Again),a(R.Again),a(R.Good),a(R.Good),a(R.Good),a(R.Again)}updateFontSize(){const i=`${this.getFontSizePx()}px`;document.body.style.fontSize=i}getCurrentUIScale(){return this.getFontSizePx()/16}getFontSizePx(){const i=this.getConfig();switch(i.uiScale){case"small":return 10;case"normal":return 16;case"custom":return Wt.clamp(i.customFontSize,8,32)}}async load(){const[i,r,a,f,c,g,v]=await Promise.all([this.storage.load(es),this.storage.load(ns),this.storage.load(rs),this.storage.load(is),this.storage.load(ss),this.storage.load(eo),this.storage.load(as)]);this.decks=i||[],this.deckData=r||{},this.config=a||Dn,this.reviewLogs=f||[],this.autoReviewGradeLog=c||[],this.meta=g||{clientVersion:"0.11.0"},this.lastSyncTime=v||new Date(0).toISOString(),this.isLoadDone=!0}async save(i=!1,r=!1,a=!0){if(await this.isDataChanged()&&(this.updateFontSize(),this.meta.modifiedAt=new Date().toISOString(),this.meta._profileVersion=1,a&&(this.meta.clientVersion="0.11.0"),await Promise.all([this.storage.save(es,this.decks),this.storage.save(ns,this.deckData),this.storage.save(rs,this.config),this.storage.save(is,this.reviewLogs),this.storage.save(ss,this.autoReviewGradeLog),this.storage.save(eo,this.meta),this.storage.save(as,this.lastSyncTime)]),!i)){const c=ts()?An.ask:An.normalPush;r?await this.profile.trySyncProfile(this,c):this.profile.trySyncProfile(this,c).catch(console.error)}}async updateLastSyncTime(i=new Date){this.lastSyncTime=i.toISOString(),await this.storage.save(as,this.lastSyncTime)}async isDataChanged(){const[i,r,a,f,c]=await Promise.all([this.storage.load(es),this.storage.load(ns),this.storage.load(rs),this.storage.load(is),this.storage.load(ss)]);return!Wt.isEqual(this.decks,i)||!Wt.isEqual(this.deckData,r)||!Wt.isEqual(this.config,a)||!Wt.isEqual(this.reviewLogs,f)||!Wt.isEqual(this.autoReviewGradeLog,c)}exportProfileStr(i=!0){return JSON.stringify(this.exportProfile(i))}async tryImportProfileStr(i,r=!0){try{const a=JSON.parse(i);return this.tryImportProfile(a,r)}catch{return!1}}exportProfile(i=!0){return{config:this.config,decks:this.decks,deckData:this.deckData,reviewLogs:i?this.reviewLogs:[],meta:this.meta}}async tryImportProfile(i,r=!0,a=!1){try{const{config:f,decks:c,deckData:g,reviewLogs:v,meta:D}=i;return this.config=f,this.decks=c,this.deckData=g,r&&(this.reviewLogs=v),this.meta=D,await this.save(a,void 0,!1),!0}catch{return!1}}async processTodaySchedule(){const i=new Date,r=Cr(i);let a=!1;for(const f of Object.keys(this.deckData)){const c=this.deckData[f];Cr(new Date(c.lastScheduleCheckDate))<r&&(c.doneTodayNewCardCount=0,c.doneTodayPreviouslyStudiedCardCount=0,c.doneTodayReviewCount=0,c.lastScheduleCheckDate=i.getTime(),a=!0)}a&&await this.save()}async getInitDeckDataById(i){const r=Hu.find(f=>f.id===i),a=await d_((r==null?void 0:r.src)??`${i}.txt`);if(a)return this.getInitDeckData(a,(r==null?void 0:r.tags)??[])}getInitDeckData(i,r){return{deck:i,tags:r,groups:[{label:nw,cardIds:Array.from(i.keys())}],ignoredIds:[],previouslyStudied:[],schedule:{},lastScheduleCheckDate:new Date(0).getTime(),doneTodayNewCardCount:0,doneTodayPreviouslyStudiedCardCount:0,doneTodayReviewCount:0}}async addDeckById(i){const r=await this.getInitDeckDataById(i);if(!r)return Promise.reject(new Error("loading deck failed"));await this.addDeck(i,r)}async addDeck(i,r){const a=this.generateNewDeckId();r.label=i,this.deckData[a]=r,!this.decks.includes(a)&&(this.decks.push(a),this.splitDeckIntoGroupOfN(a,rw),await this.save())}async deleteDeck(i,r=!1){r&&(this.decks.includes(i)&&(this.decks=this.decks.filter(a=>a!=i)),delete this.deckData[i])}generateNewDeckId(){let i;do i=g_(iw);while(this.decks.includes(i));return i}getConfig(){return Wt.merge({},Dn,this.config)}async resetConfigToDefault(){this.config=Wt.cloneDeep(Dn),await this.save()}async saveConfig(i){this.config=i,await this.save()}rateCard(i,r,a,f){var I,U;this.stopWarmUp(i,r);const c=this.deckData[i],g=this.getCard(i,r,!0);if(!g)return;const L=(((U=(I=this.deckData[i])==null?void 0:I.previouslyStudied)==null?void 0:U.includes(r))?this.fsrsPrevStudied:this.fsrs).repeat(g,f??new Date);this.setCard(i,r,L[a].card),this.pushReviewLog(i,r,L[a].log),c.previouslyStudied.includes(r)?(c.previouslyStudied.splice(c.previouslyStudied.indexOf(r),1),c.doneTodayPreviouslyStudiedCardCount++):g.state===G.New?c.doneTodayNewCardCount++:g.state===G.Review&&c.doneTodayReviewCount++}warmUpNext(i,r){var f;const a=this.deckData[i];a&&((f=a.warmUpIds)==null?void 0:f[r])!==void 0&&a.warmUpIds[r]++}getNextCard(i){if(this.extraStudyHandler.isExtraStudy())return this.extraStudyHandler.getNextCard();const r=this.getConfig(),a=this.getScheduledNewOrWarmUpCardsCount(i),f=this.getScheduledPreviouslyStudiedCardsCount(i),c=this.getScheduledReviewCardsCount(i),g=this.getTotalScheduledNewOrWarmUpTotalCount(i),v=a>0?this.getNewOrWarmUpCard(i):void 0,D=f>0?this.getPreviouslyStudiedCard(i):void 0,L=c>0?this.getTodaysScheduledCards(i)[0]:void 0,I=[],U=[L],ut=[];if(r.newCardOrder==="Before Reviews"&&I.push(v),r.newCardOrder==="After Reviews"&&ut.push(v),r.newPreviouslyStudiedCardOrder==="Before Reviews"&&I.push(D),r.newPreviouslyStudiedCardOrder==="After Reviews"&&ut.push(D),r.newCardOrder==="Mix"){const nt=g/(g+c);Math.random()<nt?U.unshift(v):U.push(v)}if(r.newPreviouslyStudiedCardOrder==="Mix"){const nt=f/(g+f+c);Math.random()<nt?U.unshift(D):U.push(D)}return[...I,...U,...ut].reduce((nt,Zt)=>nt??Zt,void 0)}skipWarmUp(i,r){const a=this.deckData[i];a&&(this.startWarmUp(i,r),a.warmUpIds[r]=so)}startWarmUp(i,r){const a=this.deckData[i];a&&(a.warmUpIds===void 0&&(a.warmUpIds={}),a.warmUpIds[r]=0)}stopWarmUp(i,r){var f;const a=(f=this.deckData[i])==null?void 0:f.warmUpIds;a&&delete a[r]}getWarmUpCount(i,r){var a,f;return(f=(a=this.deckData[i])==null?void 0:a.warmUpIds)==null?void 0:f[r]}getMaxWarmUpCount(){return so}isWarmUpCard(i,r){return this.getWarmUpCount(i,r)!==void 0}getNewOrWarmUpCard(i){const a=this.getScheduledNewOrWarmUpCardsCount(i)-this.getWarmUpCardsCount(i),f=this.getNewCard(i),c=this.deckData[i];if(!c.warmUpIds)return f;const g=Object.keys(c.warmUpIds),v=+g[Math.floor(Math.random()*g.length)];if(a<=0)return v;const D=this.getNewCardsCount(i),L=g.length;if(D+L!==0)return Math.random()<D/(D+L)?f:v}getNewCard(i){return this.getNewCards(i)[0]}getNewCards(i){return this.deckData[i].groups.flatMap(g=>g.cardIds).filter(g=>this.getWenbunCustomState(i,g)==="New")}getPreviouslyStudiedCard(i){var a;const r=this.deckData[i];if(r)return this.getConfig().startPreviouslyStudiedCardFromTheBack?(a=r.previouslyStudied)==null?void 0:a[r.previouslyStudied.length-1]:r.previouslyStudied[0]}getNewCardsCount(i){return this.getNewCards(i).length}getPreviouslyStudiedCardCount(i){var r;return((r=this.deckData[i])==null?void 0:r.previouslyStudied.length)??0}getWarmUpCardsCount(i){var r;return(r=this.deckData[i])!=null&&r.warmUpIds?Object.keys(this.deckData[i].warmUpIds).length:0}pushReviewLog(i,r,a){this.reviewLogs.push({deckId:i,cardId:r,log:a})}setCard(i,r,a){const f=this.deckData[i];f&&(f.schedule[r]=a)}getCard(i,r,a=!1){const f=this.deckData[i];if(f)return a&&f.schedule[r]===void 0?bn():f.schedule[r]}getCardWord(i,r){const a=this.deckData[i];if(!a)return"";const f=a.deck[r];return f||""}getCardDue(i,r){var a;return(a=this.getCard(i,r))==null?void 0:a.due}getCardDueFormatted(i,r){if(this.isWarmUpCard(i,r))return"Warm Up";const a=this.getCardDue(i,r);return a?xr(new Date,new Date(a)):"Not Started"}getShortCardDueFormatted(i,r){if(this.isWarmUpCard(i,r))return"";const a=this.getCardDue(i,r);return a?xr(new Date,new Date(a)):""}getRatingScheduledTimeStr(i,r){var D,L;const a=this.getCard(i,r,!0);let f={1:"",2:"",3:"",4:""};if(!a)return f;const v=(((L=(D=this.deckData[i])==null?void 0:D.previouslyStudied)==null?void 0:L.includes(r))?this.fsrsPrevStudied:this.fsrs).repeat(a,new Date);for(const I of io){const U=v[I].log.review,ut=v[I].card.due;f[I]=xr(U,ut)}return f}getWenbunCustomState(i,r){var f,c,g,v,D,L;if(((c=(f=this.deckData[i])==null?void 0:f.warmUpIds)==null?void 0:c[r])!==void 0)return"WarmUp";if((v=(g=this.deckData[i])==null?void 0:g.previouslyStudied)!=null&&v.includes(r))return"Previously Studied";if((L=(D=this.deckData[i])==null?void 0:D.ignoredIds)!=null&&L.includes(r))return"Ignored";const a=this.getCard(i,r);switch(a==null?void 0:a.state){case G.Learning:return"Learning";case G.Review:return a.scheduled_days>=21?"Mature":"Young";case G.Relearning:return"Relearning";case G.New:default:return"New"}}getTodaysReviewCards(i){const r=this.deckData[i];return this.getTodaysScheduledCards(i).filter(c=>{var g;return((g=r.schedule[c])==null?void 0:g.state)===G.Review})}getScheduledReviewCardsCount(i){const r=this.deckData[i],a=this.getTodaysReviewCards(i),f=this.getConfig(),c=Math.min(a.length,f.maxReviewsPerDay-r.doneTodayReviewCount);return Math.max(0,c)}getScheduledNewOrWarmUpCardsCount(i){const r=this.getConfig(),a=this.deckData[i],f=this.getNewCardsCount(i),c=this.getWarmUpCardsCount(i),g=Math.min(f+c,r.newCardPerDay-a.doneTodayNewCardCount);return Math.max(0,g)}getScheduledNewCardsCount(i){return this.getScheduledNewOrWarmUpCardsCount(i)-this.getWarmUpCardsCount(i)}getScheduledPreviouslyStudiedCardsCount(i){const r=this.getConfig(),a=this.deckData[i],f=Math.min(this.getPreviouslyStudiedCardCount(i),r.newPreviouslyStudiedCardPerDay-a.doneTodayPreviouslyStudiedCardCount);return Math.max(0,f)}getLearningRelearningCardsCount(i){const r=this.deckData[i];return Object.entries(r.schedule).filter(([a,f])=>f.state===G.Learning||f.state===G.Relearning).length}getTotalScheduledNewOrWarmUpTotalCount(i){var c;let r=0;const a=this.getMaxWarmUpCount(),f=this.getScheduledNewCardsCount(i);return r+=f*(a+1),(c=this.deckData[i])!=null&&c.warmUpIds&&Object.values(this.deckData[i].warmUpIds).forEach(g=>{const v=a-g+1;r+=v}),r}addPreviouslyStudiedMark(i,r){const a=this.deckData[i];!a||a.previouslyStudied.includes(r)||this.getWenbunCustomState(i,r)!=="New"||a.previouslyStudied.push(r)}removePreviouslyStudiedMark(i,r){const a=this.deckData[i];if(!a)return;const f=a.previouslyStudied.indexOf(r);f<0||a.previouslyStudied.splice(f,1)}ensureIgnoreIdArray(i){const r=this.deckData[i];r&&(r.ignoredIds||(r.ignoredIds=[]))}addIgnoredMark(i,r){var f,c;const a=this.deckData[i];a&&(this.ensureIgnoreIdArray(i),!((f=a.ignoredIds)!=null&&f.includes(r))&&((c=a.ignoredIds)==null||c.push(r)))}removeIgnoredMark(i,r){var c,g;const a=this.deckData[i];if(!a)return;const f=(c=a.ignoredIds)==null?void 0:c.indexOf(r);f==null||f<0||(g=a.ignoredIds)==null||g.splice(f,1)}getTodaysScheduledCards(i){const r=this.deckData[i];if(!r)return[];const f=Cr(new Date)+1,c=Object.entries(r.schedule).filter(([g,v])=>{var I;if(!!((I=r.ignoredIds)!=null&&I.includes(+g)))return!1;const L=Cr(new Date(v.due));return v.state===G.Review?L<f:!0});return c.sort((g,v)=>new Date(g[1].due).getTime()-new Date(v[1].due).getTime()),c.map(g=>+g[0])}getChineseToneColor(i){if(!i)return;const r=this.getConfig();return r.zh.isColorBasedOnTone?r.zh.toneColors[i-1]:void 0}getChineseToneColorArray(){return[1,2,3,4,5].map(i=>this.getChineseToneColor(i)??"")}splitDeckIntoGroupOfN(i,r){const a=this.deckData[i];if(!a)return;const f=Array.from(a.deck.keys()),c=[],g=Math.ceil(f.length/r);for(let v=0;v<g;v++){const D=`group-${v+1}`;c.push({label:D,cardIds:f.slice(v*r,(v+1)*r)})}a.groups=c}getGroupLabels(i){const r=this.deckData[i];return r?r.groups.map(a=>a.label):[]}getAllNonIgnoredIds(i){const r=this.deckData[i];return r?Array.from(r.deck.keys()).filter(f=>{var c;return!((c=r.ignoredIds)!=null&&c.includes(f))}):[]}async downloadProfile(){const i=this.exportProfileStr(),r=new Date().toLocaleDateString("en-CA");await this.fileManager.download({data:i,filename:`wenbun-profile-${r}.txt`,mimeType:"text/plain"})}async tryUploadProfile(){const i=await this.fileManager.upload();return i===null||typeof i.data!="string"?!1:this.tryImportProfileStr(i.data)}getDeckProgress(i){var L;const r=this.deckData[i];if(!r)return{totalCount:1,previouslyStudiedCount:0,youngCount:0,matureCount:0,ignoredCount:0};const a=this.getAllNonIgnoredIds(i),f=r.deck.length,c=r.previouslyStudied.length,g=a.filter(I=>this.getWenbunCustomState(i,I)==="Young").length,v=a.filter(I=>this.getWenbunCustomState(i,I)==="Mature").length,D=((L=r.ignoredIds)==null?void 0:L.length)??0;return{totalCount:f,previouslyStudiedCount:c,youngCount:g,matureCount:v,ignoredCount:D}}getDeckProgressNormalized(i){const r=this.getDeckProgress(i);return{young:r.youngCount/r.totalCount*100,mature:r.matureCount/r.totalCount*100,previouslyStudied:r.previouslyStudiedCount/r.totalCount*100,ignored:r.ignoredCount/r.totalCount*100,rest:(r.totalCount-r.youngCount-r.matureCount-r.previouslyStudiedCount-r.ignoredCount)/r.totalCount*100}}isAutoGrading(){return this.getConfig().gradingMethod==="auto"}storeAutoGradeLog(i,r,a){this.autoReviewGradeLog.push({correctCount:i,mistakeCount:r,grade:a})}getStrokeSpeed(){return+(window.localStorage.getItem(no)??1)}setStrokeSpeed(i){window.localStorage.setItem(no,i.toString())}getDeckView(){return window.localStorage.getItem(ro)??"Normal"}setDeckView(i){window.localStorage.setItem(ro,i)}adjustCardLimit(i,r,a,f){const c=this.deckData[i];c&&(c.doneTodayNewCardCount-=r,c.doneTodayPreviouslyStudiedCardCount-=a,c.doneTodayReviewCount-=f)}getCurrentAppVersion(){return"0.11.0"}getDeckInfo(i){const r=this.deckData[i];return Hu.find(a=>a.id===i)??{id:i,title:(r==null?void 0:r.label)??i,subtitle:"",tags:(r==null?void 0:r.tags)??[]}}isNewUpdateExist(){return p_("0.11.0",this.meta.clientVersion??"0.0.0")}renameDeck(i,r){const a=this.deckData[i];a&&(a.label=r)}moveCardsIntoGroup(i,r,a){const f=this.deckData[i];if(!f)return;f.groups.find(g=>g.label==a)==null&&f.groups.push({label:a,cardIds:[]}),f.groups.forEach(g=>{g.cardIds=g.cardIds.filter(v=>!r.includes(v))});const c=f.groups.find(g=>g.label==a);c==null||c.cardIds.push(...r)}}export{cw as A,aw as D,bt as E,sw as N,Ln as W,Wt as _,rw as a,R as l};
