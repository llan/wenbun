var qt=Object.defineProperty;var Bt=(r,t,i)=>t in r?qt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[t]=i;var Qe=(r,t,i)=>Bt(r,typeof t!="symbol"?t+"":t,i);import"../chunks/CWj6FrbW.js";import"../chunks/SiSAkwjt.js";import{l as Tt,n as y,a5 as Zt,aV as Xt,ai as jt,aW as Kt,aX as Jt,aY as Qt,aZ as Vt,a_ as $t,a$ as Rt,b0 as ea,q as ta,w as Ne,ak as Ct,p as wt,g as ce,av as aa,al as Et,j as l,f as D,d as h,r as m,s as k,i as e,t as _e,e as re,ar as ra,b as x,c as bt,a as xe,as as Ve,ao as na,M as sa,b1 as ia,v as oa,aL as la,a9 as H,am as mt,an as ca,aO as da,X as le,P as yt,aq as ua,b2 as va}from"../chunks/C2k6CbEI.js";import{i as O}from"../chunks/Crl2Bchr.js";import{k as ht}from"../chunks/DQcQ5N_a.js";import{e as Ut,i as Wt}from"../chunks/DJAOMF32.js";import{s as de}from"../chunks/BFp7uHGi.js";import{b as Dt}from"../chunks/DTVcAqe8.js";import{i as fa}from"../chunks/CBMlR3ml.js";import{p as gt}from"../chunks/B48BoX4-.js";import{b as ma}from"../chunks/DcoJXAFg.js";import{l as E,A as ha,W as Ce}from"../chunks/BxxS8XqS.js";import{s as F,T as _a}from"../chunks/GdbsWXTA.js";import{s as Gt}from"../chunks/B3jgN6p-.js";import{c as ga}from"../chunks/Co-1QMVx.js";import{H as pa}from"../chunks/DcL13wi7.js";import{m as xt,e as Ca,n as wa,T as rt,p as It,f as _t,C as ba}from"../chunks/BSb8eFOk.js";import{n as ya}from"../chunks/DEyn6um_.js";import{Z as xa}from"../chunks/rtqsl_Rz.js";function ka(r,t,i){Tt(()=>{var s=y(()=>t(r,i==null?void 0:i())||{});if(s!=null&&s.destroy)return()=>s.destroy()})}const Sa=()=>performance.now(),Re={tick:r=>requestAnimationFrame(r),now:()=>Sa(),tasks:new Set};function Nt(){const r=Re.now();Re.tasks.forEach(t=>{t.c(r)||(Re.tasks.delete(t),t.f())}),Re.tasks.size!==0&&Re.tick(Nt)}function Aa(r){let t;return Re.tasks.size===0&&Re.tick(Nt),{promise:new Promise(i=>{Re.tasks.add(t={c:r,f:i})}),abort(){Re.tasks.delete(t)}}}function at(r,t){Rt(()=>{r.dispatchEvent(new CustomEvent(t))})}function Ta(r){if(r==="float")return"cssFloat";if(r==="offset")return"cssOffset";if(r.startsWith("--"))return r;const t=r.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(i=>i[0].toUpperCase()+i.slice(1)).join("")}function kt(r){const t={},i=r.split(";");for(const s of i){const[d,_]=s.split(":");if(!d||_===void 0)break;const G=Ta(d.trim());t[G]=_.trim()}return t}const Ra=r=>r;function St(r,t,i,s){var d=(r&Vt)!==0,_=(r&$t)!==0,G=d&&_,L=(r&Qt)!==0,M=G?"both":d?"in":"out",g,T=t.inert,J=t.style.overflow,S,w;function q(){return Rt(()=>g??(g=i()(t,(s==null?void 0:s())??{},{direction:M})))}var a={is_global:L,in(){var o;if(t.inert=T,!d){w==null||w.abort(),(o=w==null?void 0:w.reset)==null||o.call(w);return}_||S==null||S.abort(),at(t,"introstart"),S=pt(t,q(),w,1,()=>{at(t,"introend"),S==null||S.abort(),S=g=void 0,t.style.overflow=J})},out(o){if(!_){o==null||o(),g=void 0;return}t.inert=!0,at(t,"outrostart"),w=pt(t,q(),S,0,()=>{at(t,"outroend"),o==null||o()})},stop:()=>{S==null||S.abort(),w==null||w.abort()}},R=Zt;if((R.transitions??(R.transitions=[])).push(a),d&&Xt){var P=L;if(!P){for(var u=R.parent;u&&(u.f&jt)!==0;)for(;(u=u.parent)&&(u.f&Kt)===0;);P=!u||(u.f&Jt)!==0}P&&Tt(()=>{y(()=>a.in())})}}function pt(r,t,i,s,d){var _=s===1;if(ea(t)){var G,L=!1;return ta(()=>{if(!L){var R=t({direction:_?"in":"out"});G=pt(r,R,i,s,d)}}),{abort:()=>{L=!0,G==null||G.abort()},deactivate:()=>G.deactivate(),reset:()=>G.reset(),t:()=>G.t()}}if(i==null||i.deactivate(),!(t!=null&&t.duration))return d(),{abort:Ne,deactivate:Ne,reset:Ne,t:()=>s};const{delay:M=0,css:g,tick:T,easing:J=Ra}=t;var S=[];if(_&&i===void 0&&(T&&T(0,1),g)){var w=kt(g(0,1));S.push(w,w)}var q=()=>1-s,a=r.animate(S,{duration:M,fill:"forwards"});return a.onfinish=()=>{a.cancel();var R=(i==null?void 0:i.t())??1-s;i==null||i.abort();var P=s-R,u=t.duration*Math.abs(P),o=[];if(u>0){var I=!1;if(g)for(var A=Math.ceil(u/16.666666666666668),U=0;U<=A;U+=1){var W=R+P*J(U/A),ue=kt(g(W,1-W));o.push(ue),I||(I=ue.overflow==="hidden")}I&&(r.style.overflow="hidden"),q=()=>{var ne=a.currentTime;return R+P*J(ne/u)},T&&Aa(()=>{if(a.playState!=="running")return!1;var ne=q();return T(ne,1-ne),!0})}a=r.animate(o,{duration:u,fill:"forwards"}),a.onfinish=()=>{q=()=>s,T==null||T(s,1-s),d()}},{abort:()=>{a&&(a.cancel(),a.effect=null,a.onfinish=Ne)},deactivate:()=>{d=Ne},reset:()=>{s===0&&(T==null||T(1,0))},t:()=>q()}}const Ea=({url:r})=>({deckId:r.searchParams.get("id")||"",isExtraStudy:r.searchParams.get("isExtraStudy")==="true",cardIds:r.searchParams.get("cardIds")||encodeURIComponent("[]")}),Fr=Object.freeze(Object.defineProperty({__proto__:null,load:Ea},Symbol.toStringTag,{value:"Module"}));class Ua{constructor(t,i=!0){Qe(this,"audios");Qe(this,"currentIndex",0);Qe(this,"isPlaying",!1);Qe(this,"onEnded",this.handleEnded.bind(this));this.audios=t.map(s=>{const d=new Audio(s);return d.preload="auto",i&&d.load(),d})}handleEnded(){this.audios[this.currentIndex].removeEventListener("ended",this.onEnded),this.currentIndex++,this.currentIndex<this.audios.length?this.playCurrent():(this.isPlaying=!1,this.currentIndex=0)}playCurrent(){const t=this.audios[this.currentIndex];t.addEventListener("ended",this.onEnded),t.currentTime=0,t.play().catch(i=>{console.warn("Playback failed:",i),this.stop()})}play(){this.audios.length!==0&&(this.isPlaying&&this.stop(),this.isPlaying=!0,this.currentIndex=0,this.playCurrent())}stop(){if(!this.isPlaying)return;this.isPlaying=!1;const t=this.audios[this.currentIndex];t.pause(),t.currentTime=0,t.removeEventListener("ended",this.onEnded),this.currentIndex=0}}const Wa={[E.Again]:"Fail",[E.Hard]:"Hard",[E.Good]:"Good",[E.Easy]:"Easy"},Da={[E.Again]:"again",[E.Hard]:"hard",[E.Good]:"good",[E.Easy]:"easy"},Ga={[E.Again]:"fa fa-solid fa-face-frown",[E.Hard]:"fa fa-solid fa-face-meh",[E.Good]:"fa fa-solid fa-face-smile",[E.Easy]:"fa fa-solid fa-star"};var nt;(r=>{function t(s){if(s.isFailAndReveal)return E.Again;const d=s.correctStrokeCount===0?1/0:s.incorrectStrokeCount/s.correctStrokeCount;return d<.25||s.incorrectStrokeCount<=2?E.Good:d<.75||s.incorrectStrokeCount<=4?E.Hard:E.Again}r.getGrade=t;function i(s){switch(s){case E.Again:return"Again";case E.Hard:return"Hard";case E.Good:return"Good";default:return"Unknown"}}r.gradeToLabel=i})(nt||(nt={}));var Ia=(r,t)=>t(),Na=D('<button class="audio-button svelte-xlnlhl" aria-label="Play Audio"><i class="fa-solid fa-volume-low svelte-xlnlhl"></i></button>'),Fa=D('<div class="new-element-indicator svelte-xlnlhl">New Card</div>'),La=D("<div>Warm Up</div>"),Oa=D('<div class="new-element-indicator is-hidden svelte-xlnlhl"></div>'),Pa=(r,t)=>t.onOpenDict(),Ha=D('<span class="svelte-xlnlhl"> </span>'),Ma=D('<span class="empty-character-box svelte-xlnlhl">&#x3000;</span>'),za=D('<!> <div class="right-side svelte-xlnlhl"><button class="button dict-button svelte-xlnlhl"><i class="fa-solid fa-book svelte-xlnlhl"></i> Dict</button> <div class="character-box-container chinese-font svelte-xlnlhl"></div></div>',1),Ya=(r,t)=>t(),qa=D('<i class="fa-solid fa-play svelte-xlnlhl"></i>'),Ba=D('<i class="fa-solid fa-forward svelte-xlnlhl"></i>'),Za=D('<button class="stroke-speed-button svelte-xlnlhl"><!> <span class="svelte-xlnlhl"> </span></button>'),Xa=(r,t)=>t(),ja=D('<i style="font-size: 2.4em" class="fa fa-solid fa-seedling svelte-xlnlhl"></i> <span class="svelte-xlnlhl">New</span>',1),Ka=D('<i></i> <span class="svelte-xlnlhl"> </span>',1),Ja=D("<button><!></button>"),Qa=D('<div class="character-writer svelte-xlnlhl"><div class="meaning svelte-xlnlhl"> </div> <div><div class="reading svelte-xlnlhl"> </div> <!></div> <div class="character-container svelte-xlnlhl"><div class="grid-background svelte-xlnlhl"><svg xmlns="http://www.w3.org/2000/svg" id="grid-background-target" class="svelte-xlnlhl"><line class="svelte-xlnlhl"></line><line class="svelte-xlnlhl"></line><line class="svelte-xlnlhl"></line><line class="svelte-xlnlhl"></line></svg></div> <div class="bottom-container svelte-xlnlhl"><!></div> <!> <!></div></div>');function Va(r,t){var Xe;wt(t,!0);let i=ce(500),s=ce(500),d=ce(30),_=ra(()=>e(d)),G="#DDD";const L=500,M=1600,g=new Audio(`${ma}/assets/sounds/correct-choice-43861.mp3`);let T=ce(aa([])),J=ce(!1),S=ce(!1),w=ce(!1);function q(){return parseFloat(getComputedStyle(document.body).fontSize)}function a(){return parseFloat(getComputedStyle(document.body).fontSize)/parseFloat(getComputedStyle(document.documentElement).fontSize)}function R(){const f=q()*2*.8;l(i,Math.min(document.documentElement.clientWidth-f,500)*a()),l(s,e(i),!0),l(d,.5*q()*a())}let P=gt(t,"isRequestManualGrade",15),u=gt(t,"autoReviewData",15),o=ce(0),I=(Xe=t.characterData)==null?void 0:Xe.meanings.join("; ");function A(f){for(const C of f)if(C.startsWith(rt))return It(C.substring(rt.length))}function U(){var f;l(S,!0),!e(w)&&(t.cardConfig.isFirstTime?(l(o,(e(o)+1)%t.characterData.characters.length),window.setTimeout(()=>{ue(e(o))},L)):(g.play(),l(o,e(o)+1),e(o)==((f=t.characterData)==null?void 0:f.characters.length)?(t.onComplete({...u()}),l(J,!0),l(fe,!1),window.setTimeout(()=>{ve()},L)):window.setTimeout(()=>{ue(e(o))},L)))}let W;function ue(f){if(e(w)||!t.characterData)return;W&&(t.cardConfig.isFirstTime||W.cancelQuiz(),W.hideCharacter(),W.hideOutline());const C=A(t.characterData.tags[f]??[]);W=pa.create("grid-background-target",t.characterData.characters[f],{width:e(i),height:e(s),padding:5,showCharacter:!1,showOutline:t.cardConfig.isShowOutline,highlightOnComplete:!1,strokeColor:t.app.getChineseToneColor(C)??"#555",drawingWidth:Ca,drawingColor:"#555",strokeAnimationSpeed:e(p),delayBetweenStrokes:xt(e(p),1,Fe,1e3,10),delayBetweenLoops:xt(e(p),1,Fe,2e3,10),onComplete:()=>{U()}}),t.cardConfig.isFirstTime?(setTimeout(()=>{e(S)||ve()},L),setTimeout(()=>{W.animateCharacter({onComplete:()=>{setTimeout(()=>{W.hideOutline(),W.hideCharacter(),U()},L)}})},L)):(W.quiz({leniency:t.app.getConfig().strokeLeniency,onMistake:()=>{u(u().incorrectStrokeCount++,!0),u(u().totalStrokeCount++,!0)},onCorrectStroke:()=>{u(u().correctStrokeCount++,!0),u(u().totalStrokeCount++,!0)}}),u().isFailAndReveal&&W.showOutline())}function ne(){var C;const f=(C=t.characterData)==null?void 0:C.audioUrl;f&&l(T,f.map(se=>{const ke=se.map(Se=>wa(t.cardConfig.lang,Se));return new Ua(ke)}),!0)}function ve(){if(e(w))return;const f=Math.floor(Math.random()*e(T).length),C=e(T)[f];C.stop(),C.play()}function Ge(){if(t.cardConfig.isWarmUp&&(!t.cardConfig.isGradeWarmUpCards||!t.cardConfig.isFinalWarmUp)){window.alert("Can't change grade during warm-up, since grading doesn't affect scheduling in this phase.");return}P(!P())}function Q(f=0){const C=t.cardConfig.warmUpCount??0,se=t.cardConfig.warmUpMaxCount;return`${Math.round((C+f)/se*100)}%`}let fe=ce(!1);function we(){W&&(u(u().isFailAndReveal=!0,!0),W.showOutline(),window.setTimeout(()=>{l(fe,!0)},M))}const Fe=5;let p=ce(1);function Ee(){const f=e(p)%Fe+1;l(p,f),t.app.setStrokeSpeed(f)}Et(()=>(u({correctStrokeCount:0,incorrectStrokeCount:0,totalStrokeCount:0,isFailAndReveal:!1}),R(),ne(),window.addEventListener("resize",R),l(p,t.app.getStrokeSpeed(),!0),ue(0),()=>{l(w,!0),window.removeEventListener("resize",R)}));var Me=Qa(),me=h(Me),st=h(me,!0);m(me);var Le=k(me,2);let ze;var Ye=h(Le),it=h(Ye,!0);m(Ye);var ot=k(Ye,2);{var lt=f=>{var C=Na();C.__click=[Ia,ve],x(f,C)};O(ot,f=>{e(T).length>0&&f(lt)})}m(Le);var qe=k(Le,2),Oe=h(qe),Pe=h(Oe),Ue=h(Pe);F(Ue,"stroke",G);var We=k(Ue);F(We,"stroke",G);var De=k(We);F(De,"stroke",G);var Ie=k(De);F(Ie,"stroke",G),m(Pe),m(Oe);var Be=k(Oe,2),ct=h(Be);{var Ze=f=>{var C=za(),se=xe(C);{var ke=v=>{var z=Fa();x(v,z)},Se=(v,z)=>{{var j=oe=>{var b=La();let B,Z;_e(($,K)=>{B=de(b,1,"new-element-indicator svelte-xlnlhl",null,B,$),Z=Gt(b,"",Z,K)},[()=>({"is-complete":e(J)}),()=>({"--progress":Q(),"--next-progress":Q(1)})]),x(oe,b)},ie=oe=>{var b=Oa();x(oe,b)};O(v,oe=>{t.cardConfig.isWarmUp?oe(j):oe(ie,!1)},z)}};O(se,v=>{t.cardConfig.isFirstTime?v(ke):v(Se,!1)})}var Ae=k(se,2),n=h(Ae);n.__click=[Pa,t];var c=k(n,2);Ut(c,21,()=>t.characterData.characters,Wt,(v,z,j)=>{var ie=Ve(),oe=xe(ie);{var b=Z=>{var $=Ha(),K=h($,!0);m($),_e(()=>re(K,e(z))),x(Z,$)},B=Z=>{var $=Ma();x(Z,$)};O(oe,Z=>{j<e(o)||t.cardConfig.isFirstTime?Z(b):Z(B,!1)})}x(v,ie)}),m(c),m(Ae),x(f,C)};O(ct,f=>{var C;(C=t.characterData)!=null&&C.characters&&f(Ze)})}m(Be);var $e=k(Be,2);{var dt=f=>{var C=Za();C.__click=[Ya,Ee];var se=h(C);{var ke=c=>{var v=qa();x(c,v)},Se=c=>{var v=Ba();x(c,v)};O(se,c=>{e(p)<=1?c(ke):c(Se,!1)})}var Ae=k(se,2),n=h(Ae);m(Ae),m(C),_e(()=>re(n,`${e(p)??""}x`)),x(f,C)};O($e,f=>{t.cardConfig.isFirstTime&&f(dt)})}var ut=k($e,2);{var et=f=>{var C=Ja();let se;C.__click=[Xa,Ge];var ke=h(C);{var Se=n=>{var c=ja();na(2),x(n,c)},Ae=n=>{var c=Ka(),v=xe(c),z=k(v,2),j=h(z,!0);m(z),_e(()=>{de(v,1,ga(Ga[t.autoGrade]),"svelte-xlnlhl"),re(j,Wa[t.autoGrade])}),x(n,c)};O(ke,n=>{t.cardConfig.isWarmUp&&!t.cardConfig.isGradeWarmUpCards?n(Se):n(Ae,!1)})}m(C),_e(n=>se=de(C,1,`auto-review-indicator-container ${Da[t.autoGrade]}`,"svelte-xlnlhl",se,n),[()=>({blinking:P(),animated:P(),"echo-once":!P()})]),x(f,C)};O(ut,f=>{t.autoGrade&&!e(fe)&&f(et)})}return m(qe),m(Me),_e(f=>{var C;re(st,I),ze=de(Le,1,"reading-container svelte-xlnlhl",null,ze,f),re(it,(C=t.characterData)==null?void 0:C.reading),F(Pe,"width",e(i)),F(Pe,"height",e(s)),F(Ue,"x1",e(_)),F(Ue,"y1",e(_)),F(Ue,"x2",e(i)-e(_)),F(Ue,"y2",e(s)-e(_)),F(We,"x1",e(i)-e(_)),F(We,"y1",e(_)),F(We,"x2",e(_)),F(We,"y2",e(s)-e(_)),F(De,"x1",e(i)/2),F(De,"y1",e(_)),F(De,"x2",e(i)/2),F(De,"y2",e(s)-e(_)),F(Ie,"x1",e(_)),F(Ie,"y1",e(s)/2),F(Ie,"x2",e(i)-e(_)),F(Ie,"y2",e(s)/2)},[()=>({"is-hidden":!t.app.getConfig().zh.alwaysShowReading&&!e(J)&&!t.cardConfig.isFirstTime})]),x(r,Me),bt({failAndReveal:we})}Ct(["click"]);const $a=r=>r;function er(r){const t=r-1;return t*t*t+1}function At(r){const t=typeof r=="string"&&r.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return t?[parseFloat(t[1]),t[2]||"px"]:[r,"px"]}function tr(r,{delay:t=0,duration:i=400,easing:s=$a}={}){const d=+getComputedStyle(r).opacity;return{delay:t,duration:i,easing:s,css:_=>`opacity: ${_*d}`}}function ar(r,{delay:t=0,duration:i=400,easing:s=er,x:d=0,y:_=0,opacity:G=0}={}){const L=getComputedStyle(r),M=+L.opacity,g=L.transform==="none"?"":L.transform,T=M*(1-G),[J,S]=At(d),[w,q]=At(_);return{delay:t,duration:i,easing:s,css:(a,R)=>`
			transform: ${g} translate(${(1-a)*J}${S}, ${(1-a)*w}${q});
			opacity: ${M-T*R}`}}function rr(r){const t=r-1;return t*t*t+1}var nr=(r,t)=>t.onClose(),sr=D('<div class="modal-backdrop svelte-7blv8t"><div><button class="modal-close svelte-7blv8t" aria-label="Close"><i class="fa-solid fa-xmark"></i></button> <div class="modal-panel svelte-7blv8t"><div class="modal-drag-handle svelte-7blv8t"></div> <div class="modal-container svelte-7blv8t"><!></div></div></div></div>');function ir(r,t){wt(t,!0);let i=0,s=ce(0),d=ce(!1),_=ce(null);const G=100;let L=!1;function M(o){var I;l(d,!1),i=o.touches[0].clientY,L=(((I=e(_))==null?void 0:I.scrollTop)??0)===0}function g(o){const A=o.touches[0].clientY-i;!e(d)&&L&&A>0&&l(d,!0),e(d)&&(o.cancelable&&o.preventDefault(),l(s,Math.max(0,A),!0))}function T(){e(d)&&e(s)>G&&t.onClose(),l(d,!1),l(s,0)}let J=0;function S(o){const I=document.documentElement,A=document.body;o?(I.classList.add("no-ptr"),A.classList.add("no-ptr")):(I.classList.remove("no-ptr"),A.classList.remove("no-ptr"))}function w(){J=window.scrollY;const o=document.body;o.style.position="fixed",o.style.top=`-${J}px`,o.style.left="0",o.style.right="0",o.style.width="100%",S(!0)}function q(){const o=document.body;o.style.position="",o.style.top="",o.style.left="",o.style.right="",o.style.width="",S(!1),window.scrollTo(0,J)}sa(()=>{typeof window>"u"||(t.isOpen?w():q())}),ia(()=>{q()});function a(o){const I=A=>g(A);return o.addEventListener("touchmove",I,{passive:!1}),{destroy(){o.removeEventListener("touchmove",I)}}}var R=Ve(),P=xe(R);{var u=o=>{var I=sr(),A=h(I);let U;A.__touchstart=M,A.__touchend=T;let W;var ue=h(A);ue.__click=[nr,t];var ne=k(ue,2),ve=k(h(ne),2),Ge=h(ve);oa(Ge,()=>t.children??Ne),m(ve),Dt(ve,Q=>l(_,Q),()=>e(_)),m(ne),m(A),ka(A,Q=>a==null?void 0:a(Q)),m(I),_e((Q,fe)=>{U=de(A,1,"modal-wrapper svelte-7blv8t",null,U,Q),W=Gt(A,"",W,fe)},[()=>({"is-dragging":e(d)}),()=>({transform:`translateY(${e(s)??""}px)`})]),la("touchcancel",A,T),x(o,I)};O(P,o=>{t.isOpen&&o(u)})}x(r,R),bt()}Ct(["touchstart","touchend","click"]);var or=D('<button><div class="review-button-inner svelte-1rvs14a"><div class="review-time svelte-1rvs14a"> </div> <div class="review-label svelte-1rvs14a"> </div></div></button>'),lr=D('<button><div class="review-button-inner svelte-1rvs14a"><div class="review-time svelte-1rvs14a"> </div> <div class="review-label svelte-1rvs14a"> </div></div></button>'),cr=D('<div class="bottom-container svelte-1rvs14a"><div></div></div>'),dr=()=>ya.goHomeAndClearHistory(),ur=D(`<div style="margin-top: 2em" class="svelte-1rvs14a">You have done today's review.</div> <div class="bottom-container svelte-1rvs14a"><div class="review-button-container svelte-1rvs14a"><button class="button big-button svelte-1rvs14a">Go Back</button></div></div>`,1),vr=D('<div class="counter svelte-1rvs14a"><span class="underlined svelte-1rvs14a"><!></span></div>'),fr=D('<div class="counter svelte-1rvs14a"><span> </span> <span> </span> <span> </span> <span> </span> <span> </span></div>'),mr=D('<!> <div class="character-writer-container svelte-1rvs14a"><!></div> <!>',1),hr=D('<!> <div class="container svelte-1rvs14a"><!> <!></div> <!>',1);function Lr(r,t){wt(t,!1);const i=H(),s=H(),d=H(),_=(n,c=Ne,v)=>{let z=le(()=>va(v==null?void 0:v(),""));var j=cr(),ie=h(j);Ut(ie,5,c,Wt,(oe,b)=>{var B=Ve(),Z=xe(B);{var $=ee=>{var N=or();let X;N.__click=function(...V){var he;(he=e(b).alternate.onclick)==null||he.apply(this,V)};var te=h(N),Y=h(te),ge=h(Y,!0);m(Y);var ae=k(Y,2),be=h(ae,!0);m(ae),m(te),m(N),_e(V=>{X=de(N,1,(e(b),y(()=>`review-button ${e(b).alternate.className||e(b).className||""}`)),"svelte-1rvs14a",X,V),re(ge,(e(b),y(()=>e(b).alternate.sublabel||e(b).sublabel||" "))),re(be,(e(b),y(()=>e(b).alternate.label||e(b).label||" ")))},[()=>({"is-complete":!e(b).isComplete})],le),x(ee,N)},K=ee=>{var N=lr();let X;N.__click=function(...V){var he;(he=e(b).onclick)==null||he.apply(this,V)};var te=h(N),Y=h(te),ge=h(Y,!0);m(Y);var ae=k(Y,2),be=h(ae,!0);m(ae),m(te),m(N),_e(V=>{X=de(N,1,(e(b),y(()=>`review-button ${e(b).className||""}`)),"svelte-1rvs14a",X,V),re(ge,(e(b),y(()=>e(b).sublabel||" "))),re(be,(e(b),y(()=>e(b).label||" ")))},[()=>({"is-complete":e(b).isComplete})],le),x(ee,N)};O(Z,ee=>{e(b),y(()=>e(b).alternate&&!e(b).isComplete&&e(b).alternate.isComplete)?ee($):ee(K,!1)})}x(oe,B)}),m(ie),m(j),_e(()=>de(ie,1,`review-button-container ${e(z)}`,"svelte-1rvs14a")),St(1,j,()=>ar,()=>G),St(2,j,()=>tr,()=>L),x(n,j)},G={delay:100,y:-100,duration:300,easing:rr},L={duration:200};let M=gt(t,"data",8),g=M().deckId||"",T=M().cardIds||encodeURIComponent("[]"),J=JSON.parse(decodeURIComponent(T)),S=M().isExtraStudy?"Extra Study":"Review",w=H(),q=H(!1),a=H(new ha),R=H(),P=H(!1);Et(async()=>{var v;await e(a).init();const n=(v=e(a).deckData[g])==null?void 0:v.tags;ne=n==null?void 0:n.includes(_t.ZH_YUE);const c=n==null?void 0:n.includes(_t.ZH_EXTRA_DICT);await A.init(ne?"yue":"zh",c),l(a,e(a)),ue=n==null?void 0:n.includes(_t.ZH_TRAD),l(ve,e(a).isAutoGrading()),l(Ge,e(a).getConfig().gradeWarmUpCards),l(q,!0),M().isExtraStudy&&e(a).extraStudyHandler.registerReviewCardIdsOverride(J),me()});let u=H(!1),o=H(!1),I=H(!1),A=new ba,U=H(void 0),W=H(!1),ue=!1,ne=!1,ve=H(!1),Ge=H(!1),Q=H(void 0),fe=H(!1),we=H(0);const Fe=["Fail","Hard","Good","Easy"];let p=H(void 0),Ee=H({1:"",2:"",3:"",4:""});function Me(){l(u,!1),l(W,!1),l(Q,void 0),l(fe,!1)}function me(){Me(),l(I,!0);const n=e(a).getNextCard(g);if(n===void 0){l(o,!0);return}e(a).getCard(g,n,!0)&&(l(I,!1),l(p,n),l(Ee,e(a).getRatingScheduledTimeStr(g,n)),l(U,e(a).getWenbunCustomState(g,n)),da(we))}async function st(){e(a).startWarmUp(g,e(p)),await e(a).save(),l(W,!0),l(p,e(p)),l(Ee,e(a).getRatingScheduledTimeStr(g,e(p))),l(U,e(a).getWenbunCustomState(g,e(p)))}async function Le(){e(a).skipWarmUp(g,e(p)),l(W,!0),await e(a).save(),me()}function ze(n){const c=e(a).getCardWord(g,n),v=e(a).getConfig();return A.getCharacterWriterData(c,{convertToTraditional:ue,mandarinReading:v.zh.mandarinReading,isCantonese:ne,isPlayAudio:v.zh.playAudio})}function Ye(n){const c=ze(n);return{characters:(c==null?void 0:c.characters)??"",tones:(c==null?void 0:c.tags.map(v=>it(v)??5))??[],meaning:(c==null?void 0:c.meanings[0])??""}}function it(n){for(const c of n)if(c.startsWith(rt))return It(c.substring(rt.length))}function ot(n){const c=e(a).getWarmUpCount(g,n),v=e(s)&&c===0;return{isFirstTime:e(i),isWarmUp:e(s),isFinalWarmUp:Ze(n),warmUpCount:c,warmUpMaxCount:e(a).getMaxWarmUpCount(),isGradeWarmUpCards:e(a).getConfig().gradeWarmUpCards,isShowOutline:e(i)||v,lang:ne?"yue":"zh"}}function lt(n){l(u,!0),e(ve)&&l(Q,nt.getGrade(n))}async function qe(n){e(a).rateCard(g,e(p),n),await e(a).save(),me()}function Oe(n){switch(n){case E.Easy:return"review-button-easy";case E.Good:return"review-button-good";case E.Hard:return"review-button-hard";case E.Again:return"review-button-fail"}}async function Pe(){e(a).addIgnoredMark(g,e(p)),await e(a).save(),me()}function Ue(){e(a).extraStudyHandler.rateAgain(e(p)),me()}function We(){e(a).extraStudyHandler.rateGood(e(p)),me()}async function De(){e(a).storeAutoGradeLog(e(w).correctStrokeCount,e(w).incorrectStrokeCount,e(Q)),e(a).rateCard(g,e(p),e(Q)),await e(a).save(),me()}function Ie(n){l(Q,n),l(fe,!1)}async function Be(){e(a).warmUpNext(g,e(p)),await e(a).save(),me()}async function ct(){await qe(E.Again)}function Ze(n,c){const v=e(a).getWarmUpCount(g,n);return v===void 0?!0:v>=e(a).getMaxWarmUpCount()}function $e(n,c){return e(a).getWarmUpCount(g,n)===0}function dt(){e(R)&&(e(R).failAndReveal(),l(Q,nt.getGrade(e(w))))}function ut(){l(P,!0)}mt(()=>(e(U),Ce),()=>{l(i,e(U)===Ce.New)}),mt(()=>(e(U),Ce),()=>{l(s,e(U)===Ce.WarmUp)}),mt(()=>e(w),()=>{var n;l(d,{label:"Reveal",sublabel:"(Fail)",className:"review-button-fail",onclick:()=>dt(),isComplete:!((n=e(w))!=null&&n.isFailAndReveal)})}),ca(),fa();var et=hr(),Xe=xe(et);_a(Xe,{get title(){return S}});var f=k(Xe,2),C=h(f);{var se=n=>{var c=ur(),v=k(xe(c),2),z=h(v),j=h(z);j.__click=[dr],m(z),m(v),x(n,c)};O(C,n=>{e(o)&&n(se)})}var ke=k(C,2);{var Se=n=>{var c=mr(),v=xe(c);ht(v,()=>e(we),B=>{var Z=Ve(),$=xe(Z);{var K=N=>{var X=vr(),te=h(X),Y=h(te);ht(Y,()=>e(p),ge=>{var ae=ua();_e(be=>re(ae,be),[()=>(e(a),y(()=>e(a).extraStudyHandler.getCardsCount()||""))],le),x(ge,ae)}),m(te),m(X),x(N,X)},ee=N=>{var X=fr(),te=h(X);let Y;var ge=h(te,!0);m(te);var ae=k(te,2);let be;var V=h(ae,!0);m(ae);var he=k(ae,2);let tt;var vt=h(he,!0);m(he);var pe=k(he,2);let He;var ft=h(pe,!0);m(pe);var je=k(pe,2);let Te;var Ke=h(je,!0);m(je),m(X),_e((Je,ye,Ft,Lt,Ot,Pt,Ht,Mt,zt,Yt)=>{Y=de(te,1,"deck-count-learn-relearn svelte-1rvs14a",null,Y,Je),re(ge,ye),be=de(ae,1,"deck-count-review svelte-1rvs14a",null,be,Ft),re(V,Lt),tt=de(he,1,"deck-count-new svelte-1rvs14a",null,tt,Ot),re(vt,Pt),He=de(pe,1,"deck-count-new svelte-1rvs14a",null,He,Ht),re(ft,Mt),Te=de(je,1,"deck-count-previously-studied svelte-1rvs14a",null,Te,zt),re(Ke,Yt)},[()=>({underlined:e(U)===Ce.Learning||e(U)===Ce.Relearning}),()=>(e(a),y(()=>e(a).getLearningRelearningCardsCount(g)||"")),()=>({underlined:e(U)===Ce.ReviewYoung||e(U)===Ce.ReviewMature}),()=>(e(a),y(()=>e(a).getScheduledReviewCardsCount(g)||"")),()=>({underlined:e(U)===Ce.New}),()=>(e(a),y(()=>e(a).getScheduledNewCardsCount(g)||"")),()=>({underlined:e(U)===Ce.WarmUp}),()=>(e(a),y(()=>e(a).getWarmUpCardsCount(g)?`(${e(a).getWarmUpCardsCount(g)})`:"")),()=>({underlined:e(U)===Ce.PreviouslyStudied}),()=>(e(a),y(()=>e(a).getScheduledPreviouslyStudiedCardsCount(g)||""))],le),x(N,X)};O($,N=>{yt(M()),y(()=>M().isExtraStudy)?N(K):N(ee,!1)})}x(B,Z)});var z=k(v,2),j=h(z);ht(j,()=>[e(p),e(W),e(I)],B=>{const Z=le(()=>(e(p),y(()=>ze(e(p))))),$=le(()=>(e(p),y(()=>ot(e(p)))));Dt(Va(B,{get app(){return e(a)},get characterData(){return e(Z)},onComplete:K=>lt(K),onOpenDict:()=>ut(),get cardConfig(){return e($)},get autoGrade(){return e(Q)},get isRequestManualGrade(){return e(fe)},set isRequestManualGrade(K){l(fe,K)},get autoReviewData(){return e(w)},set autoReviewData(K){l(w,K)},$$legacy:!0}),K=>l(R,K),()=>e(R))}),m(z);var ie=k(z,2);{var oe=B=>{_(B,()=>[{label:"Ignore",sublabel:"(Don't Learn)",className:"review-button-fail",isComplete:!0,onclick:()=>Pe()},{label:"Learn*",sublabel:"(Skip Warm-Up)",className:"review-button-hard",isComplete:!0,onclick:()=>Le()},{label:""},{label:"Learn",className:"review-button-easy main-button",isComplete:!0,onclick:()=>st()}])},b=(B,Z)=>{{var $=ee=>{var N=le(()=>(e(d),e(w),e(p),e(we),e(u),y(()=>{var X;return[{label:"",alternate:{...e(d),isComplete:!((X=e(w))!=null&&X.isFailAndReveal)&&!$e(e(p),e(we))}},{label:""},{label:""},{label:"Next",className:"review-button-easy",isComplete:e(u),onclick:()=>Be()}]})));_(ee,()=>e(N))},K=(ee,N)=>{{var X=Y=>{var ge=le(()=>(e(d),e(u),y(()=>[{label:"",alternate:{...e(d),isComplete:!e(u)}},{label:""},{label:""},{label:"Next",className:"review-button-easy",isComplete:e(u),onclick:()=>ct()}])));_(Y,()=>e(ge))},te=(Y,ge)=>{{var ae=V=>{_(V,()=>[{label:"Again",sublabel:"(Put Back)",className:"review-button-fail",isComplete:e(u),onclick:()=>Ue(),alternate:e(d)},{label:""},{label:""},{label:"Good",className:"review-button-easy",isComplete:e(u),onclick:()=>We()}])},be=(V,he)=>{{var tt=pe=>{var He=le(()=>(e(d),e(u),y(()=>[{label:"",alternate:{...e(d),isComplete:!e(u)}},{label:""},{label:""},{label:"Next",className:"review-button-easy",isComplete:e(u),onclick:()=>De()}])));_(pe,()=>e(He))},vt=(pe,He)=>{{var ft=Te=>{var Ke=le(()=>(e(Ee),e(u),y(()=>Fe.map((Je,ye)=>({label:Je,sublabel:e(Ee)[ye+1],className:Oe(ye+1)+" time",isComplete:e(u),onclick:()=>Ie(ye+1)})))));_(Te,()=>e(Ke),()=>"pulsing")},je=Te=>{var Ke=le(()=>(e(Ee),e(u),e(d),y(()=>Fe.map((Je,ye)=>({label:Je,sublabel:e(Ee)[ye+1],className:Oe(ye+1)+" time",isComplete:e(u),alternate:ye==0?e(d):void 0,onclick:()=>qe(ye+1)})))));_(Te,()=>e(Ke))};O(pe,Te=>{e(ve)&&e(fe)?Te(ft):Te(je,!1)},He)}};O(V,pe=>{e(ve)&&!e(fe)?pe(tt):pe(vt,!1)},he)}};O(Y,V=>{yt(M()),y(()=>M().isExtraStudy)?V(ae):V(be,!1)},ge)}};O(ee,Y=>{e(s),e(p),e(we),e(Ge),y(()=>e(s)&&Ze(e(p),e(we))&&!e(Ge))?Y(X):Y(te,!1)},N)}};O(B,ee=>{e(s),e(p),e(we),y(()=>e(s)&&!Ze(e(p),e(we)))?ee($):ee(K,!1)},Z)}};O(ie,B=>{e(i)?B(oe):B(b,!1)})}x(n,c)};O(ke,n=>{e(q)&&e(p)!==void 0&&!e(o)&&n(Se)})}m(f);var Ae=k(f,2);ir(Ae,{onClose:()=>l(P,!1),get isOpen(){return e(P)},set isOpen(n){l(P,n)},children:(n,c)=>{var v=Ve(),z=xe(v);{var j=ie=>{const oe=le(()=>(e(p),y(()=>Ye(e(p))))),b=le(()=>(e(a),y(()=>e(a).getChineseToneColorArray())));xa(ie,{get charData(){return e(oe)},get wordlist(){return A},get toneColors(){return e(b)},get zhReading(){return e(a),y(()=>e(a).getConfig().zh.mandarinReading)}})};O(z,ie=>{e(p)!==void 0&&ie(j)})}x(n,v)},$$slots:{default:!0},$$legacy:!0}),x(r,et),bt()}Ct(["click"]);export{Lr as component,Fr as universal};
