import"../chunks/CWj6FrbW.js";import"../chunks/e1-x02pv.js";import{a3 as De,p as Ie,a5 as Ce,j as y,a4 as I,f as g,d as l,i as e,r as i,b as f,c as Ae,n as M,O as ge,w as ke,s,t as T,a8 as oe,e as B,a as ye,aM as Ne,a9 as he,aL as se,ab as Re}from"../chunks/B3vXJgDE.js";import{i as Z}from"../chunks/BMd2rG11.js";import{k as Ue}from"../chunks/u-7-ff8R.js";import{s as le,T as Ge,b as Me,r as ie}from"../chunks/-bR0FToJ.js";import{s as J}from"../chunks/BgSIpHGp.js";import{b as ne,a as Be}from"../chunks/DFF9A_Ms.js";import{b as we}from"../chunks/NgEXzAtY.js";import{i as Se}from"../chunks/DRVz_ard.js";import{a as Ze,b as be}from"../chunks/D9EQzb-w.js";import{e as qe,i as Ke}from"../chunks/Cf-085yO.js";import{p as X}from"../chunks/DfwZoAIM.js";import{c as xe,C as Ye,g as ce,h as de}from"../chunks/NeAu8v0G.js";import{A as Ve}from"../chunks/DgyyUUPH.js";import{S as re}from"../chunks/tB9HzsKm.js";const Ee={name:"",words:[],lang:"zh",isEnableCustomDictionary:!1};var E=(u=>(u.Simple="simple",u.AnkiText="ankiText",u))(E||{});class Xe{constructor(n){this.app=n}getDeckData(n){const m=[];return n.lang==="yue"&&m.push(xe.ZH_YUE),n.isEnableCustomDictionary&&m.push(xe.ZH_EXTRA_DICT),this.app.getInitDeckData(n.words,m)}parseSimple(n){return{words:n.split(`
`).filter(a=>a.trim()!=="")}}parseAnkiText(n,m){return{words:n.split(`
`).filter(p=>p.trim()!==""&&!p.startsWith("#")).map(p=>p.split("	")[m-1])}}}var Je=()=>window.alert(ce),Qe=u=>{u.key==="Enter"&&window.alert(ce)},et=g('<span class="word-error not-supported svelte-1wh8jz4" style="cursor: pointer;" role="button" tabindex="0"><i class="fa-solid fa-triangle-exclamation"></i></span>'),tt=()=>window.alert(de),at=u=>{u.key==="Enter"&&window.alert(de)},st=g('<span class="word-error no-dict svelte-1wh8jz4" style="cursor: pointer;" role="button" tabindex="0"><i class="fa-solid fa-circle-exclamation"></i></span>'),it=g('<div><span class="word chinese-font svelte-1wh8jz4"> </span> <span class="reading"> </span> <span class="meaning"> </span> <!></div>'),nt=g('<div class="cards-container svelte-1wh8jz4"></div>'),rt=g('<div class="deck-preview-container svelte-1wh8jz4"><!></div>');function ot(u,n){Ie(n,!1);const m=(_,c=ke,A=ke)=>{var x=it();let $;var j=l(x),K=l(j,!0);i(j);var W=s(j,2),R=l(W,!0);i(W);var z=s(W,2),F=l(z,!0);i(z);var U=s(z,2);{var Y=w=>{var D=et();D.__click=[Je],D.__keydown=[Qe],T(()=>le(D,"title",ce)),f(w,D)},V=(w,D)=>{{var P=G=>{var S=st();S.__click=[tt],S.__keydown=[at],T(()=>le(S,"title",de)),f(G,S)};Z(w,G=>{A()||G(P)},D)}};Z(U,w=>{c(),M(()=>!k.isWordSupportedByHanziWriter(c()))?w(Y):w(V,!1)})}i(x),T((w,D)=>{$=J(x,1,"card svelte-1wh8jz4",null,$,w),B(K,c()),B(R,D),B(F,(A(),M(()=>{var P;return((P=A())==null?void 0:P.meaning)??"-"})))},[()=>({"is-show-error-only":p()&&h()>0}),()=>(c(),ge(a()),M(()=>k.getReading(c(),a().lang)||"-"))],oe),f(_,x)};let a=X(n,"deck",8,Ee),p=X(n,"filterShowIssueOnly",8,!1),h=X(n,"issueCount",12,0),r=X(n,"issueIds",28,()=>[]),k=new Ye,O=I(!1);Ce(async()=>{var _;await k.init(a().lang,(_=a())==null?void 0:_.isEnableCustomDictionary),H(),y(O,!0)});function H(){h(0);const _=[];a().words.forEach((c,A)=>{(!k.isWordSupportedByHanziWriter(c)||!k.getWordData(c))&&_.push(A)}),r(_),h(_.length)}Se();var C=rt(),N=l(C);{var q=_=>{var c=nt();qe(c,5,()=>(ge(a()),M(()=>a().words)),Ke,(A,x)=>{var $=oe(()=>(e(x),M(()=>k.getWordData(e(x)))));m(A,()=>e(x),()=>e($))}),i(c),f(_,c)};Z(N,_=>{a()!==null&&e(O)&&_(q)})}i(C),f(u,C),Ae()}De(["click","keydown"]);async function lt(u,n,m,a){const p=await e(n).fileManager.upload();if(p===null||typeof p.data!="string"){window.alert("Failed to upload file.");return}y(m,p.data),a()}var ct=g('<div><label>Column Index: <input type="number" step="1" min="0"/></label></div>'),dt=(u,n)=>y(n,!e(n)),vt=g('<div class="info-issue is-issue svelte-5yul8g"> </div> <button class="button"> </button>',1),ut=g('<div class="info-issue">No issues found.</div> <button class="button" style="visibility: hidden;">&npsb;</button>',1),pt=g('<div class="deck-preview-container svelte-5yul8g"><!></div>'),_t=g('<div style="text-align: right;"><input type="text"/> <div style="color: #A64547;">Deck with this name already exists. Please choose another name.</div> <div style="color: #A64547;">Deck name cannot be empty.</div></div>'),mt=g("<select><option>Mandarin</option><option>Cantonese</option></select>"),ft=g('<input type="checkbox"/>'),gt=g(`<!> <div class="main-container svelte-5yul8g"><div class="upload-container svelte-5yul8g"><div class="section-title svelte-5yul8g">Input</div> <div><label>Format: <select><option>Simple</option><option>Anki Text</option></select></label> <a aria-label="Help" class="help-link svelte-5yul8g"><i class="fa-solid fa-circle-question"></i></a></div> <!> <textarea class="deck-textarea svelte-5yul8g" placeholder="Enter deck text here"></textarea> <button class="button" style="align-self: flex-end;"><i class="fa-solid fa-upload"></i>&nbsp;
            Upload File</button></div> <div class="preview-container svelte-5yul8g"><div class="section-title svelte-5yul8g">Preview</div> <div class="info-issue-container svelte-5yul8g"><!></div> <!></div> <div class="config-container svelte-5yul8g"><div class="section-title svelte-5yul8g">Config</div> <div class="config-items svelte-5yul8g"><!> <!> <!></div></div> <div class="add-deck-container svelte-5yul8g"><button class="button">Add Deck</button></div></div>`,1);function Pt(u,n){Ie(n,!1);const m="customDeckInput";let a=I(new Ve),p=new Xe(e(a)),h=I(""),r=I(Ee),k=I(0),O=I([]),H=I(!1),C=I(E.Simple),N=I(1),q=I(0);function _(){Ne(q)}function c(){window.localStorage.setItem(m,e(h));const t=A();t&&y(r,{...e(r),...t}),_()}function A(){switch(e(C)){case E.Simple:return p.parseSimple(e(h));case E.AnkiText:return p.parseAnkiText(e(h),e(N))}}async function x(){if(e(r).name.trim()===""){window.alert("Deck name cannot be empty.");return}if(e(a).isDeckIdExists(e(r).name)){window.alert("Deck with this name already exists. Please choose another name.");return}if(e(k)>0&&!window.confirm("You have issues in your deck. Card with issues will be ignored. Are you sure you want to add this deck?"))return;const t=p.getDeckData(e(r));t.ignoredIds=e(O),await e(a).addDeck(e(r).name,t),Ze(`${be}/`)}Ce(async()=>{const t=window.localStorage.getItem(m);t&&y(h,t),await e(a).init(),c(),y(a,e(a)),await e(a).initProfile()&&c(),y(a,e(a))}),Se();var $=gt(),j=ye($);Ge(j,{title:"Upload Custom Deck"});var K=s(j,2),W=l(K),R=s(l(W),2),z=l(R),F=s(l(z));T(()=>{e(C),he(()=>{})}),F.__change=c;var U=l(F),Y={},V=s(U),w={};i(F),i(z);var D=s(z,2);i(R);var P=s(R,2);{var G=t=>{var v=ct(),o=l(v),d=s(l(o));ie(d),d.__input=c,i(o),i(v),ne(d,()=>e(N),b=>y(N,b)),f(t,v)};Z(P,t=>{e(C)===E.AnkiText&&t(G)})}var S=s(P,2);Me(S),S.__input=c;var Te=s(S,2);Te.__click=[lt,a,h,c],i(W);var Q=s(W,2),ee=s(l(Q),2),$e=l(ee);{var We=t=>{var v=vt(),o=ye(v),d=l(o);i(o);var b=s(o,2);b.__click=[dt,H];var L=l(b,!0);i(b),T(()=>{B(d,`Found ${e(k)??""} issue(s)`),B(L,e(H)?"Show All":"Filter to Issues")}),f(t,v)},ze=t=>{var v=ut();Re(2),f(t,v)};Z($e,t=>{e(k)!=0?t(We):t(ze,!1)})}i(ee);var Pe=s(ee,2);Ue(Pe,()=>e(q),t=>{var v=pt(),o=l(v);ot(o,{get deck(){return e(r)},get filterShowIssueOnly(){return e(H)},get issueCount(){return e(k)},set issueCount(d){y(k,d)},get issueIds(){return e(O)},set issueIds(d){y(O,d)},$$legacy:!0}),i(v),f(t,v)}),i(Q);var te=s(Q,2),ve=s(l(te),2),ue=l(ve);re(ue,{key:"deckName",children:(t,v)=>{var o=_t(),d=l(o);ie(d);let b;var L=s(d,2);let me;var Fe=s(L,2);let fe;i(o),T((ae,Le,He)=>{b=J(d,1,"",null,b,ae),me=J(L,1,"warning-text svelte-5yul8g",null,me,Le),fe=J(Fe,1,"warning-text svelte-5yul8g",null,fe,He)},[()=>({invalid:e(a).isDeckIdExists(e(r).name)}),()=>({hidden:!e(a).isDeckIdExists(e(r).name)}),()=>({hidden:e(r).name.trim()})],oe),ne(d,()=>e(r).name,ae=>se(r,e(r).name=ae)),f(t,o)},$$slots:{default:!0}});var pe=s(ue,2);re(pe,{key:"deckLanguage",children:(t,v)=>{var o=mt();T(()=>{e(r),he(()=>{})});var d=l(o);d.value=d.__value="zh";var b=s(d);b.value=b.__value="yue",i(o),we(o,()=>e(r).lang,L=>se(r,e(r).lang=L)),f(t,o)},$$slots:{default:!0}});var Oe=s(pe,2);re(Oe,{key:"deckEnableCustomDictionary",children:(t,v)=>{var o=ft();ie(o),o.__change=c,Be(o,()=>e(r).isEnableCustomDictionary,d=>se(r,e(r).isEnableCustomDictionary=d)),f(t,o)},$$slots:{default:!0}}),i(ve),i(te);var _e=s(te,2),je=l(_e);je.__click=x,i(_e),i(K),T(()=>{Y!==(Y=E.Simple)&&(U.value=(U.__value=E.Simple)??""),w!==(w=E.AnkiText)&&(V.value=(V.__value=E.AnkiText)??""),le(D,"href",`${be??""}/upload-custom-deck/help`)}),we(F,()=>e(C),t=>y(C,t)),ne(S,()=>e(h),t=>y(h,t)),f(u,$),Ae()}De(["change","input","click"]);export{Pt as component};
