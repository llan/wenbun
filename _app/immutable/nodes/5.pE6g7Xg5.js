var we=Object.defineProperty;var Pe=(s,t,e)=>t in s?we(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var St=(s,t,e)=>Pe(s,typeof t!="symbol"?t+"":t,e);import"../chunks/CWj6FrbW.js";import{i as De}from"../chunks/CdGgX4fi.js";import{o as Zt,s as J,d as Me}from"../chunks/B4tcad5q.js";import{h as Ht,d as xe,a0 as Re,aJ as Te,aK as be,c as Ae,p as Oe,m as $e,n as Ee,U as Ie,o as te,w as I,C,D as y,B as M,y as Tt,g as d,s as ot,z as T,A as ee,b as P,a9 as Le,x as bt,q as j,G as Wt,I as yt}from"../chunks/DCeKAzBs.js";import{i as lt}from"../chunks/B_3B16l0.js";import{d as ze,f as Fe,p as re,s as S,e as ie,i as se,A as He,T as We,g as at}from"../chunks/4mydEKmB.js";import{s as ne}from"../chunks/Be9VuDtp.js";import{p as Be}from"../chunks/DFIMFCGJ.js";import{b as oe}from"../chunks/BqCs0SEl.js";function qe(s,t,e){Ht&&xe();var r=s,i=Ie,n,o=Re()?Te:be;Ae(()=>{o(i,i=t())&&(n&&Oe(n),n=$e(()=>e(r)))}),Ht&&(r=Ee)}const Ue=({url:s})=>({deckId:s.searchParams.get("id")||""}),di=Object.freeze(Object.defineProperty({__proto__:null,load:Ue},Symbol.toStringTag,{value:"Module"}));var Ct,wt,Pt;const B=typeof window>"u"?global:window,ae=B.performance&&(()=>B.performance.now())||(()=>Date.now()),Dt=((Ct=B.requestAnimationFrame)===null||Ct===void 0?void 0:Ct.bind(B))||(s=>setTimeout(()=>s(ae()),1e3/60)),Bt=((wt=B.cancelAnimationFrame)===null||wt===void 0?void 0:wt.bind(B))||clearTimeout;function dt(s){return s[s.length-1]}const Et=(s,t)=>s<0?t+s:s,Ne=(s,t)=>s[Et(t,s.length)];function he(s,t){const e={...s};for(const r in t){const i=s[r],n=t[r];i!==n&&(i&&n&&typeof i=="object"&&typeof n=="object"&&!Array.isArray(n)?e[r]=he(i,n):e[r]=n)}return e}function je(s,t){const e=s.split("."),r={};let i=r;for(let n=0;n<e.length;n++){const o=n===e.length-1?t:{};i[e[n]]=o,i=o}return r}let qt=0;function ce(){return qt++,qt}function ht(s){return s.reduce((e,r)=>r+e,0)/s.length}function b(s){const t=s.toUpperCase().trim();if(/^#([A-F0-9]{3}){1,2}$/.test(t)){let r=t.substring(1).split("");r.length===3&&(r=[r[0],r[0],r[1],r[1],r[2],r[2]]);const i=`${r.join("")}`;return{r:parseInt(i.slice(0,2),16),g:parseInt(i.slice(2,4),16),b:parseInt(i.slice(4,6),16),a:1}}const e=t.match(/^RGBA?\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d*\.?\d+))?\)$/);if(e)return{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10),a:parseFloat(e[4]||1,10)};throw new Error(`Invalid color: ${s}`)}const Ve=s=>s.replace(/^\s+/,"").replace(/\s+$/,"");function pt(s,t){const e={};for(let r=0;r<t;r++)e[r]=s;return e}function Qe(s,t){const e={};for(let r=0;r<s;r++)e[r]=t(r);return e}const Mt=((Pt=B.navigator)===null||Pt===void 0?void 0:Pt.userAgent)||"",Ge=Mt.indexOf("MSIE ")>0||Mt.indexOf("Trident/")>0||Mt.indexOf("Edge/")>0,le=()=>{};class Xe{constructor(t,e,r=le){this._mutationChains=[],this._onStateChange=r,this.state={options:{drawingFadeDuration:e.drawingFadeDuration,drawingWidth:e.drawingWidth,drawingColor:b(e.drawingColor),strokeColor:b(e.strokeColor),outlineColor:b(e.outlineColor),radicalColor:b(e.radicalColor||e.strokeColor),highlightColor:b(e.highlightColor)},character:{main:{opacity:e.showCharacter?1:0,strokes:{}},outline:{opacity:e.showOutline?1:0,strokes:{}},highlight:{opacity:1,strokes:{}}},userStrokes:null};for(let i=0;i<t.strokes.length;i++)this.state.character.main.strokes[i]={opacity:1,displayPortion:1},this.state.character.outline.strokes[i]={opacity:1,displayPortion:1},this.state.character.highlight.strokes[i]={opacity:0,displayPortion:1}}overwriteOnStateChange(t){this._onStateChange=t}updateState(t){const e=he(this.state,t);this._onStateChange(e,this.state),this.state=e}run(t,e={}){const r=t.map(i=>i.scope);return this.cancelMutations(r),new Promise(i=>{const n={_isActive:!0,_index:0,_resolve:i,_mutations:t,_loop:e.loop,_scopes:r};this._mutationChains.push(n),this._run(n)})}_run(t){if(!t._isActive)return;const e=t._mutations;if(t._index>=e.length)if(t._loop)t._index=0;else{t._isActive=!1,this._mutationChains=this._mutationChains.filter(i=>i!==t),t._resolve({canceled:!1});return}t._mutations[t._index].run(this).then(()=>{t._isActive&&(t._index++,this._run(t))})}_getActiveMutations(){return this._mutationChains.map(t=>t._mutations[t._index])}pauseAll(){this._getActiveMutations().forEach(t=>t.pause())}resumeAll(){this._getActiveMutations().forEach(t=>t.resume())}cancelMutations(t){for(const e of this._mutationChains)for(const r of e._scopes)for(const i of t)(r.startsWith(i)||i.startsWith(r))&&this._cancelMutationChain(e)}cancelAll(){this.cancelMutations([""])}_cancelMutationChain(t){var e;t._isActive=!1;for(let r=t._index;r<t._mutations.length;r++)t._mutations[r].cancel(this);(e=t._resolve)===null||e===void 0||e.call(t,{canceled:!0}),this._mutationChains=this._mutationChains.filter(r=>r!==t)}}const q=(s,t)=>({x:s.x-t.x,y:s.y-t.y}),ut=s=>Math.sqrt(Math.pow(s.x,2)+Math.pow(s.y,2)),x=(s,t)=>ut(q(s,t)),Ye=(s,t)=>s.x===t.x&&s.y===t.y,At=(s,t=1)=>{const e=t*10;return{x:Math.round(e*s.x)/e,y:Math.round(e*s.y)/e}},It=s=>{let t=s[0];return s.slice(1).reduce((r,i)=>{const n=x(i,t);return t=i,r+n},0)},Ke=(s,t)=>(s.x*t.x+s.y*t.y)/ut(s)/ut(t),Lt=(s,t,e)=>{const r=q(t,s),i=e/ut(r);return{x:t.x+i*r.x,y:t.y+i*r.y}},Je=(s,t)=>{const e=s.length>=t.length?s:t,r=s.length>=t.length?t:s,i=(o,a,h,c)=>{if(o===0&&a===0)return x(e[0],r[0]);if(o>0&&a===0)return Math.max(h[0],x(e[o],r[0]));const l=c[c.length-1];return o===0&&a>0?Math.max(l,x(e[0],r[a])):Math.max(Math.min(h[a],h[a-1],l),x(e[o],r[a]))};let n=[];for(let o=0;o<e.length;o++){const a=[];for(let h=0;h<r.length;h++)a.push(i(o,h,n,a));n=a}return n[r.length-1]},Ze=(s,t=.05)=>{const e=s.slice(0,1);for(const r of s.slice(1)){const i=e[e.length-1],n=x(r,i);if(n>t){const o=Math.ceil(n/t),a=n/o;for(let h=0;h<o;h++)e.push(Lt(r,i,-1*a*(h+1)))}else e.push(r)}return e},tr=(s,t=30)=>{const r=It(s)/(t-1),i=[s[0]],n=dt(s),o=s.slice(1);for(let a=0;a<t-2;a++){let h=dt(i),c=r,l=!1;for(;!l;){const u=x(h,o[0]);if(u<c)c-=u,h=o.shift();else{const v=Lt(h,o[0],c-u);i.push(v),l=!0}}}return i.push(n),i},Ut=s=>{const t=tr(s),e=ht(t.map(h=>h.x)),r=ht(t.map(h=>h.y)),i={x:e,y:r},n=t.map(h=>q(h,i)),o=Math.sqrt(ht([Math.pow(n[0].x,2)+Math.pow(n[0].y,2),Math.pow(dt(n).x,2)+Math.pow(dt(n).y,2)])),a=n.map(h=>({x:h.x/o,y:h.y/o}));return Ze(a)},er=(s,t)=>s.map(e=>({x:Math.cos(t)*e.x-Math.sin(t)*e.y,y:Math.sin(t)*e.x+Math.cos(t)*e.y})),rr=s=>{if(s.length<3)return s;const t=[s[0],s[1]];return s.slice(2).forEach(e=>{const r=t.length,i=q(e,t[r-1]),n=q(t[r-1],t[r-2]);i.y*n.x-i.x*n.y===0&&t.pop(),t.push(e)}),t};function zt(s,t=!1){const e=At(s[0]),r=s.slice(1);let i=`M ${e.x} ${e.y}`;return r.forEach(n=>{const o=At(n);i+=` L ${o.x} ${o.y}`}),t&&(i+="Z"),i}const de=(s,t)=>{const e=rr(s);if(e.length<2)return e;const r=e[1],i=e[0],n=Lt(r,i,t),o=e.slice(1);return o.unshift(n),o};class ir{constructor(t,e,r,i=!1){this.path=t,this.points=e,this.strokeNum=r,this.isInRadical=i}getStartingPoint(){return this.points[0]}getEndingPoint(){return this.points[this.points.length-1]}getLength(){return It(this.points)}getVectors(){let t=this.points[0];return this.points.slice(1).map(r=>{const i=q(r,t);return t=r,i})}getDistance(t){const e=this.points.map(r=>x(r,t));return Math.min(...e)}getAverageDistance(t){return t.reduce((r,i)=>r+this.getDistance(i),0)/t.length}}class sr{constructor(t,e){this.symbol=t,this.strokes=e}}function nr({radStrokes:s,strokes:t,medians:e}){const r=i=>{var n;return((n=s==null?void 0:s.indexOf(i))!==null&&n!==void 0?n:-1)>=0};return t.map((i,n)=>{const o=e[n].map(a=>{const[h,c]=a;return{x:h,y:c}});return new ir(i,o,n,r(n))})}function or(s,t){const e=nr(t);return new sr(s,e)}const ar=[{x:0,y:-124},{x:1024,y:900}],[_t,ue]=ar,Nt=ue.x-_t.x,jt=ue.y-_t.y;class Vt{constructor(t){const{padding:e,width:r,height:i}=t;this.padding=e,this.width=r,this.height=i;const n=r-2*e,o=i-2*e,a=n/Nt,h=o/jt;this.scale=Math.min(a,h);const c=e+(n-this.scale*Nt)/2,l=e+(o-this.scale*jt)/2;this.xOffset=-1*_t.x*this.scale+c,this.yOffset=-1*_t.y*this.scale+l}convertExternalPoint(t){const e=(t.x-this.xOffset)/this.scale,r=(this.height-this.yOffset-t.y)/this.scale;return{x:e,y:r}}}const hr=0,Qt=250,cr=.4,lr=.35;function dr(s,t,e,r={}){const i=t.strokes,n=pr(s.points);if(n.length<2)return{isMatch:!1,meta:{isStrokeBackwards:!1}};const{isMatch:o,meta:a,avgDist:h}=ct(n,i[e],r);if(!o)return{isMatch:o,meta:a};const c=i.slice(e+1);let l=h;for(let u=0;u<c.length;u++){const{isMatch:v,avgDist:f}=ct(n,c[u],{...r,checkBackwards:!1});v&&f<l&&(l=f)}if(l<h){const u=.6*(l+h)/(2*h),{isMatch:v,meta:f}=ct(n,i[e],{...r,leniency:(r.leniency||1)*u});return{isMatch:v,meta:f}}return{isMatch:o,meta:a}}const ur=(s,t,e)=>{const r=x(t.getStartingPoint(),s[0]),i=x(t.getEndingPoint(),s[s.length-1]);return r<=Qt*e&&i<=Qt*e},_r=s=>{const t=[];let e=s[0];return s.slice(1).forEach(r=>{t.push(q(r,e)),e=r}),t},gr=(s,t)=>{const e=_r(s),r=t.getVectors(),i=e.map(o=>{const a=r.map(h=>Ke(h,o));return Math.max(...a)});return ht(i)>hr},fr=(s,t,e)=>e*(It(s)+25)/(t.getLength()+25)>=lr,pr=s=>{if(s.length<2)return s;const[t,...e]=s,r=[t];for(const i of e)Ye(i,r[r.length-1])||r.push(i);return r},vr=[Math.PI/16,Math.PI/32,0,-1*Math.PI/32,-1*Math.PI/16],mr=(s,t,e)=>{const r=Ut(s),i=Ut(t);let n=1/0;return vr.forEach(o=>{const a=Je(r,er(i,o));a<n&&(n=a)}),n<=cr*e},ct=(s,t,e)=>{const{leniency:r=1,isOutlineVisible:i=!1,checkBackwards:n=!0,averageDistanceThreshold:o=350}=e,a=t.getAverageDistance(s),h=i||t.strokeNum>0?.5:1,c=a<=o*h*r;if(!c)return{isMatch:!1,avgDist:a,meta:{isStrokeBackwards:!1}};const l=ur(s,t,r),u=gr(s,t),v=mr(s,t.points,r),f=fr(s,t,r),k=c&&l&&u&&v&&f;return n&&!k&&ct([...s].reverse(),t,{...e,checkBackwards:!1}).isMatch?{isMatch:k,avgDist:a,meta:{isStrokeBackwards:!0}}:{isMatch:k,avgDist:a,meta:{isStrokeBackwards:!1}}};class kr{constructor(t,e,r){this.id=t,this.points=[e],this.externalPoints=[r]}appendPoint(t,e){this.points.push(t),this.externalPoints.push(e)}}class Sr{constructor(t){this._duration=t,this._startTime=null,this._paused=!1,this.scope=`delay.${t}`}run(){return this._startTime=ae(),this._runningPromise=new Promise(t=>{this._resolve=t,this._timeout=setTimeout(()=>this.cancel(),this._duration)}),this._runningPromise}pause(){if(this._paused)return;const t=performance.now()-(this._startTime||0);this._duration=Math.max(0,this._duration-t),clearTimeout(this._timeout),this._paused=!0}resume(){this._paused&&(this._startTime=performance.now(),this._timeout=setTimeout(()=>this.cancel(),this._duration),this._paused=!1)}cancel(){clearTimeout(this._timeout),this._resolve&&this._resolve(),this._resolve=void 0}}class _{constructor(t,e,r={}){this._tick=i=>{if(this._startPauseTime!==null)return;const n=Math.min(1,(i-this._startTime-this._pausedDuration)/this._duration);if(n===1)this._renderState.updateState(this._values),this._frameHandle=void 0,this.cancel(this._renderState);else{const o=yr(n),a=_e(this._startState,this._values,o);this._renderState.updateState(a),this._frameHandle=Dt(this._tick)}},this.scope=t,this._valuesOrCallable=e,this._duration=r.duration||0,this._force=r.force,this._pausedDuration=0,this._startPauseTime=null}run(t){return this._values||this._inflateValues(t),this._duration===0&&t.updateState(this._values),this._duration===0||ge(t.state,this._values)?Promise.resolve():(this._renderState=t,this._startState=t.state,this._startTime=performance.now(),this._frameHandle=Dt(this._tick),new Promise(e=>{this._resolve=e}))}_inflateValues(t){let e=this._valuesOrCallable;typeof this._valuesOrCallable=="function"&&(e=this._valuesOrCallable(t.state)),this._values=je(this.scope,e)}pause(){this._startPauseTime===null&&(this._frameHandle&&Bt(this._frameHandle),this._startPauseTime=performance.now())}resume(){this._startPauseTime!==null&&(this._frameHandle=Dt(this._tick),this._pausedDuration+=performance.now()-this._startPauseTime,this._startPauseTime=null)}cancel(t){var e;(e=this._resolve)===null||e===void 0||e.call(this),this._resolve=void 0,Bt(this._frameHandle||-1),this._frameHandle=void 0,this._force&&(this._values||this._inflateValues(t),t.updateState(this._values))}}_.Delay=Sr;function _e(s,t,e){const r={};for(const i in t){const n=t[i],o=s==null?void 0:s[i];typeof o=="number"&&typeof n=="number"&&n>=0?r[i]=e*(n-o)+o:r[i]=_e(o,n,e)}return r}function ge(s,t){for(const e in t){const r=t[e],i=s==null?void 0:s[e];if(r>=0){if(r!==i)return!1}else if(!ge(i,r))return!1}return!0}const yr=s=>-Math.cos(s*Math.PI)/2+.5,fe=(s,t,e)=>[new _(`character.${s}.strokes`,pt({opacity:1,displayPortion:1},t.strokes.length),{duration:e,force:!0})],Ot=(s,t,e)=>[new _(`character.${s}`,{opacity:1,strokes:pt({opacity:1,displayPortion:1},t.strokes.length)},{duration:e,force:!0})],V=(s,t,e)=>[new _(`character.${s}.opacity`,0,{duration:e,force:!0}),...fe(s,t,0)],Gt=(s,t,e)=>[new _(`options.${s}`,t,{duration:e})],pe=(s,t,e)=>{const r=s.strokeNum,i=(s.getLength()+600)/(3*e);return[new _("options.highlightColor",t),new _("character.highlight",{opacity:1,strokes:{[r]:{displayPortion:0,opacity:0}}}),new _(`character.highlight.strokes.${r}`,{displayPortion:1,opacity:1},{duration:i}),new _(`character.highlight.strokes.${r}.opacity`,0,{duration:i,force:!0})]},ve=(s,t,e)=>{const r=t.strokeNum,i=(t.getLength()+600)/(3*e);return[new _(`character.${s}`,{opacity:1,strokes:{[r]:{displayPortion:0,opacity:1}}}),new _(`character.${s}.strokes.${r}.displayPortion`,1,{duration:i})]},Cr=(s,t,e,r)=>{const i=o=>{const a=o.character[s],h={opacity:1,strokes:{}};for(let c=0;c<t.strokes.length;c++)h.strokes[c]={opacity:a.opacity*a.strokes[c].opacity};return h},n=t.strokes[e];return[new _(`character.${s}`,i),...ve(s,n,r)]},wr=(s,t,e)=>[new _(`character.${s}.strokes.${t}`,{displayPortion:1,opacity:1},{duration:e,force:!0})],me=(s,t,e,r,i)=>{let n=V(s,t,e);return n=n.concat(fe(s,t,0)),n.push(new _(`character.${s}`,{opacity:1,strokes:pt({opacity:0},t.strokes.length)},{force:!0})),t.strokes.forEach((o,a)=>{a>0&&n.push(new _.Delay(i)),n=n.concat(ve(s,o,r))}),n},Pr=(s,t,e,r,i,n)=>{const o=me(s,t,e,r,i);return o.push(new _.Delay(n)),o},Dr=(s,t,e)=>[...V("main",s,t),new _("character.highlight",{opacity:1,strokes:pt({opacity:0},s.strokes.length)},{force:!0}),new _("character.main",{opacity:1,strokes:Qe(s.strokes.length,r=>({opacity:r<e?1:0}))},{force:!0})],Mr=(s,t)=>[new _("quiz.activeUserStrokeId",s,{force:!0}),new _(`userStrokes.${s}`,{points:[t],opacity:1},{force:!0})],xr=(s,t)=>[new _(`userStrokes.${s}.points`,t,{force:!0})],Rr=(s,t)=>[new _(`userStrokes.${s}.opacity`,0,{duration:t})],Xt=s=>(s==null?void 0:s.map(t=>new _(`userStrokes.${t}`,null,{force:!0})))||[],Tr=(s,t,e)=>[new _("options.highlightColor",t),...V("highlight",s),...Ot("highlight",s,e/2),...V("highlight",s,e/2)],br=s=>({pathString:zt(s.externalPoints),points:s.points.map(t=>At(t))});class Ar{constructor(t,e,r){this._currentStrokeIndex=0,this._mistakesOnStroke=0,this._totalMistakes=0,this._character=t,this._renderState=e,this._isActive=!1,this._positioner=r}startQuiz(t){this._userStrokesIds&&this._renderState.run(Xt(this._userStrokesIds)),this._userStrokesIds=[],this._isActive=!0,this._options=t;const e=Et(t.quizStartStrokeNum,this._character.strokes.length);return this._currentStrokeIndex=Math.min(e,this._character.strokes.length-1),this._mistakesOnStroke=0,this._totalMistakes=0,this._renderState.run(Dr(this._character,t.strokeFadeDuration,this._currentStrokeIndex))}startUserStroke(t){var e;if(!this._isActive)return null;if(this._userStroke)return this.endUserStroke();const r=this._positioner.convertExternalPoint(t),i=ce();return this._userStroke=new kr(i,r,t),(e=this._userStrokesIds)===null||e===void 0||e.push(i),this._renderState.run(Mr(i,r))}continueUserStroke(t){if(!this._userStroke)return Promise.resolve();const e=this._positioner.convertExternalPoint(t);this._userStroke.appendPoint(e,t);const r=this._userStroke.points.slice(0);return this._renderState.run(xr(this._userStroke.id,r))}setPositioner(t){this._positioner=t}endUserStroke(){var t;if(!this._userStroke)return;if(this._renderState.run(Rr(this._userStroke.id,(t=this._options.drawingFadeDuration)!==null&&t!==void 0?t:300)),this._userStroke.points.length===1){this._userStroke=void 0;return}const{acceptBackwardsStrokes:e,markStrokeCorrectAfterMisses:r}=this._options,i=this._getCurrentStroke(),{isMatch:n,meta:o}=dr(this._userStroke,this._character,this._currentStrokeIndex,{isOutlineVisible:this._renderState.state.character.outline.opacity>0,leniency:this._options.leniency,averageDistanceThreshold:this._options.averageDistanceThreshold}),a=r&&this._mistakesOnStroke+1>=r;if(n||a||o.isStrokeBackwards&&e)this._handleSuccess(o);else{this._handleFailure(o);const{showHintAfterMisses:c,highlightColor:l,strokeHighlightSpeed:u}=this._options;c!==!1&&this._mistakesOnStroke>=c&&this._renderState.run(pe(i,b(l),u))}this._userStroke=void 0}cancel(){this._isActive=!1,this._userStrokesIds&&this._renderState.run(Xt(this._userStrokesIds))}_getStrokeData({isCorrect:t,meta:e}){return{character:this._character.symbol,strokeNum:this._currentStrokeIndex,mistakesOnStroke:this._mistakesOnStroke,totalMistakes:this._totalMistakes,strokesRemaining:this._character.strokes.length-this._currentStrokeIndex-(t?1:0),drawnPath:br(this._userStroke),isBackwards:e.isStrokeBackwards}}nextStroke(){if(!this._options)return;const{strokes:t,symbol:e}=this._character,{onComplete:r,highlightOnComplete:i,strokeFadeDuration:n,highlightCompleteColor:o,highlightColor:a,strokeHighlightDuration:h}=this._options;let c=wr("main",this._currentStrokeIndex,n);this._mistakesOnStroke=0,this._currentStrokeIndex+=1,this._currentStrokeIndex===t.length&&(this._isActive=!1,r==null||r({character:e,totalMistakes:this._totalMistakes}),i&&(c=c.concat(Tr(this._character,b(o||a),(h||0)*2)))),this._renderState.run(c)}_handleSuccess(t){if(!this._options)return;const{onCorrectStroke:e}=this._options;e==null||e({...this._getStrokeData({isCorrect:!0,meta:t})}),this.nextStroke()}_handleFailure(t){var e,r;this._mistakesOnStroke+=1,this._totalMistakes+=1,(e=(r=this._options).onMistake)===null||e===void 0||e.call(r,this._getStrokeData({isCorrect:!1,meta:t}))}_getCurrentStroke(){return this._character.strokes[this._currentStrokeIndex]}}function H(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function $(s,t,e){s.setAttributeNS(null,t,e)}function gt(s,t){Object.keys(t).forEach(e=>$(s,e,t[e]))}function Or(s){let t="";return window.location&&window.location.href&&(t=window.location.href.replace(/#[^#]*$/,"").replace(/"/gi,"%22")),`url("${t}#${s}")`}function ke(s){var t;s==null||(t=s.parentNode)===null||t===void 0||t.removeChild(s)}class W{constructor(t){this.stroke=t,this._pathLength=t.getLength()+W.STROKE_WIDTH/2}_getStrokeDashoffset(t){return this._pathLength*.999*(1-t)}_getColor({strokeColor:t,radicalColor:e}){return e&&this.stroke.isInRadical?e:t}}W.STROKE_WIDTH=200;const Yt=200;class $r extends W{constructor(t){super(t),this._oldProps=void 0}mount(t){this._animationPath=H("path"),this._clip=H("clipPath"),this._strokePath=H("path");const e=`mask-${ce()}`;$(this._clip,"id",e),$(this._strokePath,"d",this.stroke.path),this._animationPath.style.opacity="0",$(this._animationPath,"clip-path",Or(e));const r=de(this.stroke.points,Yt/2);return $(this._animationPath,"d",zt(r)),gt(this._animationPath,{stroke:"#FFFFFF","stroke-width":Yt.toString(),fill:"none","stroke-linecap":"round","stroke-linejoin":"miter","stroke-dasharray":`${this._pathLength},${this._pathLength}`}),this._clip.appendChild(this._strokePath),t.defs.appendChild(this._clip),t.svg.appendChild(this._animationPath),this}render(t){var e,r;if(t===this._oldProps||!this._animationPath)return;t.displayPortion!==((e=this._oldProps)===null||e===void 0?void 0:e.displayPortion)&&(this._animationPath.style.strokeDashoffset=this._getStrokeDashoffset(t.displayPortion).toString());const i=this._getColor(t);if(!this._oldProps||i!==this._getColor(this._oldProps)){const{r:n,g:o,b:a,a:h}=i;gt(this._animationPath,{stroke:`rgba(${n},${o},${a},${h})`})}t.opacity!==((r=this._oldProps)===null||r===void 0?void 0:r.opacity)&&(this._animationPath.style.opacity=t.opacity.toString()),this._oldProps=t}}class xt{constructor(t){this._oldProps=void 0,this._strokeRenderers=t.strokes.map(e=>new $r(e))}mount(t){const e=t.createSubRenderTarget();this._group=e.svg,this._strokeRenderers.forEach(r=>{r.mount(e)})}render(t){var e,r;if(t===this._oldProps||!this._group)return;const{opacity:i,strokes:n,strokeColor:o,radicalColor:a=null}=t;if(i!==((e=this._oldProps)===null||e===void 0?void 0:e.opacity)&&(this._group.style.opacity=i.toString(),!Ge)){var h;i===0?this._group.style.display="none":((h=this._oldProps)===null||h===void 0?void 0:h.opacity)===0&&this._group.style.removeProperty("display")}const c=!this._oldProps||o!==this._oldProps.strokeColor||a!==this._oldProps.radicalColor;if(c||n!==((r=this._oldProps)===null||r===void 0?void 0:r.strokes))for(let u=0;u<this._strokeRenderers.length;u++){var l;!c&&(l=this._oldProps)!==null&&l!==void 0&&l.strokes&&n[u]===this._oldProps.strokes[u]||this._strokeRenderers[u].render({strokeColor:o,radicalColor:a,opacity:n[u].opacity,displayPortion:n[u].displayPortion})}this._oldProps=t}}class Er{constructor(){this._oldProps=void 0}mount(t){this._path=H("path"),t.svg.appendChild(this._path)}render(t){var e,r,i,n;if(!(!this._path||t===this._oldProps)){if(t.strokeColor!==((e=this._oldProps)===null||e===void 0?void 0:e.strokeColor)||t.strokeWidth!==((r=this._oldProps)===null||r===void 0?void 0:r.strokeWidth)){const{r:o,g:a,b:h,a:c}=t.strokeColor;gt(this._path,{fill:"none",stroke:`rgba(${o},${a},${h},${c})`,"stroke-width":t.strokeWidth.toString(),"stroke-linecap":"round","stroke-linejoin":"round"})}t.opacity!==((i=this._oldProps)===null||i===void 0?void 0:i.opacity)&&$(this._path,"opacity",t.opacity.toString()),t.points!==((n=this._oldProps)===null||n===void 0?void 0:n.points)&&$(this._path,"d",zt(t.points)),this._oldProps=t}}destroy(){ke(this._path)}}class Ir{constructor(t,e){this._character=t,this._positioner=e,this._mainCharRenderer=new xt(t),this._outlineCharRenderer=new xt(t),this._highlightCharRenderer=new xt(t),this._userStrokeRenderers={}}mount(t){const e=t.createSubRenderTarget(),r=e.svg,{xOffset:i,yOffset:n,height:o,scale:a}=this._positioner;$(r,"transform",`translate(${i}, ${o-n}) scale(${a}, ${-1*a})`),this._outlineCharRenderer.mount(e),this._mainCharRenderer.mount(e),this._highlightCharRenderer.mount(e),this._positionedTarget=e}render(t){const{main:e,outline:r,highlight:i}=t.character,{outlineColor:n,radicalColor:o,highlightColor:a,strokeColor:h,drawingWidth:c,drawingColor:l}=t.options;this._outlineCharRenderer.render({opacity:r.opacity,strokes:r.strokes,strokeColor:n}),this._mainCharRenderer.render({opacity:e.opacity,strokes:e.strokes,strokeColor:h,radicalColor:o}),this._highlightCharRenderer.render({opacity:i.opacity,strokes:i.strokes,strokeColor:a});const u=t.userStrokes||{};for(const f in this._userStrokeRenderers)if(!u[f]){var v;(v=this._userStrokeRenderers[f])===null||v===void 0||v.destroy(),delete this._userStrokeRenderers[f]}for(const f in u){const k=u[f];if(!k)continue;const R={strokeWidth:c,strokeColor:l,...k};(()=>{if(this._userStrokeRenderers[f])return this._userStrokeRenderers[f];const D=new Er;return D.mount(this._positionedTarget),this._userStrokeRenderers[f]=D,D})().render(R)}}destroy(){ke(this._positionedTarget.svg),this._positionedTarget.defs.innerHTML=""}}class Se{constructor(t){this.node=t}addPointerStartListener(t){this.node.addEventListener("mousedown",e=>{t(this._eventify(e,this._getMousePoint))}),this.node.addEventListener("touchstart",e=>{t(this._eventify(e,this._getTouchPoint))})}addPointerMoveListener(t){this.node.addEventListener("mousemove",e=>{t(this._eventify(e,this._getMousePoint))}),this.node.addEventListener("touchmove",e=>{t(this._eventify(e,this._getTouchPoint))})}addPointerEndListener(t){document.addEventListener("mouseup",t),document.addEventListener("touchend",t)}getBoundingClientRect(){return this.node.getBoundingClientRect()}updateDimensions(t,e){this.node.setAttribute("width",`${t}`),this.node.setAttribute("height",`${e}`)}_eventify(t,e){return{getPoint:()=>e.call(this,t),preventDefault:()=>t.preventDefault()}}_getMousePoint(t){const{left:e,top:r}=this.getBoundingClientRect(),i=t.clientX-e,n=t.clientY-r;return{x:i,y:n}}_getTouchPoint(t){const{left:e,top:r}=this.getBoundingClientRect(),i=t.touches[0].clientX-e,n=t.touches[0].clientY-r;return{x:i,y:n}}}class ft extends Se{constructor(t,e){super(t),this.svg=t,this.defs=e,"createSVGPoint"in t&&(this._pt=t.createSVGPoint())}static init(t,e="100%",r="100%"){const i=typeof t=="string"?document.getElementById(t):t;if(!i)throw new Error(`HanziWriter target element not found: ${t}`);const n=i.nodeName.toUpperCase(),o=(()=>{if(n==="SVG"||n==="G")return i;{const h=H("svg");return i.appendChild(h),h}})();gt(o,{width:e,height:r});const a=H("defs");return o.appendChild(a),new ft(o,a)}createSubRenderTarget(){const t=H("g");return this.svg.appendChild(t),new ft(t,this.defs)}_getMousePoint(t){if(this._pt&&(this._pt.x=t.clientX,this._pt.y=t.clientY,"getScreenCTM"in this.node)){var e;const r=this._pt.matrixTransform((e=this.node.getScreenCTM())===null||e===void 0?void 0:e.inverse());return{x:r.x,y:r.y}}return super._getMousePoint.call(this,t)}_getTouchPoint(t){if(this._pt&&(this._pt.x=t.touches[0].clientX,this._pt.y=t.touches[0].clientY,"getScreenCTM"in this.node)){var e;const r=this._pt.matrixTransform((e=this.node.getScreenCTM())===null||e===void 0?void 0:e.inverse());return{x:r.x,y:r.y}}return super._getTouchPoint(t)}}var Lr={HanziWriterRenderer:Ir,createRenderTarget:ft.init};const ye=(s,t)=>{s.beginPath();const e=t[0],r=t.slice(1);s.moveTo(e.x,e.y);for(const i of r)s.lineTo(i.x,i.y);s.stroke()},zr=s=>{const t=s.split(/(^|\s+)(?=[A-Z])/).filter(r=>r!==" "),e=[r=>r.beginPath()];for(const r of t){const[i,...n]=r.split(/\s+/),o=n.map(a=>parseFloat(a));i==="M"?e.push(a=>a.moveTo(...o)):i==="L"?e.push(a=>a.lineTo(...o)):i==="C"?e.push(a=>a.bezierCurveTo(...o)):i==="Q"&&e.push(a=>a.quadraticCurveTo(...o))}return r=>e.forEach(i=>i(r))};class Fr extends W{constructor(t,e=!0){super(t),e&&Path2D?this._path2D=new Path2D(this.stroke.path):this._pathCmd=zr(this.stroke.path),this._extendedMaskPoints=de(this.stroke.points,W.STROKE_WIDTH/2)}render(t,e){if(e.opacity<.05)return;if(t.save(),this._path2D)t.clip(this._path2D);else{var r;(r=this._pathCmd)===null||r===void 0||r.call(this,t),t.globalAlpha=0,t.stroke(),t.clip()}const{r:i,g:n,b:o,a}=this._getColor(e),h=a===1?`rgb(${i},${n},${o})`:`rgb(${i},${n},${o},${a})`,c=this._getStrokeDashoffset(e.displayPortion);t.globalAlpha=e.opacity,t.strokeStyle=h,t.fillStyle=h,t.lineWidth=W.STROKE_WIDTH,t.lineCap="round",t.lineJoin="round",t.setLineDash([this._pathLength,this._pathLength],c),t.lineDashOffset=c,ye(t,this._extendedMaskPoints),t.restore()}}class Rt{constructor(t){this._strokeRenderers=t.strokes.map(e=>new Fr(e))}render(t,e){if(e.opacity<.05)return;const{opacity:r,strokeColor:i,radicalColor:n,strokes:o}=e;for(let a=0;a<this._strokeRenderers.length;a++)this._strokeRenderers[a].render(t,{strokeColor:i,radicalColor:n,opacity:o[a].opacity*r,displayPortion:o[a].displayPortion||0})}}function Hr(s,t){if(t.opacity<.05)return;const{opacity:e,strokeWidth:r,strokeColor:i,points:n}=t,{r:o,g:a,b:h,a:c}=i;s.save(),s.globalAlpha=e,s.lineWidth=r,s.strokeStyle=`rgba(${o},${a},${h},${c})`,s.lineCap="round",s.lineJoin="round",ye(s,n),s.restore()}class Wr{constructor(t,e){this.destroy=le,this._character=t,this._positioner=e,this._mainCharRenderer=new Rt(t),this._outlineCharRenderer=new Rt(t),this._highlightCharRenderer=new Rt(t)}mount(t){this._target=t}_animationFrame(t){const{width:e,height:r,scale:i,xOffset:n,yOffset:o}=this._positioner,a=this._target.getContext();a.clearRect(0,0,e,r),a.save(),a.translate(n,r-o),a.transform(1,0,0,-1,0,0),a.scale(i,i),t(a),a.restore(),a.draw&&a.draw()}render(t){const{outline:e,main:r,highlight:i}=t.character,{outlineColor:n,strokeColor:o,radicalColor:a,highlightColor:h,drawingColor:c,drawingWidth:l}=t.options;this._animationFrame(u=>{this._outlineCharRenderer.render(u,{opacity:e.opacity,strokes:e.strokes,strokeColor:n}),this._mainCharRenderer.render(u,{opacity:r.opacity,strokes:r.strokes,strokeColor:o,radicalColor:a}),this._highlightCharRenderer.render(u,{opacity:i.opacity,strokes:i.strokes,strokeColor:h});const v=t.userStrokes||{};for(const f in v){const k=v[f];if(k){const R={strokeWidth:l,strokeColor:c,...k};Hr(u,R)}}})}}class Ft extends Se{constructor(t){super(t)}static init(t,e="100%",r="100%"){const i=typeof t=="string"?document.getElementById(t):t;if(!i)throw new Error(`HanziWriter target element not found: ${t}`);const n=i.nodeName.toUpperCase(),o=(()=>{if(n==="CANVAS")return i;const a=document.createElement("canvas");return i.appendChild(a),a})();return o.setAttribute("width",e),o.setAttribute("height",r),new Ft(o)}getContext(){return this.node.getContext("2d")}}var Br={HanziWriterRenderer:Wr,createRenderTarget:Ft.init};const qr="2.0",Ur=s=>`https://cdn.jsdelivr.net/npm/hanzi-writer-data@${qr}/${s}.json`,Nr=(s,t,e)=>{const r=new XMLHttpRequest;r.overrideMimeType&&r.overrideMimeType("application/json"),r.open("GET",Ur(s),!0),r.onerror=i=>{e(r,i)},r.onreadystatechange=()=>{r.readyState===4&&(r.status===200?t(JSON.parse(r.responseText)):r.status!==0&&e&&e(r))},r.send(null)},Kt={charDataLoader:Nr,onLoadCharDataError:null,onLoadCharDataSuccess:null,showOutline:!0,showCharacter:!0,renderer:"svg",width:0,height:0,padding:20,strokeAnimationSpeed:1,strokeFadeDuration:400,strokeHighlightDuration:200,strokeHighlightSpeed:2,delayBetweenStrokes:1e3,delayBetweenLoops:2e3,strokeColor:"#555",radicalColor:null,highlightColor:"#AAF",outlineColor:"#DDD",drawingColor:"#333",leniency:1,showHintAfterMisses:3,highlightOnComplete:!0,highlightCompleteColor:null,markStrokeCorrectAfterMisses:!1,acceptBackwardsStrokes:!1,quizStartStrokeNum:0,averageDistanceThreshold:350,drawingFadeDuration:300,drawingWidth:4,strokeWidth:2,outlineWidth:2,rendererOverride:{}};class Jt{constructor(t){this._loadCounter=0,this._isLoading=!1,this.loadingFailed=!1,this._options=t}_debouncedLoad(t,e){const r=o=>{if(e===this._loadCounter){var a;(a=this._resolve)===null||a===void 0||a.call(this,o)}},i=o=>{if(e===this._loadCounter){var a;(a=this._reject)===null||a===void 0||a.call(this,o)}},n=this._options.charDataLoader(t,r,i);n&&("then"in n?n.then(r).catch(i):r(n))}_setupLoadingPromise(){return new Promise((t,e)=>{this._resolve=t,this._reject=e}).then(t=>{var e,r;return this._isLoading=!1,(e=(r=this._options).onLoadCharDataSuccess)===null||e===void 0||e.call(r,t),t}).catch(t=>{if(this._isLoading=!1,this.loadingFailed=!0,this._options.onLoadCharDataError){this._options.onLoadCharDataError(t);return}if(t instanceof Error)throw t;const e=new Error(`Failed to load char data for ${this._loadingChar}`);throw e.reason=t,e})}loadCharData(t){this._loadingChar=t;const e=this._setupLoadingPromise();return this.loadingFailed=!1,this._isLoading=!0,this._loadCounter++,this._debouncedLoad(t,this._loadCounter),e}}class E{constructor(t,e={}){const{HanziWriterRenderer:r,createRenderTarget:i}=e.renderer==="canvas"?Br:Lr,n=e.rendererOverride||{};this._renderer={HanziWriterRenderer:n.HanziWriterRenderer||r,createRenderTarget:n.createRenderTarget||i},this.target=this._renderer.createRenderTarget(t,e.width,e.height),this._options=this._assignOptions(e),this._loadingManager=new Jt(this._options),this._setupListeners()}static create(t,e,r){const i=new E(t,r);return i.setCharacter(e),i}static loadCharacterData(t,e={}){const r=(()=>{const{_loadingManager:i,_loadingOptions:n}=E;return(i==null?void 0:i._loadingChar)===t&&n===e?i:new Jt({...Kt,...e})})();return E._loadingManager=r,E._loadingOptions=e,r.loadCharData(t)}static getScalingTransform(t,e,r=0){const i=new Vt({width:t,height:e,padding:r});return{x:i.xOffset,y:i.yOffset,scale:i.scale,transform:Ve(`
        translate(${i.xOffset}, ${i.height-i.yOffset})
        scale(${i.scale}, ${-1*i.scale})
      `).replace(/\s+/g," ")}}showCharacter(t={}){return this._options.showCharacter=!0,this._withData(()=>{var e;return(e=this._renderState)===null||e===void 0?void 0:e.run(Ot("main",this._character,typeof t.duration=="number"?t.duration:this._options.strokeFadeDuration)).then(r=>{var i;return(i=t.onComplete)===null||i===void 0||i.call(t,r),r})})}hideCharacter(t={}){return this._options.showCharacter=!1,this._withData(()=>{var e;return(e=this._renderState)===null||e===void 0?void 0:e.run(V("main",this._character,typeof t.duration=="number"?t.duration:this._options.strokeFadeDuration)).then(r=>{var i;return(i=t.onComplete)===null||i===void 0||i.call(t,r),r})})}animateCharacter(t={}){return this.cancelQuiz(),this._withData(()=>{var e;return(e=this._renderState)===null||e===void 0?void 0:e.run(me("main",this._character,this._options.strokeFadeDuration,this._options.strokeAnimationSpeed,this._options.delayBetweenStrokes)).then(r=>{var i;return(i=t.onComplete)===null||i===void 0||i.call(t,r),r})})}animateStroke(t,e={}){return this.cancelQuiz(),this._withData(()=>{var r;return(r=this._renderState)===null||r===void 0?void 0:r.run(Cr("main",this._character,Et(t,this._character.strokes.length),this._options.strokeAnimationSpeed)).then(i=>{var n;return(n=e.onComplete)===null||n===void 0||n.call(e,i),i})})}highlightStroke(t,e={}){const r=()=>{if(!(!this._character||!this._renderState))return this._renderState.run(pe(Ne(this._character.strokes,t),b(this._options.highlightColor),this._options.strokeHighlightSpeed)).then(i=>{var n;return(n=e.onComplete)===null||n===void 0||n.call(e,i),i})};return this._withData(r)}async loopCharacterAnimation(){return this.cancelQuiz(),this._withData(()=>this._renderState.run(Pr("main",this._character,this._options.strokeFadeDuration,this._options.strokeAnimationSpeed,this._options.delayBetweenStrokes,this._options.delayBetweenLoops),{loop:!0}))}pauseAnimation(){return this._withData(()=>{var t;return(t=this._renderState)===null||t===void 0?void 0:t.pauseAll()})}resumeAnimation(){return this._withData(()=>{var t;return(t=this._renderState)===null||t===void 0?void 0:t.resumeAll()})}showOutline(t={}){return this._options.showOutline=!0,this._withData(()=>{var e;return(e=this._renderState)===null||e===void 0?void 0:e.run(Ot("outline",this._character,typeof t.duration=="number"?t.duration:this._options.strokeFadeDuration)).then(r=>{var i;return(i=t.onComplete)===null||i===void 0||i.call(t,r),r})})}hideOutline(t={}){return this._options.showOutline=!1,this._withData(()=>{var e;return(e=this._renderState)===null||e===void 0?void 0:e.run(V("outline",this._character,typeof t.duration=="number"?t.duration:this._options.strokeFadeDuration)).then(r=>{var i;return(i=t.onComplete)===null||i===void 0||i.call(t,r),r})})}updateDimensions({width:t,height:e,padding:r}){if(t!==void 0&&(this._options.width=t),e!==void 0&&(this._options.height=e),r!==void 0&&(this._options.padding=r),this.target.updateDimensions(this._options.width,this._options.height),this._character&&this._renderState&&this._hanziWriterRenderer&&this._positioner){this._hanziWriterRenderer.destroy();const i=this._initAndMountHanziWriterRenderer(this._character);this._renderState.overwriteOnStateChange(n=>i.render(n)),i.render(this._renderState.state),this._quiz&&this._quiz.setPositioner(this._positioner)}}updateColor(t,e,r={}){var i;let n=[];const o=t==="radicalColor"&&!e?this._options.strokeColor:e,a=b(o);this._options[t]=e;const h=(i=r.duration)!==null&&i!==void 0?i:this._options.strokeFadeDuration;return n=n.concat(Gt(t,a,h)),t==="radicalColor"&&!e&&(n=n.concat(Gt(t,null,0))),this._withData(()=>{var c;return(c=this._renderState)===null||c===void 0?void 0:c.run(n).then(l=>{var u;return(u=r.onComplete)===null||u===void 0||u.call(r,l),l})})}quiz(t={}){return this._withData(async()=>{this._character&&this._renderState&&this._positioner&&(this.cancelQuiz(),this._quiz=new Ar(this._character,this._renderState,this._positioner),this._options={...this._options,...t},this._quiz.startQuiz(this._options))})}skipQuizStroke(){this._quiz&&this._quiz.nextStroke()}cancelQuiz(){this._quiz&&(this._quiz.cancel(),this._quiz=void 0)}setCharacter(t){return this.cancelQuiz(),this._char=t,this._hanziWriterRenderer&&this._hanziWriterRenderer.destroy(),this._renderState&&this._renderState.cancelAll(),this._hanziWriterRenderer=null,this._withDataPromise=this._loadingManager.loadCharData(t).then(e=>{if(!e||this._loadingManager.loadingFailed)return;this._character=or(t,e),this._renderState=new Xe(this._character,this._options,i=>r.render(i));const r=this._initAndMountHanziWriterRenderer(this._character);r.render(this._renderState.state)}),this._withDataPromise}_initAndMountHanziWriterRenderer(t){const{width:e,height:r,padding:i}=this._options;this._positioner=new Vt({width:e,height:r,padding:i});const n=new this._renderer.HanziWriterRenderer(t,this._positioner);return n.mount(this.target),this._hanziWriterRenderer=n,n}async getCharacterData(){if(!this._char)throw new Error("setCharacter() must be called before calling getCharacterData()");return await this._withData(()=>this._character)}_assignOptions(t){const e={...Kt,...t};return t.strokeAnimationDuration&&!t.strokeAnimationSpeed&&(e.strokeAnimationSpeed=500/t.strokeAnimationDuration),t.strokeHighlightDuration&&!t.strokeHighlightSpeed&&(e.strokeHighlightSpeed=500/e.strokeHighlightDuration),t.highlightCompleteColor||(e.highlightCompleteColor=e.highlightColor),this._fillWidthAndHeight(e)}_fillWidthAndHeight(t){const e={...t};if(e.width&&!e.height)e.height=e.width;else if(e.height&&!e.width)e.width=e.height;else if(!e.width&&!e.height){const{width:r,height:i}=this.target.getBoundingClientRect(),n=Math.min(r,i);e.width=n,e.height=n}return e}_withData(t){if(this._loadingManager.loadingFailed)throw Error("Failed to load character data. Call setCharacter and try again.");return this._withDataPromise?this._withDataPromise.then(()=>{if(!this._loadingManager.loadingFailed)return t()}):Promise.resolve().then(t)}_setupListeners(){this.target.addPointerStartListener(t=>{this._quiz&&(t.preventDefault(),this._quiz.startUserStroke(t.getPoint()))}),this.target.addPointerMoveListener(t=>{this._quiz&&(t.preventDefault(),this._quiz.continueUserStroke(t.getPoint()))}),this.target.addPointerEndListener(()=>{var t;(t=this._quiz)===null||t===void 0||t.endUserStroke()})}}E._loadingManager=null;E._loadingOptions=null;const $t="tone-";class jr{constructor(){St(this,"dict",{});St(this,"initialized",!1);this.init()}async init(){const e=await(await fetch(ze)).json();this.dict=e,this.initialized=!0}getCharacterWriterData(t){t=t.replace(/\r/g,"");const e=this.dict[t];if(!e)return{characters:t,reading:t,meanings:[Fe],tags:[]};const r=t,i=e.pinyin,n=[e.meaning],o=[];return e.pinyin_num.split(" ").forEach((h,c)=>{const l=re(h[h.length-1])??0;o[c]=[`${$t}${l}`]}),{characters:r,reading:i,meanings:n,tags:o}}}var Vr=I('<span class="svelte-s33uac"> </span>'),Qr=I('<span class="empty-character-box svelte-s33uac">&#x3000;</span>'),Gr=I('<div class="character-box-container svelte-s33uac"></div>'),Xr=I('<div class="character-writer svelte-s33uac"><div class="meaning svelte-s33uac"> </div> <div> </div> <div class="character-container svelte-s33uac"><div class="grid-background svelte-s33uac"><svg xmlns="http://www.w3.org/2000/svg" id="grid-background-target"><line x1="0" y1="0"></line><line y1="0" x2="0"></line><line y1="0"></line><line x1="0"></line></svg></div> <!></div></div>');function Yr(s,t){var N;te(t,!0);let e=ot(500),r=ot(500),i="#DDD";const n=500,o=new Audio(`${oe}/assets/sounds/correct-choice-43861.mp3`);let a=ot(!1);function h(){return parseFloat(getComputedStyle(document.documentElement).fontSize)}function c(){const m=h()*5*2;P(e,Math.min(window.innerWidth-m,500),!0),P(r,d(e),!0)}let l=ot(0),u=(N=t.characterData)==null?void 0:N.meanings.join("; ");function v(m){for(const p of m)if(p.startsWith($t))return re(p.substring($t.length))}function f(){var m;o.play(),P(l,d(l)+1),d(l)==((m=t.characterData)==null?void 0:m.characters.length)?(t.onComplete(),P(a,!0)):window.setTimeout(()=>{R(d(l))},n)}let k;function R(m){if(!t.characterData)return;k&&(k.cancelQuiz(),k.hideCharacter());const p=v(t.characterData.tags[m]??[]);k=E.create("grid-background-target",t.characterData.characters[m],{width:d(e),height:d(r),padding:5,showCharacter:!1,showOutline:!1,highlightOnComplete:!1,strokeColor:t.app.getChineseToneColor(p)??"#555",onComplete:()=>{f()}}),k.quiz()}Zt(()=>(c(),window.addEventListener("resize",c),R(0),()=>{window.removeEventListener("resize",c)}));var U=Xr(),D=C(U),Z=C(D,!0);y(D);var L=M(D,2);let Q;var vt=C(L,!0);y(L);var tt=M(L,2),G=C(tt),g=C(G),w=C(g);S(w,"stroke",i);var A=M(w);S(A,"stroke",i);var z=M(A);S(z,"stroke",i);var F=M(z);S(F,"stroke",i),y(g),y(G);var et=M(G,2);{var X=m=>{var p=Gr();ie(p,21,()=>t.characterData.characters,se,(rt,it,Y)=>{var st=Le(),nt=bt(st);{var mt=O=>{var K=Vr(),Ce=C(K,!0);y(K),Tt(()=>J(Ce,d(it))),T(O,K)},kt=O=>{var K=Qr();T(O,K)};lt(nt,O=>{Y<d(l)?O(mt):O(kt,!1)})}T(rt,st)}),y(p),T(m,p)};lt(et,m=>{var p;(p=t.characterData)!=null&&p.characters&&m(X)})}y(tt),y(U),Tt(m=>{var p;J(Z,u),Q=ne(L,1,"reading svelte-s33uac",null,Q,m),J(vt,(p=t.characterData)==null?void 0:p.reading),S(g,"width",d(e)),S(g,"height",d(r)),S(w,"x2",d(e)),S(w,"y2",d(r)),S(A,"x1",d(e)),S(A,"y2",d(r)),S(z,"x1",d(e)/2),S(z,"x2",d(e)/2),S(z,"y2",d(r)),S(F,"y1",d(r)/2),S(F,"x2",d(e)),S(F,"y2",d(r)/2)},[()=>({"is-hidden":!t.app.getConfig().zh.alwaysShowReading&&!d(a)})]),T(s,U),ee()}var Kr=I("<div>You have done today's review.</div>"),Jr=I('<button><div class="review-button-inner svelte-1egxf2g"><div class="review-time svelte-1egxf2g"> </div> <div class="review-label svelte-1egxf2g"> </div></div></button>'),Zr=I('<div class="character-writer-container svelte-1egxf2g"><!></div> <div class="bottom-container svelte-1egxf2g"><div class="review-button-container svelte-1egxf2g"></div></div>',1),ti=I('<!> <div class="container svelte-1egxf2g"><!> <!></div>',1);function ui(s,t){te(t,!1);let r=Be(t,"data",8)().deckId||"",i=j(!1),n=j(new He);Zt(async()=>{await d(n).init(),await h.init(),P(n,d(n)),P(i,!0),v()});let o=j(!1),a=j(!1),h=new jr;const c=["Fail","Hard","Good","Easy"];let l=j(void 0),u=j({1:"",2:"",3:"",4:""});function v(){P(o,!1);const g=d(n).getNextCard(r);if(g==null){P(a,!0);return}d(n).getCard(r,g)&&(P(l,g),P(u,d(n).getRatingScheduledTimeStr(r,g)))}function f(g){const w=d(n).getCardWord(r,g);return h.getCharacterWriterData(w)}function k(){P(o,!0)}async function R(g){d(n).rateCard(r,d(l),g),await d(n).save(),v()}function U(g){switch(g){case at.Easy:return"review-button-easy";case at.Good:return"review-button-good";case at.Hard:return"review-button-hard";case at.Again:return"review-button-fail"}}De();var D=ti(),Z=bt(D);We(Z,{title:"Review",get backUrl(){return`${oe??""}/`}});var L=M(Z,2),Q=C(L);{var vt=g=>{var w=Kr();T(g,w)};lt(Q,g=>{d(a)&&g(vt)})}var tt=M(Q,2);{var G=g=>{var w=Zr(),A=bt(w),z=C(A);qe(z,()=>d(l),X=>{const N=Wt(()=>(d(l),yt(()=>f(d(l)))));Yr(X,{get app(){return d(n)},get characterData(){return d(N)},onComplete:()=>k()})}),y(A);var F=M(A,2),et=C(F);ie(et,5,()=>c,se,(X,N,m)=>{var p=Jr();let rt;p.__click=()=>R(m+1);var it=C(p),Y=C(it),st=C(Y,!0);y(Y);var nt=M(Y,2),mt=C(nt,!0);y(nt),y(it),y(p),Tt((kt,O)=>{rt=ne(p,1,kt,"svelte-1egxf2g",rt,O),J(st,(d(u),yt(()=>d(u)[m+1]))),J(mt,d(N))},[()=>yt(()=>`review-button ${U(m+1)}`),()=>({"is-complete":d(o)})],Wt),T(X,p)}),y(et),y(F),T(g,w)};lt(tt,g=>{d(i)&&d(l)!==void 0&&!d(a)&&g(G)})}y(L),T(s,D),ee()}Me(["click"]);export{ui as component,di as universal};
