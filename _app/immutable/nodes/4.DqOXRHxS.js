var xe=n=>{throw TypeError(n)};var he=(n,r,t)=>r.has(n)||xe("Cannot "+t);var v=(n,r,t)=>(he(n,r,"read from private field"),t?t.call(n):r.get(n)),O=(n,r,t)=>r.has(n)?xe("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(n):r.set(n,t);var te=(n,r,t)=>(he(n,r,"access private method"),t);import"../chunks/CWj6FrbW.js";import"../chunks/Bwjk16kZ.js";import{d as et,o as tt,s as $}from"../chunks/Bm5w9rKm.js";import{s as ae,u as ke,a as at,g as e,b as u,i as se,a7 as st,E as T,a8 as ge,a9 as rt,aa as z,ab as ye,ag as b,ad as C,ae as it,af as x,ah as _,W as f,ac as re,o as nt,Y as ot}from"../chunks/CppPYvqM.js";import{i as H}from"../chunks/BmZSK_NP.js";import{e as we,i as Se}from"../chunks/CboPmxil.js";import{T as lt,r as ct}from"../chunks/BgD2c6e2.js";import{s as ie}from"../chunks/WtSHSpat.js";import{b as ut}from"../chunks/CNs2C0tZ.js";import{i as dt}from"../chunks/DR_ajWpe.js";import{p as vt}from"../chunks/B8WkJiGh.js";import{b as _t}from"../chunks/BSi2MV8y.js";import{A as ft,b as pt,c as bt,d as mt,W as h}from"../chunks/BwqE_mTR.js";import{S as xt}from"../chunks/mNDhM2q8.js";const ht=({url:n})=>({deckId:n.searchParams.get("id")||""}),aa=Object.freeze(Object.defineProperty({__proto__:null,load:ht},Symbol.toStringTag,{value:"Module"}));var kt=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],gt=["difference","intersection","symmetricDifference","union"],Ce=!1,P,g,M,K,W,Me,ze;const J=class J extends Set{constructor(t){super();O(this,W);O(this,P,new Map);O(this,g,ae(0));O(this,M,ae(0));O(this,K,ke||-1);if(t){for(var c of t)super.add(c);v(this,M).v=super.size}Ce||te(this,W,ze).call(this)}has(t){var c=super.has(t),k=v(this,P),l=k.get(t);if(l===void 0){if(!c)return e(v(this,g)),!1;l=te(this,W,Me).call(this,!0),k.set(t,l)}return e(l),c}add(t){return super.has(t)||(super.add(t),u(v(this,M),super.size),se(v(this,g))),this}delete(t){var c=super.delete(t),k=v(this,P),l=k.get(t);return l!==void 0&&(k.delete(t),u(l,!1)),c&&(u(v(this,M),super.size),se(v(this,g))),c}clear(){if(super.size!==0){super.clear();var t=v(this,P);for(var c of t.values())u(c,!1);t.clear(),u(v(this,M),0),se(v(this,g))}}keys(){return this.values()}values(){return e(v(this,g)),super.values()}entries(){return e(v(this,g)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return e(v(this,M))}};P=new WeakMap,g=new WeakMap,M=new WeakMap,K=new WeakMap,W=new WeakSet,Me=function(t){return ke===v(this,K)?ae(t):at(t)},ze=function(){Ce=!0;var t=J.prototype,c=Set.prototype;for(const k of kt)t[k]=function(...l){return e(v(this,g)),c[k].apply(this,l)};for(const k of gt)t[k]=function(...l){e(v(this,g));var j=c[k].apply(this,l);return new J(j)}};let ne=J;var yt=(n,r)=>r(),wt=(n,r,t)=>r(e(t).label),St=z('<i class="fa-solid fa-chevron-down"></i>'),Ct=z('<i class="fa-solid fa-chevron-right"></i>'),Mt=(n,r)=>r(),zt=(n,r)=>r(),Dt=(n,r)=>r(),Tt=(n,r)=>r(),Et=(n,r)=>r(),It=(n,r)=>r(),Ot=z('<div style="display: flex; flex-direction: row; justify-content: space-between; width: 100%; gap: 0.5em;"><div class="group-buttons-container svelte-1e3uxxx" style="align-items: flex-start;"><button class="button svelte-1e3uxxx"><i class="fa-solid fa-xmark"></i>cancel selection</button> <button class="button svelte-1e3uxxx"><i class="fa-solid fa-check-double"></i>select all</button></div> <div class="group-buttons-container svelte-1e3uxxx" style="align-items: flex-end;"><button class="button svelte-1e3uxxx"><i class="fa-solid fa-book-open"></i><span>mark as <b>previously studied</b></span></button> <button class="button svelte-1e3uxxx"><i class="fa-solid fa-book-open"></i><span>remove <b>previously studied</b> mark</span></button> <button class="button svelte-1e3uxxx"><i class="fa-solid fa-square-xmark"></i><span>mark as <b>ignored</b></span></button> <button class="button svelte-1e3uxxx"><i class="fa-solid fa-square-xmark"></i><span>remove <b>ignored</b> mark</span></button></div></div>'),Pt=(n,r,t,c)=>r(e(t).label,e(c)),Wt=(n,r,t,c)=>{n.key=="Enter"&&r(e(t).label,e(c))},Nt=(n,r,t,c)=>r(e(t).label,e(c),n),At=z('<button class="button select-button svelte-1e3uxxx">select</button>'),Ut=z('<div role="button" tabindex="0"><!> <div class="card-word svelte-1e3uxxx"><span class="word"> </span></div> <div class="card-details svelte-1e3uxxx"><div> </div> <div> </div></div></div>'),Gt=z('<!> <div class="group-content svelte-1e3uxxx"></div>',1),Rt=z('<div class="group svelte-1e3uxxx"><button class="group-header svelte-1e3uxxx"><div> </div> <div><!></div></button> <!></div>'),jt=z('<!> <div class="container svelte-1e3uxxx"><div class="top-container" style="display: flex; gap: 0.5em; margin-bottom: 2em"><button class="button svelte-1e3uxxx">Split into groups of</button> <input class="input" type="number" min="1" max="100"/></div> <div class="group-container svelte-1e3uxxx"></div></div>',1);function sa(n,r){st(r,!1);const t=T(),c=T();let l=vt(r,"data",8)().deckId||"",j=!1,oe,i=T(new ft);tt(async()=>{var s,a;await e(i).init(),j=(a=(s=e(i).deckData[l])==null?void 0:s.tags)==null?void 0:a.includes(bt.ZH_TRAD),oe=new mt("cn","tw"),u(i,e(i))});let S=T(new xt);function De(s){e(S).set(s,!e(S).get(s)),u(S,e(S))}function Q(s,a,m){switch(m.getWenbunCustomState(s,a)??h.New){case h.New:return"card-status-new";case h.WarmUp:return"card-status-new";case h.Learning:return"card-status-learning";case h.ReviewYoung:return"card-status-review-young";case h.ReviewMature:return"card-status-review-mature";case h.Relearning:return"card-status-relearning";case h.PreviouslyStudied:return"card-status-previously-studied";case h.Ignored:return"card-status-ignored"}}function Te(s,a){const m=e(i).getCardWord(s,a);return j?oe.convert(m):m}let q=T(pt);async function Ee(){const s=Math.ceil(e(t).deck.length/e(q));window.confirm(`Split the deck into ${s} groups?`)&&(e(i).splitDeckIntoGroupOfN(l,e(q)),await e(i).save(),u(i,e(i)))}let p=T(null),o=T(new ne);function Ie(s,a,m){m==null||m.stopPropagation(),u(p,s),e(o).clear(),a!=null&&e(o).add(a),u(o,e(o))}function Oe(){u(p,null),e(o).clear(),u(o,e(o))}function Pe(s,a,m){return e(p)==s&&m.has(a)}function le(s,a){e(p)==s&&(e(o).has(a)?e(o).delete(a):e(o).add(a),u(o,e(o)))}function We(){if(e(p)==null)return;const s=e(t).groups.find(a=>a.label==e(p));if(s!=null){e(o).clear();for(const a of s.cardIds)e(o).add(a);u(o,e(o))}}async function Ne(){e(p)!=null&&(e(o).forEach(s=>{e(i).addPreviouslyStudiedMark(l,s)}),await e(i).save(),u(i,e(i)))}async function Ae(){e(p)!=null&&(e(o).forEach(s=>{e(i).removePreviouslyStudiedMark(l,s)}),await e(i).save(),u(i,e(i)))}async function Ue(){e(p)!=null&&(e(o).forEach(s=>{e(i).addIgnoredMark(l,s)}),await e(i).save(),u(i,e(i)))}async function Ge(){e(p)!=null&&(e(o).forEach(s=>{e(i).removeIgnoredMark(l,s)}),await e(i).save(),u(i,e(i)))}function Re(s){return s===h.WarmUp?h.New:s}ge(()=>e(i),()=>{u(t,e(i).deckData[l])}),ge(()=>e(t),()=>{var s;u(c,((s=e(t))==null?void 0:s.groups)??[])}),rt(),dt();var ce=jt(),ue=ye(ce);lt(ue,{title:"Deck",get backUrl(){return`${_t??""}/`}});var de=x(ue,2),V=b(de),ve=b(V);ve.__click=[yt,Ee];var _e=x(ve,2);ct(_e),_(V);var fe=x(V,2);we(fe,5,()=>e(c),Se,(s,a)=>{var m=Rt(),F=b(m);F.__click=[wt,De,a];var X=b(F),je=b(X,!0);_(X);var pe=x(X,2),qe=b(pe);{var Fe=y=>{var E=St();C(y,E)},Le=y=>{var E=Ct();C(y,E)};H(qe,y=>{e(S),e(a),f(()=>e(S).get(e(a).label))?y(Fe):y(Le,!1)})}_(pe),_(F);var Be=x(F,2);{var Ye=y=>{var E=Gt(),be=ye(E);{var Ze=N=>{var d=Ot(),w=b(d),A=b(w);A.__click=[Mt,Oe];var L=x(A,2);L.__click=[zt,We],_(w);var B=x(w,2),D=b(B);D.__click=[Dt,Ne];var I=x(D,2);I.__click=[Tt,Ae];var U=x(I,2);U.__click=[Et,Ue];var G=x(U,2);G.__click=[It,Ge],_(B),_(d),re(()=>{D.disabled=(e(o),f(()=>e(o).size==0)),I.disabled=(e(o),f(()=>e(o).size==0)),U.disabled=(e(o),f(()=>e(o).size==0)),G.disabled=(e(o),f(()=>e(o).size==0))}),C(N,d)};H(be,N=>{e(p),e(a),f(()=>e(p)==e(a).label)&&N(Ze)})}var me=x(be,2);we(me,5,()=>(e(a),f(()=>e(a).cardIds)),Se,(N,d)=>{var w=Ut();let A;w.__click=[Pt,le,a,d],w.__keydown=[Wt,le,a,d];var L=b(w);{var B=R=>{var Z=At();Z.__click=[Nt,Ie,a,d],C(R,Z)};H(L,R=>{e(p),e(a),f(()=>e(p)!=e(a).label)&&R(B)})}var D=x(L,2),I=b(D),U=b(I,!0);_(I),_(D);var G=x(D,2),Y=b(G),$e=b(Y,!0);_(Y);var ee=x(Y,2),He=b(ee,!0);_(ee),_(G),_(w),re((R,Z,Ke,Je,Qe,Ve,Xe)=>{A=ie(w,1,R,"svelte-1e3uxxx",A,Z),$(U,Ke),ie(Y,1,Je,"svelte-1e3uxxx"),$($e,Qe),ie(ee,1,Ve,"svelte-1e3uxxx"),$(He,Xe)},[()=>(e(d),e(i),f(()=>`card ${Q(l,e(d),e(i))}`)),()=>({selectable:e(p)==e(a).label,selected:Pe(e(a).label,e(d),e(o))}),()=>(e(d),f(()=>Te(l,e(d)))),()=>(e(d),e(i),f(()=>`status ${Q(l,e(d),e(i))}`)),()=>(e(i),e(d),ot(h),f(()=>Re(e(i).getWenbunCustomState(l,e(d))??h.New))),()=>(e(d),e(i),f(()=>`due ${Q(l,e(d),e(i))}`)),()=>(e(i),e(d),f(()=>e(i).getCardDueFormatted(l,e(d))))],nt),C(N,w)}),_(me),C(y,E)};H(Be,y=>{e(S),e(a),f(()=>e(S).get(e(a).label))&&y(Ye)})}_(m),re(()=>$(je,(e(a),f(()=>e(a).label=="__ungrouped__"?"Ungrouped":e(a).label)))),C(s,m)}),_(fe),_(de),ut(_e,()=>e(q),s=>u(q,s)),C(n,ce),it()}et(["click","keydown"]);export{sa as component,aa as universal};
