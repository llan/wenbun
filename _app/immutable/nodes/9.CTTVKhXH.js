var Nt=Object.defineProperty;var Dt=(r,t,i)=>t in r?Nt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[t]=i;var je=(r,t,i)=>Dt(r,typeof t!="symbol"?t+"":t,i);import"../chunks/CWj6FrbW.js";import"../chunks/e1-x02pv.js";import{T as Pt,aU as Mt,X as Ot,aV as Ht,aW as Lt,l as zt,n as S,aX as qt,aY as Bt,aZ as jt,a_ as Xt,q as Zt,w as Pe,a3 as wt,p as pt,g as Ae,ae as Yt,a5 as yt,j as l,f as T,d as _,r as m,s as R,i as e,t as ue,e as $,b as y,c as bt,a as Ue,aF as dt,ab as Kt,a4 as N,a6 as ot,a7 as Jt,aM as Qt,O as ft,aa as Vt,a8 as he,a$ as $t}from"../chunks/B3vXJgDE.js";import{i as D}from"../chunks/BMd2rG11.js";import{k as lt}from"../chunks/u-7-ff8R.js";import{e as kt,i as St,c as ea}from"../chunks/Cf-085yO.js";import{s as ne}from"../chunks/BgSIpHGp.js";import{w as xt}from"../chunks/Ez8RYIMR.js";import{b as ta}from"../chunks/DIAS94Ab.js";import{i as aa}from"../chunks/DRVz_ard.js";import{p as ut}from"../chunks/DfwZoAIM.js";import{b as ra}from"../chunks/eGB6Oygj.js";import{l as b,A as na,W as de}from"../chunks/U2xNi-t8.js";import{s as Z,T as ia}from"../chunks/FqWXS_Ev.js";import{s as sa}from"../chunks/BW2CcSmq.js";import{H as oa}from"../chunks/DcL13wi7.js";import{i as mt,b as la,j as ca,T as gt,p as da,c as ct,C as ua}from"../chunks/vMM3V1dH.js";const va=()=>performance.now(),Se={tick:r=>requestAnimationFrame(r),now:()=>va(),tasks:new Set};function At(){const r=Se.now();Se.tasks.forEach(t=>{t.c(r)||(Se.tasks.delete(t),t.f())}),Se.tasks.size!==0&&Se.tick(At)}function fa(r){let t;return Se.tasks.size===0&&Se.tick(At),{promise:new Promise(i=>{Se.tasks.add(t={c:r,f:i})}),abort(){Se.tasks.delete(t)}}}function Je(r,t){xt(()=>{r.dispatchEvent(new CustomEvent(t))})}function ma(r){if(r==="float")return"cssFloat";if(r==="offset")return"cssOffset";if(r.startsWith("--"))return r;const t=r.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(i=>i[0].toUpperCase()+i.slice(1)).join("")}function _t(r){const t={},i=r.split(";");for(const s of i){const[d,w]=s.split(":");if(!d||w===void 0)break;const L=ma(d.trim());t[L]=w.trim()}return t}const ga=r=>r;function ht(r,t,i,s){var d=(r&Bt)!==0,w=(r&jt)!==0,L=d&&w,z=(r&qt)!==0,G=L?"both":d?"in":"out",u,W=t.inert,ve=t.style.overflow,U,g;function P(){return xt(()=>u??(u=i()(t,(s==null?void 0:s())??{},{direction:G})))}var a={is_global:z,in(){var F;if(t.inert=W,!d){g==null||g.abort(),(F=g==null?void 0:g.reset)==null||F.call(g);return}w||U==null||U.abort(),Je(t,"introstart"),U=vt(t,P(),g,1,()=>{Je(t,"introend"),U==null||U.abort(),U=u=void 0,t.style.overflow=ve})},out(F){if(!w){F==null||F(),u=void 0;return}t.inert=!0,Je(t,"outrostart"),g=vt(t,P(),U,0,()=>{Je(t,"outroend"),F==null||F()})},stop:()=>{U==null||U.abort(),g==null||g.abort()}},p=Pt;if((p.transitions??(p.transitions=[])).push(a),d&&Mt){var x=z;if(!x){for(var M=p.parent;M&&(M.f&Ot)!==0;)for(;(M=M.parent)&&(M.f&Ht)===0;);x=!M||(M.f&Lt)!==0}x&&zt(()=>{S(()=>a.in())})}}function vt(r,t,i,s,d){var w=s===1;if(Xt(t)){var L,z=!1;return Zt(()=>{if(!z){var p=t({direction:w?"in":"out"});L=vt(r,p,i,s,d)}}),{abort:()=>{z=!0,L==null||L.abort()},deactivate:()=>L.deactivate(),reset:()=>L.reset(),t:()=>L.t()}}if(i==null||i.deactivate(),!(t!=null&&t.duration))return d(),{abort:Pe,deactivate:Pe,reset:Pe,t:()=>s};const{delay:G=0,css:u,tick:W,easing:ve=ga}=t;var U=[];if(w&&i===void 0&&(W&&W(0,1),u)){var g=_t(u(0,1));U.push(g,g)}var P=()=>1-s,a=r.animate(U,{duration:G,fill:"forwards"});return a.onfinish=()=>{a.cancel();var p=(i==null?void 0:i.t())??1-s;i==null||i.abort();var x=s-p,M=t.duration*Math.abs(x),F=[];if(M>0){var O=!1;if(u)for(var E=Math.ceil(M/16.666666666666668),fe=0;fe<=E;fe+=1){var Ce=p+x*ve(fe/E),we=_t(u(Ce,1-Ce));F.push(we),O||(O=we.overflow==="hidden")}O&&(r.style.overflow="hidden"),P=()=>{var ae=a.currentTime;return p+x*ve(ae/M)},W&&fa(()=>{if(a.playState!=="running")return!1;var ae=P();return W(ae,1-ae),!0})}a=r.animate(F,{duration:M,fill:"forwards"}),a.onfinish=()=>{P=()=>s,W==null||W(s,1-s),d()}},{abort:()=>{a&&(a.cancel(),a.effect=null,a.onfinish=Pe)},deactivate:()=>{d=Pe},reset:()=>{s===0&&(W==null||W(1,0))},t:()=>P()}}const _a=({url:r})=>({deckId:r.searchParams.get("id")||"",isExtraStudy:r.searchParams.get("isExtraStudy")==="true",cardIds:r.searchParams.get("cardIds")||encodeURIComponent("[]")}),_r=Object.freeze(Object.defineProperty({__proto__:null,load:_a},Symbol.toStringTag,{value:"Module"}));class ha{constructor(t,i=!0){je(this,"audios");je(this,"currentIndex",0);je(this,"isPlaying",!1);je(this,"onEnded",this.handleEnded.bind(this));this.audios=t.map(s=>{const d=new Audio(s);return d.preload="auto",i&&d.load(),d})}handleEnded(){this.audios[this.currentIndex].removeEventListener("ended",this.onEnded),this.currentIndex++,this.currentIndex<this.audios.length?this.playCurrent():(this.isPlaying=!1,this.currentIndex=0)}playCurrent(){const t=this.audios[this.currentIndex];t.addEventListener("ended",this.onEnded),t.currentTime=0,t.play().catch(i=>{console.warn("Playback failed:",i),this.stop()})}play(){this.audios.length!==0&&(this.isPlaying&&this.stop(),this.isPlaying=!0,this.currentIndex=0,this.playCurrent())}stop(){if(!this.isPlaying)return;this.isPlaying=!1;const t=this.audios[this.currentIndex];t.pause(),t.currentTime=0,t.removeEventListener("ended",this.onEnded),this.currentIndex=0}}const Ca={[b.Again]:"Fail",[b.Hard]:"Hard",[b.Good]:"Good",[b.Easy]:"Easy"},wa={[b.Again]:"again",[b.Hard]:"hard",[b.Good]:"good",[b.Easy]:"easy"},pa={[b.Again]:"fa fa-solid fa-face-frown",[b.Hard]:"fa fa-solid fa-face-meh",[b.Good]:"fa fa-solid fa-face-smile",[b.Easy]:"fa fa-solid fa-star"};var Qe;(r=>{function t(s){if(s.isFailAndReveal)return b.Again;const d=s.correctStrokeCount===0?1/0:s.incorrectStrokeCount/s.correctStrokeCount;return d<.25||s.incorrectStrokeCount<=2?b.Good:d<.75||s.incorrectStrokeCount<=4?b.Hard:b.Again}r.getGrade=t;function i(s){switch(s){case b.Again:return"Again";case b.Hard:return"Hard";case b.Good:return"Good";default:return"Unknown"}}r.gradeToLabel=i})(Qe||(Qe={}));var ya=(r,t)=>t(),ba=T('<button class="audio-button svelte-1lcyu7b" aria-label="Play Audio"><i class="fa-solid fa-volume-low svelte-1lcyu7b"></i></button>'),ka=T('<div class="new-element-indicator svelte-1lcyu7b">New Card</div>'),Sa=T("<div>Warm Up</div>"),xa=T('<div class="new-element-indicator is-hidden svelte-1lcyu7b"></div>'),Aa=T('<span class="svelte-1lcyu7b"> </span>'),Ra=T('<span class="empty-character-box svelte-1lcyu7b">&#x3000;</span>'),Ta=T('<!> <div class="character-box-container chinese-font svelte-1lcyu7b"></div>',1),Ua=(r,t)=>t(),Wa=T('<i class="fa-solid fa-play svelte-1lcyu7b"></i>'),Ea=T('<i class="fa-solid fa-forward svelte-1lcyu7b"></i>'),Ga=T('<button class="stroke-speed-button svelte-1lcyu7b"><!> <span class="svelte-1lcyu7b"> </span></button>'),Fa=(r,t)=>t(),Ia=T('<i style="font-size: 2.4em" class="fa fa-solid fa-seedling svelte-1lcyu7b"></i> <span class="svelte-1lcyu7b">New</span>',1),Na=T('<i></i> <span class="svelte-1lcyu7b"> </span>',1),Da=T("<button><!></button>"),Pa=T('<div class="character-writer svelte-1lcyu7b"><div class="meaning svelte-1lcyu7b"> </div> <div><div class="reading svelte-1lcyu7b"> </div> <!></div> <div class="character-container svelte-1lcyu7b"><div class="grid-background svelte-1lcyu7b"><svg xmlns="http://www.w3.org/2000/svg" id="grid-background-target" class="svelte-1lcyu7b"><line x1="0" y1="0" class="svelte-1lcyu7b"></line><line y1="0" x2="0" class="svelte-1lcyu7b"></line><line y1="0" class="svelte-1lcyu7b"></line><line x1="0" class="svelte-1lcyu7b"></line></svg></div> <div class="bottom-container svelte-1lcyu7b"><!></div> <!> <!></div></div>');function Ma(r,t){var Le;pt(t,!0);let i=Ae(500),s=Ae(500),d="#DDD";const w=500,L=new Audio(`${ra}/assets/sounds/correct-choice-43861.mp3`);let z=Ae(Yt([])),G=Ae(!1),u=Ae(!1),W=Ae(!1);function ve(){return parseFloat(getComputedStyle(document.body).fontSize)}function U(){return parseFloat(getComputedStyle(document.body).fontSize)/parseFloat(getComputedStyle(document.documentElement).fontSize)}function g(){const o=ve()*3*2;l(i,Math.min(document.documentElement.clientWidth-o,500)*U()),l(s,e(i),!0)}let P=ut(t,"isRequestManualGrade",15),a=ut(t,"autoReviewData",15),p=Ae(0),x=(Le=t.characterData)==null?void 0:Le.meanings.join("; ");function M(o){for(const c of o)if(c.startsWith(gt))return da(c.substring(gt.length))}function F(){var o;l(u,!0),!e(W)&&(t.cardConfig.isFirstTime?(l(p,(e(p)+1)%t.characterData.characters.length),window.setTimeout(()=>{E(e(p))},w)):(L.play(),l(p,e(p)+1),e(p)==((o=t.characterData)==null?void 0:o.characters.length)?(t.onComplete({...a()}),l(G,!0),window.setTimeout(()=>{Ce()},w)):window.setTimeout(()=>{E(e(p))},w)))}let O;function E(o){if(e(W)||!t.characterData)return;O&&(t.cardConfig.isFirstTime||O.cancelQuiz(),O.hideCharacter(),O.hideOutline());const c=M(t.characterData.tags[o]??[]);O=oa.create("grid-background-target",t.characterData.characters[o],{width:e(i),height:e(s),padding:5,showCharacter:!1,showOutline:t.cardConfig.isShowOutline,highlightOnComplete:!1,strokeColor:t.app.getChineseToneColor(c)??"#555",drawingWidth:la,drawingColor:"#555",strokeAnimationSpeed:e(Y),delayBetweenStrokes:mt(e(Y),1,ie,1e3,10),delayBetweenLoops:mt(e(Y),1,ie,2e3,10),onComplete:()=>{F()}}),t.cardConfig.isFirstTime?(setTimeout(()=>{e(u)||Ce()},w),setTimeout(()=>{O.animateCharacter({onComplete:()=>{setTimeout(()=>{O.hideOutline(),O.hideCharacter(),F()},w)}})},w)):(O.quiz({leniency:t.app.getConfig().strokeLeniency,onMistake:()=>{a(a().incorrectStrokeCount++,!0),a(a().totalStrokeCount++,!0)},onCorrectStroke:()=>{a(a().correctStrokeCount++,!0),a(a().totalStrokeCount++,!0)}}),a().isFailAndReveal&&O.showOutline())}function fe(){var c;const o=(c=t.characterData)==null?void 0:c.audioUrl;o&&l(z,o.map(ee=>{const pe=ee.map(ye=>ca(t.cardConfig.lang,ye));return new ha(pe)}),!0)}function Ce(){const o=Math.floor(Math.random()*e(z).length),c=e(z)[o];c.stop(),c.play()}function we(){if(t.cardConfig.isWarmUp&&(!t.cardConfig.isGradeWarmUpCards||!t.cardConfig.isFinalWarmUp)){window.alert("Can't change grade during warm-up, since grading doesn't affect scheduling in this phase.");return}P(!P())}function ae(o=0){const c=t.cardConfig.warmUpCount??0,ee=t.cardConfig.warmUpMaxCount;return`${Math.round((c+o)/ee*100)}%`}function Me(){O&&(a(a().isFailAndReveal=!0,!0),O.showOutline())}const ie=5;let Y=Ae(1);function me(){const o=e(Y)%ie+1;l(Y,o),t.app.setStrokeSpeed(o)}yt(()=>(a({correctStrokeCount:0,incorrectStrokeCount:0,totalStrokeCount:0,isFailAndReveal:!1}),g(),fe(),window.addEventListener("resize",g),l(Y,t.app.getStrokeSpeed(),!0),E(0),()=>{l(W,!0),window.removeEventListener("resize",g)}));var We=Pa(),h=_(We),xe=_(h,!0);m(h);var Ee=R(h,2);let se;var Oe=_(Ee),Ve=_(Oe,!0);m(Oe);var $e=R(Oe,2);{var et=o=>{var c=ba();c.__click=[ya,Ce],y(o,c)};D($e,o=>{e(z).length>0&&o(et)})}m(Ee);var Xe=R(Ee,2),Ge=_(Xe),Re=_(Ge),Fe=_(Re);Z(Fe,"stroke",d);var Ie=R(Fe);Z(Ie,"stroke",d);var Te=R(Ie);Z(Te,"stroke",d);var Ne=R(Te);Z(Ne,"stroke",d),m(Re),m(Ge);var He=R(Ge,2),tt=_(He);{var at=o=>{var c=Ta(),ee=Ue(c);{var pe=v=>{var f=ka();y(v,f)},ye=(v,f)=>{{var q=B=>{var oe=Sa();let C,k;ue((j,le)=>{C=ne(oe,1,"new-element-indicator svelte-1lcyu7b",null,C,j),k=sa(oe,"",k,le)},[()=>({"is-complete":e(G)}),()=>({"--progress":ae(),"--next-progress":ae(1)})]),y(B,oe)},K=B=>{var oe=xa();y(B,oe)};D(v,B=>{t.cardConfig.isWarmUp?B(q):B(K,!1)},f)}};D(ee,v=>{t.cardConfig.isFirstTime?v(pe):v(ye,!1)})}var n=R(ee,2);kt(n,21,()=>t.characterData.characters,St,(v,f,q)=>{var K=dt(),B=Ue(K);{var oe=k=>{var j=Aa(),le=_(j,!0);m(j),ue(()=>$(le,e(f))),y(k,j)},C=k=>{var j=Ra();y(k,j)};D(B,k=>{q<e(p)||t.cardConfig.isFirstTime?k(oe):k(C,!1)})}y(v,K)}),m(n),y(o,c)};D(tt,o=>{var c;(c=t.characterData)!=null&&c.characters&&o(at)})}m(He);var De=R(He,2);{var rt=o=>{var c=Ga();c.__click=[Ua,me];var ee=_(c);{var pe=f=>{var q=Wa();y(f,q)},ye=f=>{var q=Ea();y(f,q)};D(ee,f=>{e(Y)<=1?f(pe):f(ye,!1)})}var n=R(ee,2),v=_(n);m(n),m(c),ue(()=>$(v,`${e(Y)??""}x`)),y(o,c)};D(De,o=>{t.cardConfig.isFirstTime&&o(rt)})}var nt=R(De,2);{var Ze=o=>{var c=Da();let ee;c.__click=[Fa,we];var pe=_(c);{var ye=v=>{var f=Ia();Kt(2),y(v,f)},n=v=>{var f=Na(),q=Ue(f),K=R(q,2),B=_(K,!0);m(K),ue(()=>{ne(q,1,ea(pa[t.autoGrade]),"svelte-1lcyu7b"),$(B,Ca[t.autoGrade])}),y(v,f)};D(pe,v=>{t.cardConfig.isWarmUp&&!t.cardConfig.isGradeWarmUpCards?v(ye):v(n,!1)})}m(c),ue(v=>ee=ne(c,1,`auto-review-indicator-container ${wa[t.autoGrade]}`,"svelte-1lcyu7b",ee,v),[()=>({blinking:P(),animated:P(),"echo-once":!P()})]),y(o,c)};D(nt,o=>{t.autoGrade&&o(Ze)})}return m(Xe),m(We),ue(o=>{var c;$(xe,x),se=ne(Ee,1,"reading-container svelte-1lcyu7b",null,se,o),$(Ve,(c=t.characterData)==null?void 0:c.reading),Z(Re,"width",e(i)),Z(Re,"height",e(s)),Z(Fe,"x2",e(i)),Z(Fe,"y2",e(s)),Z(Ie,"x1",e(i)),Z(Ie,"y2",e(s)),Z(Te,"x1",e(i)/2),Z(Te,"x2",e(i)/2),Z(Te,"y2",e(s)),Z(Ne,"y1",e(s)/2),Z(Ne,"x2",e(i)),Z(Ne,"y2",e(s)/2)},[()=>({"is-hidden":!t.app.getConfig().zh.alwaysShowReading&&!e(G)&&!t.cardConfig.isFirstTime})]),y(r,We),bt({failAndReveal:Me})}wt(["click"]);const Oa=r=>r;function Ha(r){const t=r-1;return t*t*t+1}function Ct(r){const t=typeof r=="string"&&r.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return t?[parseFloat(t[1]),t[2]||"px"]:[r,"px"]}function La(r,{delay:t=0,duration:i=400,easing:s=Oa}={}){const d=+getComputedStyle(r).opacity;return{delay:t,duration:i,easing:s,css:w=>`opacity: ${w*d}`}}function za(r,{delay:t=0,duration:i=400,easing:s=Ha,x:d=0,y:w=0,opacity:L=0}={}){const z=getComputedStyle(r),G=+z.opacity,u=z.transform==="none"?"":z.transform,W=G*(1-L),[ve,U]=Ct(d),[g,P]=Ct(w);return{delay:t,duration:i,easing:s,css:(a,p)=>`
			transform: ${u} translate(${(1-a)*ve}${U}, ${(1-a)*g}${P});
			opacity: ${G-W*p}`}}function qa(r){const t=r-1;return t*t*t+1}var Ba=T('<button><div class="review-button-inner svelte-9hsnmw"><div class="review-time svelte-9hsnmw"> </div> <div class="review-label svelte-9hsnmw"> </div></div></button>'),ja=T('<button><div class="review-button-inner svelte-9hsnmw"><div class="review-time svelte-9hsnmw"> </div> <div class="review-label svelte-9hsnmw"> </div></div></button>'),Xa=T('<div class="bottom-container svelte-9hsnmw"><div></div></div>'),Za=T(`<div class="svelte-9hsnmw">You have done today's review.</div>`),Ya=T('<div class="counter svelte-9hsnmw"><span class="underlined svelte-9hsnmw"><!></span></div>'),Ka=T('<div class="counter svelte-9hsnmw"><span> </span> <span> </span> <span> </span> <span> </span> <span> </span></div>'),Ja=T('<!> <div class="character-writer-container svelte-9hsnmw"><!></div> <!>',1),Qa=T('<!> <div class="container svelte-9hsnmw"><!> <!></div>',1);function hr(r,t){pt(t,!1);const i=N(),s=N(),d=N(),w=(n,v=Pe,f)=>{let q=he(()=>$t(f==null?void 0:f(),""));var K=Xa(),B=_(K);kt(B,5,v,St,(oe,C)=>{var k=dt(),j=Ue(k);{var le=J=>{var A=Ba();let H;A.__click=function(...X){var re;(re=e(C).alternate.onclick)==null||re.apply(this,X)};var Q=_(A),I=_(Q),be=_(I,!0);m(I);var V=R(I,2),ge=_(V,!0);m(V),m(Q),m(A),ue(X=>{H=ne(A,1,(e(C),S(()=>`review-button ${e(C).alternate.className||e(C).className||""}`)),"svelte-9hsnmw",H,X),$(be,(e(C),S(()=>e(C).alternate.sublabel||e(C).sublabel||" "))),$(ge,(e(C),S(()=>e(C).alternate.label||e(C).label||" ")))},[()=>({"is-complete":!e(C).isComplete})],he),y(J,A)},te=J=>{var A=ja();let H;A.__click=function(...X){var re;(re=e(C).onclick)==null||re.apply(this,X)};var Q=_(A),I=_(Q),be=_(I,!0);m(I);var V=R(I,2),ge=_(V,!0);m(V),m(Q),m(A),ue(X=>{H=ne(A,1,(e(C),S(()=>`review-button ${e(C).className||""}`)),"svelte-9hsnmw",H,X),$(be,(e(C),S(()=>e(C).sublabel||" "))),$(ge,(e(C),S(()=>e(C).label||" ")))},[()=>({"is-complete":e(C).isComplete})],he),y(J,A)};D(j,J=>{e(C),S(()=>e(C).alternate&&!e(C).isComplete&&e(C).alternate.isComplete)?J(le):J(te,!1)})}y(oe,k)}),m(B),m(K),ue(()=>ne(B,1,`review-button-container ${e(q)}`,"svelte-9hsnmw")),ht(1,K,()=>za,()=>L),ht(2,K,()=>La,()=>z),y(n,K)},L={delay:100,y:-100,duration:300,easing:qa},z={duration:200};let G=ut(t,"data",8),u=G().deckId||"",W=G().cardIds||encodeURIComponent("[]"),ve=JSON.parse(decodeURIComponent(W)),U=G().isExtraStudy?"Extra Study":"Review",g=N(),P=N(!1),a=N(new na),p=N();yt(async()=>{var f;await e(a).init();const n=(f=e(a).deckData[u])==null?void 0:f.tags;we=n==null?void 0:n.includes(ct.ZH_YUE);const v=n==null?void 0:n.includes(ct.ZH_EXTRA_DICT);await O.init(we?"yue":"zh",v),l(a,e(a)),Ce=n==null?void 0:n.includes(ct.ZH_TRAD),l(ae,e(a).isAutoGrading()),l(Me,e(a).getConfig().gradeWarmUpCards),l(P,!0),G().isExtraStudy&&e(a).extraStudyHandler.registerReviewCardIdsOverride(ve),se()});let x=N(!1),M=N(!1),F=N(!1),O=new ua,E=N(void 0),fe=N(!1),Ce=!1,we=!1,ae=N(!1),Me=N(!1),ie=N(void 0),Y=N(!1),me=N(0);const We=["Fail","Hard","Good","Easy"];let h=N(void 0),xe=N({1:"",2:"",3:"",4:""});function Ee(){l(x,!1),l(fe,!1),l(ie,void 0),l(Y,!1)}function se(){Ee(),l(F,!0);const n=e(a).getNextCard(u);if(n===void 0){l(M,!0);return}e(a).getCard(u,n,!0)&&(l(F,!1),l(h,n),l(xe,e(a).getRatingScheduledTimeStr(u,n)),l(E,e(a).getWenbunCustomState(u,n)),Qt(me))}async function Oe(){e(a).startWarmUp(u,e(h)),await e(a).save(),l(fe,!0),l(h,e(h)),l(xe,e(a).getRatingScheduledTimeStr(u,e(h))),l(E,e(a).getWenbunCustomState(u,e(h)))}async function Ve(){e(a).skipWarmUp(u,e(h)),l(fe,!0),await e(a).save(),se()}function $e(n){const v=e(a).getCardWord(u,n),f=e(a).getConfig();return O.getCharacterWriterData(v,{convertToTraditional:Ce,mandarinReading:f.zh.mandarinReading,isCantonese:we,isPlayAudio:f.zh.playAudio})}function et(n){const v=e(a).getWarmUpCount(u,n),f=e(s)&&v===0;return{isFirstTime:e(i),isWarmUp:e(s),isFinalWarmUp:De(n),warmUpCount:v,warmUpMaxCount:e(a).getMaxWarmUpCount(),isGradeWarmUpCards:e(a).getConfig().gradeWarmUpCards,isShowOutline:e(i)||f,lang:we?"yue":"zh"}}function Xe(n){l(x,!0),e(ae)&&l(ie,Qe.getGrade(n))}async function Ge(n){e(a).rateCard(u,e(h),n),await e(a).save(),se()}function Re(n){switch(n){case b.Easy:return"review-button-easy";case b.Good:return"review-button-good";case b.Hard:return"review-button-hard";case b.Again:return"review-button-fail"}}async function Fe(){e(a).addIgnoredMark(u,e(h)),await e(a).save(),se()}function Ie(){e(a).extraStudyHandler.rateAgain(e(h)),se()}function Te(){e(a).extraStudyHandler.rateGood(e(h)),se()}async function Ne(){e(a).storeAutoGradeLog(e(g).correctStrokeCount,e(g).incorrectStrokeCount,e(ie)),e(a).rateCard(u,e(h),e(ie)),await e(a).save(),se()}function He(n){l(ie,n),l(Y,!1)}async function tt(){e(a).warmUpNext(u,e(h)),await e(a).save(),se()}async function at(){await Ge(b.Again)}function De(n,v){const f=e(a).getWarmUpCount(u,n);return f===void 0?!0:f>=e(a).getMaxWarmUpCount()}function rt(n,v){return e(a).getWarmUpCount(u,n)===0}function nt(){e(p)&&(e(p).failAndReveal(),l(ie,Qe.getGrade(e(g))))}ot(()=>(e(E),de),()=>{l(i,e(E)===de.New)}),ot(()=>(e(E),de),()=>{l(s,e(E)===de.WarmUp)}),ot(()=>e(g),()=>{var n;l(d,{label:"Reveal",sublabel:"(Fail)",className:"review-button-fail",onclick:()=>nt(),isComplete:!((n=e(g))!=null&&n.isFailAndReveal)})}),Jt(),aa();var Ze=Qa(),Le=Ue(Ze);ia(Le,{get title(){return U}});var o=R(Le,2),c=_(o);{var ee=n=>{var v=Za();y(n,v)};D(c,n=>{e(M)&&n(ee)})}var pe=R(c,2);{var ye=n=>{var v=Ja(),f=Ue(v);lt(f,()=>e(me),k=>{var j=dt(),le=Ue(j);{var te=A=>{var H=Ya(),Q=_(H),I=_(Q);lt(I,()=>e(h),be=>{var V=Vt();ue(ge=>$(V,ge),[()=>(e(a),S(()=>e(a).extraStudyHandler.getCardsCount()||""))],he),y(be,V)}),m(Q),m(H),y(A,H)},J=A=>{var H=Ka(),Q=_(H);let I;var be=_(Q,!0);m(Q);var V=R(Q,2);let ge;var X=_(V,!0);m(V);var re=R(V,2);let Ye;var it=_(re,!0);m(re);var ce=R(re,2);let Ke;var st=_(ce,!0);m(ce);var ze=R(ce,2);let ke;var qe=_(ze,!0);m(ze),m(H),ue((Be,_e,Rt,Tt,Ut,Wt,Et,Gt,Ft,It)=>{I=ne(Q,1,"deck-count-learn-relearn svelte-9hsnmw",null,I,Be),$(be,_e),ge=ne(V,1,"deck-count-review svelte-9hsnmw",null,ge,Rt),$(X,Tt),Ye=ne(re,1,"deck-count-new svelte-9hsnmw",null,Ye,Ut),$(it,Wt),Ke=ne(ce,1,"deck-count-new svelte-9hsnmw",null,Ke,Et),$(st,Gt),ke=ne(ze,1,"deck-count-previously-studied svelte-9hsnmw",null,ke,Ft),$(qe,It)},[()=>({underlined:e(E)===de.Learning||e(E)===de.Relearning}),()=>(e(a),S(()=>e(a).getLearningRelearningCardsCount(u)||"")),()=>({underlined:e(E)===de.ReviewYoung||e(E)===de.ReviewMature}),()=>(e(a),S(()=>e(a).getScheduledReviewCardsCount(u)||"")),()=>({underlined:e(E)===de.New}),()=>(e(a),S(()=>e(a).getScheduledNewCardsCount(u)||"")),()=>({underlined:e(E)===de.WarmUp}),()=>(e(a),S(()=>e(a).getWarmUpCardsCount(u)?`(${e(a).getWarmUpCardsCount(u)})`:"")),()=>({underlined:e(E)===de.PreviouslyStudied}),()=>(e(a),S(()=>e(a).getScheduledPreviouslyStudiedCardsCount(u)||""))],he),y(A,H)};D(le,A=>{ft(G()),S(()=>G().isExtraStudy)?A(te):A(J,!1)})}y(k,j)});var q=R(f,2),K=_(q);lt(K,()=>[e(h),e(fe),e(F)],k=>{const j=he(()=>(e(h),S(()=>$e(e(h))))),le=he(()=>(e(h),S(()=>et(e(h)))));ta(Ma(k,{get app(){return e(a)},get characterData(){return e(j)},onComplete:te=>Xe(te),get cardConfig(){return e(le)},get autoGrade(){return e(ie)},get isRequestManualGrade(){return e(Y)},set isRequestManualGrade(te){l(Y,te)},get autoReviewData(){return e(g)},set autoReviewData(te){l(g,te)},$$legacy:!0}),te=>l(p,te),()=>e(p))}),m(q);var B=R(q,2);{var oe=k=>{w(k,()=>[{label:"Ignore",sublabel:"(Don't Learn)",className:"review-button-fail",isComplete:!0,onclick:()=>Fe()},{label:"Learn*",sublabel:"(Skip Warm-Up)",className:"review-button-hard",isComplete:!0,onclick:()=>Ve()},{label:""},{label:"Learn",className:"review-button-easy main-button",isComplete:!0,onclick:()=>Oe()}])},C=(k,j)=>{{var le=J=>{var A=he(()=>(e(d),e(g),e(h),e(me),e(x),S(()=>{var H;return[{label:"",alternate:{...e(d),isComplete:!((H=e(g))!=null&&H.isFailAndReveal)&&!rt(e(h),e(me))}},{label:""},{label:""},{label:"Next",className:"review-button-easy",isComplete:e(x),onclick:()=>tt()}]})));w(J,()=>e(A))},te=(J,A)=>{{var H=I=>{w(I,()=>[{label:"",alternate:e(d)},{label:""},{label:""},{label:"Next",className:"review-button-easy",isComplete:e(x),onclick:()=>at()}])},Q=(I,be)=>{{var V=X=>{w(X,()=>[{label:"Again",sublabel:"(Put Back)",className:"review-button-fail",isComplete:e(x),onclick:()=>Ie(),alternate:e(d)},{label:""},{label:""},{label:"Good",className:"review-button-easy",isComplete:e(x),onclick:()=>Te()}])},ge=(X,re)=>{{var Ye=ce=>{w(ce,()=>[{label:"",alternate:e(d)},{label:""},{label:""},{label:"Next",className:"review-button-easy",isComplete:e(x),onclick:()=>Ne()}])},it=(ce,Ke)=>{{var st=ke=>{var qe=he(()=>(e(xe),e(x),S(()=>We.map((Be,_e)=>({label:Be,sublabel:e(xe)[_e+1],className:Re(_e+1)+" time",isComplete:e(x),onclick:()=>He(_e+1)})))));w(ke,()=>e(qe),()=>"pulsing")},ze=ke=>{var qe=he(()=>(e(xe),e(x),e(d),S(()=>We.map((Be,_e)=>({label:Be,sublabel:e(xe)[_e+1],className:Re(_e+1)+" time",isComplete:e(x),alternate:_e==0?e(d):void 0,onclick:()=>Ge(_e+1)})))));w(ke,()=>e(qe))};D(ce,ke=>{e(ae)&&e(Y)?ke(st):ke(ze,!1)},Ke)}};D(X,ce=>{e(ae)&&!e(Y)?ce(Ye):ce(it,!1)},re)}};D(I,X=>{ft(G()),S(()=>G().isExtraStudy)?X(V):X(ge,!1)},be)}};D(J,I=>{e(s),e(h),e(me),e(Me),S(()=>e(s)&&De(e(h),e(me))&&!e(Me))?I(H):I(Q,!1)},A)}};D(k,J=>{e(s),e(h),e(me),S(()=>e(s)&&!De(e(h),e(me)))?J(le):J(te,!1)},j)}};D(B,k=>{e(i)?k(oe):k(C,!1)})}y(n,v)};D(pe,n=>{e(P)&&e(h)!==void 0&&!e(M)&&n(ye)})}m(o),y(r,Ze),bt()}wt(["click"]);export{hr as component,_r as universal};
