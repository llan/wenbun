var xe=n=>{throw TypeError(n)};var he=(n,r,t)=>r.has(n)||xe("Cannot "+t);var v=(n,r,t)=>(he(n,r,"read from private field"),t?t.call(n):r.get(n)),I=(n,r,t)=>r.has(n)?xe("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(n):r.set(n,t);var te=(n,r,t)=>(he(n,r,"access private method"),t);import"../chunks/CWj6FrbW.js";import"../chunks/D12B_2YD.js";import{d as et,o as tt,s as H}from"../chunks/DHzHPe8k.js";import{e as ae,u as ke,g as at,h as e,i as u,j as se,p as st,P as T,ag as ge,ah as rt,f as z,a as ye,d as b,b as C,c as it,s as x,r as _,a3 as f,t as re,A as nt,a5 as ot}from"../chunks/DkA9jLS_.js";import{i as K}from"../chunks/0GsRM2Fi.js";import{e as we,i as Se}from"../chunks/Bw1cR02L.js";import{T as lt,r as ct}from"../chunks/CRQyXenr.js";import{s as ie}from"../chunks/QHNB9Zof.js";import{b as ut}from"../chunks/CvMiflhs.js";import{i as dt}from"../chunks/EGtqtshi.js";import{p as vt}from"../chunks/DB5RGsVz.js";import{b as _t}from"../chunks/DfFDKNy7.js";import{A as ft,b as pt,c as bt,d as mt,W as h}from"../chunks/BHbUbeCh.js";import{S as xt}from"../chunks/CEnmia9v.js";const ht=({url:n})=>({deckId:n.searchParams.get("id")||""}),aa=Object.freeze(Object.defineProperty({__proto__:null,load:ht},Symbol.toStringTag,{value:"Module"}));var kt=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],gt=["difference","intersection","symmetricDifference","union"],Ce=!1,O,g,M,Y,A,Me,ze;const J=class J extends Set{constructor(t){super();I(this,A);I(this,O,new Map);I(this,g,ae(0));I(this,M,ae(0));I(this,Y,ke||-1);if(t){for(var c of t)super.add(c);v(this,M).v=super.size}Ce||te(this,A,ze).call(this)}has(t){var c=super.has(t),k=v(this,O),l=k.get(t);if(l===void 0){if(!c)return e(v(this,g)),!1;l=te(this,A,Me).call(this,!0),k.set(t,l)}return e(l),c}add(t){return super.has(t)||(super.add(t),u(v(this,M),super.size),se(v(this,g))),this}delete(t){var c=super.delete(t),k=v(this,O),l=k.get(t);return l!==void 0&&(k.delete(t),u(l,!1)),c&&(u(v(this,M),super.size),se(v(this,g))),c}clear(){if(super.size!==0){super.clear();var t=v(this,O);for(var c of t.values())u(c,!1);t.clear(),u(v(this,M),0),se(v(this,g))}}keys(){return this.values()}values(){return e(v(this,g)),super.values()}entries(){return e(v(this,g)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return e(v(this,M))}};O=new WeakMap,g=new WeakMap,M=new WeakMap,Y=new WeakMap,A=new WeakSet,Me=function(t){return ke===v(this,Y)?ae(t):at(t)},ze=function(){Ce=!0;var t=J.prototype,c=Set.prototype;for(const k of kt)t[k]=function(...l){return e(v(this,g)),c[k].apply(this,l)};for(const k of gt)t[k]=function(...l){e(v(this,g));var R=c[k].apply(this,l);return new J(R)}};let ne=J;var yt=(n,r)=>r(),wt=(n,r,t)=>r(e(t).label),St=z('<i class="fa-solid fa-chevron-down"></i>'),Ct=z('<i class="fa-solid fa-chevron-right"></i>'),Mt=(n,r)=>r(),zt=(n,r)=>r(),Dt=(n,r)=>r(),Tt=(n,r)=>r(),Pt=(n,r)=>r(),Et=(n,r)=>r(),It=z('<div style="display: flex; flex-direction: row; justify-content: space-between; width: 100%; gap: 0.5em;"><div class="group-buttons-container svelte-1e3uxxx" style="align-items: flex-start;"><button class="button svelte-1e3uxxx"><i class="fa-solid fa-xmark"></i>cancel selection</button> <button class="button svelte-1e3uxxx"><i class="fa-solid fa-check-double"></i>select all</button></div> <div class="group-buttons-container svelte-1e3uxxx" style="align-items: flex-end;"><button class="button svelte-1e3uxxx"><i class="fa-solid fa-book-open"></i><span>mark as <b>previously studied</b></span></button> <button class="button svelte-1e3uxxx"><i class="fa-solid fa-book-open"></i><span>remove <b>previously studied</b> mark</span></button> <button class="button svelte-1e3uxxx"><i class="fa-solid fa-square-xmark"></i><span>mark as <b>ignored</b></span></button> <button class="button svelte-1e3uxxx"><i class="fa-solid fa-square-xmark"></i><span>remove <b>ignored</b> mark</span></button></div></div>'),Ot=(n,r,t,c)=>r(e(t).label,e(c)),At=(n,r,t,c)=>{n.key=="Enter"&&r(e(t).label,e(c))},Nt=(n,r,t,c)=>r(e(t).label,e(c),n),Wt=z('<button class="button select-button svelte-1e3uxxx">select</button>'),Ut=z('<div role="button" tabindex="0"><!> <div class="card-word svelte-1e3uxxx"><span class="word"> </span></div> <div class="card-details svelte-1e3uxxx"><div> </div> <div> </div></div></div>'),jt=z('<!> <div class="group-content svelte-1e3uxxx"></div>',1),Gt=z('<div class="group svelte-1e3uxxx"><button class="group-header svelte-1e3uxxx"><div> </div> <div><!></div></button> <!></div>'),Rt=z('<!> <div class="container svelte-1e3uxxx"><div class="top-container" style="display: flex; gap: 0.5em; margin-bottom: 2em"><button class="button svelte-1e3uxxx">Split into groups of</button> <input class="input" type="number" min="1" max="100"/></div> <div class="group-container svelte-1e3uxxx"></div></div>',1);function sa(n,r){st(r,!1);const t=T(),c=T();let l=vt(r,"data",8)().deckId||"",R=!1,oe,i=T(new ft);tt(async()=>{var s,a;await e(i).init(),R=(a=(s=e(i).deckData[l])==null?void 0:s.tags)==null?void 0:a.includes(bt.ZH_TRAD),oe=new mt("cn","tw"),u(i,e(i))});let S=T(new xt);function De(s){e(S).set(s,!e(S).get(s)),u(S,e(S))}function Q(s,a,m){switch(m.getWenbunCustomState(s,a)??h.New){case h.New:return"card-status-new";case h.WarmUp:return"card-status-new";case h.Learning:return"card-status-learning";case h.ReviewYoung:return"card-status-review-young";case h.ReviewMature:return"card-status-review-mature";case h.Relearning:return"card-status-relearning";case h.PreviouslyStudied:return"card-status-previously-studied";case h.Ignored:return"card-status-ignored"}}function Te(s,a){const m=e(i).getCardWord(s,a);return R?oe.convert(m):m}let q=T(pt);async function Pe(){const s=Math.ceil(e(t).deck.length/e(q));window.confirm(`Split the deck into ${s} groups?`)&&(e(i).splitDeckIntoGroupOfN(l,e(q)),await e(i).save(),u(i,e(i)))}let p=T(null),o=T(new ne);function Ee(s,a,m){m==null||m.stopPropagation(),u(p,s),e(o).clear(),a!=null&&e(o).add(a),u(o,e(o))}function Ie(){u(p,null),e(o).clear(),u(o,e(o))}function Oe(s,a,m){return e(p)==s&&m.has(a)}function le(s,a){e(p)==s&&(e(o).has(a)?e(o).delete(a):e(o).add(a),u(o,e(o)))}function Ae(){if(e(p)==null)return;const s=e(t).groups.find(a=>a.label==e(p));if(s!=null){e(o).clear();for(const a of s.cardIds)e(o).add(a);u(o,e(o))}}async function Ne(){e(p)!=null&&(e(o).forEach(s=>{e(i).addPreviouslyStudiedMark(l,s)}),await e(i).save(),u(i,e(i)))}async function We(){e(p)!=null&&(e(o).forEach(s=>{e(i).removePreviouslyStudiedMark(l,s)}),await e(i).save(),u(i,e(i)))}async function Ue(){e(p)!=null&&(e(o).forEach(s=>{e(i).addIgnoredMark(l,s)}),await e(i).save(),u(i,e(i)))}async function je(){e(p)!=null&&(e(o).forEach(s=>{e(i).removeIgnoredMark(l,s)}),await e(i).save(),u(i,e(i)))}function Ge(s){return s===h.WarmUp?h.New:s}ge(()=>e(i),()=>{u(t,e(i).deckData[l])}),ge(()=>e(t),()=>{var s;u(c,((s=e(t))==null?void 0:s.groups)??[])}),rt(),dt();var ce=Rt(),ue=ye(ce);lt(ue,{title:"Deck",get backUrl(){return`${_t??""}/`}});var de=x(ue,2),V=b(de),ve=b(V);ve.__click=[yt,Pe];var _e=x(ve,2);ct(_e),_(V);var fe=x(V,2);we(fe,5,()=>e(c),Se,(s,a)=>{var m=Gt(),F=b(m);F.__click=[wt,De,a];var X=b(F),Re=b(X,!0);_(X);var pe=x(X,2),qe=b(pe);{var Fe=y=>{var P=St();C(y,P)},Le=y=>{var P=Ct();C(y,P)};K(qe,y=>{e(S),e(a),f(()=>e(S).get(e(a).label))?y(Fe):y(Le,!1)})}_(pe),_(F);var Be=x(F,2);{var Ze=y=>{var P=jt(),be=ye(P);{var $e=N=>{var d=It(),w=b(d),W=b(w);W.__click=[Mt,Ie];var L=x(W,2);L.__click=[zt,Ae],_(w);var B=x(w,2),D=b(B);D.__click=[Dt,Ne];var E=x(D,2);E.__click=[Tt,We];var U=x(E,2);U.__click=[Pt,Ue];var j=x(U,2);j.__click=[Et,je],_(B),_(d),re(()=>{D.disabled=(e(o),f(()=>e(o).size==0)),E.disabled=(e(o),f(()=>e(o).size==0)),U.disabled=(e(o),f(()=>e(o).size==0)),j.disabled=(e(o),f(()=>e(o).size==0))}),C(N,d)};K(be,N=>{e(p),e(a),f(()=>e(p)==e(a).label)&&N($e)})}var me=x(be,2);we(me,5,()=>(e(a),f(()=>e(a).cardIds)),Se,(N,d)=>{var w=Ut();let W;w.__click=[Ot,le,a,d],w.__keydown=[At,le,a,d];var L=b(w);{var B=G=>{var $=Wt();$.__click=[Nt,Ee,a,d],C(G,$)};K(L,G=>{e(p),e(a),f(()=>e(p)!=e(a).label)&&G(B)})}var D=x(L,2),E=b(D),U=b(E,!0);_(E),_(D);var j=x(D,2),Z=b(j),He=b(Z,!0);_(Z);var ee=x(Z,2),Ke=b(ee,!0);_(ee),_(j),_(w),re((G,$,Ye,Je,Qe,Ve,Xe)=>{W=ie(w,1,G,"svelte-1e3uxxx",W,$),H(U,Ye),ie(Z,1,Je,"svelte-1e3uxxx"),H(He,Qe),ie(ee,1,Ve,"svelte-1e3uxxx"),H(Ke,Xe)},[()=>(e(d),e(i),f(()=>`card ${Q(l,e(d),e(i))}`)),()=>({selectable:e(p)==e(a).label,selected:Oe(e(a).label,e(d),e(o))}),()=>(e(d),f(()=>Te(l,e(d)))),()=>(e(d),e(i),f(()=>`status ${Q(l,e(d),e(i))}`)),()=>(e(i),e(d),ot(h),f(()=>Ge(e(i).getWenbunCustomState(l,e(d))??h.New))),()=>(e(d),e(i),f(()=>`due ${Q(l,e(d),e(i))}`)),()=>(e(i),e(d),f(()=>e(i).getCardDueFormatted(l,e(d))))],nt),C(N,w)}),_(me),C(y,P)};K(Be,y=>{e(S),e(a),f(()=>e(S).get(e(a).label))&&y(Ze)})}_(m),re(()=>H(Re,(e(a),f(()=>e(a).label=="__ungrouped__"?"Ungrouped":e(a).label)))),C(s,m)}),_(fe),_(de),ut(_e,()=>e(q),s=>u(q,s)),C(n,ce),it()}et(["click","keydown"]);export{sa as component,aa as universal};
