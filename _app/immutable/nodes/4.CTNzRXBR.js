var he=n=>{throw TypeError(n)};var ke=(n,i,t)=>i.has(n)||he("Cannot "+t);var v=(n,i,t)=>(ke(n,i,"read from private field"),t?t.call(n):i.get(n)),I=(n,i,t)=>i.has(n)?he("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(n):i.set(n,t);var te=(n,i,t)=>(ke(n,i,"access private method"),t);import"../chunks/CWj6FrbW.js";import"../chunks/C7vLGdXP.js";import{d as tt,o as at,s as H}from"../chunks/CLpbRZ0x.js";import{e as ae,u as ge,g as st,h as e,i as u,j as se,p as rt,S as T,ai as ye,aj as it,f as z,a as we,d as b,b as C,c as nt,s as x,r as _,a7 as f,t as re,G as ot,a9 as lt}from"../chunks/DjN3b0Ki.js";import{i as K}from"../chunks/Bu_gglvj.js";import{e as Se,i as Ce}from"../chunks/D2VCDp_j.js";import{T as ct,r as ut}from"../chunks/DhJIDP9Q.js";import{s as ie}from"../chunks/C0SqAXoy.js";import{b as dt}from"../chunks/D_4RZU8o.js";import{i as vt}from"../chunks/CYG9lWKH.js";import{p as _t}from"../chunks/BReWSNzY.js";import{b as ft}from"../chunks/DfA_aqBK.js";import{A as pt,b as bt,c as mt,d as xt,W as h}from"../chunks/DRpHFl-G.js";import{S as ht}from"../chunks/B83PMSVd.js";const kt=({url:n})=>({deckId:n.searchParams.get("id")||""}),sa=Object.freeze(Object.defineProperty({__proto__:null,load:kt},Symbol.toStringTag,{value:"Module"}));var gt=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],yt=["difference","intersection","symmetricDifference","union"],Me=!1,O,g,M,Y,N,ze,De;const J=class J extends Set{constructor(t){super();I(this,N);I(this,O,new Map);I(this,g,ae(0));I(this,M,ae(0));I(this,Y,ge||-1);if(t){for(var c of t)super.add(c);v(this,M).v=super.size}Me||te(this,N,De).call(this)}has(t){var c=super.has(t),k=v(this,O),l=k.get(t);if(l===void 0){if(!c)return e(v(this,g)),!1;l=te(this,N,ze).call(this,!0),k.set(t,l)}return e(l),c}add(t){return super.has(t)||(super.add(t),u(v(this,M),super.size),se(v(this,g))),this}delete(t){var c=super.delete(t),k=v(this,O),l=k.get(t);return l!==void 0&&(k.delete(t),u(l,!1)),c&&(u(v(this,M),super.size),se(v(this,g))),c}clear(){if(super.size!==0){super.clear();var t=v(this,O);for(var c of t.values())u(c,!1);t.clear(),u(v(this,M),0),se(v(this,g))}}keys(){return this.values()}values(){return e(v(this,g)),super.values()}entries(){return e(v(this,g)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return e(v(this,M))}};O=new WeakMap,g=new WeakMap,M=new WeakMap,Y=new WeakMap,N=new WeakSet,ze=function(t){return ge===v(this,Y)?ae(t):st(t)},De=function(){Me=!0;var t=J.prototype,c=Set.prototype;for(const k of gt)t[k]=function(...l){return e(v(this,g)),c[k].apply(this,l)};for(const k of yt)t[k]=function(...l){e(v(this,g));var R=c[k].apply(this,l);return new J(R)}};let ne=J;var wt=(n,i)=>i(),St=(n,i,t)=>i(e(t).label),Ct=z('<i class="fa-solid fa-chevron-down"></i>'),Mt=z('<i class="fa-solid fa-chevron-right"></i>'),zt=(n,i)=>i(),Dt=(n,i)=>i(),Tt=(n,i)=>i(),Pt=(n,i)=>i(),Et=(n,i)=>i(),It=(n,i)=>i(),Ot=z('<div style="display: flex; flex-direction: row; justify-content: space-between; width: 100%; gap: 0.5em;"><div class="group-buttons-container svelte-1e3uxxx" style="align-items: flex-start;"><button class="button svelte-1e3uxxx"><i class="fa-solid fa-xmark"></i>cancel selection</button> <button class="button svelte-1e3uxxx"><i class="fa-solid fa-check-double"></i>select all</button></div> <div class="group-buttons-container svelte-1e3uxxx" style="align-items: flex-end;"><button class="button svelte-1e3uxxx"><i class="fa-solid fa-book-open"></i><span>mark as <b>previously studied</b></span></button> <button class="button svelte-1e3uxxx"><i class="fa-solid fa-book-open"></i><span>remove <b>previously studied</b> mark</span></button> <button class="button svelte-1e3uxxx"><i class="fa-solid fa-square-xmark"></i><span>mark as <b>ignored</b></span></button> <button class="button svelte-1e3uxxx"><i class="fa-solid fa-square-xmark"></i><span>remove <b>ignored</b> mark</span></button></div></div>'),Nt=(n,i,t,c)=>i(e(t).label,e(c)),Wt=(n,i,t,c)=>{n.key=="Enter"&&i(e(t).label,e(c))},At=(n,i,t,c)=>i(e(t).label,e(c),n),Ut=z('<button class="button select-button svelte-1e3uxxx">select</button>'),jt=z('<div role="button" tabindex="0"><!> <div class="card-word svelte-1e3uxxx"><span class="word"> </span></div> <div class="card-details svelte-1e3uxxx"><div> </div> <div> </div></div></div>'),Gt=z('<!> <div class="group-content svelte-1e3uxxx"></div>',1),Rt=z('<div class="group svelte-1e3uxxx"><button class="group-header svelte-1e3uxxx"><div> </div> <div><!></div></button> <!></div>'),qt=z('<!> <div class="container svelte-1e3uxxx"><div class="top-container" style="display: flex; gap: 0.5em; margin-bottom: 2em"><button class="button svelte-1e3uxxx">Split into groups of</button> <input class="input" type="number" min="1" max="100"/></div> <div class="group-container svelte-1e3uxxx"></div></div>',1);function ra(n,i){rt(i,!1);const t=T(),c=T();let l=_t(i,"data",8)().deckId||"",R=!1,oe,r=T(new pt);at(async()=>{await e(r).init(),le(),await e(r).initProfile()&&le()});function le(){var s,a;R=(a=(s=e(r).deckData[l])==null?void 0:s.tags)==null?void 0:a.includes(mt.ZH_TRAD),oe=new xt("cn","tw"),u(r,e(r))}let S=T(new ht);function Te(s){e(S).set(s,!e(S).get(s)),u(S,e(S))}function Q(s,a,m){switch(m.getWenbunCustomState(s,a)??h.New){case h.New:return"card-status-new";case h.WarmUp:return"card-status-new";case h.Learning:return"card-status-learning";case h.ReviewYoung:return"card-status-review-young";case h.ReviewMature:return"card-status-review-mature";case h.Relearning:return"card-status-relearning";case h.PreviouslyStudied:return"card-status-previously-studied";case h.Ignored:return"card-status-ignored"}}function Pe(s,a){const m=e(r).getCardWord(s,a);return R?oe.convert(m):m}let q=T(bt);async function Ee(){const s=Math.ceil(e(t).deck.length/e(q));window.confirm(`Split the deck into ${s} groups?`)&&(e(r).splitDeckIntoGroupOfN(l,e(q)),await e(r).save(),u(r,e(r)))}let p=T(null),o=T(new ne);function Ie(s,a,m){m==null||m.stopPropagation(),u(p,s),e(o).clear(),a!=null&&e(o).add(a),u(o,e(o))}function Oe(){u(p,null),e(o).clear(),u(o,e(o))}function Ne(s,a,m){return e(p)==s&&m.has(a)}function ce(s,a){e(p)==s&&(e(o).has(a)?e(o).delete(a):e(o).add(a),u(o,e(o)))}function We(){if(e(p)==null)return;const s=e(t).groups.find(a=>a.label==e(p));if(s!=null){e(o).clear();for(const a of s.cardIds)e(o).add(a);u(o,e(o))}}async function Ae(){e(p)!=null&&(e(o).forEach(s=>{e(r).addPreviouslyStudiedMark(l,s)}),await e(r).save(),u(r,e(r)))}async function Ue(){e(p)!=null&&(e(o).forEach(s=>{e(r).removePreviouslyStudiedMark(l,s)}),await e(r).save(),u(r,e(r)))}async function je(){e(p)!=null&&(e(o).forEach(s=>{e(r).addIgnoredMark(l,s)}),await e(r).save(),u(r,e(r)))}async function Ge(){e(p)!=null&&(e(o).forEach(s=>{e(r).removeIgnoredMark(l,s)}),await e(r).save(),u(r,e(r)))}function Re(s){return s===h.WarmUp?h.New:s}ye(()=>e(r),()=>{u(t,e(r).deckData[l])}),ye(()=>e(t),()=>{var s;u(c,((s=e(t))==null?void 0:s.groups)??[])}),it(),vt();var ue=qt(),de=we(ue);ct(de,{title:"Deck",get backUrl(){return`${ft??""}/`}});var ve=x(de,2),V=b(ve),_e=b(V);_e.__click=[wt,Ee];var fe=x(_e,2);ut(fe),_(V);var pe=x(V,2);Se(pe,5,()=>e(c),Ce,(s,a)=>{var m=Rt(),F=b(m);F.__click=[St,Te,a];var X=b(F),qe=b(X,!0);_(X);var be=x(X,2),Fe=b(be);{var Le=y=>{var P=Ct();C(y,P)},Be=y=>{var P=Mt();C(y,P)};K(Fe,y=>{e(S),e(a),f(()=>e(S).get(e(a).label))?y(Le):y(Be,!1)})}_(be),_(F);var Ze=x(F,2);{var $e=y=>{var P=Gt(),me=we(P);{var He=W=>{var d=Ot(),w=b(d),A=b(w);A.__click=[zt,Oe];var L=x(A,2);L.__click=[Dt,We],_(w);var B=x(w,2),D=b(B);D.__click=[Tt,Ae];var E=x(D,2);E.__click=[Pt,Ue];var U=x(E,2);U.__click=[Et,je];var j=x(U,2);j.__click=[It,Ge],_(B),_(d),re(()=>{D.disabled=(e(o),f(()=>e(o).size==0)),E.disabled=(e(o),f(()=>e(o).size==0)),U.disabled=(e(o),f(()=>e(o).size==0)),j.disabled=(e(o),f(()=>e(o).size==0))}),C(W,d)};K(me,W=>{e(p),e(a),f(()=>e(p)==e(a).label)&&W(He)})}var xe=x(me,2);Se(xe,5,()=>(e(a),f(()=>e(a).cardIds)),Ce,(W,d)=>{var w=jt();let A;w.__click=[Nt,ce,a,d],w.__keydown=[Wt,ce,a,d];var L=b(w);{var B=G=>{var $=Ut();$.__click=[At,Ie,a,d],C(G,$)};K(L,G=>{e(p),e(a),f(()=>e(p)!=e(a).label)&&G(B)})}var D=x(L,2),E=b(D),U=b(E,!0);_(E),_(D);var j=x(D,2),Z=b(j),Ke=b(Z,!0);_(Z);var ee=x(Z,2),Ye=b(ee,!0);_(ee),_(j),_(w),re((G,$,Je,Qe,Ve,Xe,et)=>{A=ie(w,1,G,"svelte-1e3uxxx",A,$),H(U,Je),ie(Z,1,Qe,"svelte-1e3uxxx"),H(Ke,Ve),ie(ee,1,Xe,"svelte-1e3uxxx"),H(Ye,et)},[()=>(e(d),e(r),f(()=>`card ${Q(l,e(d),e(r))}`)),()=>({selectable:e(p)==e(a).label,selected:Ne(e(a).label,e(d),e(o))}),()=>(e(d),f(()=>Pe(l,e(d)))),()=>(e(d),e(r),f(()=>`status ${Q(l,e(d),e(r))}`)),()=>(e(r),e(d),lt(h),f(()=>Re(e(r).getWenbunCustomState(l,e(d))??h.New))),()=>(e(d),e(r),f(()=>`due ${Q(l,e(d),e(r))}`)),()=>(e(r),e(d),f(()=>e(r).getCardDueFormatted(l,e(d))))],ot),C(W,w)}),_(xe),C(y,P)};K(Ze,y=>{e(S),e(a),f(()=>e(S).get(e(a).label))&&y($e)})}_(m),re(()=>H(qe,(e(a),f(()=>e(a).label=="__ungrouped__"?"Ungrouped":e(a).label)))),C(s,m)}),_(pe),_(ve),dt(fe,()=>e(q),s=>u(q,s)),C(n,ue),nt()}tt(["click","keydown"]);export{ra as component,sa as universal};
