var qe=n=>{throw TypeError(n)};var Le=(n,o,s)=>o.has(n)||qe("Cannot "+s);var m=(n,o,s)=>(Le(n,o,"read from private field"),s?s.call(n):o.get(n)),X=(n,o,s)=>o.has(n)?qe("Cannot add the same private member more than once"):o instanceof WeakSet?o.add(n):o.set(n,s);var ye=(n,o,s)=>(Le(n,o,"access private method"),s);import"../chunks/CWj6FrbW.js";import"../chunks/DUOQ2h4l.js";import{g as we,u as Be,h as ut,i as e,j as v,k as Se,ak as _t,p as ft,a9 as D,al as mt,am as _e,an as pt,f as I,a as xe,t as Y,s as _,d as c,b as M,c as gt,ap as bt,r as l,n as d,P as H,e as Q,aJ as kt,w as fe,X as He}from"../chunks/C5etlkrB.js";import{i as $}from"../chunks/Cc2rhPc8.js";import{e as Ze,i as Je}from"../chunks/Dnr6C7Qa.js";import{T as ht,r as yt}from"../chunks/BvNWHEz1.js";import{s as ne}from"../chunks/DzZJzTEu.js";import{b as wt}from"../chunks/10tJ-hDV.js";import{b as St}from"../chunks/W8I556om.js";import{i as xt}from"../chunks/BkP1o4TQ.js";import{p as Ct}from"../chunks/DgBratTy.js";import{g as Dt,b as Mt}from"../chunks/_1toS6uJ.js";import{D as w,A as Nt,a as zt,W as p}from"../chunks/AIxcQUCD.js";import{c as At,d as Pt}from"../chunks/Cy3mxnRm.js";import{S as Et}from"../chunks/lfAKR2uN.js";const It=({url:n})=>({deckId:n.searchParams.get("id")||""}),xa=Object.freeze(Object.defineProperty({__proto__:null,load:It},Symbol.toStringTag,{value:"Module"}));var Tt=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],Wt=["difference","intersection","symmetricDifference","union"],Ke=!1,ee,x,U,me,te,Xe,Ye;const pe=class pe extends Set{constructor(s){super();X(this,te);X(this,ee,new Map);X(this,x,we(0));X(this,U,we(0));X(this,me,Be||-1);if(s){for(var g of s)super.add(g);m(this,U).v=super.size}Ke||ye(this,te,Ye).call(this)}has(s){var g=super.has(s),b=m(this,ee),k=b.get(s);if(k===void 0){if(!g)return e(m(this,x)),!1;k=ye(this,te,Xe).call(this,!0),b.set(s,k)}return e(k),g}add(s){return super.has(s)||(super.add(s),v(m(this,U),super.size),Se(m(this,x))),this}delete(s){var g=super.delete(s),b=m(this,ee),k=b.get(s);return k!==void 0&&(b.delete(s),v(k,!1)),g&&(v(m(this,U),super.size),Se(m(this,x))),g}clear(){if(super.size!==0){super.clear();var s=m(this,ee);for(var g of s.values())v(g,!1);s.clear(),v(m(this,U),0),Se(m(this,x))}}keys(){return this.values()}values(){return e(m(this,x)),super.values()}entries(){return e(m(this,x)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return e(m(this,U))}};ee=new WeakMap,x=new WeakMap,U=new WeakMap,me=new WeakMap,te=new WeakSet,Xe=function(s){return Be===m(this,me)?we(s):ut(s)},Ye=function(){Ke=!0;var s=pe.prototype,g=Set.prototype;for(const b of Tt)s[b]=function(...k){return e(m(this,x)),g[b].apply(this,k)};for(const b of Wt)s[b]=function(...k){e(m(this,x));var le=g[b].apply(this,k);return new pe(le)}};let Ce=pe;var Ot=(n,o,s)=>o(s()),jt=(n,o,s)=>{n.key=="Enter"&&o(s())},Ut=(n,o,s)=>o(s(),n),Gt=I('<button class="button select-button svelte-8msg06">select</button>'),Rt=I('<div role="button" tabindex="0"><!> <div class="card-word svelte-8msg06"><span class="word chinese-font"> </span></div> <div class="card-details svelte-8msg06"><div> </div> <div> </div></div></div>'),Vt=(n,o,s)=>o(s()),Ft=(n,o,s)=>{n.key=="Enter"&&o(s())},qt=I('<div role="button" tabindex="0"><div class="card-word svelte-8msg06"><span class="word chinese-font"> </span></div> <div class="card-details svelte-8msg06"><div> </div></div></div>'),Lt=(n,o,s)=>o(e(s)),Bt=(n,o)=>o(),Ht=(n,o)=>o(),Zt=(n,o,s)=>o(e(s).label),Jt=I('<i class="fa-solid fa-chevron-down"></i>'),Kt=I('<i class="fa-solid fa-chevron-right"></i>'),Xt=(n,o)=>o(),Yt=(n,o,s)=>o(e(s).label),Qt=(n,o)=>o(),$t=(n,o)=>o(),ea=(n,o)=>o(),ta=(n,o)=>o(),aa=(n,o)=>o(),sa=I('<div style="display: flex; flex-direction: row; justify-content: space-between; width: 100%; gap: 0.5em;"><div class="group-buttons-container svelte-8msg06" style="align-items: flex-start;"><button class="button svelte-8msg06"><i class="fa-solid fa-xmark"></i>cancel selection</button> <button class="button svelte-8msg06"><i class="fa-solid fa-check-double"></i>select all in this group</button></div> <div class="group-buttons-container svelte-8msg06" style="align-items: flex-end;"><button class="button svelte-8msg06"><i class="fa-solid fa-chalkboard-user"></i><span>start <b>extra study</b> from selection</span></button> <button class="button svelte-8msg06"><i class="fa-solid fa-book-open"></i><span>mark as <b>previously studied</b></span></button> <button class="button svelte-8msg06"><i class="fa-solid fa-book-open"></i><span>remove <b>previously studied</b> mark</span></button> <button class="button svelte-8msg06"><i class="fa-solid fa-square-xmark"></i><span>mark as <b>ignored</b></span></button> <button class="button svelte-8msg06"><i class="fa-solid fa-square-xmark"></i><span>remove <b>ignored</b> mark</span></button></div></div>'),ra=I('<!> <div class="group-content svelte-8msg06"></div>',1),oa=I('<div class="group svelte-8msg06"><button class="group-header svelte-8msg06"><div> </div> <div><!></div></button> <!></div>'),ia=I('<!> <div class="container svelte-8msg06"><div class="top-container" style="display: flex; gap: 0.5em; margin-bottom: 2em"><div class="top-control-container svelte-8msg06"><div><label style="display: flex; gap: 0.5em; align-items: center; justify-content: space-between;">View: <select style="flex-grow: 1;"><option>Normal</option><option>Small</option></select></label></div> <div style="display: flex; gap: 0.5em; align-items: center;"><button class="button svelte-8msg06">Split into groups of</button> <input class="input" type="number" min="1" max="100"/></div> <button class="button delete-button svelte-8msg06"><i class="fa-solid fa-trash"></i> Delete this Deck</button></div></div> <div class="group-container svelte-8msg06"></div></div>',1);function Ca(n,o){ft(o,!1);const s=D(),g=D(),b=D(),k=D(),le=(a,t=fe,h=fe)=>{var f=Rt();let z;f.__click=[Ot,de,t],f.__keydown=[jt,de,t];var W=c(f);{var R=A=>{var L=Gt();L.__click=[Ut,Ae,t],M(A,L)};$(W,A=>{e(G)||A(R)})}var V=_(W,2),F=c(V),q=c(F,!0);l(F),l(V);var Z=_(V,2),O=c(Z),y=c(O,!0);l(O);var S=_(O,2),J=c(S,!0);l(S),l(Z),l(f),Y((A,L,B,P,j,K,se)=>{z=ne(f,1,A,"svelte-8msg06",z,L),Q(q,B),ne(O,1,P,"svelte-8msg06"),Q(y,j),ne(S,1,K,"svelte-8msg06"),Q(J,se)},[()=>(t(),e(r),d(()=>`card ${ae(u,t(),e(r))}`)),()=>({selectable:e(G),selected:Pe(t(),e(i))}),()=>(t(),d(()=>ze(u,t()))),()=>(t(),e(r),d(()=>`status ${ae(u,t(),e(r))}`)),()=>(e(r),t(),H(p),d(()=>lt(e(r).getWenbunCustomState(u,t())??p.New))),()=>(t(),e(r),d(()=>`due ${ae(u,t(),e(r))}`)),()=>(e(r),t(),d(()=>e(r).getCardDueFormatted(u,t())))],He),M(a,f)},Qe=(a,t=fe,h=fe)=>{var f=qt();let z;f.__click=[Vt,de,t],f.__keydown=[Ft,de,t];var W=c(f),R=c(W),V=c(R,!0);l(R),l(W);var F=_(W,2),q=c(F),Z=c(q,!0);l(q),l(F),l(f),Y((O,y,S,J,A)=>{z=ne(f,1,O,"svelte-8msg06",z,y),Q(V,S),ne(q,1,J,"svelte-8msg06"),Q(Z,A)},[()=>(t(),e(r),d(()=>`card-small ${ae(u,t(),e(r))}`)),()=>({selected:Pe(t(),e(i))}),()=>(t(),d(()=>ze(u,t()))),()=>(t(),e(r),d(()=>`due ${ae(u,t(),e(r))}`)),()=>(e(r),t(),d(()=>e(r).getShortCardDueFormatted(u,t())))],He),M(a,f)};let u=Ct(o,"data",8)().deckId||"",De=!1,Me,N=D(w.Normal),r=D(new Nt);mt(async()=>{await e(r).init(),Ne(),await e(r).initProfile()&&Ne()});function Ne(){var a,t;De=(t=(a=e(r).deckData[u])==null?void 0:a.tags)==null?void 0:t.includes(At.ZH_TRAD),Me=new Pt("cn","tw"),v(N,e(r).getDeckView()),v(r,e(r))}let T=D(new Et);function $e(a){e(T).set(a,!e(T).get(a)),v(T,e(T))}function ae(a,t,h){switch(h.getWenbunCustomState(a,t)??p.New){case p.New:return"card-status-new";case p.WarmUp:return"card-status-new";case p.Learning:return"card-status-learning";case p.ReviewYoung:return"card-status-review-young";case p.ReviewMature:return"card-status-review-mature";case p.Relearning:return"card-status-relearning";case p.PreviouslyStudied:return"card-status-previously-studied";case p.Ignored:return"card-status-ignored"}}function ze(a,t){const h=e(r).getCardWord(a,t);return De?Me.convert(h):h}let ce=D(zt);async function et(){const a=Math.ceil(e(s).deck.length/e(ce));window.confirm(`Split the deck into ${a} groups?`)&&(e(r).splitDeckIntoGroupOfN(u,e(ce)),await e(r).save(),v(r,e(r)))}async function tt(){const a=window.confirm("Are you sure you want to delete this deck?");if(!a)return;const t=window.confirm("Are you really sure you want to delete this deck? All data will be lost.");t&&(e(r).deleteDeck(u,a&&t),await e(r).save(),Dt(`${Mt}/`))}let G=D(!1),i=D(new Ce);function Ae(a,t){t==null||t.stopPropagation(),v(G,!0),e(i).clear(),a!=null&&e(i).add(a),v(i,e(i))}function at(){v(G,!1),e(i).clear(),v(i,e(i))}function Pe(a,t){return t.has(a)}function de(a){if(!e(G)){Ae(a);return}e(i).has(a)?e(i).delete(a):e(i).add(a),v(i,e(i))}function st(a){const t=e(s).groups.find(h=>h.label==a);if(t!=null){e(i).clear();for(const h of t.cardIds)e(i).add(h);v(i,e(i))}}async function rt(){e(i).forEach(a=>{e(r).addPreviouslyStudiedMark(u,a)}),await e(r).save(),v(r,e(r))}async function ot(){e(i).forEach(a=>{e(r).removePreviouslyStudiedMark(u,a)}),await e(r).save(),v(r,e(r))}async function it(){e(i).forEach(a=>{e(r).addIgnoredMark(u,a)}),await e(r).save(),v(r,e(r))}async function nt(){e(i).forEach(a=>{e(r).removeIgnoredMark(u,a)}),await e(r).save(),v(r,e(r))}function lt(a){return a===p.WarmUp?p.New:a}function ct(a){e(r).setDeckView(a)}function dt(){!e(G)||e(i).size===0||e(r).extraStudyHandler.startExtraStudy(u,Array.from(e(i)))}_e(()=>e(r),()=>{v(s,e(r).deckData[u])}),_e(()=>e(s),()=>{var a;v(g,((a=e(s))==null?void 0:a.groups)??[])}),_e(()=>(e(i),e(r),p),()=>{v(b,Array.from(e(i)).some(a=>e(r).getWenbunCustomState(u,a)==p.PreviouslyStudied))}),_e(()=>(e(i),e(r),p),()=>{v(k,Array.from(e(i)).some(a=>e(r).getWenbunCustomState(u,a)==p.Ignored))}),pt(),xt();var Ee=ia(),Ie=xe(Ee);ht(Ie,{title:"Deck"});var Te=_(Ie,2),ge=c(Te),We=c(ge),be=c(We),Oe=c(be),ve=_(c(Oe));Y(()=>{e(N),bt(()=>{})}),ve.__change=[Lt,ct,N];var ke=c(ve),je={},Ue=_(ke),Ge={};l(ve),l(Oe),l(be);var he=_(be,2),Re=c(he);Re.__click=[Bt,et];var Ve=_(Re,2);yt(Ve),l(he);var vt=_(he,2);vt.__click=[Ht,tt],l(We),l(ge);var Fe=_(ge,2);Ze(Fe,5,()=>e(g),Je,(a,t)=>{var h=oa(),f=c(h);f.__click=[Zt,$e,t];var z=c(f),W=c(z,!0);l(z);var R=_(z,2),V=c(R);{var F=y=>{var S=Jt();M(y,S)},q=y=>{var S=Kt();M(y,S)};$(V,y=>{e(T),e(t),d(()=>e(T).get(e(t).label))?y(F):y(q,!1)})}l(R),l(f);var Z=_(f,2);{var O=y=>{var S=ra(),J=xe(S);{var A=B=>{var P=sa(),j=c(P),K=c(j);K.__click=[Xt,at];var se=_(K,2);se.__click=[Yt,st,t],l(j);var ue=_(j,2),C=c(ue);C.__click=[Qt,dt];var re=_(C,2);re.__click=[$t,rt];var oe=_(re,2);oe.__click=[ea,ot];var ie=_(oe,2);ie.__click=[ta,it];var E=_(ie,2);E.__click=[aa,nt],l(ue),l(P),Y(()=>{C.disabled=(e(i),d(()=>e(i).size==0)),re.disabled=(e(i),d(()=>e(i).size==0)),oe.disabled=(e(i),e(b),d(()=>e(i).size==0||!e(b))),ie.disabled=(e(i),d(()=>e(i).size==0)),E.disabled=(e(i),e(k),d(()=>e(i).size==0||!e(k)))}),M(B,P)};$(J,B=>{e(G)&&B(A)})}var L=_(J,2);Ze(L,5,()=>(e(t),d(()=>e(t).cardIds)),Je,(B,P)=>{var j=kt(),K=xe(j);{var se=C=>{le(C,()=>e(P),()=>e(t))},ue=(C,re)=>{{var oe=E=>{Qe(E,()=>e(P),()=>e(t))},ie=E=>{le(E,()=>e(P),()=>e(t))};$(C,E=>{e(N),H(w),d(()=>e(N)==w.Small)?E(oe):E(ie,!1)},re)}};$(K,C=>{e(N),H(w),d(()=>e(N)==w.Normal)?C(se):C(ue,!1)})}M(B,j)}),l(L),M(y,S)};$(Z,y=>{e(T),e(t),d(()=>e(T).get(e(t).label))&&y(O)})}l(h),Y(()=>Q(W,(e(t),d(()=>e(t).label=="__ungrouped__"?"Ungrouped":e(t).label)))),M(a,h)}),l(Fe),l(Te),Y(()=>{je!==(je=(H(w),d(()=>w.Normal)))&&(ke.value=(ke.__value=(H(w),d(()=>w.Normal)))??""),Ge!==(Ge=(H(w),d(()=>w.Small)))&&(Ue.value=(Ue.__value=(H(w),d(()=>w.Small)))??"")}),St(ve,()=>e(N),a=>v(N,a)),wt(Ve,()=>e(ce),a=>v(ce,a)),M(n,Ee),gt()}_t(["click","keydown","change"]);export{Ca as component,xa as universal};
