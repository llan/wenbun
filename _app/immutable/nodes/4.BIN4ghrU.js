var qe=n=>{throw TypeError(n)};var Le=(n,i,r)=>i.has(n)||qe("Cannot "+r);var p=(n,i,r)=>(Le(n,i,"read from private field"),r?r.call(n):i.get(n)),J=(n,i,r)=>i.has(n)?qe("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(n):i.set(n,r);var ye=(n,i,r)=>(Le(n,i,"access private method"),r);import"../chunks/CWj6FrbW.js";import"../chunks/e1-x02pv.js";import{g as we,u as Be,h as ut,i as e,j as v,k as xe,a3 as _t,p as ft,a4 as C,a5 as pt,a6 as _e,a7 as mt,f as P,a as Se,t as Q,s as _,d as c,b as D,c as bt,a9 as gt,r as l,n as d,O as H,e as X,aF as kt,w as fe,a8 as He}from"../chunks/B3vXJgDE.js";import{i as $}from"../chunks/BMd2rG11.js";import{e as Ze,i as Ke}from"../chunks/Cf-085yO.js";import{T as ht,r as yt}from"../chunks/-bR0FToJ.js";import{s as ne}from"../chunks/BgSIpHGp.js";import{b as wt}from"../chunks/DFF9A_Ms.js";import{b as xt}from"../chunks/NgEXzAtY.js";import{i as St}from"../chunks/DRVz_ard.js";import{p as jt}from"../chunks/DfwZoAIM.js";import{a as Ct,b as Dt}from"../chunks/D9EQzb-w.js";import{D as w,A as Mt,a as Nt,W as m}from"../chunks/DgyyUUPH.js";import{c as zt,d as At}from"../chunks/NeAu8v0G.js";import{S as Et}from"../chunks/BsRTULe9.js";const Pt=({url:n})=>({deckId:n.searchParams.get("id")||""}),Sa=Object.freeze(Object.defineProperty({__proto__:null,load:Pt},Symbol.toStringTag,{value:"Module"}));var It=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],Tt=["difference","intersection","symmetricDifference","union"],Ye=!1,ee,S,U,pe,te,Je,Qe;const me=class me extends Set{constructor(r){super();J(this,te);J(this,ee,new Map);J(this,S,we(0));J(this,U,we(0));J(this,pe,Be||-1);if(r){for(var b of r)super.add(b);p(this,U).v=super.size}Ye||ye(this,te,Qe).call(this)}has(r){var b=super.has(r),g=p(this,ee),k=g.get(r);if(k===void 0){if(!b)return e(p(this,S)),!1;k=ye(this,te,Je).call(this,!0),g.set(r,k)}return e(k),b}add(r){return super.has(r)||(super.add(r),v(p(this,U),super.size),xe(p(this,S))),this}delete(r){var b=super.delete(r),g=p(this,ee),k=g.get(r);return k!==void 0&&(g.delete(r),v(k,!1)),b&&(v(p(this,U),super.size),xe(p(this,S))),b}clear(){if(super.size!==0){super.clear();var r=p(this,ee);for(var b of r.values())v(b,!1);r.clear(),v(p(this,U),0),xe(p(this,S))}}keys(){return this.values()}values(){return e(p(this,S)),super.values()}entries(){return e(p(this,S)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return e(p(this,U))}};ee=new WeakMap,S=new WeakMap,U=new WeakMap,pe=new WeakMap,te=new WeakSet,Je=function(r){return Be===p(this,pe)?we(r):ut(r)},Qe=function(){Ye=!0;var r=me.prototype,b=Set.prototype;for(const g of It)r[g]=function(...k){return e(p(this,S)),b[g].apply(this,k)};for(const g of Tt)r[g]=function(...k){e(p(this,S));var le=b[g].apply(this,k);return new me(le)}};let je=me;var Ot=(n,i,r)=>i(r()),Wt=(n,i,r)=>{n.key=="Enter"&&i(r())},Ut=(n,i,r)=>i(r(),n),Ft=P('<button class="button select-button svelte-1xr8ij4">select</button>'),Gt=P('<div role="button" tabindex="0"><!> <div class="card-word svelte-1xr8ij4"><span class="word chinese-font"> </span></div> <div class="card-details svelte-1xr8ij4"><div> </div> <div> </div></div></div>'),Rt=(n,i,r)=>i(r()),Vt=(n,i,r)=>{n.key=="Enter"&&i(r())},qt=P('<div role="button" tabindex="0"><div class="card-word svelte-1xr8ij4"><span class="word chinese-font"> </span></div> <div class="card-details svelte-1xr8ij4"><div> </div></div></div>'),Lt=(n,i,r)=>i(e(r)),Bt=(n,i)=>i(),Ht=(n,i)=>i(),Zt=(n,i,r)=>i(e(r).label),Kt=P('<i class="fa-solid fa-chevron-down"></i>'),Yt=P('<i class="fa-solid fa-chevron-right"></i>'),Jt=(n,i)=>i(),Qt=(n,i,r)=>i(e(r).label),Xt=(n,i)=>i(),$t=(n,i)=>i(),ea=(n,i)=>i(),ta=(n,i)=>i(),aa=(n,i)=>i(),ra=P('<div style="display: flex; flex-direction: row; justify-content: space-between; width: 100%; gap: 0.5em;"><div class="group-buttons-container svelte-1xr8ij4" style="align-items: flex-start;"><button class="button svelte-1xr8ij4"><i class="fa-solid fa-xmark"></i>cancel selection</button> <button class="button svelte-1xr8ij4"><i class="fa-solid fa-check-double"></i>select all in this group</button></div> <div class="group-buttons-container svelte-1xr8ij4" style="align-items: flex-end;"><button class="button svelte-1xr8ij4"><i class="fa-solid fa-chalkboard-user"></i><span>start <b>extra study</b> from selection</span></button> <button class="button svelte-1xr8ij4"><i class="fa-solid fa-book-open"></i><span>mark as <b>previously studied</b></span></button> <button class="button svelte-1xr8ij4"><i class="fa-solid fa-book-open"></i><span>remove <b>previously studied</b> mark</span></button> <button class="button svelte-1xr8ij4"><i class="fa-solid fa-square-xmark"></i><span>mark as <b>ignored</b></span></button> <button class="button svelte-1xr8ij4"><i class="fa-solid fa-square-xmark"></i><span>remove <b>ignored</b> mark</span></button></div></div>'),sa=P('<!> <div class="group-content svelte-1xr8ij4"></div>',1),ia=P('<div class="group svelte-1xr8ij4"><button class="group-header svelte-1xr8ij4"><div> </div> <div><!></div></button> <!></div>'),oa=P('<!> <div class="container svelte-1xr8ij4"><div class="top-container" style="display: flex; gap: 0.5em; margin-bottom: 2em"><div class="top-control-container svelte-1xr8ij4"><div><label style="display: flex; gap: 0.5em; align-items: center; justify-content: space-between;">View: <select style="flex-grow: 1;"><option>Normal</option><option>Small</option></select></label></div> <div style="display: flex; gap: 0.5em; align-items: center;"><button class="button svelte-1xr8ij4">Split into groups of</button> <input class="input" type="number" min="1" max="100"/></div> <button class="button delete-button svelte-1xr8ij4"><i class="fa-solid fa-trash"></i> Delete this Deck</button></div></div> <div class="group-container svelte-1xr8ij4"></div></div>',1);function ja(n,i){ft(i,!1);const r=C(),b=C(),g=C(),k=C(),le=(a,t=fe,h=fe)=>{var f=Gt();let N;f.__click=[Ot,de,t],f.__keydown=[Wt,de,t];var T=c(f);{var G=z=>{var L=Ft();L.__click=[Ut,ze,t],D(z,L)};$(T,z=>{e(F)||z(G)})}var R=_(T,2),V=c(R),q=c(V,!0);l(V),l(R);var Z=_(R,2),O=c(Z),y=c(O,!0);l(O);var x=_(O,2),K=c(x,!0);l(x),l(Z),l(f),Q((z,L,B,A,W,Y,re)=>{N=ne(f,1,z,"svelte-1xr8ij4",N,L),X(q,B),ne(O,1,A,"svelte-1xr8ij4"),X(y,W),ne(x,1,Y,"svelte-1xr8ij4"),X(K,re)},[()=>(t(),e(s),d(()=>`card ${ae(u,t(),e(s))}`)),()=>({selectable:e(F),selected:Ae(t(),e(o))}),()=>(t(),d(()=>Ne(u,t()))),()=>(t(),e(s),d(()=>`status ${ae(u,t(),e(s))}`)),()=>(e(s),t(),H(m),d(()=>lt(e(s).getWenbunCustomState(u,t())??m.New))),()=>(t(),e(s),d(()=>`due ${ae(u,t(),e(s))}`)),()=>(e(s),t(),d(()=>e(s).getCardDueFormatted(u,t())))],He),D(a,f)},Xe=(a,t=fe,h=fe)=>{var f=qt();let N;f.__click=[Rt,de,t],f.__keydown=[Vt,de,t];var T=c(f),G=c(T),R=c(G,!0);l(G),l(T);var V=_(T,2),q=c(V),Z=c(q,!0);l(q),l(V),l(f),Q((O,y,x,K,z)=>{N=ne(f,1,O,"svelte-1xr8ij4",N,y),X(R,x),ne(q,1,K,"svelte-1xr8ij4"),X(Z,z)},[()=>(t(),e(s),d(()=>`card-small ${ae(u,t(),e(s))}`)),()=>({selected:Ae(t(),e(o))}),()=>(t(),d(()=>Ne(u,t()))),()=>(t(),e(s),d(()=>`due ${ae(u,t(),e(s))}`)),()=>(e(s),t(),d(()=>e(s).getShortCardDueFormatted(u,t())))],He),D(a,f)};let u=jt(i,"data",8)().deckId||"",Ce=!1,De,M=C(w.Normal),s=C(new Mt);pt(async()=>{await e(s).init(),Me(),await e(s).initProfile()&&Me()});function Me(){var a,t;Ce=(t=(a=e(s).deckData[u])==null?void 0:a.tags)==null?void 0:t.includes(zt.ZH_TRAD),De=new At("cn","tw"),v(M,e(s).getDeckView()),v(s,e(s))}let I=C(new Et);function $e(a){e(I).set(a,!e(I).get(a)),v(I,e(I))}function ae(a,t,h){switch(h.getWenbunCustomState(a,t)??m.New){case m.New:return"card-status-new";case m.WarmUp:return"card-status-new";case m.Learning:return"card-status-learning";case m.ReviewYoung:return"card-status-review-young";case m.ReviewMature:return"card-status-review-mature";case m.Relearning:return"card-status-relearning";case m.PreviouslyStudied:return"card-status-previously-studied";case m.Ignored:return"card-status-ignored"}}function Ne(a,t){const h=e(s).getCardWord(a,t);return Ce?De.convert(h):h}let ce=C(Nt);async function et(){const a=Math.ceil(e(r).deck.length/e(ce));window.confirm(`Split the deck into ${a} groups?`)&&(e(s).splitDeckIntoGroupOfN(u,e(ce)),await e(s).save(),v(s,e(s)))}async function tt(){const a=window.confirm("Are you sure you want to delete this deck?");if(!a)return;const t=window.confirm("Are you really sure you want to delete this deck? All data will be lost.");t&&(e(s).deleteDeck(u,a&&t),await e(s).save(),Ct(`${Dt}/`))}let F=C(!1),o=C(new je);function ze(a,t){t==null||t.stopPropagation(),v(F,!0),e(o).clear(),a!=null&&e(o).add(a),v(o,e(o))}function at(){v(F,!1),e(o).clear(),v(o,e(o))}function Ae(a,t){return t.has(a)}function de(a){if(!e(F)){ze(a);return}e(o).has(a)?e(o).delete(a):e(o).add(a),v(o,e(o))}function rt(a){const t=e(r).groups.find(h=>h.label==a);if(t!=null){e(o).clear();for(const h of t.cardIds)e(o).add(h);v(o,e(o))}}async function st(){e(o).forEach(a=>{e(s).addPreviouslyStudiedMark(u,a)}),await e(s).save(),v(s,e(s))}async function it(){e(o).forEach(a=>{e(s).removePreviouslyStudiedMark(u,a)}),await e(s).save(),v(s,e(s))}async function ot(){e(o).forEach(a=>{e(s).addIgnoredMark(u,a)}),await e(s).save(),v(s,e(s))}async function nt(){e(o).forEach(a=>{e(s).removeIgnoredMark(u,a)}),await e(s).save(),v(s,e(s))}function lt(a){return a===m.WarmUp?m.New:a}function ct(a){e(s).setDeckView(a)}function dt(){!e(F)||e(o).size===0||e(s).extraStudyHandler.startExtraStudy(u,Array.from(e(o)))}_e(()=>e(s),()=>{v(r,e(s).deckData[u])}),_e(()=>e(r),()=>{var a;v(b,((a=e(r))==null?void 0:a.groups)??[])}),_e(()=>(e(o),e(s),m),()=>{v(g,Array.from(e(o)).some(a=>e(s).getWenbunCustomState(u,a)==m.PreviouslyStudied))}),_e(()=>(e(o),e(s),m),()=>{v(k,Array.from(e(o)).some(a=>e(s).getWenbunCustomState(u,a)==m.Ignored))}),mt(),St();var Ee=oa(),Pe=Se(Ee);ht(Pe,{title:"Deck"});var Ie=_(Pe,2),be=c(Ie),Te=c(be),ge=c(Te),Oe=c(ge),ve=_(c(Oe));Q(()=>{e(M),gt(()=>{})}),ve.__change=[Lt,ct,M];var ke=c(ve),We={},Ue=_(ke),Fe={};l(ve),l(Oe),l(ge);var he=_(ge,2),Ge=c(he);Ge.__click=[Bt,et];var Re=_(Ge,2);yt(Re),l(he);var vt=_(he,2);vt.__click=[Ht,tt],l(Te),l(be);var Ve=_(be,2);Ze(Ve,5,()=>e(b),Ke,(a,t)=>{var h=ia(),f=c(h);f.__click=[Zt,$e,t];var N=c(f),T=c(N,!0);l(N);var G=_(N,2),R=c(G);{var V=y=>{var x=Kt();D(y,x)},q=y=>{var x=Yt();D(y,x)};$(R,y=>{e(I),e(t),d(()=>e(I).get(e(t).label))?y(V):y(q,!1)})}l(G),l(f);var Z=_(f,2);{var O=y=>{var x=sa(),K=Se(x);{var z=B=>{var A=ra(),W=c(A),Y=c(W);Y.__click=[Jt,at];var re=_(Y,2);re.__click=[Qt,rt,t],l(W);var ue=_(W,2),j=c(ue);j.__click=[Xt,dt];var se=_(j,2);se.__click=[$t,st];var ie=_(se,2);ie.__click=[ea,it];var oe=_(ie,2);oe.__click=[ta,ot];var E=_(oe,2);E.__click=[aa,nt],l(ue),l(A),Q(()=>{j.disabled=(e(o),d(()=>e(o).size==0)),se.disabled=(e(o),d(()=>e(o).size==0)),ie.disabled=(e(o),e(g),d(()=>e(o).size==0||!e(g))),oe.disabled=(e(o),d(()=>e(o).size==0)),E.disabled=(e(o),e(k),d(()=>e(o).size==0||!e(k)))}),D(B,A)};$(K,B=>{e(F)&&B(z)})}var L=_(K,2);Ze(L,5,()=>(e(t),d(()=>e(t).cardIds)),Ke,(B,A)=>{var W=kt(),Y=Se(W);{var re=j=>{le(j,()=>e(A),()=>e(t))},ue=(j,se)=>{{var ie=E=>{Xe(E,()=>e(A),()=>e(t))},oe=E=>{le(E,()=>e(A),()=>e(t))};$(j,E=>{e(M),H(w),d(()=>e(M)==w.Small)?E(ie):E(oe,!1)},se)}};$(Y,j=>{e(M),H(w),d(()=>e(M)==w.Normal)?j(re):j(ue,!1)})}D(B,W)}),l(L),D(y,x)};$(Z,y=>{e(I),e(t),d(()=>e(I).get(e(t).label))&&y(O)})}l(h),Q(()=>X(T,(e(t),d(()=>e(t).label=="__ungrouped__"?"Ungrouped":e(t).label)))),D(a,h)}),l(Ve),l(Ie),Q(()=>{We!==(We=(H(w),d(()=>w.Normal)))&&(ke.value=(ke.__value=(H(w),d(()=>w.Normal)))??""),Fe!==(Fe=(H(w),d(()=>w.Small)))&&(Ue.value=(Ue.__value=(H(w),d(()=>w.Small)))??"")}),xt(ve,()=>e(M),a=>v(M,a)),wt(Re,()=>e(ce),a=>v(ce,a)),D(n,Ee),bt()}_t(["click","keydown","change"]);export{ja as component,Sa as universal};
