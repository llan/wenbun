var Je=o=>{throw TypeError(o)};var Qe=(o,r,n)=>r.has(o)||Je("Cannot "+n);var b=(o,r,n)=>(Qe(o,r,"read from private field"),n?n.call(o):r.get(o)),ae=(o,r,n)=>r.has(o)?Je("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(o):r.set(o,n);var Ie=(o,r,n)=>(Qe(o,r,"access private method"),n);import"../chunks/CWj6FrbW.js";import"../chunks/SiSAkwjt.js";import{g as Ee,u as $e,h as Mt,i as e,j as c,k as Me,ak as Nt,p as zt,a9 as y,al as At,am as Y,an as Pt,f as I,a as be,t as J,s as _,d as v,b as x,c as Tt,P as F,r as l,ap as Wt,n as d,aL as Ot,ao as Gt,e as L,as as jt,w as ke,X as et}from"../chunks/C2k6CbEI.js";import{i as B}from"../chunks/Crl2Bchr.js";import{e as tt,i as at}from"../chunks/DJAOMF32.js";import{T as qt,r as st}from"../chunks/GdbsWXTA.js";import{s as ue}from"../chunks/BFp7uHGi.js";import{b as rt}from"../chunks/CMrEsRZ4.js";import{b as Rt}from"../chunks/1wqpN5PF.js";import{b as Ut}from"../chunks/DTVcAqe8.js";import{i as Vt}from"../chunks/CBMlR3ml.js";import{p as Ft}from"../chunks/B48BoX4-.js";import{g as Lt,b as Bt}from"../chunks/DcoJXAFg.js";import{D as C,A as Ht,a as Zt,W as g}from"../chunks/BxxS8XqS.js";import{f as Kt,g as Xt,i as nt}from"../chunks/BSb8eFOk.js";import{S as Yt}from"../chunks/CCFbYWHf.js";const Jt=({url:o})=>({deckId:o.searchParams.get("id")||""}),Ka=Object.freeze(Object.defineProperty({__proto__:null,load:Jt},Symbol.toStringTag,{value:"Module"}));var Qt=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],$t=["difference","intersection","symmetricDifference","union"],it=!1,se,N,H,ge,re,ot,ct;const he=class he extends Set{constructor(n){super();ae(this,re);ae(this,se,new Map);ae(this,N,Ee(0));ae(this,H,Ee(0));ae(this,ge,$e||-1);if(n){for(var m of n)super.add(m);b(this,H).v=super.size}it||Ie(this,re,ct).call(this)}has(n){var m=super.has(n),w=b(this,se),h=w.get(n);if(h===void 0){if(!m)return e(b(this,N)),!1;h=Ie(this,re,ot).call(this,!0),w.set(n,h)}return e(h),m}add(n){return super.has(n)||(super.add(n),c(b(this,H),super.size),Me(b(this,N))),this}delete(n){var m=super.delete(n),w=b(this,se),h=w.get(n);return h!==void 0&&(w.delete(n),c(h,!1)),m&&(c(b(this,H),super.size),Me(b(this,N))),m}clear(){if(super.size!==0){super.clear();var n=b(this,se);for(var m of n.values())c(m,!1);n.clear(),c(b(this,H),0),Me(b(this,N))}}keys(){return this.values()}values(){return e(b(this,N)),super.values()}entries(){return e(b(this,N)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return e(b(this,H))}};se=new WeakMap,N=new WeakMap,H=new WeakMap,ge=new WeakMap,re=new WeakSet,ot=function(n){return $e===b(this,ge)?Ee(n):Mt(n)},ct=function(){it=!0;var n=he.prototype,m=Set.prototype;for(const w of Qt)n[w]=function(...h){return e(b(this,N)),m[w].apply(this,h)};for(const w of $t)n[w]=function(...h){e(b(this,N));var ne=m[w].apply(this,h);return new he(ne)}};let Ne=he;var ea=(o,r,n)=>r(n()),ta=(o,r,n)=>{o.key=="Enter"&&r(n())},aa=(o,r,n)=>r(n(),o),sa=I('<button class="button select-button svelte-1st7cs9">select</button>'),ra=I('<div role="button" tabindex="0"><!> <div class="card-word svelte-1st7cs9"><span class="word chinese-font"> </span></div> <div class="card-details svelte-1st7cs9"><div> </div> <div> </div></div></div>'),na=(o,r,n)=>r(n()),ia=(o,r,n)=>{o.key=="Enter"&&r(n())},oa=I('<div role="button" tabindex="0"><div class="card-word svelte-1st7cs9"><span class="word chinese-font"> </span></div> <div class="card-details svelte-1st7cs9"><div> </div></div></div>'),ca=(o,r)=>r(),la=I('<form><input class="name-input" type="text"/> <button class="button-name-edit svelte-1st7cs9" type="submit" aria-label="Save deck name"><i class="fa-solid fa-square-check"></i></button> <button class="button-name-edit svelte-1st7cs9" aria-label="Cancel"><i class="fa-solid fa-square-xmark"></i></button></form>'),va=(o,r)=>c(r,!0),da=I('<button class="button-name-edit svelte-1st7cs9" aria-label="Edit deck name"><i class="fa-solid fa-pen-to-square"></i></button>'),ua=I('<div class="deck-info svelte-1st7cs9"><span class="deck-card-title"> </span> <span class="deck-card-subtitle svelte-1st7cs9"> </span> <div class="loading"></div></div> <!>',1),_a=(o,r,n)=>r(e(n)),fa=(o,r)=>r(),pa=(o,r)=>r(),ma=(o,r,n)=>r(e(n).label),ba=I('<i class="fa-solid fa-chevron-down"></i>'),ka=I('<i class="fa-solid fa-chevron-right"></i>'),ga=(o,r)=>r(),ha=(o,r,n)=>r(e(n).label),ya=(o,r)=>r(),wa=(o,r)=>r(),Sa=(o,r)=>r(),xa=(o,r)=>r(),Ca=(o,r)=>r(),Da=(o,r)=>r(),Ia=I('<div style="display: flex; flex-direction: row; justify-content: space-between; width: 100%; gap: 0.5em;"><div class="group-buttons-container svelte-1st7cs9" style="align-items: flex-start;"><button class="button svelte-1st7cs9"><i class="fa-solid fa-xmark"></i>cancel selection</button> <button class="button svelte-1st7cs9"><i class="fa-solid fa-check-double"></i>select all in this group</button></div> <div class="group-buttons-container svelte-1st7cs9" style="align-items: flex-end;"><button class="button svelte-1st7cs9"><i class="fa-solid fa-chalkboard-user"></i><span>start <b>extra study</b> from selection</span></button> <button class="button svelte-1st7cs9"><i class="fa-solid fa-right-left"></i><span>move to another group</span></button> <button class="button svelte-1st7cs9"><i class="fa-solid fa-book-open"></i><span>mark as <b>previously studied</b></span></button> <button class="button svelte-1st7cs9"><i class="fa-solid fa-book-open"></i><span>remove <b>previously studied</b> mark</span></button> <button class="button svelte-1st7cs9"><i class="fa-solid fa-square-xmark"></i><span>mark as <b>ignored</b></span></button> <button class="button svelte-1st7cs9"><i class="fa-solid fa-square-xmark"></i><span>remove <b>ignored</b> mark</span></button></div></div>'),Ea=I('<!> <div class="group-content svelte-1st7cs9"></div>',1),Ma=I('<div class="group svelte-1st7cs9"><button class="group-header svelte-1st7cs9"><div> </div> <div><!></div></button> <!></div>'),Na=I('<!> <div class="container svelte-1st7cs9"><div class="top-container svelte-1st7cs9"><div class="deck-name-container svelte-1st7cs9"><!></div> <div class="top-control-container svelte-1st7cs9"><div><label style="display: flex; gap: 0.5em; align-items: center; justify-content: space-between;">View: <select style="flex-grow: 1;"><option>Normal</option><option>Small</option></select></label></div> <div style="display: flex; gap: 0.5em; align-items: center;"><button class="button svelte-1st7cs9">Split into groups of</button> <input class="input" type="number" min="1" max="100"/></div> <button class="button delete-button svelte-1st7cs9"><i class="fa-solid fa-trash"></i> Delete this Deck</button></div></div> <div class="group-container svelte-1st7cs9"></div></div>',1);function Xa(o,r){zt(r,!1);const n=y(),m=y(),w=y(),h=y(),ne=y(),ze=y(),Ae=(a,t=ke,p=ke)=>{var f=ra();let k;f.__click=[ea,fe,t],f.__keydown=[ta,fe,t];var E=v(f);{var T=j=>{var K=sa();K.__click=[aa,Ge,t],x(j,K)};B(E,j=>{e(Z)||j(T)})}var W=_(E,2),O=v(W),M=v(O,!0);l(O),l(W);var G=_(W,2),U=v(G),S=v(U,!0);l(U);var D=_(U,2),ee=v(D,!0);l(D),l(G),l(f),J((j,K,X,q,V,te,ce)=>{k=ue(f,1,j,"svelte-1st7cs9",k,K),L(M,X),ue(U,1,q,"svelte-1st7cs9"),L(S,V),ue(D,1,te,"svelte-1st7cs9"),L(ee,ce)},[()=>(t(),e(s),d(()=>`card ${ie(u,t(),e(s))}`)),()=>({selectable:e(Z),selected:je(t(),e(i))}),()=>(t(),d(()=>Oe(u,t()))),()=>(t(),e(s),d(()=>`status ${ie(u,t(),e(s))}`)),()=>(e(s),t(),F(g),d(()=>gt(e(s).getWenbunCustomState(u,t())??g.New))),()=>(t(),e(s),d(()=>`due ${ie(u,t(),e(s))}`)),()=>(e(s),t(),d(()=>e(s).getCardDueFormatted(u,t())))],et),x(a,f)},lt=(a,t=ke,p=ke)=>{var f=oa();let k;f.__click=[na,fe,t],f.__keydown=[ia,fe,t];var E=v(f),T=v(E),W=v(T,!0);l(T),l(E);var O=_(E,2),M=v(O),G=v(M,!0);l(M),l(O),l(f),J((U,S,D,ee,j)=>{k=ue(f,1,U,"svelte-1st7cs9",k,S),L(W,D),ue(M,1,ee,"svelte-1st7cs9"),L(G,j)},[()=>(t(),e(s),d(()=>`card-small ${ie(u,t(),e(s))}`)),()=>({selected:je(t(),e(i))}),()=>(t(),d(()=>Oe(u,t()))),()=>(t(),e(s),d(()=>`due ${ie(u,t(),e(s))}`)),()=>(e(s),t(),d(()=>e(s).getShortCardDueFormatted(u,t())))],et),x(a,f)};let ye=Ft(r,"data",8),u=ye().deckId||"",Pe=!1,Te,P=y(C.Normal),s=y(new Ht);At(async()=>{await e(s).init(),We(),await e(s).initProfile()&&We()});function We(){var a,t;Pe=(t=(a=e(s).deckData[u])==null?void 0:a.tags)==null?void 0:t.includes(Kt.ZH_TRAD),Te=new Xt("cn","tw"),c(P,e(s).getDeckView()),c($,e(s).getDeckInfo(u).title),c(s,e(s))}let R=y(new Yt);function vt(a){e(R).set(a,!e(R).get(a)),c(R,e(R))}function ie(a,t,p){switch(p.getWenbunCustomState(a,t)??g.New){case g.New:return"card-status-new";case g.WarmUp:return"card-status-new";case g.Learning:return"card-status-learning";case g.ReviewYoung:return"card-status-review-young";case g.ReviewMature:return"card-status-review-mature";case g.Relearning:return"card-status-relearning";case g.PreviouslyStudied:return"card-status-previously-studied";case g.Ignored:return"card-status-ignored"}}function Oe(a,t){const p=e(s).getCardWord(a,t);return Pe?Te.convert(p):p}let _e=y(Zt);async function dt(){const a=Math.ceil(e(n).deck.length/e(_e));window.confirm(`Split the deck into ${a} groups?`)&&(e(s).splitDeckIntoGroupOfN(u,e(_e)),await e(s).save(),c(s,e(s)))}async function ut(){const a=window.confirm("Are you sure you want to delete this deck?");if(!a)return;const t=window.confirm("Are you really sure you want to delete this deck? All data will be lost.");t&&(e(s).deleteDeck(u,a&&t),await e(s).save(),Lt(`${Bt}/`))}let Z=y(!1),i=y(new Ne);function Ge(a,t){t==null||t.stopPropagation(),c(Z,!0),e(i).clear(),a!=null&&e(i).add(a),c(i,e(i))}function _t(){c(Z,!1),e(i).clear(),c(i,e(i))}function je(a,t){return t.has(a)}function fe(a){if(!e(Z)){Ge(a);return}e(i).has(a)?e(i).delete(a):e(i).add(a),c(i,e(i))}function ft(a){const t=e(n).groups.find(p=>p.label==a);if(t!=null){e(i).clear();for(const p of t.cardIds)e(i).add(p);c(i,e(i))}}async function pt(){e(i).forEach(a=>{e(s).addPreviouslyStudiedMark(u,a)}),await e(s).save(),c(s,e(s))}async function mt(){e(i).forEach(a=>{e(s).removePreviouslyStudiedMark(u,a)}),await e(s).save(),c(s,e(s))}async function bt(){e(i).forEach(a=>{e(s).addIgnoredMark(u,a)}),await e(s).save(),c(s,e(s))}async function kt(){e(i).forEach(a=>{e(s).removeIgnoredMark(u,a)}),await e(s).save(),c(s,e(s))}function gt(a){return a===g.WarmUp?g.New:a}function ht(a){e(s).setDeckView(a)}function yt(){!e(Z)||e(i).size===0||e(s).extraStudyHandler.startExtraStudy(u,Array.from(e(i)))}let Q=y(!1),$=y(""),oe=y(null);async function wt(){if(e($).trim()===""){window.alert("Deck name cannot be empty.");return}e(s).renameDeck(u,e($)),await e(s).save(),c(Q,!1),c(s,e(s))}function St(){c(Q,!1),c($,e(s).getDeckInfo(u).title)}async function xt(){const a=window.prompt("Enter target group name: *(new group will be created if the name does not exist)");a&&(e(s).moveCardsIntoGroup(u,Array.from(e(i)),a),await e(s).save(),e(i).clear(),c(s,e(s)))}Y(()=>e(s),()=>{c(n,e(s).deckData[u])}),Y(()=>(e(s),F(ye())),()=>{c(m,e(s).getDeckInfo(ye().deckId??""))}),Y(()=>e(n),()=>{var a;c(w,((a=e(n))==null?void 0:a.groups)??[])}),Y(()=>(e(i),e(s),g),()=>{c(h,Array.from(e(i)).some(a=>e(s).getWenbunCustomState(u,a)==g.PreviouslyStudied))}),Y(()=>(e(i),e(s),g),()=>{c(ne,Array.from(e(i)).some(a=>e(s).getWenbunCustomState(u,a)==g.Ignored))}),Y(()=>nt,()=>{c(ze,!nt(u))}),Y(()=>(e(Q),e(oe)),()=>{e(Q)&&e(oe)&&e(oe).focus()}),Pt(),Vt();var qe=Na(),Re=be(qe);qt(Re,{title:"Deck"});var Ue=_(Re,2),we=v(Ue),Se=v(we),Ct=v(Se);{var Dt=a=>{var t=la(),p=v(t);st(p),Ut(p,k=>c(oe,k),()=>e(oe));var f=_(p,4);f.__click=[ca,St],l(t),Ot("submit",t,k=>{k.preventDefault(),wt()}),rt(p,()=>e($),k=>c($,k)),x(a,t)},It=a=>{var t=ua(),p=be(t),f=v(p),k=v(f,!0);l(f);var E=_(f,2),T=v(E,!0);l(E),Gt(2),l(p);var W=_(p,2);{var O=M=>{var G=da();G.__click=[va,Q],x(M,G)};B(W,M=>{e(ze)&&M(O)})}J(()=>{L(k,(e(m),d(()=>e(m).title))),L(T,(e(m),d(()=>e(m).subtitle)))}),x(a,t)};B(Ct,a=>{e(Q)?a(Dt):a(It,!1)})}l(Se);var Ve=_(Se,2),xe=v(Ve),Fe=v(xe),pe=_(v(Fe));J(()=>{e(P),Wt(()=>{})}),pe.__change=[_a,ht,P];var Ce=v(pe),Le={},Be=_(Ce),He={};l(pe),l(Fe),l(xe);var De=_(xe,2),Ze=v(De);Ze.__click=[fa,dt];var Ke=_(Ze,2);st(Ke),l(De);var Et=_(De,2);Et.__click=[pa,ut],l(Ve),l(we);var Xe=_(we,2);tt(Xe,5,()=>e(w),at,(a,t)=>{var p=Ma(),f=v(p);f.__click=[ma,vt,t];var k=v(f),E=v(k,!0);l(k);var T=_(k,2),W=v(T);{var O=S=>{var D=ba();x(S,D)},M=S=>{var D=ka();x(S,D)};B(W,S=>{e(R),e(t),d(()=>e(R).get(e(t).label))?S(O):S(M,!1)})}l(T),l(f);var G=_(f,2);{var U=S=>{var D=Ea(),ee=be(D);{var j=X=>{var q=Ia(),V=v(q),te=v(V);te.__click=[ga,_t];var ce=_(te,2);ce.__click=[ha,ft,t],l(V);var me=_(V,2),z=v(me);z.__click=[ya,yt];var le=_(z,2);le.__click=[wa,xt];var ve=_(le,2);ve.__click=[Sa,pt];var de=_(ve,2);de.__click=[xa,mt];var A=_(de,2);A.__click=[Ca,bt];var Ye=_(A,2);Ye.__click=[Da,kt],l(me),l(q),J(()=>{z.disabled=(e(i),d(()=>e(i).size==0)),le.disabled=(e(i),d(()=>e(i).size==0)),ve.disabled=(e(i),d(()=>e(i).size==0)),de.disabled=(e(i),e(h),d(()=>e(i).size==0||!e(h))),A.disabled=(e(i),d(()=>e(i).size==0)),Ye.disabled=(e(i),e(ne),d(()=>e(i).size==0||!e(ne)))}),x(X,q)};B(ee,X=>{e(Z)&&X(j)})}var K=_(ee,2);tt(K,5,()=>(e(t),d(()=>e(t).cardIds)),at,(X,q)=>{var V=jt(),te=be(V);{var ce=z=>{Ae(z,()=>e(q),()=>e(t))},me=(z,le)=>{{var ve=A=>{lt(A,()=>e(q),()=>e(t))},de=A=>{Ae(A,()=>e(q),()=>e(t))};B(z,A=>{e(P),F(C),d(()=>e(P)==C.Small)?A(ve):A(de,!1)},le)}};B(te,z=>{e(P),F(C),d(()=>e(P)==C.Normal)?z(ce):z(me,!1)})}x(X,V)}),l(K),x(S,D)};B(G,S=>{e(R),e(t),d(()=>e(R).get(e(t).label))&&S(U)})}l(p),J(()=>L(E,(e(t),d(()=>e(t).label=="__ungrouped__"?"Ungrouped":e(t).label)))),x(a,p)}),l(Xe),l(Ue),J(()=>{Le!==(Le=(F(C),d(()=>C.Normal)))&&(Ce.value=(Ce.__value=(F(C),d(()=>C.Normal)))??""),He!==(He=(F(C),d(()=>C.Small)))&&(Be.value=(Be.__value=(F(C),d(()=>C.Small)))??"")}),Rt(pe,()=>e(P),a=>c(P,a)),rt(Ke,()=>e(_e),a=>c(_e,a)),x(o,qe),Tt()}Nt(["click","keydown","change"]);export{Xa as component,Ka as universal};
