import"../chunks/CWj6FrbW.js";import"../chunks/SiSAkwjt.js";import{ak as he,p as xe,al as De,j as D,a9 as A,f,d as r,i as e,r as s,b as _,c as Ie,n as Z,P as fe,w as me,s as a,t as T,X as oe,e as j,a as ke,aO as Ne,ap as ge,aN as He,aM as se,ao as Le}from"../chunks/C2k6CbEI.js";import{i as q}from"../chunks/Crl2Bchr.js";import{k as Re}from"../chunks/DQcQ5N_a.js";import{s as le,T as Ue,r as ie}from"../chunks/GdbsWXTA.js";import{s as Ce}from"../chunks/BFp7uHGi.js";import{b as ne,a as ze}from"../chunks/CMrEsRZ4.js";import{b as ye}from"../chunks/1wqpN5PF.js";import{i as Ae}from"../chunks/CBMlR3ml.js";import{g as Ge,b as be}from"../chunks/DcoJXAFg.js";import{e as Me,i as Be}from"../chunks/DJAOMF32.js";import{p as J}from"../chunks/B48BoX4-.js";import{f as we,C as Ze,j as ce,k as de}from"../chunks/BSb8eFOk.js";import{A as je}from"../chunks/BxxS8XqS.js";import{S as re}from"../chunks/BMtuTulc.js";const Se={name:"",words:[],lang:"zh",isEnableCustomDictionary:!1};var S=(p=>(p.Simple="simple",p.AnkiText="ankiText",p))(S||{});class qe{constructor(o){this.app=o}getDeckData(o){const k=[];return o.lang==="yue"&&k.push(we.ZH_YUE),o.isEnableCustomDictionary&&k.push(we.ZH_EXTRA_DICT),this.app.getInitDeckData(o.words,k)}parseSimple(o){return{words:o.split(`
`).filter(i=>i.trim()!=="")}}parseAnkiText(o,k){return{words:o.split(`
`).filter(w=>w.trim()!==""&&!w.startsWith("#")).map(w=>w.split("	")[k-1])}}}var Ke=()=>window.alert(ce),Xe=p=>{p.key==="Enter"&&window.alert(ce)},Ye=f('<span class="word-error not-supported svelte-gba299" style="cursor: pointer;" role="button" tabindex="0"><i class="fa-solid fa-triangle-exclamation"></i></span>'),Ve=()=>window.alert(de),Je=p=>{p.key==="Enter"&&window.alert(de)},Qe=f('<span class="word-error no-dict svelte-gba299" style="cursor: pointer;" role="button" tabindex="0"><i class="fa-solid fa-circle-exclamation"></i></span>'),et=f('<div><span class="word chinese-font svelte-gba299"> </span> <span class="reading"> </span> <span class="meaning"> </span> <!></div>'),tt=f('<div class="cards-container svelte-gba299"></div>'),at=f('<div class="deck-preview-container svelte-gba299"><!></div>');function st(p,o){xe(o,!1);const k=(u,l=me,C=me)=>{var h=et();let W;var P=r(h),X=r(P,!0);s(P);var O=a(P,2),G=r(O,!0);s(O);var E=a(O,2),M=r(E,!0);s(E);var F=a(E,2);{var B=y=>{var b=Ye();b.__click=[Ke],b.__keydown=[Xe],T(()=>le(b,"title",ce)),_(y,b)},Y=(y,b)=>{{var N=H=>{var L=Qe();L.__click=[Ve],L.__keydown=[Je],T(()=>le(L,"title",de)),_(H,L)};q(y,H=>{C()||H(N)},b)}};q(F,y=>{l(),Z(()=>!m.isWordSupportedByHanziWriter(l()))?y(B):y(Y,!1)})}s(h),T((y,b)=>{W=Ce(h,1,"card svelte-gba299",null,W,y),j(X,l()),j(G,b),j(M,(C(),Z(()=>{var N;return((N=C())==null?void 0:N.meaning)??"-"})))},[()=>({"is-show-error-only":w()&&g()>0}),()=>(l(),fe(i()),Z(()=>m.getReading(l(),i().lang)||"-"))],oe),_(u,h)};let i=J(o,"deck",8,Se),w=J(o,"filterShowIssueOnly",8,!1),g=J(o,"issueCount",12,0),c=J(o,"issueIds",28,()=>[]),m=new Ze,$=A(!1);De(async()=>{var u;await m.init(i().lang,(u=i())==null?void 0:u.isEnableCustomDictionary),U(),D($,!0)});function U(){g(0);const u=[];i().words.forEach((l,C)=>{(!m.isWordSupportedByHanziWriter(l)||!m.getWordData(l))&&u.push(C)}),c(u),g(u.length)}Ae();var I=at(),z=r(I);{var K=u=>{var l=tt();Me(l,5,()=>(fe(i()),Z(()=>i().words)),Be,(C,h)=>{var W=oe(()=>(e(h),Z(()=>m.getWordData(e(h)))));k(C,()=>e(h),()=>e(W))}),s(l),_(u,l)};q(z,u=>{i()!==null&&e($)&&u(K)})}s(I),_(p,I),Ie()}he(["click","keydown"]);var it=f('<div><label>Column Index: <input type="number" step="1" min="0"/></label></div>'),nt=(p,o)=>D(o,!e(o)),rt=f('<div class="info-issue is-issue svelte-1u19yr2"> </div> <button class="button"> </button>',1),ot=f('<div class="info-issue">No issues found.</div> <button class="button" style="visibility: hidden;">&npsb;</button>',1),lt=f('<div class="deck-preview-container svelte-1u19yr2"><!></div>'),ct=f('<div style="text-align: right;"><input type="text"/> <div style="color: #A64547;">Deck name cannot be empty.</div></div>'),dt=f("<select><option>Mandarin</option><option>Cantonese</option></select>"),vt=f('<input type="checkbox"/>'),ut=f(`<!> <div class="main-container svelte-1u19yr2"><div class="upload-container svelte-1u19yr2"><div class="section-title svelte-1u19yr2">Input</div> <div><label>Format: <select><option>Simple</option><option>Anki Text</option></select></label> <a aria-label="Help" class="help-link svelte-1u19yr2"><i class="fa-solid fa-circle-question"></i></a></div> <!> <textarea class="deck-textarea svelte-1u19yr2" placeholder="Enter deck text here"></textarea> <button class="button" style="align-self: flex-end;"><i class="fa-solid fa-upload"></i>&nbsp;
            Upload File</button></div> <div class="preview-container svelte-1u19yr2"><div class="section-title svelte-1u19yr2">Preview</div> <div class="info-issue-container svelte-1u19yr2"><!></div> <!></div> <div class="config-container svelte-1u19yr2"><div class="section-title svelte-1u19yr2">Config</div> <div class="config-items svelte-1u19yr2"><!> <!> <!></div></div> <div class="add-deck-container svelte-1u19yr2"><button class="button">Add Deck</button></div></div>`,1);function Tt(p,o){xe(o,!1);const k="customDeckInput";let i=new je,w=new qe(i),g=A(""),c=A(Se),m=A(0),$=A([]),U=A(!1),I=A(S.Simple),z=A(1),K=A(0);function u(){Ne(K)}function l(){window.localStorage.setItem(k,e(g));const t=C();t&&D(c,{...e(c),...t}),u()}function C(){switch(e(I)){case S.Simple:return w.parseSimple(e(g));case S.AnkiText:return w.parseAnkiText(e(g),e(z))}}async function h(){const t=await i.fileManager.upload();if(t===null||typeof t.data!="string"){window.alert("Failed to upload file.");return}D(g,t.data),l()}async function W(){if(e(c).name.trim()===""){window.alert("Deck name cannot be empty.");return}if(e(m)>0&&!window.confirm("You have issues in your deck. Card with issues will be ignored. Are you sure you want to add this deck?"))return;const t=w.getDeckData(e(c));t.ignoredIds=e($),await i.addDeck(e(c).name,t),Ge(`${be}/`)}De(async()=>{const t=window.localStorage.getItem(k);t&&D(g,t),await i.init(),l(),i=i,await i.initProfile()&&l(),i=i}),Ae();var P=ut(),X=ke(P);Ue(X,{title:"Upload Custom Deck"});var O=a(X,2),G=r(O),E=a(r(G),2),M=r(E),F=a(r(M));T(()=>{e(I),ge(()=>{})}),F.__change=l;var B=r(F),Y={},y=a(B),b={};s(F),s(M);var N=a(M,2);s(E);var H=a(E,2);{var L=t=>{var v=it(),n=r(v),d=a(r(n));ie(d),d.__input=l,s(n),s(v),ne(d,()=>e(z),x=>D(z,x)),_(t,v)};q(H,t=>{e(I)===S.AnkiText&&t(L)})}var V=a(H,2);He(V),V.__input=l;var Te=a(V,2);Te.__click=h,s(G);var Q=a(G,2),ee=a(r(Q),2),Ee=r(ee);{var $e=t=>{var v=rt(),n=ke(v),d=r(n);s(n);var x=a(n,2);x.__click=[nt,U];var R=r(x,!0);s(x),T(()=>{j(d,`Found ${e(m)??""} issue(s)`),j(R,e(U)?"Show All":"Filter to Issues")}),_(t,v)},We=t=>{var v=ot();Le(2),_(t,v)};q(Ee,t=>{e(m)!=0?t($e):t(We,!1)})}s(ee);var Pe=a(ee,2);Re(Pe,()=>e(K),t=>{var v=lt(),n=r(v);st(n,{get deck(){return e(c)},get filterShowIssueOnly(){return e(U)},get issueCount(){return e(m)},set issueCount(d){D(m,d)},get issueIds(){return e($)},set issueIds(d){D($,d)},$$legacy:!0}),s(v),_(t,v)}),s(Q);var te=a(Q,2),ve=a(r(te),2),ue=r(ve);re(ue,{key:"deckName",children:(t,v)=>{var n=ct(),d=r(n);ie(d);var x=a(d,2);let R;s(n),T(ae=>R=Ce(x,1,"warning-text svelte-1u19yr2",null,R,ae),[()=>({hidden:e(c).name.trim()})],oe),ne(d,()=>e(c).name,ae=>se(c,e(c).name=ae)),_(t,n)},$$slots:{default:!0}});var pe=a(ue,2);re(pe,{key:"deckLanguage",children:(t,v)=>{var n=dt();T(()=>{e(c),ge(()=>{})});var d=r(n);d.value=d.__value="zh";var x=a(d);x.value=x.__value="yue",s(n),ye(n,()=>e(c).lang,R=>se(c,e(c).lang=R)),_(t,n)},$$slots:{default:!0}});var Oe=a(pe,2);re(Oe,{key:"deckEnableCustomDictionary",children:(t,v)=>{var n=vt();ie(n),n.__change=l,ze(n,()=>e(c).isEnableCustomDictionary,d=>se(c,e(c).isEnableCustomDictionary=d)),_(t,n)},$$slots:{default:!0}}),s(ve),s(te);var _e=a(te,2),Fe=r(_e);Fe.__click=W,s(_e),s(O),T(()=>{Y!==(Y=S.Simple)&&(B.value=(B.__value=S.Simple)??""),b!==(b=S.AnkiText)&&(y.value=(y.__value=S.AnkiText)??""),le(N,"href",`${be??""}/upload-custom-deck/help`)}),ye(F,()=>e(I),t=>D(I,t)),ne(V,()=>e(g),t=>D(g,t)),_(p,P),Ie()}he(["change","input","click"]);export{Tt as component};
