var rr=Object.defineProperty;var ir=(s,t,e)=>t in s?rr(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var bt=(s,t,e)=>ir(s,typeof t!="symbol"?t+"":t,e);import"../chunks/CWj6FrbW.js";import"../chunks/C9SiBo4C.js";import{d as Re,o as Ae,s as B}from"../chunks/C2FOGMiU.js";import{h as _e,B as sr,c as nr,aP as or,aQ as ar,A as hr,L as lr,K as cr,M as dr,U as ur,O as Ee,s as mt,a5 as _r,b as y,S as O,Z as m,_ as p,Y as b,g as h,V as at,W as M,X as Ie,T as ot,ag as Oe,P as $,Q as vr,R as gr,y as ve,d as H,aM as fr,a0 as kt}from"../chunks/XIoSnaTS.js";import{i as J}from"../chunks/DAhYkV_L.js";import{g as pr,e as Le,i as ze,T as ge,p as mr,A as kr,c as fe,h as wr,W as nt,j as Et}from"../chunks/WvndEMzX.js";import{s as Q}from"../chunks/new4gNWg.js";import{i as yr}from"../chunks/DEcBvPEb.js";import{p as Cr}from"../chunks/CbXtU1xg.js";import{b as Fe}from"../chunks/cjryQm_H.js";import{s as T,T as Sr}from"../chunks/DSL8OlOS.js";function pe(s,t,e){_e&&sr();var r=s,i=ur,n,a=nr()?or:ar;hr(()=>{a(i,i=t())&&(n&&lr(n),n=cr(()=>e(r)))}),_e&&(r=dr)}const Pr=({url:s})=>({deckId:s.searchParams.get("id")||"",isExtraStudy:s.searchParams.get("isExtraStudy")==="true",cardIds:s.searchParams.get("cardIds")||encodeURIComponent("[]")}),ss=Object.freeze(Object.defineProperty({__proto__:null,load:Pr},Symbol.toStringTag,{value:"Module"}));var Jt,te,ee;const ct=typeof window>"u"?global:window,He=ct.performance&&(()=>ct.performance.now())||(()=>Date.now()),re=((Jt=ct.requestAnimationFrame)===null||Jt===void 0?void 0:Jt.bind(ct))||(s=>setTimeout(()=>s(He()),1e3/60)),me=((te=ct.cancelAnimationFrame)===null||te===void 0?void 0:te.bind(ct))||clearTimeout;function Lt(s){return s[s.length-1]}const he=(s,t)=>s<0?t+s:s,br=(s,t)=>s[he(t,s.length)];function We(s,t){const e={...s};for(const r in t){const i=s[r],n=t[r];i!==n&&(i&&n&&typeof i=="object"&&typeof n=="object"&&!Array.isArray(n)?e[r]=We(i,n):e[r]=n)}return e}function Dr(s,t){const e=s.split("."),r={};let i=r;for(let n=0;n<e.length;n++){const a=n===e.length-1?t:{};i[e[n]]=a,i=a}return r}let ke=0;function $e(){return ke++,ke}function It(s){return s.reduce((e,r)=>r+e,0)/s.length}function G(s){const t=s.toUpperCase().trim();if(/^#([A-F0-9]{3}){1,2}$/.test(t)){let r=t.substring(1).split("");r.length===3&&(r=[r[0],r[0],r[1],r[1],r[2],r[2]]);const i=`${r.join("")}`;return{r:parseInt(i.slice(0,2),16),g:parseInt(i.slice(2,4),16),b:parseInt(i.slice(4,6),16),a:1}}const e=t.match(/^RGBA?\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d*\.?\d+))?\)$/);if(e)return{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10),a:parseFloat(e[4]||1,10)};throw new Error(`Invalid color: ${s}`)}const xr=s=>s.replace(/^\s+/,"").replace(/\s+$/,"");function $t(s,t){const e={};for(let r=0;r<t;r++)e[r]=s;return e}function Tr(s,t){const e={};for(let r=0;r<s;r++)e[r]=t(r);return e}const ie=((ee=ct.navigator)===null||ee===void 0?void 0:ee.userAgent)||"",Mr=ie.indexOf("MSIE ")>0||ie.indexOf("Trident/")>0||ie.indexOf("Edge/")>0,Be=()=>{};class Rr{constructor(t,e,r=Be){this._mutationChains=[],this._onStateChange=r,this.state={options:{drawingFadeDuration:e.drawingFadeDuration,drawingWidth:e.drawingWidth,drawingColor:G(e.drawingColor),strokeColor:G(e.strokeColor),outlineColor:G(e.outlineColor),radicalColor:G(e.radicalColor||e.strokeColor),highlightColor:G(e.highlightColor)},character:{main:{opacity:e.showCharacter?1:0,strokes:{}},outline:{opacity:e.showOutline?1:0,strokes:{}},highlight:{opacity:1,strokes:{}}},userStrokes:null};for(let i=0;i<t.strokes.length;i++)this.state.character.main.strokes[i]={opacity:1,displayPortion:1},this.state.character.outline.strokes[i]={opacity:1,displayPortion:1},this.state.character.highlight.strokes[i]={opacity:0,displayPortion:1}}overwriteOnStateChange(t){this._onStateChange=t}updateState(t){const e=We(this.state,t);this._onStateChange(e,this.state),this.state=e}run(t,e={}){const r=t.map(i=>i.scope);return this.cancelMutations(r),new Promise(i=>{const n={_isActive:!0,_index:0,_resolve:i,_mutations:t,_loop:e.loop,_scopes:r};this._mutationChains.push(n),this._run(n)})}_run(t){if(!t._isActive)return;const e=t._mutations;if(t._index>=e.length)if(t._loop)t._index=0;else{t._isActive=!1,this._mutationChains=this._mutationChains.filter(i=>i!==t),t._resolve({canceled:!1});return}t._mutations[t._index].run(this).then(()=>{t._isActive&&(t._index++,this._run(t))})}_getActiveMutations(){return this._mutationChains.map(t=>t._mutations[t._index])}pauseAll(){this._getActiveMutations().forEach(t=>t.pause())}resumeAll(){this._getActiveMutations().forEach(t=>t.resume())}cancelMutations(t){for(const e of this._mutationChains)for(const r of e._scopes)for(const i of t)(r.startsWith(i)||i.startsWith(r))&&this._cancelMutationChain(e)}cancelAll(){this.cancelMutations([""])}_cancelMutationChain(t){var e;t._isActive=!1;for(let r=t._index;r<t._mutations.length;r++)t._mutations[r].cancel(this);(e=t._resolve)===null||e===void 0||e.call(t,{canceled:!0}),this._mutationChains=this._mutationChains.filter(r=>r!==t)}}const dt=(s,t)=>({x:s.x-t.x,y:s.y-t.y}),zt=s=>Math.sqrt(Math.pow(s.x,2)+Math.pow(s.y,2)),q=(s,t)=>zt(dt(s,t)),Ar=(s,t)=>s.x===t.x&&s.y===t.y,oe=(s,t=1)=>{const e=t*10;return{x:Math.round(e*s.x)/e,y:Math.round(e*s.y)/e}},le=s=>{let t=s[0];return s.slice(1).reduce((r,i)=>{const n=q(i,t);return t=i,r+n},0)},Er=(s,t)=>(s.x*t.x+s.y*t.y)/zt(s)/zt(t),ce=(s,t,e)=>{const r=dt(t,s),i=e/zt(r);return{x:t.x+i*r.x,y:t.y+i*r.y}},Ir=(s,t)=>{const e=s.length>=t.length?s:t,r=s.length>=t.length?t:s,i=(a,o,c,l)=>{if(a===0&&o===0)return q(e[0],r[0]);if(a>0&&o===0)return Math.max(c[0],q(e[a],r[0]));const u=l[l.length-1];return a===0&&o>0?Math.max(u,q(e[0],r[o])):Math.max(Math.min(c[o],c[o-1],u),q(e[a],r[o]))};let n=[];for(let a=0;a<e.length;a++){const o=[];for(let c=0;c<r.length;c++)o.push(i(a,c,n,o));n=o}return n[r.length-1]},Or=(s,t=.05)=>{const e=s.slice(0,1);for(const r of s.slice(1)){const i=e[e.length-1],n=q(r,i);if(n>t){const a=Math.ceil(n/t),o=n/a;for(let c=0;c<a;c++)e.push(ce(r,i,-1*o*(c+1)))}else e.push(r)}return e},Lr=(s,t=30)=>{const r=le(s)/(t-1),i=[s[0]],n=Lt(s),a=s.slice(1);for(let o=0;o<t-2;o++){let c=Lt(i),l=r,u=!1;for(;!u;){const d=q(c,a[0]);if(d<l)l-=d,c=a.shift();else{const v=ce(c,a[0],l-d);i.push(v),u=!0}}}return i.push(n),i},we=s=>{const t=Lr(s),e=It(t.map(c=>c.x)),r=It(t.map(c=>c.y)),i={x:e,y:r},n=t.map(c=>dt(c,i)),a=Math.sqrt(It([Math.pow(n[0].x,2)+Math.pow(n[0].y,2),Math.pow(Lt(n).x,2)+Math.pow(Lt(n).y,2)])),o=n.map(c=>({x:c.x/a,y:c.y/a}));return Or(o)},zr=(s,t)=>s.map(e=>({x:Math.cos(t)*e.x-Math.sin(t)*e.y,y:Math.sin(t)*e.x+Math.cos(t)*e.y})),Fr=s=>{if(s.length<3)return s;const t=[s[0],s[1]];return s.slice(2).forEach(e=>{const r=t.length,i=dt(e,t[r-1]),n=dt(t[r-1],t[r-2]);i.y*n.x-i.x*n.y===0&&t.pop(),t.push(e)}),t};function de(s,t=!1){const e=oe(s[0]),r=s.slice(1);let i=`M ${e.x} ${e.y}`;return r.forEach(n=>{const a=oe(n);i+=` L ${a.x} ${a.y}`}),t&&(i+="Z"),i}const qe=(s,t)=>{const e=Fr(s);if(e.length<2)return e;const r=e[1],i=e[0],n=ce(r,i,t),a=e.slice(1);return a.unshift(n),a};class Hr{constructor(t,e,r,i=!1){this.path=t,this.points=e,this.strokeNum=r,this.isInRadical=i}getStartingPoint(){return this.points[0]}getEndingPoint(){return this.points[this.points.length-1]}getLength(){return le(this.points)}getVectors(){let t=this.points[0];return this.points.slice(1).map(r=>{const i=dt(r,t);return t=r,i})}getDistance(t){const e=this.points.map(r=>q(r,t));return Math.min(...e)}getAverageDistance(t){return t.reduce((r,i)=>r+this.getDistance(i),0)/t.length}}class Wr{constructor(t,e){this.symbol=t,this.strokes=e}}function $r({radStrokes:s,strokes:t,medians:e}){const r=i=>{var n;return((n=s==null?void 0:s.indexOf(i))!==null&&n!==void 0?n:-1)>=0};return t.map((i,n)=>{const a=e[n].map(o=>{const[c,l]=o;return{x:c,y:l}});return new Hr(i,a,n,r(n))})}function Br(s,t){const e=$r(t);return new Wr(s,e)}const qr=[{x:0,y:-124},{x:1024,y:900}],[Ft,je]=qr,ye=je.x-Ft.x,Ce=je.y-Ft.y;class Se{constructor(t){const{padding:e,width:r,height:i}=t;this.padding=e,this.width=r,this.height=i;const n=r-2*e,a=i-2*e,o=n/ye,c=a/Ce;this.scale=Math.min(o,c);const l=e+(n-this.scale*ye)/2,u=e+(a-this.scale*Ce)/2;this.xOffset=-1*Ft.x*this.scale+l,this.yOffset=-1*Ft.y*this.scale+u}convertExternalPoint(t){const e=(t.x-this.xOffset)/this.scale,r=(this.height-this.yOffset-t.y)/this.scale;return{x:e,y:r}}}const jr=0,Pe=250,Ur=.4,Nr=.35;function Vr(s,t,e,r={}){const i=t.strokes,n=Zr(s.points);if(n.length<2)return{isMatch:!1,meta:{isStrokeBackwards:!1}};const{isMatch:a,meta:o,avgDist:c}=Ot(n,i[e],r);if(!a)return{isMatch:a,meta:o};const l=i.slice(e+1);let u=c;for(let d=0;d<l.length;d++){const{isMatch:v,avgDist:w}=Ot(n,l[d],{...r,checkBackwards:!1});v&&w<u&&(u=w)}if(u<c){const d=.6*(u+c)/(2*c),{isMatch:v,meta:w}=Ot(n,i[e],{...r,leniency:(r.leniency||1)*d});return{isMatch:v,meta:w}}return{isMatch:a,meta:o}}const Qr=(s,t,e)=>{const r=q(t.getStartingPoint(),s[0]),i=q(t.getEndingPoint(),s[s.length-1]);return r<=Pe*e&&i<=Pe*e},Gr=s=>{const t=[];let e=s[0];return s.slice(1).forEach(r=>{t.push(dt(r,e)),e=r}),t},Yr=(s,t)=>{const e=Gr(s),r=t.getVectors(),i=e.map(a=>{const o=r.map(c=>Er(c,a));return Math.max(...o)});return It(i)>jr},Xr=(s,t,e)=>e*(le(s)+25)/(t.getLength()+25)>=Nr,Zr=s=>{if(s.length<2)return s;const[t,...e]=s,r=[t];for(const i of e)Ar(i,r[r.length-1])||r.push(i);return r},Kr=[Math.PI/16,Math.PI/32,0,-1*Math.PI/32,-1*Math.PI/16],Jr=(s,t,e)=>{const r=we(s),i=we(t);let n=1/0;return Kr.forEach(a=>{const o=Ir(r,zr(i,a));o<n&&(n=o)}),n<=Ur*e},Ot=(s,t,e)=>{const{leniency:r=1,isOutlineVisible:i=!1,checkBackwards:n=!0,averageDistanceThreshold:a=350}=e,o=t.getAverageDistance(s),c=i||t.strokeNum>0?.5:1,l=o<=a*c*r;if(!l)return{isMatch:!1,avgDist:o,meta:{isStrokeBackwards:!1}};const u=Qr(s,t,r),d=Yr(s,t),v=Jr(s,t.points,r),w=Xr(s,t,r),C=l&&u&&d&&v&&w;return n&&!C&&Ot([...s].reverse(),t,{...e,checkBackwards:!1}).isMatch?{isMatch:C,avgDist:o,meta:{isStrokeBackwards:!0}}:{isMatch:C,avgDist:o,meta:{isStrokeBackwards:!1}}};class ti{constructor(t,e,r){this.id=t,this.points=[e],this.externalPoints=[r]}appendPoint(t,e){this.points.push(t),this.externalPoints.push(e)}}class ei{constructor(t){this._duration=t,this._startTime=null,this._paused=!1,this.scope=`delay.${t}`}run(){return this._startTime=He(),this._runningPromise=new Promise(t=>{this._resolve=t,this._timeout=setTimeout(()=>this.cancel(),this._duration)}),this._runningPromise}pause(){if(this._paused)return;const t=performance.now()-(this._startTime||0);this._duration=Math.max(0,this._duration-t),clearTimeout(this._timeout),this._paused=!0}resume(){this._paused&&(this._startTime=performance.now(),this._timeout=setTimeout(()=>this.cancel(),this._duration),this._paused=!1)}cancel(){clearTimeout(this._timeout),this._resolve&&this._resolve(),this._resolve=void 0}}class k{constructor(t,e,r={}){this._tick=i=>{if(this._startPauseTime!==null)return;const n=Math.min(1,(i-this._startTime-this._pausedDuration)/this._duration);if(n===1)this._renderState.updateState(this._values),this._frameHandle=void 0,this.cancel(this._renderState);else{const a=ri(n),o=Ue(this._startState,this._values,a);this._renderState.updateState(o),this._frameHandle=re(this._tick)}},this.scope=t,this._valuesOrCallable=e,this._duration=r.duration||0,this._force=r.force,this._pausedDuration=0,this._startPauseTime=null}run(t){return this._values||this._inflateValues(t),this._duration===0&&t.updateState(this._values),this._duration===0||Ne(t.state,this._values)?Promise.resolve():(this._renderState=t,this._startState=t.state,this._startTime=performance.now(),this._frameHandle=re(this._tick),new Promise(e=>{this._resolve=e}))}_inflateValues(t){let e=this._valuesOrCallable;typeof this._valuesOrCallable=="function"&&(e=this._valuesOrCallable(t.state)),this._values=Dr(this.scope,e)}pause(){this._startPauseTime===null&&(this._frameHandle&&me(this._frameHandle),this._startPauseTime=performance.now())}resume(){this._startPauseTime!==null&&(this._frameHandle=re(this._tick),this._pausedDuration+=performance.now()-this._startPauseTime,this._startPauseTime=null)}cancel(t){var e;(e=this._resolve)===null||e===void 0||e.call(this),this._resolve=void 0,me(this._frameHandle||-1),this._frameHandle=void 0,this._force&&(this._values||this._inflateValues(t),t.updateState(this._values))}}k.Delay=ei;function Ue(s,t,e){const r={};for(const i in t){const n=t[i],a=s==null?void 0:s[i];typeof a=="number"&&typeof n=="number"&&n>=0?r[i]=e*(n-a)+a:r[i]=Ue(a,n,e)}return r}function Ne(s,t){for(const e in t){const r=t[e],i=s==null?void 0:s[e];if(r>=0){if(r!==i)return!1}else if(!Ne(i,r))return!1}return!0}const ri=s=>-Math.cos(s*Math.PI)/2+.5,Ve=(s,t,e)=>[new k(`character.${s}.strokes`,$t({opacity:1,displayPortion:1},t.strokes.length),{duration:e,force:!0})],ae=(s,t,e)=>[new k(`character.${s}`,{opacity:1,strokes:$t({opacity:1,displayPortion:1},t.strokes.length)},{duration:e,force:!0})],wt=(s,t,e)=>[new k(`character.${s}.opacity`,0,{duration:e,force:!0}),...Ve(s,t,0)],be=(s,t,e)=>[new k(`options.${s}`,t,{duration:e})],Qe=(s,t,e)=>{const r=s.strokeNum,i=(s.getLength()+600)/(3*e);return[new k("options.highlightColor",t),new k("character.highlight",{opacity:1,strokes:{[r]:{displayPortion:0,opacity:0}}}),new k(`character.highlight.strokes.${r}`,{displayPortion:1,opacity:1},{duration:i}),new k(`character.highlight.strokes.${r}.opacity`,0,{duration:i,force:!0})]},Ge=(s,t,e)=>{const r=t.strokeNum,i=(t.getLength()+600)/(3*e);return[new k(`character.${s}`,{opacity:1,strokes:{[r]:{displayPortion:0,opacity:1}}}),new k(`character.${s}.strokes.${r}.displayPortion`,1,{duration:i})]},ii=(s,t,e,r)=>{const i=a=>{const o=a.character[s],c={opacity:1,strokes:{}};for(let l=0;l<t.strokes.length;l++)c.strokes[l]={opacity:o.opacity*o.strokes[l].opacity};return c},n=t.strokes[e];return[new k(`character.${s}`,i),...Ge(s,n,r)]},si=(s,t,e)=>[new k(`character.${s}.strokes.${t}`,{displayPortion:1,opacity:1},{duration:e,force:!0})],Ye=(s,t,e,r,i)=>{let n=wt(s,t,e);return n=n.concat(Ve(s,t,0)),n.push(new k(`character.${s}`,{opacity:1,strokes:$t({opacity:0},t.strokes.length)},{force:!0})),t.strokes.forEach((a,o)=>{o>0&&n.push(new k.Delay(i)),n=n.concat(Ge(s,a,r))}),n},ni=(s,t,e,r,i,n)=>{const a=Ye(s,t,e,r,i);return a.push(new k.Delay(n)),a},oi=(s,t,e)=>[...wt("main",s,t),new k("character.highlight",{opacity:1,strokes:$t({opacity:0},s.strokes.length)},{force:!0}),new k("character.main",{opacity:1,strokes:Tr(s.strokes.length,r=>({opacity:r<e?1:0}))},{force:!0})],ai=(s,t)=>[new k("quiz.activeUserStrokeId",s,{force:!0}),new k(`userStrokes.${s}`,{points:[t],opacity:1},{force:!0})],hi=(s,t)=>[new k(`userStrokes.${s}.points`,t,{force:!0})],li=(s,t)=>[new k(`userStrokes.${s}.opacity`,0,{duration:t})],De=s=>(s==null?void 0:s.map(t=>new k(`userStrokes.${t}`,null,{force:!0})))||[],ci=(s,t,e)=>[new k("options.highlightColor",t),...wt("highlight",s),...ae("highlight",s,e/2),...wt("highlight",s,e/2)],di=s=>({pathString:de(s.externalPoints),points:s.points.map(t=>oe(t))});class ui{constructor(t,e,r){this._currentStrokeIndex=0,this._mistakesOnStroke=0,this._totalMistakes=0,this._character=t,this._renderState=e,this._isActive=!1,this._positioner=r}startQuiz(t){this._userStrokesIds&&this._renderState.run(De(this._userStrokesIds)),this._userStrokesIds=[],this._isActive=!0,this._options=t;const e=he(t.quizStartStrokeNum,this._character.strokes.length);return this._currentStrokeIndex=Math.min(e,this._character.strokes.length-1),this._mistakesOnStroke=0,this._totalMistakes=0,this._renderState.run(oi(this._character,t.strokeFadeDuration,this._currentStrokeIndex))}startUserStroke(t){var e;if(!this._isActive)return null;if(this._userStroke)return this.endUserStroke();const r=this._positioner.convertExternalPoint(t),i=$e();return this._userStroke=new ti(i,r,t),(e=this._userStrokesIds)===null||e===void 0||e.push(i),this._renderState.run(ai(i,r))}continueUserStroke(t){if(!this._userStroke)return Promise.resolve();const e=this._positioner.convertExternalPoint(t);this._userStroke.appendPoint(e,t);const r=this._userStroke.points.slice(0);return this._renderState.run(hi(this._userStroke.id,r))}setPositioner(t){this._positioner=t}endUserStroke(){var t;if(!this._userStroke)return;if(this._renderState.run(li(this._userStroke.id,(t=this._options.drawingFadeDuration)!==null&&t!==void 0?t:300)),this._userStroke.points.length===1){this._userStroke=void 0;return}const{acceptBackwardsStrokes:e,markStrokeCorrectAfterMisses:r}=this._options,i=this._getCurrentStroke(),{isMatch:n,meta:a}=Vr(this._userStroke,this._character,this._currentStrokeIndex,{isOutlineVisible:this._renderState.state.character.outline.opacity>0,leniency:this._options.leniency,averageDistanceThreshold:this._options.averageDistanceThreshold}),o=r&&this._mistakesOnStroke+1>=r;if(n||o||a.isStrokeBackwards&&e)this._handleSuccess(a);else{this._handleFailure(a);const{showHintAfterMisses:l,highlightColor:u,strokeHighlightSpeed:d}=this._options;l!==!1&&this._mistakesOnStroke>=l&&this._renderState.run(Qe(i,G(u),d))}this._userStroke=void 0}cancel(){this._isActive=!1,this._userStrokesIds&&this._renderState.run(De(this._userStrokesIds))}_getStrokeData({isCorrect:t,meta:e}){return{character:this._character.symbol,strokeNum:this._currentStrokeIndex,mistakesOnStroke:this._mistakesOnStroke,totalMistakes:this._totalMistakes,strokesRemaining:this._character.strokes.length-this._currentStrokeIndex-(t?1:0),drawnPath:di(this._userStroke),isBackwards:e.isStrokeBackwards}}nextStroke(){if(!this._options)return;const{strokes:t,symbol:e}=this._character,{onComplete:r,highlightOnComplete:i,strokeFadeDuration:n,highlightCompleteColor:a,highlightColor:o,strokeHighlightDuration:c}=this._options;let l=si("main",this._currentStrokeIndex,n);this._mistakesOnStroke=0,this._currentStrokeIndex+=1,this._currentStrokeIndex===t.length&&(this._isActive=!1,r==null||r({character:e,totalMistakes:this._totalMistakes}),i&&(l=l.concat(ci(this._character,G(a||o),(c||0)*2)))),this._renderState.run(l)}_handleSuccess(t){if(!this._options)return;const{onCorrectStroke:e}=this._options;e==null||e({...this._getStrokeData({isCorrect:!0,meta:t})}),this.nextStroke()}_handleFailure(t){var e,r;this._mistakesOnStroke+=1,this._totalMistakes+=1,(e=(r=this._options).onMistake)===null||e===void 0||e.call(r,this._getStrokeData({isCorrect:!1,meta:t}))}_getCurrentStroke(){return this._character.strokes[this._currentStrokeIndex]}}function ht(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function tt(s,t,e){s.setAttributeNS(null,t,e)}function Ht(s,t){Object.keys(t).forEach(e=>tt(s,e,t[e]))}function _i(s){let t="";return window.location&&window.location.href&&(t=window.location.href.replace(/#[^#]*$/,"").replace(/"/gi,"%22")),`url("${t}#${s}")`}function Xe(s){var t;s==null||(t=s.parentNode)===null||t===void 0||t.removeChild(s)}class lt{constructor(t){this.stroke=t,this._pathLength=t.getLength()+lt.STROKE_WIDTH/2}_getStrokeDashoffset(t){return this._pathLength*.999*(1-t)}_getColor({strokeColor:t,radicalColor:e}){return e&&this.stroke.isInRadical?e:t}}lt.STROKE_WIDTH=200;const xe=200;class vi extends lt{constructor(t){super(t),this._oldProps=void 0}mount(t){this._animationPath=ht("path"),this._clip=ht("clipPath"),this._strokePath=ht("path");const e=`mask-${$e()}`;tt(this._clip,"id",e),tt(this._strokePath,"d",this.stroke.path),this._animationPath.style.opacity="0",tt(this._animationPath,"clip-path",_i(e));const r=qe(this.stroke.points,xe/2);return tt(this._animationPath,"d",de(r)),Ht(this._animationPath,{stroke:"#FFFFFF","stroke-width":xe.toString(),fill:"none","stroke-linecap":"round","stroke-linejoin":"miter","stroke-dasharray":`${this._pathLength},${this._pathLength}`}),this._clip.appendChild(this._strokePath),t.defs.appendChild(this._clip),t.svg.appendChild(this._animationPath),this}render(t){var e,r;if(t===this._oldProps||!this._animationPath)return;t.displayPortion!==((e=this._oldProps)===null||e===void 0?void 0:e.displayPortion)&&(this._animationPath.style.strokeDashoffset=this._getStrokeDashoffset(t.displayPortion).toString());const i=this._getColor(t);if(!this._oldProps||i!==this._getColor(this._oldProps)){const{r:n,g:a,b:o,a:c}=i;Ht(this._animationPath,{stroke:`rgba(${n},${a},${o},${c})`})}t.opacity!==((r=this._oldProps)===null||r===void 0?void 0:r.opacity)&&(this._animationPath.style.opacity=t.opacity.toString()),this._oldProps=t}}class se{constructor(t){this._oldProps=void 0,this._strokeRenderers=t.strokes.map(e=>new vi(e))}mount(t){const e=t.createSubRenderTarget();this._group=e.svg,this._strokeRenderers.forEach(r=>{r.mount(e)})}render(t){var e,r;if(t===this._oldProps||!this._group)return;const{opacity:i,strokes:n,strokeColor:a,radicalColor:o=null}=t;if(i!==((e=this._oldProps)===null||e===void 0?void 0:e.opacity)&&(this._group.style.opacity=i.toString(),!Mr)){var c;i===0?this._group.style.display="none":((c=this._oldProps)===null||c===void 0?void 0:c.opacity)===0&&this._group.style.removeProperty("display")}const l=!this._oldProps||a!==this._oldProps.strokeColor||o!==this._oldProps.radicalColor;if(l||n!==((r=this._oldProps)===null||r===void 0?void 0:r.strokes))for(let d=0;d<this._strokeRenderers.length;d++){var u;!l&&(u=this._oldProps)!==null&&u!==void 0&&u.strokes&&n[d]===this._oldProps.strokes[d]||this._strokeRenderers[d].render({strokeColor:a,radicalColor:o,opacity:n[d].opacity,displayPortion:n[d].displayPortion})}this._oldProps=t}}class gi{constructor(){this._oldProps=void 0}mount(t){this._path=ht("path"),t.svg.appendChild(this._path)}render(t){var e,r,i,n;if(!(!this._path||t===this._oldProps)){if(t.strokeColor!==((e=this._oldProps)===null||e===void 0?void 0:e.strokeColor)||t.strokeWidth!==((r=this._oldProps)===null||r===void 0?void 0:r.strokeWidth)){const{r:a,g:o,b:c,a:l}=t.strokeColor;Ht(this._path,{fill:"none",stroke:`rgba(${a},${o},${c},${l})`,"stroke-width":t.strokeWidth.toString(),"stroke-linecap":"round","stroke-linejoin":"round"})}t.opacity!==((i=this._oldProps)===null||i===void 0?void 0:i.opacity)&&tt(this._path,"opacity",t.opacity.toString()),t.points!==((n=this._oldProps)===null||n===void 0?void 0:n.points)&&tt(this._path,"d",de(t.points)),this._oldProps=t}}destroy(){Xe(this._path)}}class fi{constructor(t,e){this._character=t,this._positioner=e,this._mainCharRenderer=new se(t),this._outlineCharRenderer=new se(t),this._highlightCharRenderer=new se(t),this._userStrokeRenderers={}}mount(t){const e=t.createSubRenderTarget(),r=e.svg,{xOffset:i,yOffset:n,height:a,scale:o}=this._positioner;tt(r,"transform",`translate(${i}, ${a-n}) scale(${o}, ${-1*o})`),this._outlineCharRenderer.mount(e),this._mainCharRenderer.mount(e),this._highlightCharRenderer.mount(e),this._positionedTarget=e}render(t){const{main:e,outline:r,highlight:i}=t.character,{outlineColor:n,radicalColor:a,highlightColor:o,strokeColor:c,drawingWidth:l,drawingColor:u}=t.options;this._outlineCharRenderer.render({opacity:r.opacity,strokes:r.strokes,strokeColor:n}),this._mainCharRenderer.render({opacity:e.opacity,strokes:e.strokes,strokeColor:c,radicalColor:a}),this._highlightCharRenderer.render({opacity:i.opacity,strokes:i.strokes,strokeColor:o});const d=t.userStrokes||{};for(const w in this._userStrokeRenderers)if(!d[w]){var v;(v=this._userStrokeRenderers[w])===null||v===void 0||v.destroy(),delete this._userStrokeRenderers[w]}for(const w in d){const C=d[w];if(!C)continue;const A={strokeWidth:l,strokeColor:u,...C};(()=>{if(this._userStrokeRenderers[w])return this._userStrokeRenderers[w];const z=new gi;return z.mount(this._positionedTarget),this._userStrokeRenderers[w]=z,z})().render(A)}}destroy(){Xe(this._positionedTarget.svg),this._positionedTarget.defs.innerHTML=""}}class Ze{constructor(t){this.node=t}addPointerStartListener(t){this.node.addEventListener("mousedown",e=>{t(this._eventify(e,this._getMousePoint))}),this.node.addEventListener("touchstart",e=>{t(this._eventify(e,this._getTouchPoint))})}addPointerMoveListener(t){this.node.addEventListener("mousemove",e=>{t(this._eventify(e,this._getMousePoint))}),this.node.addEventListener("touchmove",e=>{t(this._eventify(e,this._getTouchPoint))})}addPointerEndListener(t){document.addEventListener("mouseup",t),document.addEventListener("touchend",t)}getBoundingClientRect(){return this.node.getBoundingClientRect()}updateDimensions(t,e){this.node.setAttribute("width",`${t}`),this.node.setAttribute("height",`${e}`)}_eventify(t,e){return{getPoint:()=>e.call(this,t),preventDefault:()=>t.preventDefault()}}_getMousePoint(t){const{left:e,top:r}=this.getBoundingClientRect(),i=t.clientX-e,n=t.clientY-r;return{x:i,y:n}}_getTouchPoint(t){const{left:e,top:r}=this.getBoundingClientRect(),i=t.touches[0].clientX-e,n=t.touches[0].clientY-r;return{x:i,y:n}}}class Wt extends Ze{constructor(t,e){super(t),this.svg=t,this.defs=e,"createSVGPoint"in t&&(this._pt=t.createSVGPoint())}static init(t,e="100%",r="100%"){const i=typeof t=="string"?document.getElementById(t):t;if(!i)throw new Error(`HanziWriter target element not found: ${t}`);const n=i.nodeName.toUpperCase(),a=(()=>{if(n==="SVG"||n==="G")return i;{const c=ht("svg");return i.appendChild(c),c}})();Ht(a,{width:e,height:r});const o=ht("defs");return a.appendChild(o),new Wt(a,o)}createSubRenderTarget(){const t=ht("g");return this.svg.appendChild(t),new Wt(t,this.defs)}_getMousePoint(t){if(this._pt&&(this._pt.x=t.clientX,this._pt.y=t.clientY,"getScreenCTM"in this.node)){var e;const r=this._pt.matrixTransform((e=this.node.getScreenCTM())===null||e===void 0?void 0:e.inverse());return{x:r.x,y:r.y}}return super._getMousePoint.call(this,t)}_getTouchPoint(t){if(this._pt&&(this._pt.x=t.touches[0].clientX,this._pt.y=t.touches[0].clientY,"getScreenCTM"in this.node)){var e;const r=this._pt.matrixTransform((e=this.node.getScreenCTM())===null||e===void 0?void 0:e.inverse());return{x:r.x,y:r.y}}return super._getTouchPoint(t)}}var pi={HanziWriterRenderer:fi,createRenderTarget:Wt.init};const Ke=(s,t)=>{s.beginPath();const e=t[0],r=t.slice(1);s.moveTo(e.x,e.y);for(const i of r)s.lineTo(i.x,i.y);s.stroke()},mi=s=>{const t=s.split(/(^|\s+)(?=[A-Z])/).filter(r=>r!==" "),e=[r=>r.beginPath()];for(const r of t){const[i,...n]=r.split(/\s+/),a=n.map(o=>parseFloat(o));i==="M"?e.push(o=>o.moveTo(...a)):i==="L"?e.push(o=>o.lineTo(...a)):i==="C"?e.push(o=>o.bezierCurveTo(...a)):i==="Q"&&e.push(o=>o.quadraticCurveTo(...a))}return r=>e.forEach(i=>i(r))};class ki extends lt{constructor(t,e=!0){super(t),e&&Path2D?this._path2D=new Path2D(this.stroke.path):this._pathCmd=mi(this.stroke.path),this._extendedMaskPoints=qe(this.stroke.points,lt.STROKE_WIDTH/2)}render(t,e){if(e.opacity<.05)return;if(t.save(),this._path2D)t.clip(this._path2D);else{var r;(r=this._pathCmd)===null||r===void 0||r.call(this,t),t.globalAlpha=0,t.stroke(),t.clip()}const{r:i,g:n,b:a,a:o}=this._getColor(e),c=o===1?`rgb(${i},${n},${a})`:`rgb(${i},${n},${a},${o})`,l=this._getStrokeDashoffset(e.displayPortion);t.globalAlpha=e.opacity,t.strokeStyle=c,t.fillStyle=c,t.lineWidth=lt.STROKE_WIDTH,t.lineCap="round",t.lineJoin="round",t.setLineDash([this._pathLength,this._pathLength],l),t.lineDashOffset=l,Ke(t,this._extendedMaskPoints),t.restore()}}class ne{constructor(t){this._strokeRenderers=t.strokes.map(e=>new ki(e))}render(t,e){if(e.opacity<.05)return;const{opacity:r,strokeColor:i,radicalColor:n,strokes:a}=e;for(let o=0;o<this._strokeRenderers.length;o++)this._strokeRenderers[o].render(t,{strokeColor:i,radicalColor:n,opacity:a[o].opacity*r,displayPortion:a[o].displayPortion||0})}}function wi(s,t){if(t.opacity<.05)return;const{opacity:e,strokeWidth:r,strokeColor:i,points:n}=t,{r:a,g:o,b:c,a:l}=i;s.save(),s.globalAlpha=e,s.lineWidth=r,s.strokeStyle=`rgba(${a},${o},${c},${l})`,s.lineCap="round",s.lineJoin="round",Ke(s,n),s.restore()}class yi{constructor(t,e){this.destroy=Be,this._character=t,this._positioner=e,this._mainCharRenderer=new ne(t),this._outlineCharRenderer=new ne(t),this._highlightCharRenderer=new ne(t)}mount(t){this._target=t}_animationFrame(t){const{width:e,height:r,scale:i,xOffset:n,yOffset:a}=this._positioner,o=this._target.getContext();o.clearRect(0,0,e,r),o.save(),o.translate(n,r-a),o.transform(1,0,0,-1,0,0),o.scale(i,i),t(o),o.restore(),o.draw&&o.draw()}render(t){const{outline:e,main:r,highlight:i}=t.character,{outlineColor:n,strokeColor:a,radicalColor:o,highlightColor:c,drawingColor:l,drawingWidth:u}=t.options;this._animationFrame(d=>{this._outlineCharRenderer.render(d,{opacity:e.opacity,strokes:e.strokes,strokeColor:n}),this._mainCharRenderer.render(d,{opacity:r.opacity,strokes:r.strokes,strokeColor:a,radicalColor:o}),this._highlightCharRenderer.render(d,{opacity:i.opacity,strokes:i.strokes,strokeColor:c});const v=t.userStrokes||{};for(const w in v){const C=v[w];if(C){const A={strokeWidth:u,strokeColor:l,...C};wi(d,A)}}})}}class ue extends Ze{constructor(t){super(t)}static init(t,e="100%",r="100%"){const i=typeof t=="string"?document.getElementById(t):t;if(!i)throw new Error(`HanziWriter target element not found: ${t}`);const n=i.nodeName.toUpperCase(),a=(()=>{if(n==="CANVAS")return i;const o=document.createElement("canvas");return i.appendChild(o),o})();return a.setAttribute("width",e),a.setAttribute("height",r),new ue(a)}getContext(){return this.node.getContext("2d")}}var Ci={HanziWriterRenderer:yi,createRenderTarget:ue.init};const Si="2.0",Pi=s=>`https://cdn.jsdelivr.net/npm/hanzi-writer-data@${Si}/${s}.json`,bi=(s,t,e)=>{const r=new XMLHttpRequest;r.overrideMimeType&&r.overrideMimeType("application/json"),r.open("GET",Pi(s),!0),r.onerror=i=>{e(r,i)},r.onreadystatechange=()=>{r.readyState===4&&(r.status===200?t(JSON.parse(r.responseText)):r.status!==0&&e&&e(r))},r.send(null)},Te={charDataLoader:bi,onLoadCharDataError:null,onLoadCharDataSuccess:null,showOutline:!0,showCharacter:!0,renderer:"svg",width:0,height:0,padding:20,strokeAnimationSpeed:1,strokeFadeDuration:400,strokeHighlightDuration:200,strokeHighlightSpeed:2,delayBetweenStrokes:1e3,delayBetweenLoops:2e3,strokeColor:"#555",radicalColor:null,highlightColor:"#AAF",outlineColor:"#DDD",drawingColor:"#333",leniency:1,showHintAfterMisses:3,highlightOnComplete:!0,highlightCompleteColor:null,markStrokeCorrectAfterMisses:!1,acceptBackwardsStrokes:!1,quizStartStrokeNum:0,averageDistanceThreshold:350,drawingFadeDuration:300,drawingWidth:4,strokeWidth:2,outlineWidth:2,rendererOverride:{}};class Me{constructor(t){this._loadCounter=0,this._isLoading=!1,this.loadingFailed=!1,this._options=t}_debouncedLoad(t,e){const r=a=>{if(e===this._loadCounter){var o;(o=this._resolve)===null||o===void 0||o.call(this,a)}},i=a=>{if(e===this._loadCounter){var o;(o=this._reject)===null||o===void 0||o.call(this,a)}},n=this._options.charDataLoader(t,r,i);n&&("then"in n?n.then(r).catch(i):r(n))}_setupLoadingPromise(){return new Promise((t,e)=>{this._resolve=t,this._reject=e}).then(t=>{var e,r;return this._isLoading=!1,(e=(r=this._options).onLoadCharDataSuccess)===null||e===void 0||e.call(r,t),t}).catch(t=>{if(this._isLoading=!1,this.loadingFailed=!0,this._options.onLoadCharDataError){this._options.onLoadCharDataError(t);return}if(t instanceof Error)throw t;const e=new Error(`Failed to load char data for ${this._loadingChar}`);throw e.reason=t,e})}loadCharData(t){this._loadingChar=t;const e=this._setupLoadingPromise();return this.loadingFailed=!1,this._isLoading=!0,this._loadCounter++,this._debouncedLoad(t,this._loadCounter),e}}class et{constructor(t,e={}){const{HanziWriterRenderer:r,createRenderTarget:i}=e.renderer==="canvas"?Ci:pi,n=e.rendererOverride||{};this._renderer={HanziWriterRenderer:n.HanziWriterRenderer||r,createRenderTarget:n.createRenderTarget||i},this.target=this._renderer.createRenderTarget(t,e.width,e.height),this._options=this._assignOptions(e),this._loadingManager=new Me(this._options),this._setupListeners()}static create(t,e,r){const i=new et(t,r);return i.setCharacter(e),i}static loadCharacterData(t,e={}){const r=(()=>{const{_loadingManager:i,_loadingOptions:n}=et;return(i==null?void 0:i._loadingChar)===t&&n===e?i:new Me({...Te,...e})})();return et._loadingManager=r,et._loadingOptions=e,r.loadCharData(t)}static getScalingTransform(t,e,r=0){const i=new Se({width:t,height:e,padding:r});return{x:i.xOffset,y:i.yOffset,scale:i.scale,transform:xr(`
        translate(${i.xOffset}, ${i.height-i.yOffset})
        scale(${i.scale}, ${-1*i.scale})
      `).replace(/\s+/g," ")}}showCharacter(t={}){return this._options.showCharacter=!0,this._withData(()=>{var e;return(e=this._renderState)===null||e===void 0?void 0:e.run(ae("main",this._character,typeof t.duration=="number"?t.duration:this._options.strokeFadeDuration)).then(r=>{var i;return(i=t.onComplete)===null||i===void 0||i.call(t,r),r})})}hideCharacter(t={}){return this._options.showCharacter=!1,this._withData(()=>{var e;return(e=this._renderState)===null||e===void 0?void 0:e.run(wt("main",this._character,typeof t.duration=="number"?t.duration:this._options.strokeFadeDuration)).then(r=>{var i;return(i=t.onComplete)===null||i===void 0||i.call(t,r),r})})}animateCharacter(t={}){return this.cancelQuiz(),this._withData(()=>{var e;return(e=this._renderState)===null||e===void 0?void 0:e.run(Ye("main",this._character,this._options.strokeFadeDuration,this._options.strokeAnimationSpeed,this._options.delayBetweenStrokes)).then(r=>{var i;return(i=t.onComplete)===null||i===void 0||i.call(t,r),r})})}animateStroke(t,e={}){return this.cancelQuiz(),this._withData(()=>{var r;return(r=this._renderState)===null||r===void 0?void 0:r.run(ii("main",this._character,he(t,this._character.strokes.length),this._options.strokeAnimationSpeed)).then(i=>{var n;return(n=e.onComplete)===null||n===void 0||n.call(e,i),i})})}highlightStroke(t,e={}){const r=()=>{if(!(!this._character||!this._renderState))return this._renderState.run(Qe(br(this._character.strokes,t),G(this._options.highlightColor),this._options.strokeHighlightSpeed)).then(i=>{var n;return(n=e.onComplete)===null||n===void 0||n.call(e,i),i})};return this._withData(r)}async loopCharacterAnimation(){return this.cancelQuiz(),this._withData(()=>this._renderState.run(ni("main",this._character,this._options.strokeFadeDuration,this._options.strokeAnimationSpeed,this._options.delayBetweenStrokes,this._options.delayBetweenLoops),{loop:!0}))}pauseAnimation(){return this._withData(()=>{var t;return(t=this._renderState)===null||t===void 0?void 0:t.pauseAll()})}resumeAnimation(){return this._withData(()=>{var t;return(t=this._renderState)===null||t===void 0?void 0:t.resumeAll()})}showOutline(t={}){return this._options.showOutline=!0,this._withData(()=>{var e;return(e=this._renderState)===null||e===void 0?void 0:e.run(ae("outline",this._character,typeof t.duration=="number"?t.duration:this._options.strokeFadeDuration)).then(r=>{var i;return(i=t.onComplete)===null||i===void 0||i.call(t,r),r})})}hideOutline(t={}){return this._options.showOutline=!1,this._withData(()=>{var e;return(e=this._renderState)===null||e===void 0?void 0:e.run(wt("outline",this._character,typeof t.duration=="number"?t.duration:this._options.strokeFadeDuration)).then(r=>{var i;return(i=t.onComplete)===null||i===void 0||i.call(t,r),r})})}updateDimensions({width:t,height:e,padding:r}){if(t!==void 0&&(this._options.width=t),e!==void 0&&(this._options.height=e),r!==void 0&&(this._options.padding=r),this.target.updateDimensions(this._options.width,this._options.height),this._character&&this._renderState&&this._hanziWriterRenderer&&this._positioner){this._hanziWriterRenderer.destroy();const i=this._initAndMountHanziWriterRenderer(this._character);this._renderState.overwriteOnStateChange(n=>i.render(n)),i.render(this._renderState.state),this._quiz&&this._quiz.setPositioner(this._positioner)}}updateColor(t,e,r={}){var i;let n=[];const a=t==="radicalColor"&&!e?this._options.strokeColor:e,o=G(a);this._options[t]=e;const c=(i=r.duration)!==null&&i!==void 0?i:this._options.strokeFadeDuration;return n=n.concat(be(t,o,c)),t==="radicalColor"&&!e&&(n=n.concat(be(t,null,0))),this._withData(()=>{var l;return(l=this._renderState)===null||l===void 0?void 0:l.run(n).then(u=>{var d;return(d=r.onComplete)===null||d===void 0||d.call(r,u),u})})}quiz(t={}){return this._withData(async()=>{this._character&&this._renderState&&this._positioner&&(this.cancelQuiz(),this._quiz=new ui(this._character,this._renderState,this._positioner),this._options={...this._options,...t},this._quiz.startQuiz(this._options))})}skipQuizStroke(){this._quiz&&this._quiz.nextStroke()}cancelQuiz(){this._quiz&&(this._quiz.cancel(),this._quiz=void 0)}setCharacter(t){return this.cancelQuiz(),this._char=t,this._hanziWriterRenderer&&this._hanziWriterRenderer.destroy(),this._renderState&&this._renderState.cancelAll(),this._hanziWriterRenderer=null,this._withDataPromise=this._loadingManager.loadCharData(t).then(e=>{if(!e||this._loadingManager.loadingFailed)return;this._character=Br(t,e),this._renderState=new Rr(this._character,this._options,i=>r.render(i));const r=this._initAndMountHanziWriterRenderer(this._character);r.render(this._renderState.state)}),this._withDataPromise}_initAndMountHanziWriterRenderer(t){const{width:e,height:r,padding:i}=this._options;this._positioner=new Se({width:e,height:r,padding:i});const n=new this._renderer.HanziWriterRenderer(t,this._positioner);return n.mount(this.target),this._hanziWriterRenderer=n,n}async getCharacterData(){if(!this._char)throw new Error("setCharacter() must be called before calling getCharacterData()");return await this._withData(()=>this._character)}_assignOptions(t){const e={...Te,...t};return t.strokeAnimationDuration&&!t.strokeAnimationSpeed&&(e.strokeAnimationSpeed=500/t.strokeAnimationDuration),t.strokeHighlightDuration&&!t.strokeHighlightSpeed&&(e.strokeHighlightSpeed=500/e.strokeHighlightDuration),t.highlightCompleteColor||(e.highlightCompleteColor=e.highlightColor),this._fillWidthAndHeight(e)}_fillWidthAndHeight(t){const e={...t};if(e.width&&!e.height)e.height=e.width;else if(e.height&&!e.width)e.width=e.height;else if(!e.width&&!e.height){const{width:r,height:i}=this.target.getBoundingClientRect(),n=Math.min(r,i);e.width=n,e.height=n}return e}_withData(t){if(this._loadingManager.loadingFailed)throw Error("Failed to load character data. Call setCharacter and try again.");return this._withDataPromise?this._withDataPromise.then(()=>{if(!this._loadingManager.loadingFailed)return t()}):Promise.resolve().then(t)}_setupListeners(){this.target.addPointerStartListener(t=>{this._quiz&&(t.preventDefault(),this._quiz.startUserStroke(t.getPoint()))}),this.target.addPointerMoveListener(t=>{this._quiz&&(t.preventDefault(),this._quiz.continueUserStroke(t.getPoint()))}),this.target.addPointerEndListener(()=>{var t;(t=this._quiz)===null||t===void 0||t.endUserStroke()})}}et._loadingManager=null;et._loadingOptions=null;class Di{constructor(t,e=!0){bt(this,"audios");bt(this,"currentIndex",0);bt(this,"isPlaying",!1);bt(this,"onEnded",this.handleEnded.bind(this));this.audios=t.map(r=>{const i=new Audio(r);return i.preload="auto",e&&i.load(),i})}handleEnded(){this.audios[this.currentIndex].removeEventListener("ended",this.onEnded),this.currentIndex++,this.currentIndex<this.audios.length?this.playCurrent():(this.isPlaying=!1,this.currentIndex=0)}playCurrent(){const t=this.audios[this.currentIndex];t.addEventListener("ended",this.onEnded),t.currentTime=0,t.play().catch(e=>{console.warn("Playback failed:",e),this.stop()})}play(){this.audios.length!==0&&(this.isPlaying&&this.stop(),this.isPlaying=!0,this.currentIndex=0,this.playCurrent())}stop(){if(!this.isPlaying)return;this.isPlaying=!1;const t=this.audios[this.currentIndex];t.pause(),t.currentTime=0,t.removeEventListener("ended",this.onEnded),this.currentIndex=0}}var xi=(s,t)=>t(),Ti=O('<button class="audio-button svelte-1vij5ww" aria-label="Play Audio"><i class="fa-solid fa-volume-low"></i></button>'),Mi=O('<span class="svelte-1vij5ww"> </span>'),Ri=O('<span class="empty-character-box svelte-1vij5ww">&#x3000;</span>'),Ai=O('<div>New Card</div> <div class="character-box-container svelte-1vij5ww"></div>',1),Ei=O('<div class="character-writer svelte-1vij5ww"><div class="meaning svelte-1vij5ww"> </div> <div><div class="reading svelte-1vij5ww"> </div> <!></div> <div class="character-container svelte-1vij5ww"><div class="grid-background svelte-1vij5ww"><svg xmlns="http://www.w3.org/2000/svg" id="grid-background-target"><line x1="0" y1="0"></line><line y1="0" x2="0"></line><line y1="0"></line><line x1="0"></line></svg></div> <div class="bottom-container svelte-1vij5ww"><!></div></div></div>');function Ii(s,t){var E;Ee(t,!0);let e=mt(500),r=mt(500),i="#DDD";const n=500,a=new Audio(`${Fe}/assets/sounds/correct-choice-43861.mp3`);let o=mt(_r([])),c=mt(!1),l=mt(!1);function u(){return parseFloat(getComputedStyle(document.documentElement).fontSize)}function d(){const _=u()*3*2;y(e,Math.min(document.documentElement.clientWidth-_,500),!0),y(r,h(e),!0)}let v=mt(0),w=(E=t.characterData)==null?void 0:E.meanings.join("; ");function C(_){for(const g of _)if(g.startsWith(ge))return mr(g.substring(ge.length))}function A(){var _;h(l)||(t.cardConfig.isFirstTime?(y(v,(h(v)+1)%t.characterData.characters.length),window.setTimeout(()=>{z(h(v))},n)):(a.play(),y(v,h(v)+1),h(v)==((_=t.characterData)==null?void 0:_.characters.length)?(t.onComplete(),y(c,!0),window.setTimeout(()=>{P()},n)):window.setTimeout(()=>{z(h(v))},n)))}let L;function z(_){if(h(l)||!t.characterData)return;L&&(t.cardConfig.isFirstTime||L.cancelQuiz(),L.hideCharacter());const g=C(t.characterData.tags[_]??[]);L=et.create("grid-background-target",t.characterData.characters[_],{width:h(e),height:h(r),padding:5,showCharacter:!1,showOutline:t.cardConfig.isFirstTime,highlightOnComplete:!1,strokeColor:t.app.getChineseToneColor(g)??"#555",onComplete:()=>{A()}}),t.cardConfig.isFirstTime?(setTimeout(()=>{P()},n),setTimeout(()=>{L.animateCharacter({onComplete:()=>{setTimeout(()=>{L.hideOutline(),L.hideCharacter(),A()},n)}})},n)):L.quiz()}function Bt(){var g;const _=(g=t.characterData)==null?void 0:g.audioUrl;console.log(_),_&&y(o,_.map(vt=>{const Z=vt.map(gt=>pr(t.cardConfig.lang,gt));return new Di(Z)}),!0)}function P(){const _=Math.floor(Math.random()*h(o).length),g=h(o)[_];g.stop(),g.play()}Ae(()=>(d(),Bt(),window.addEventListener("resize",d),z(0),()=>{y(l,!0),window.removeEventListener("resize",d)}));var Y=Ei(),j=m(Y),qt=m(j,!0);p(j);var ut=b(j,2);let Dt;var yt=m(ut),jt=m(yt,!0);p(yt);var Ut=b(yt,2);{var Nt=_=>{var g=Ti();g.__click=[xi,P],M(_,g)};J(Ut,_=>{h(o).length>0&&_(Nt)})}p(ut);var xt=b(ut,2),Ct=m(xt),rt=m(Ct),it=m(rt);T(it,"stroke",i);var st=b(it);T(st,"stroke",i);var X=b(st);T(X,"stroke",i);var _t=b(X);T(_t,"stroke",i),p(rt),p(Ct);var Tt=b(Ct,2),Vt=m(Tt);{var f=_=>{var g=Ai(),vt=ot(g);let Z;var gt=b(vt,2);Le(gt,21,()=>t.characterData.characters,ze,(ft,Mt,Qt)=>{var Rt=Oe(),Gt=ot(Rt);{var D=S=>{var R=Mi(),F=m(R,!0);p(R),at(()=>B(F,h(Mt))),M(S,R)},x=S=>{var R=Ri();M(S,R)};J(Gt,S=>{Qt<h(v)||t.cardConfig.isFirstTime?S(D):S(x,!1)})}M(ft,Rt)}),p(gt),at(ft=>Z=Q(vt,1,"new-element-indicator svelte-1vij5ww",null,Z,ft),[()=>({"is-hidden":!t.cardConfig.isFirstTime})]),M(_,g)};J(Vt,_=>{var g;(g=t.characterData)!=null&&g.characters&&_(f)})}p(Tt),p(xt),p(Y),at(_=>{var g;B(qt,w),Dt=Q(ut,1,"reading-container svelte-1vij5ww",null,Dt,_),B(jt,(g=t.characterData)==null?void 0:g.reading),T(rt,"width",h(e)),T(rt,"height",h(r)),T(it,"x2",h(e)),T(it,"y2",h(r)),T(st,"x1",h(e)),T(st,"y2",h(r)),T(X,"x1",h(e)/2),T(X,"x2",h(e)/2),T(X,"y2",h(r)),T(_t,"y1",h(r)/2),T(_t,"x2",h(e)),T(_t,"y2",h(r)/2)},[()=>({"is-hidden":!t.app.getConfig().zh.alwaysShowReading&&!h(c)&&!t.cardConfig.isFirstTime})]),M(s,Y),Ie()}Re(["click"]);var Oi=O("<div>You have done today's review.</div>"),Li=O('<div class="counter svelte-i879cr"><span class="underlined svelte-i879cr"><!></span></div>'),zi=O('<div class="counter svelte-i879cr"><span> </span> <span> </span> <span> </span> <span> </span></div>'),Fi=(s,t)=>t(),Hi=(s,t)=>t(),Wi=O(`<button class="review-button is-complete review-button-fail svelte-i879cr"><div class="review-button-inner svelte-i879cr"><div class="review-time svelte-i879cr">(Don't Learn)</div> <div class="review-label svelte-i879cr">Ignore</div></div></button> <div class="review-button svelte-i879cr"><div class="review-time svelte-i879cr">&nbsp;</div><div class="review-label svelte-i879cr">&nbsp;</div></div> <div class="review-button svelte-i879cr"><div class="review-time svelte-i879cr">&nbsp;</div><div class="review-label svelte-i879cr">&nbsp;</div></div> <button class="review-button is-complete review-button-easy svelte-i879cr"><div class="review-button-inner svelte-i879cr"><div class="review-time svelte-i879cr">&nbsp;</div> <div class="review-label svelte-i879cr">Learn</div></div></button>`,1),$i=(s,t)=>t(),Bi=(s,t)=>t(),qi=O('<button><div class="review-button-inner svelte-i879cr"><div class="review-time svelte-i879cr">(Put Back)</div> <div class="review-label svelte-i879cr">Again</div></div></button> <div class="review-button svelte-i879cr"><div class="review-time svelte-i879cr">&nbsp;</div><div class="review-label svelte-i879cr">&nbsp;</div></div> <div class="review-button svelte-i879cr"><div class="review-time svelte-i879cr">&nbsp;</div><div class="review-label svelte-i879cr">&nbsp;</div></div> <button><div class="review-button-inner svelte-i879cr"><div class="review-time svelte-i879cr">&nbsp;</div> <div class="review-label svelte-i879cr">Good</div></div></button>',1),ji=O('<button><div class="review-button-inner svelte-i879cr"><div class="review-time svelte-i879cr"> </div> <div class="review-label svelte-i879cr"> </div></div></button>'),Ui=O('<!> <div class="character-writer-container svelte-i879cr"><!></div> <div class="bottom-container svelte-i879cr"><div class="review-button-container svelte-i879cr"><!></div></div>',1),Ni=O('<!> <div class="container svelte-i879cr"><!> <!></div>',1);function ns(s,t){Ee(t,!1);const e=$();let r=Cr(t,"data",8),i=r().deckId||"",n=r().cardIds||encodeURIComponent("[]"),a=JSON.parse(decodeURIComponent(n)),o=r().isExtraStudy?"Extra Study":"Review",c=$(!1),l=$(new kr);Ae(async()=>{var f,E,_,g;await h(l).init(),z=(E=(f=h(l).deckData[i])==null?void 0:f.tags)==null?void 0:E.includes(fe.ZH_YUE),await w.init(z?"yue":"zh"),y(l,h(l)),L=(g=(_=h(l).deckData[i])==null?void 0:_.tags)==null?void 0:g.includes(fe.ZH_TRAD),y(c,!0),r().isExtraStudy&&h(l).extraStudyHandler.registerReviewCardIdsOverride(a),j()});let u=$(!1),d=$(!1),v=$(!1),w=new wr,C=$(void 0),A=$(!1),L=!1,z=!1;const Bt=["Fail","Hard","Good","Easy"];let P=$(void 0),Y=$({1:"",2:"",3:"",4:""});function j(){y(v,!0),y(u,!1),y(A,!1);const f=h(l).getNextCard(i);if(f===void 0){y(d,!0);return}h(l).getCard(i,f,!0)&&(y(v,!1),y(P,f),y(Y,h(l).getRatingScheduledTimeStr(i,f)),y(C,h(l).getWenbunCustomState(i,f)))}function qt(){y(A,!0),y(P,h(P)),y(Y,h(l).getRatingScheduledTimeStr(i,h(P)))}function ut(f){const E=h(l).getCardWord(i,f),_=h(l).getConfig();return w.getCharacterWriterData(E,{convertToTraditional:L,mandarinReading:_.zh.mandarinReading,isCantonese:z,isPlayAudio:_.zh.playAudio})}function Dt(f){return{isFirstTime:h(e),lang:z?"yue":"zh"}}function yt(){y(u,!0)}async function jt(f){h(l).rateCard(i,h(P),f),await h(l).save(),j()}function Ut(f){switch(f){case Et.Easy:return"review-button-easy";case Et.Good:return"review-button-good";case Et.Hard:return"review-button-hard";case Et.Again:return"review-button-fail"}}async function Nt(){h(l).addIgnoredMark(i,h(P)),await h(l).save(),j()}function xt(){h(l).extraStudyHandler.rateAgain(h(P)),j()}function Ct(){h(l).extraStudyHandler.rateGood(h(P)),j()}vr(()=>(h(C),h(A)),()=>{y(e,h(C)===nt.New&&!h(A))}),gr(),yr();var rt=Ni(),it=ot(rt);Sr(it,{get title(){return o},get backUrl(){return`${Fe??""}/`}});var st=b(it,2),X=m(st);{var _t=f=>{var E=Oi();M(f,E)};J(X,f=>{h(d)&&f(_t)})}var Tt=b(X,2);{var Vt=f=>{var E=Ui(),_=ot(E);{var g=D=>{var x=Li(),S=m(x),R=m(S);pe(R,()=>h(P),F=>{var I=fr();at(W=>B(I,W),[()=>(h(l),H(()=>h(l).extraStudyHandler.getCardsCount()||""))],kt),M(F,I)}),p(S),p(x),M(D,x)},vt=D=>{var x=zi(),S=m(x);let R;var F=m(S,!0);p(S);var I=b(S,2);let W;var pt=m(I,!0);p(I);var U=b(I,2);let N;var V=m(U,!0);p(U);var K=b(U,2);let St;var Pt=m(K,!0);p(K),p(x),at((Yt,At,Xt,Zt,Kt,Je,tr,er)=>{R=Q(S,1,"deck-count-learn-relearn svelte-i879cr",null,R,Yt),B(F,At),W=Q(I,1,"deck-count-review svelte-i879cr",null,W,Xt),B(pt,Zt),N=Q(U,1,"deck-count-new svelte-i879cr",null,N,Kt),B(V,Je),St=Q(K,1,"deck-count-previously-studied svelte-i879cr",null,St,tr),B(Pt,er)},[()=>({underlined:h(C)===nt.Learning||h(C)===nt.Relearning}),()=>(h(l),H(()=>h(l).getLearningRelearningCardsCount(i)||"")),()=>({underlined:h(C)===nt.ReviewYoung||h(C)===nt.ReviewMature}),()=>(h(l),H(()=>h(l).getScheduledReviewCardsCount(i)||"")),()=>({underlined:h(C)===nt.New}),()=>(h(l),H(()=>h(l).getScheduledNewCardsCount(i)||"")),()=>({underlined:h(C)===nt.PreviouslyStudied}),()=>(h(l),H(()=>h(l).getScheduledPreviouslyStudiedCardsCount(i)||""))],kt),M(D,x)};J(_,D=>{ve(r()),H(()=>r().isExtraStudy)?D(g):D(vt,!1)})}var Z=b(_,2),gt=m(Z);pe(gt,()=>[h(P),h(A),h(v)],D=>{const x=kt(()=>(h(P),H(()=>ut(h(P))))),S=kt(()=>(h(P),H(()=>Dt(h(P)))));Ii(D,{get app(){return h(l)},get characterData(){return h(x)},onComplete:()=>yt(),get cardConfig(){return h(S)}})}),p(Z);var ft=b(Z,2),Mt=m(ft),Qt=m(Mt);{var Rt=D=>{var x=Wi(),S=ot(x);S.__click=[Fi,Nt];var R=b(S,6);R.__click=[Hi,qt],M(D,x)},Gt=(D,x)=>{{var S=F=>{var I=qi(),W=ot(I);let pt;W.__click=[$i,xt];var U=b(W,6);let N;U.__click=[Bi,Ct],at((V,K)=>{pt=Q(W,1,"review-button is-complete review-button-fail svelte-i879cr",null,pt,V),N=Q(U,1,"review-button is-complete review-button-easy svelte-i879cr",null,N,K)},[()=>({"is-complete":h(u)}),()=>({"is-complete":h(u)})],kt),M(F,I)},R=F=>{var I=Oe(),W=ot(I);Le(W,1,()=>Bt,ze,(pt,U,N)=>{var V=ji();let K;V.__click=()=>jt(N+1);var St=m(V),Pt=m(St),Yt=m(Pt,!0);p(Pt);var At=b(Pt,2),Xt=m(At,!0);p(At),p(St),p(V),at((Zt,Kt)=>{K=Q(V,1,Zt,"svelte-i879cr",K,Kt),B(Yt,(h(Y),H(()=>h(Y)[N+1]))),B(Xt,h(U))},[()=>H(()=>`review-button ${Ut(N+1)}`),()=>({"is-complete":h(u)})],kt),M(pt,V)}),M(F,I)};J(D,F=>{ve(r()),H(()=>r().isExtraStudy)?F(S):F(R,!1)},x)}};J(Qt,D=>{h(e)?D(Rt):D(Gt,!1)})}p(Mt),p(ft),M(f,E)};J(Tt,f=>{h(c)&&h(P)!==void 0&&!h(d)&&f(Vt)})}p(st),M(s,rt),Ie()}Re(["click"]);export{ns as component,ss as universal};
