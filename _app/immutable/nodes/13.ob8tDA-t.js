import"../chunks/CWj6FrbW.js";import"../chunks/BR-jNC44.js";import{ak as De,p as Ie,al as Ce,j as y,a9 as I,f as k,d as l,i as e,r as i,b as f,c as Ae,n as B,P as ke,w as ge,s,t as T,X as oe,e as K,a as ye,aM as Ue,ap as be,aL as ze,aK as se,ao as Ge}from"../chunks/BNrJ_7a3.js";import{i as Z}from"../chunks/Dag-yXur.js";import{k as Me}from"../chunks/B185AYG7.js";import{s as le,T as Be,r as ie}from"../chunks/BCvXdneq.js";import{s as J}from"../chunks/DoH2Tnow.js";import{b as ne,a as Ke}from"../chunks/3msDmk7a.js";import{b as he}from"../chunks/0VvKN6gX.js";import{i as Se}from"../chunks/1lHFToNQ.js";import{g as Ze,b as we}from"../chunks/Xv_LnwQ6.js";import{e as qe,i as Xe}from"../chunks/bkIv8HrQ.js";import{p as V}from"../chunks/BTdz68iL.js";import{c as xe,C as Ye,g as ce,h as de}from"../chunks/CMR42ROY.js";import{A as je}from"../chunks/CSGCvJxP.js";import{S as re}from"../chunks/CR7DnRQF.js";const Ee={name:"",words:[],lang:"zh",isEnableCustomDictionary:!1};var E=(u=>(u.Simple="simple",u.AnkiText="ankiText",u))(E||{});class Ve{constructor(n){this.app=n}getDeckData(n){const m=[];return n.lang==="yue"&&m.push(xe.ZH_YUE),n.isEnableCustomDictionary&&m.push(xe.ZH_EXTRA_DICT),this.app.getInitDeckData(n.words,m)}parseSimple(n){return{words:n.split(`
`).filter(a=>a.trim()!=="")}}parseAnkiText(n,m){return{words:n.split(`
`).filter(p=>p.trim()!==""&&!p.startsWith("#")).map(p=>p.split("	")[m-1])}}}var Je=()=>window.alert(ce),Qe=u=>{u.key==="Enter"&&window.alert(ce)},et=k('<span class="word-error not-supported svelte-gba299" style="cursor: pointer;" role="button" tabindex="0"><i class="fa-solid fa-triangle-exclamation"></i></span>'),tt=()=>window.alert(de),at=u=>{u.key==="Enter"&&window.alert(de)},st=k('<span class="word-error no-dict svelte-gba299" style="cursor: pointer;" role="button" tabindex="0"><i class="fa-solid fa-circle-exclamation"></i></span>'),it=k('<div><span class="word chinese-font svelte-gba299"> </span> <span class="reading"> </span> <span class="meaning"> </span> <!></div>'),nt=k('<div class="cards-container svelte-gba299"></div>'),rt=k('<div class="deck-preview-container svelte-gba299"><!></div>');function ot(u,n){Ie(n,!1);const m=(_,c=ge,A=ge)=>{var x=it();let $;var O=l(x),X=l(O,!0);i(O);var P=s(O,2),z=l(P,!0);i(P);var W=s(P,2),H=l(W,!0);i(W);var G=s(W,2);{var Y=h=>{var D=et();D.__click=[Je],D.__keydown=[Qe],T(()=>le(D,"title",ce)),f(h,D)},j=(h,D)=>{{var F=M=>{var S=st();S.__click=[tt],S.__keydown=[at],T(()=>le(S,"title",de)),f(M,S)};Z(h,M=>{A()||M(F)},D)}};Z(G,h=>{c(),B(()=>!g.isWordSupportedByHanziWriter(c()))?h(Y):h(j,!1)})}i(x),T((h,D)=>{$=J(x,1,"card svelte-gba299",null,$,h),K(X,c()),K(z,D),K(H,(A(),B(()=>{var F;return((F=A())==null?void 0:F.meaning)??"-"})))},[()=>({"is-show-error-only":p()&&b()>0}),()=>(c(),ke(a()),B(()=>g.getReading(c(),a().lang)||"-"))],oe),f(_,x)};let a=V(n,"deck",8,Ee),p=V(n,"filterShowIssueOnly",8,!1),b=V(n,"issueCount",12,0),r=V(n,"issueIds",28,()=>[]),g=new Ye,L=I(!1);Ce(async()=>{var _;await g.init(a().lang,(_=a())==null?void 0:_.isEnableCustomDictionary),R(),y(L,!0)});function R(){b(0);const _=[];a().words.forEach((c,A)=>{(!g.isWordSupportedByHanziWriter(c)||!g.getWordData(c))&&_.push(A)}),r(_),b(_.length)}Se();var C=rt(),U=l(C);{var q=_=>{var c=nt();qe(c,5,()=>(ke(a()),B(()=>a().words)),Xe,(A,x)=>{var $=oe(()=>(e(x),B(()=>g.getWordData(e(x)))));m(A,()=>e(x),()=>e($))}),i(c),f(_,c)};Z(U,_=>{a()!==null&&e(L)&&_(q)})}i(C),f(u,C),Ae()}De(["click","keydown"]);async function lt(u,n,m,a){const p=await e(n).fileManager.upload();if(p===null||typeof p.data!="string"){window.alert("Failed to upload file.");return}y(m,p.data),a()}var ct=k('<div><label>Column Index: <input type="number" step="1" min="0"/></label></div>'),dt=(u,n)=>y(n,!e(n)),vt=k('<div class="info-issue is-issue svelte-1u19yr2"> </div> <button class="button"> </button>',1),ut=k('<div class="info-issue">No issues found.</div> <button class="button" style="visibility: hidden;">&npsb;</button>',1),pt=k('<div class="deck-preview-container svelte-1u19yr2"><!></div>'),_t=k('<div style="text-align: right;"><input type="text"/> <div style="color: #A64547;">Deck with this name already exists. Please choose another name.</div> <div style="color: #A64547;">Deck name cannot be empty.</div></div>'),mt=k("<select><option>Mandarin</option><option>Cantonese</option></select>"),ft=k('<input type="checkbox"/>'),kt=k(`<!> <div class="main-container svelte-1u19yr2"><div class="upload-container svelte-1u19yr2"><div class="section-title svelte-1u19yr2">Input</div> <div><label>Format: <select><option>Simple</option><option>Anki Text</option></select></label> <a aria-label="Help" class="help-link svelte-1u19yr2"><i class="fa-solid fa-circle-question"></i></a></div> <!> <textarea class="deck-textarea svelte-1u19yr2" placeholder="Enter deck text here"></textarea> <button class="button" style="align-self: flex-end;"><i class="fa-solid fa-upload"></i>&nbsp;
            Upload File</button></div> <div class="preview-container svelte-1u19yr2"><div class="section-title svelte-1u19yr2">Preview</div> <div class="info-issue-container svelte-1u19yr2"><!></div> <!></div> <div class="config-container svelte-1u19yr2"><div class="section-title svelte-1u19yr2">Config</div> <div class="config-items svelte-1u19yr2"><!> <!> <!></div></div> <div class="add-deck-container svelte-1u19yr2"><button class="button">Add Deck</button></div></div>`,1);function Ft(u,n){Ie(n,!1);const m="customDeckInput";let a=I(new je),p=new Ve(e(a)),b=I(""),r=I(Ee),g=I(0),L=I([]),R=I(!1),C=I(E.Simple),U=I(1),q=I(0);function _(){Ue(q)}function c(){window.localStorage.setItem(m,e(b));const t=A();t&&y(r,{...e(r),...t}),_()}function A(){switch(e(C)){case E.Simple:return p.parseSimple(e(b));case E.AnkiText:return p.parseAnkiText(e(b),e(U))}}async function x(){if(e(r).name.trim()===""){window.alert("Deck name cannot be empty.");return}if(e(a).isDeckIdExists(e(r).name)){window.alert("Deck with this name already exists. Please choose another name.");return}if(e(g)>0&&!window.confirm("You have issues in your deck. Card with issues will be ignored. Are you sure you want to add this deck?"))return;const t=p.getDeckData(e(r));t.ignoredIds=e(L),await e(a).addDeck(e(r).name,t),Ze(`${we}/`)}Ce(async()=>{const t=window.localStorage.getItem(m);t&&y(b,t),await e(a).init(),c(),y(a,e(a)),await e(a).initProfile()&&c(),y(a,e(a))}),Se();var $=kt(),O=ye($);Be(O,{title:"Upload Custom Deck"});var X=s(O,2),P=l(X),z=s(l(P),2),W=l(z),H=s(l(W));T(()=>{e(C),be(()=>{})}),H.__change=c;var G=l(H),Y={},j=s(G),h={};i(H),i(W);var D=s(W,2);i(z);var F=s(z,2);{var M=t=>{var v=ct(),o=l(v),d=s(l(o));ie(d),d.__input=c,i(o),i(v),ne(d,()=>e(U),w=>y(U,w)),f(t,v)};Z(F,t=>{e(C)===E.AnkiText&&t(M)})}var S=s(F,2);ze(S),S.__input=c;var Te=s(S,2);Te.__click=[lt,a,b,c],i(P);var Q=s(P,2),ee=s(l(Q),2),$e=l(ee);{var Pe=t=>{var v=vt(),o=ye(v),d=l(o);i(o);var w=s(o,2);w.__click=[dt,R];var N=l(w,!0);i(w),T(()=>{K(d,`Found ${e(g)??""} issue(s)`),K(N,e(R)?"Show All":"Filter to Issues")}),f(t,v)},We=t=>{var v=ut();Ge(2),f(t,v)};Z($e,t=>{e(g)!=0?t(Pe):t(We,!1)})}i(ee);var Fe=s(ee,2);Me(Fe,()=>e(q),t=>{var v=pt(),o=l(v);ot(o,{get deck(){return e(r)},get filterShowIssueOnly(){return e(R)},get issueCount(){return e(g)},set issueCount(d){y(g,d)},get issueIds(){return e(L)},set issueIds(d){y(L,d)},$$legacy:!0}),i(v),f(t,v)}),i(Q);var te=s(Q,2),ve=s(l(te),2),ue=l(ve);re(ue,{key:"deckName",children:(t,v)=>{var o=_t(),d=l(o);ie(d);let w;var N=s(d,2);let me;var He=s(N,2);let fe;i(o),T((ae,Ne,Re)=>{w=J(d,1,"",null,w,ae),me=J(N,1,"warning-text svelte-1u19yr2",null,me,Ne),fe=J(He,1,"warning-text svelte-1u19yr2",null,fe,Re)},[()=>({invalid:e(a).isDeckIdExists(e(r).name)}),()=>({hidden:!e(a).isDeckIdExists(e(r).name)}),()=>({hidden:e(r).name.trim()})],oe),ne(d,()=>e(r).name,ae=>se(r,e(r).name=ae)),f(t,o)},$$slots:{default:!0}});var pe=s(ue,2);re(pe,{key:"deckLanguage",children:(t,v)=>{var o=mt();T(()=>{e(r),be(()=>{})});var d=l(o);d.value=d.__value="zh";var w=s(d);w.value=w.__value="yue",i(o),he(o,()=>e(r).lang,N=>se(r,e(r).lang=N)),f(t,o)},$$slots:{default:!0}});var Le=s(pe,2);re(Le,{key:"deckEnableCustomDictionary",children:(t,v)=>{var o=ft();ie(o),o.__change=c,Ke(o,()=>e(r).isEnableCustomDictionary,d=>se(r,e(r).isEnableCustomDictionary=d)),f(t,o)},$$slots:{default:!0}}),i(ve),i(te);var _e=s(te,2),Oe=l(_e);Oe.__click=x,i(_e),i(X),T(()=>{Y!==(Y=E.Simple)&&(G.value=(G.__value=E.Simple)??""),h!==(h=E.AnkiText)&&(j.value=(j.__value=E.AnkiText)??""),le(D,"href",`${we??""}/upload-custom-deck/help`)}),he(H,()=>e(C),t=>y(C,t)),ne(S,()=>e(b),t=>y(b,t)),f(u,$),Ae()}De(["change","input","click"]);export{Ft as component};
