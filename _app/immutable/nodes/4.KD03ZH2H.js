var ye=n=>{throw TypeError(n)};var we=(n,i,t)=>i.has(n)||ye("Cannot "+t);var f=(n,i,t)=>(we(n,i,"read from private field"),t?t.call(n):i.get(n)),E=(n,i,t)=>i.has(n)?ye("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(n):i.set(n,t);var ae=(n,i,t)=>(we(n,i,"access private method"),t);import"../chunks/CWj6FrbW.js";import"../chunks/e1y9C63k.js";import{d as nt,o as ot,s as Z}from"../chunks/BzFAuoMn.js";import{e as se,u as ze,g as lt,h as e,i as u,j as re,p as ct,X as T,ai as Se,aj as ut,f as M,a as xe,d as _,s as m,b as x,c as dt,r as v,a7 as p,t as ie,H as vt,a9 as ft}from"../chunks/BqfnsoT0.js";import{i as K}from"../chunks/SbZFkT06.js";import{e as Ce,i as Me}from"../chunks/4L0NknSj.js";import{T as _t,r as pt}from"../chunks/B7pZ-LzU.js";import{s as ne}from"../chunks/D7BTPPfp.js";import{b as bt}from"../chunks/Bq5wG4L9.js";import{i as mt}from"../chunks/BEabaf4r.js";import{p as kt}from"../chunks/8f3Y1WCl.js";import{g as ht,b as De}from"../chunks/0thJK1pv.js";import{A as gt,D as yt,W as h}from"../chunks/31fOCuSw.js";import{c as wt,d as zt}from"../chunks/BwjUfq8s.js";import{S as St}from"../chunks/BCq4_qPV.js";const xt=({url:n})=>({deckId:n.searchParams.get("id")||""}),ua=Object.freeze(Object.defineProperty({__proto__:null,load:xt},Symbol.toStringTag,{value:"Module"}));var Ct=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],Mt=["difference","intersection","symmetricDifference","union"],Te=!1,I,y,C,X,O,Ae,Pe;const Y=class Y extends Set{constructor(t){super();E(this,O);E(this,I,new Map);E(this,y,se(0));E(this,C,se(0));E(this,X,ze||-1);if(t){for(var c of t)super.add(c);f(this,C).v=super.size}Te||ae(this,O,Pe).call(this)}has(t){var c=super.has(t),g=f(this,I),l=g.get(t);if(l===void 0){if(!c)return e(f(this,y)),!1;l=ae(this,O,Ae).call(this,!0),g.set(t,l)}return e(l),c}add(t){return super.has(t)||(super.add(t),u(f(this,C),super.size),re(f(this,y))),this}delete(t){var c=super.delete(t),g=f(this,I),l=g.get(t);return l!==void 0&&(g.delete(t),u(l,!1)),c&&(u(f(this,C),super.size),re(f(this,y))),c}clear(){if(super.size!==0){super.clear();var t=f(this,I);for(var c of t.values())u(c,!1);t.clear(),u(f(this,C),0),re(f(this,y))}}keys(){return this.values()}values(){return e(f(this,y)),super.values()}entries(){return e(f(this,y)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return e(f(this,C))}};I=new WeakMap,y=new WeakMap,C=new WeakMap,X=new WeakMap,O=new WeakSet,Ae=function(t){return ze===f(this,X)?se(t):lt(t)},Pe=function(){Te=!0;var t=Y.prototype,c=Set.prototype;for(const g of Ct)t[g]=function(...l){return e(f(this,y)),c[g].apply(this,l)};for(const g of Mt)t[g]=function(...l){e(f(this,y));var R=c[g].apply(this,l);return new Y(R)}};let oe=Y;var Dt=(n,i)=>i(),Tt=(n,i)=>i(),At=(n,i,t)=>i(e(t).label),Pt=M('<i class="fa-solid fa-chevron-down"></i>'),Et=M('<i class="fa-solid fa-chevron-right"></i>'),It=(n,i)=>i(),Ot=(n,i)=>i(),Nt=(n,i)=>i(),Wt=(n,i)=>i(),Ut=(n,i)=>i(),jt=(n,i)=>i(),Gt=M('<div style="display: flex; flex-direction: row; justify-content: space-between; width: 100%; gap: 0.5em;"><div class="group-buttons-container svelte-ztfula" style="align-items: flex-start;"><button class="button svelte-ztfula"><i class="fa-solid fa-xmark"></i>cancel selection</button> <button class="button svelte-ztfula"><i class="fa-solid fa-check-double"></i>select all</button></div> <div class="group-buttons-container svelte-ztfula" style="align-items: flex-end;"><button class="button svelte-ztfula"><i class="fa-solid fa-book-open"></i><span>mark as <b>previously studied</b></span></button> <button class="button svelte-ztfula"><i class="fa-solid fa-book-open"></i><span>remove <b>previously studied</b> mark</span></button> <button class="button svelte-ztfula"><i class="fa-solid fa-square-xmark"></i><span>mark as <b>ignored</b></span></button> <button class="button svelte-ztfula"><i class="fa-solid fa-square-xmark"></i><span>remove <b>ignored</b> mark</span></button></div></div>'),Rt=(n,i,t,c)=>i(e(t).label,e(c)),qt=(n,i,t,c)=>{n.key=="Enter"&&i(e(t).label,e(c))},Ft=(n,i,t,c)=>i(e(t).label,e(c),n),Lt=M('<button class="button select-button svelte-ztfula">select</button>'),$t=M('<div role="button" tabindex="0"><!> <div class="card-word svelte-ztfula"><span class="word"> </span></div> <div class="card-details svelte-ztfula"><div> </div> <div> </div></div></div>'),Bt=M('<!> <div class="group-content svelte-ztfula"></div>',1),Ht=M('<div class="group svelte-ztfula"><button class="group-header svelte-ztfula"><div> </div> <div><!></div></button> <!></div>'),Zt=M('<!> <div class="container svelte-ztfula"><div class="top-container" style="display: flex; gap: 0.5em; margin-bottom: 2em"><div class="top-control-container svelte-ztfula"><div style="display: flex; gap: 0.5em; align-items: center;"><button class="button svelte-ztfula">Split into groups of</button> <input class="input" type="number" min="1" max="100"/></div> <button class="button delete-button svelte-ztfula"><i class="fa-solid fa-trash"></i> Delete this Deck</button></div></div> <div class="group-container svelte-ztfula"></div></div>',1);function da(n,i){ct(i,!1);const t=T(),c=T();let l=kt(i,"data",8)().deckId||"",R=!1,le,r=T(new gt);ot(async()=>{await e(r).init(),ce(),await e(r).initProfile()&&ce()});function ce(){var s,a;R=(a=(s=e(r).deckData[l])==null?void 0:s.tags)==null?void 0:a.includes(wt.ZH_TRAD),le=new zt("cn","tw"),u(r,e(r))}let S=T(new St);function Ee(s){e(S).set(s,!e(S).get(s)),u(S,e(S))}function J(s,a,k){switch(k.getWenbunCustomState(s,a)??h.New){case h.New:return"card-status-new";case h.WarmUp:return"card-status-new";case h.Learning:return"card-status-learning";case h.ReviewYoung:return"card-status-review-young";case h.ReviewMature:return"card-status-review-mature";case h.Relearning:return"card-status-relearning";case h.PreviouslyStudied:return"card-status-previously-studied";case h.Ignored:return"card-status-ignored"}}function Ie(s,a){const k=e(r).getCardWord(s,a);return R?le.convert(k):k}let q=T(yt);async function Oe(){const s=Math.ceil(e(t).deck.length/e(q));window.confirm(`Split the deck into ${s} groups?`)&&(e(r).splitDeckIntoGroupOfN(l,e(q)),await e(r).save(),u(r,e(r)))}async function Ne(){const s=window.confirm("Are you sure you want to delete this deck?");if(!s)return;const a=window.confirm("Are you really sure you want to delete this deck? All data will be lost.");a&&(e(r).deleteDeck(l,s&&a),await e(r).save(),ht(`${De}/`))}let b=T(null),o=T(new oe);function We(s,a,k){k==null||k.stopPropagation(),u(b,s),e(o).clear(),a!=null&&e(o).add(a),u(o,e(o))}function Ue(){u(b,null),e(o).clear(),u(o,e(o))}function je(s,a,k){return e(b)==s&&k.has(a)}function ue(s,a){e(b)==s&&(e(o).has(a)?e(o).delete(a):e(o).add(a),u(o,e(o)))}function Ge(){if(e(b)==null)return;const s=e(t).groups.find(a=>a.label==e(b));if(s!=null){e(o).clear();for(const a of s.cardIds)e(o).add(a);u(o,e(o))}}async function Re(){e(b)!=null&&(e(o).forEach(s=>{e(r).addPreviouslyStudiedMark(l,s)}),await e(r).save(),u(r,e(r)))}async function qe(){e(b)!=null&&(e(o).forEach(s=>{e(r).removePreviouslyStudiedMark(l,s)}),await e(r).save(),u(r,e(r)))}async function Fe(){e(b)!=null&&(e(o).forEach(s=>{e(r).addIgnoredMark(l,s)}),await e(r).save(),u(r,e(r)))}async function Le(){e(b)!=null&&(e(o).forEach(s=>{e(r).removeIgnoredMark(l,s)}),await e(r).save(),u(r,e(r)))}function $e(s){return s===h.WarmUp?h.New:s}Se(()=>e(r),()=>{u(t,e(r).deckData[l])}),Se(()=>e(t),()=>{var s;u(c,((s=e(t))==null?void 0:s.groups)??[])}),ut(),mt();var de=Zt(),ve=xe(de);_t(ve,{title:"Deck",get backUrl(){return`${De??""}/`}});var fe=m(ve,2),Q=_(fe),_e=_(Q),V=_(_e),pe=_(V);pe.__click=[Dt,Oe];var be=m(pe,2);pt(be),v(V);var Be=m(V,2);Be.__click=[Tt,Ne],v(_e),v(Q);var me=m(Q,2);Ce(me,5,()=>e(c),Me,(s,a)=>{var k=Ht(),F=_(k);F.__click=[At,Ee,a];var ee=_(F),He=_(ee,!0);v(ee);var ke=m(ee,2),Ze=_(ke);{var Ke=w=>{var A=Pt();x(w,A)},Xe=w=>{var A=Et();x(w,A)};K(Ze,w=>{e(S),e(a),p(()=>e(S).get(e(a).label))?w(Ke):w(Xe,!1)})}v(ke),v(F);var Ye=m(F,2);{var Je=w=>{var A=Bt(),he=xe(A);{var Qe=N=>{var d=Gt(),z=_(d),W=_(z);W.__click=[It,Ue];var L=m(W,2);L.__click=[Ot,Ge],v(z);var $=m(z,2),D=_($);D.__click=[Nt,Re];var P=m(D,2);P.__click=[Wt,qe];var U=m(P,2);U.__click=[Ut,Fe];var j=m(U,2);j.__click=[jt,Le],v($),v(d),ie(()=>{D.disabled=(e(o),p(()=>e(o).size==0)),P.disabled=(e(o),p(()=>e(o).size==0)),U.disabled=(e(o),p(()=>e(o).size==0)),j.disabled=(e(o),p(()=>e(o).size==0))}),x(N,d)};K(he,N=>{e(b),e(a),p(()=>e(b)==e(a).label)&&N(Qe)})}var ge=m(he,2);Ce(ge,5,()=>(e(a),p(()=>e(a).cardIds)),Me,(N,d)=>{var z=$t();let W;z.__click=[Rt,ue,a,d],z.__keydown=[qt,ue,a,d];var L=_(z);{var $=G=>{var H=Lt();H.__click=[Ft,We,a,d],x(G,H)};K(L,G=>{e(b),e(a),p(()=>e(b)!=e(a).label)&&G($)})}var D=m(L,2),P=_(D),U=_(P,!0);v(P),v(D);var j=m(D,2),B=_(j),Ve=_(B,!0);v(B);var te=m(B,2),et=_(te,!0);v(te),v(j),v(z),ie((G,H,tt,at,st,rt,it)=>{W=ne(z,1,G,"svelte-ztfula",W,H),Z(U,tt),ne(B,1,at,"svelte-ztfula"),Z(Ve,st),ne(te,1,rt,"svelte-ztfula"),Z(et,it)},[()=>(e(d),e(r),p(()=>`card ${J(l,e(d),e(r))}`)),()=>({selectable:e(b)==e(a).label,selected:je(e(a).label,e(d),e(o))}),()=>(e(d),p(()=>Ie(l,e(d)))),()=>(e(d),e(r),p(()=>`status ${J(l,e(d),e(r))}`)),()=>(e(r),e(d),ft(h),p(()=>$e(e(r).getWenbunCustomState(l,e(d))??h.New))),()=>(e(d),e(r),p(()=>`due ${J(l,e(d),e(r))}`)),()=>(e(r),e(d),p(()=>e(r).getCardDueFormatted(l,e(d))))],vt),x(N,z)}),v(ge),x(w,A)};K(Ye,w=>{e(S),e(a),p(()=>e(S).get(e(a).label))&&w(Je)})}v(k),ie(()=>Z(He,(e(a),p(()=>e(a).label=="__ungrouped__"?"Ungrouped":e(a).label)))),x(s,k)}),v(me),v(fe),bt(be,()=>e(q),s=>u(q,s)),x(n,de),dt()}nt(["click","keydown"]);export{da as component,ua as universal};
