var me=n=>{throw TypeError(n)};var ke=(n,r,t)=>r.has(n)||me("Cannot "+t);var v=(n,r,t)=>(ke(n,r,"read from private field"),t?t.call(n):r.get(n)),E=(n,r,t)=>r.has(n)?me("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(n):r.set(n,t);var te=(n,r,t)=>(ke(n,r,"access private method"),t);import"../chunks/CWj6FrbW.js";import"../chunks/BwBI99aB.js";import{d as et,o as tt,s as Z}from"../chunks/ycU_2_ja.js";import{s as ae,u as he,a as at,g as e,b as u,i as se,K as st,L as D,M as ge,N as rt,O as T,P as ye,V as b,R as C,S as it,T as m,W as _,d as f,Q as re,Y as nt,q as ot}from"../chunks/D5KdzY0j.js";import{i as $}from"../chunks/B0cj2f_u.js";import{A as lt,e as we,b as ct,c as ut,C as dt,i as Se,W as k}from"../chunks/Duvcdp-S.js";import{T as vt,r as _t}from"../chunks/BhN4PZSw.js";import{s as ie}from"../chunks/ChyXsXdu.js";import{b as ft}from"../chunks/Dgc4Hvsz.js";import{i as pt}from"../chunks/DaQO7wjj.js";import{p as bt}from"../chunks/MYtgBzKL.js";import{b as xt}from"../chunks/CtMDA3SB.js";import{S as mt}from"../chunks/DpZSsXjr.js";const kt=({url:n})=>({deckId:n.searchParams.get("id")||""}),ta=Object.freeze(Object.defineProperty({__proto__:null,load:kt},Symbol.toStringTag,{value:"Module"}));var ht=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],gt=["difference","intersection","symmetricDifference","union"],Ce=!1,I,g,M,H,N,Me,Te;const Q=class Q extends Set{constructor(t){super();E(this,N);E(this,I,new Map);E(this,g,ae(0));E(this,M,ae(0));E(this,H,he||-1);if(t){for(var c of t)super.add(c);v(this,M).v=super.size}Ce||te(this,N,Te).call(this)}has(t){var c=super.has(t),h=v(this,I),l=h.get(t);if(l===void 0){if(!c)return e(v(this,g)),!1;l=te(this,N,Me).call(this,!0),h.set(t,l)}return e(l),c}add(t){return super.has(t)||(super.add(t),u(v(this,M),super.size),se(v(this,g))),this}delete(t){var c=super.delete(t),h=v(this,I),l=h.get(t);return l!==void 0&&(h.delete(t),u(l,!1)),c&&(u(v(this,M),super.size),se(v(this,g))),c}clear(){if(super.size!==0){super.clear();var t=v(this,I);for(var c of t.values())u(c,!1);t.clear(),u(v(this,M),0),se(v(this,g))}}keys(){return this.values()}values(){return e(v(this,g)),super.values()}entries(){return e(v(this,g)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return e(v(this,M))}};I=new WeakMap,g=new WeakMap,M=new WeakMap,H=new WeakMap,N=new WeakSet,Me=function(t){return he===v(this,H)?ae(t):at(t)},Te=function(){Ce=!0;var t=Q.prototype,c=Set.prototype;for(const h of ht)t[h]=function(...l){return e(v(this,g)),c[h].apply(this,l)};for(const h of gt)t[h]=function(...l){e(v(this,g));var j=c[h].apply(this,l);return new Q(j)}};let ne=Q;var yt=(n,r)=>r(),wt=(n,r,t)=>r(e(t).label),St=T('<i class="fa-solid fa-chevron-down"></i>'),Ct=T('<i class="fa-solid fa-chevron-right"></i>'),Mt=(n,r)=>r(),Tt=(n,r)=>r(),zt=(n,r)=>r(),Dt=(n,r)=>r(),Ot=(n,r)=>r(),Pt=(n,r)=>r(),Et=T('<div style="display: flex; flex-direction: row; justify-content: space-between; width: 100%; gap: 0.5em;"><div class="group-buttons-container svelte-1e3uxxx" style="align-items: flex-start;"><button class="button svelte-1e3uxxx"><i class="fa-solid fa-xmark"></i>cancel selection</button> <button class="button svelte-1e3uxxx"><i class="fa-solid fa-check-double"></i>select all</button></div> <div class="group-buttons-container svelte-1e3uxxx" style="align-items: flex-end;"><button class="button svelte-1e3uxxx"><i class="fa-solid fa-book-open"></i><span>mark as <b>previously studied</b></span></button> <button class="button svelte-1e3uxxx"><i class="fa-solid fa-book-open"></i><span>remove <b>previously studied</b> mark</span></button> <button class="button svelte-1e3uxxx"><i class="fa-solid fa-square-xmark"></i><span>mark as <b>ignored</b></span></button> <button class="button svelte-1e3uxxx"><i class="fa-solid fa-square-xmark"></i><span>remove <b>ignored</b> mark</span></button></div></div>'),It=(n,r,t,c)=>r(e(t).label,e(c)),Nt=(n,r,t,c)=>{n.key=="Enter"&&r(e(t).label,e(c))},Wt=(n,r,t,c)=>r(e(t).label,e(c),n),At=T('<button class="button select-button svelte-1e3uxxx">select</button>'),Ut=T('<div role="button" tabindex="0"><!> <div class="card-word svelte-1e3uxxx"><span class="word"> </span></div> <div class="card-details svelte-1e3uxxx"><div> </div> <div> </div></div></div>'),Rt=T('<!> <div class="group-content svelte-1e3uxxx"></div>',1),Gt=T('<div class="group svelte-1e3uxxx"><button class="group-header svelte-1e3uxxx"><div> </div> <div><!></div></button> <!></div>'),jt=T('<!> <div class="container svelte-1e3uxxx"><div class="top-container" style="display: flex; gap: 0.5em; margin-bottom: 2em"><button class="button svelte-1e3uxxx">Split into groups of</button> <input class="input" type="number" min="1" max="100"/></div> <div class="group-container svelte-1e3uxxx"></div></div>',1);function aa(n,r){st(r,!1);const t=D(),c=D();let l=bt(r,"data",8)().deckId||"",j=!1,oe,i=D(new lt);tt(async()=>{var s,a;await e(i).init(),j=(a=(s=e(i).deckData[l])==null?void 0:s.tags)==null?void 0:a.includes(ut.ZH_TRAD),oe=new dt("cn","tw"),u(i,e(i))});let S=D(new mt);function ze(s){e(S).set(s,!e(S).get(s)),u(S,e(S))}function V(s,a,x){switch(x.getWenbunCustomState(s,a)??k.New){case k.New:return"card-status-new";case k.WarmUp:return"card-status-new";case k.Learning:return"card-status-learning";case k.ReviewYoung:return"card-status-review-young";case k.ReviewMature:return"card-status-review-mature";case k.Relearning:return"card-status-relearning";case k.PreviouslyStudied:return"card-status-previously-studied";case k.Ignored:return"card-status-ignored"}}function De(s,a){const x=e(i).getCardWord(s,a);return j?oe.convert(x):x}let q=D(ct);async function Oe(){const s=Math.ceil(e(t).deck.length/e(q));window.confirm(`Split the deck into ${s} groups?`)&&(e(i).splitDeckIntoGroupOfN(l,e(q)),await e(i).save(),u(i,e(i)))}let p=D(null),o=D(new ne);function Pe(s,a,x){x==null||x.stopPropagation(),u(p,s),e(o).clear(),a!=null&&e(o).add(a),u(o,e(o))}function Ee(){u(p,null),e(o).clear(),u(o,e(o))}function Ie(s,a,x){return e(p)==s&&x.has(a)}function le(s,a){e(p)==s&&(e(o).has(a)?e(o).delete(a):e(o).add(a),u(o,e(o)))}function Ne(){if(e(p)==null)return;const s=e(t).groups.find(a=>a.label==e(p));if(s!=null){e(o).clear();for(const a of s.cardIds)e(o).add(a);u(o,e(o))}}async function We(){e(p)!=null&&(e(o).forEach(s=>{e(i).addPreviouslyStudiedMark(l,s)}),await e(i).save(),u(i,e(i)))}async function Ae(){e(p)!=null&&(e(o).forEach(s=>{e(i).removePreviouslyStudiedMark(l,s)}),await e(i).save(),u(i,e(i)))}async function Ue(){e(p)!=null&&(e(o).forEach(s=>{e(i).addIgnoredMark(l,s)}),await e(i).save(),u(i,e(i)))}async function Re(){e(p)!=null&&(e(o).forEach(s=>{e(i).removeIgnoredMark(l,s)}),await e(i).save(),u(i,e(i)))}function Ge(s){return s===k.WarmUp?k.New:s}ge(()=>e(i),()=>{u(t,e(i).deckData[l])}),ge(()=>e(t),()=>{var s;u(c,((s=e(t))==null?void 0:s.groups)??[])}),rt(),pt();var ce=jt(),ue=ye(ce);vt(ue,{title:"Deck",get backUrl(){return`${xt??""}/`}});var de=m(ue,2),J=b(de),ve=b(J);ve.__click=[yt,Oe];var _e=m(ve,2);_t(_e),_(J);var fe=m(J,2);we(fe,5,()=>e(c),Se,(s,a)=>{var x=Gt(),L=b(x);L.__click=[wt,ze,a];var X=b(L),je=b(X,!0);_(X);var pe=m(X,2),qe=b(pe);{var Le=y=>{var O=St();C(y,O)},Fe=y=>{var O=Ct();C(y,O)};$(qe,y=>{e(S),e(a),f(()=>e(S).get(e(a).label))?y(Le):y(Fe,!1)})}_(pe),_(L);var Be=m(L,2);{var Ke=y=>{var O=Rt(),be=ye(O);{var Ye=W=>{var d=Et(),w=b(d),A=b(w);A.__click=[Mt,Ee];var F=m(A,2);F.__click=[Tt,Ne],_(w);var B=m(w,2),z=b(B);z.__click=[zt,We];var P=m(z,2);P.__click=[Dt,Ae];var U=m(P,2);U.__click=[Ot,Ue];var R=m(U,2);R.__click=[Pt,Re],_(B),_(d),re(()=>{z.disabled=(e(o),f(()=>e(o).size==0)),P.disabled=(e(o),f(()=>e(o).size==0)),U.disabled=(e(o),f(()=>e(o).size==0)),R.disabled=(e(o),f(()=>e(o).size==0))}),C(W,d)};$(be,W=>{e(p),e(a),f(()=>e(p)==e(a).label)&&W(Ye)})}var xe=m(be,2);we(xe,5,()=>(e(a),f(()=>e(a).cardIds)),Se,(W,d)=>{var w=Ut();let A;w.__click=[It,le,a,d],w.__keydown=[Nt,le,a,d];var F=b(w);{var B=G=>{var Y=At();Y.__click=[Wt,Pe,a,d],C(G,Y)};$(F,G=>{e(p),e(a),f(()=>e(p)!=e(a).label)&&G(B)})}var z=m(F,2),P=b(z),U=b(P,!0);_(P),_(z);var R=m(z,2),K=b(R),Ze=b(K,!0);_(K);var ee=m(K,2),$e=b(ee,!0);_(ee),_(R),_(w),re((G,Y,He,Qe,Ve,Je,Xe)=>{A=ie(w,1,G,"svelte-1e3uxxx",A,Y),Z(U,He),ie(K,1,Qe,"svelte-1e3uxxx"),Z(Ze,Ve),ie(ee,1,Je,"svelte-1e3uxxx"),Z($e,Xe)},[()=>(e(d),e(i),f(()=>`card ${V(l,e(d),e(i))}`)),()=>({selectable:e(p)==e(a).label,selected:Ie(e(a).label,e(d),e(o))}),()=>(e(d),f(()=>De(l,e(d)))),()=>(e(d),e(i),f(()=>`status ${V(l,e(d),e(i))}`)),()=>(e(i),e(d),ot(k),f(()=>Ge(e(i).getWenbunCustomState(l,e(d))??k.New))),()=>(e(d),e(i),f(()=>`due ${V(l,e(d),e(i))}`)),()=>(e(i),e(d),f(()=>e(i).getCardDueFormatted(l,e(d))))],nt),C(W,w)}),_(xe),C(y,O)};$(Be,y=>{e(S),e(a),f(()=>e(S).get(e(a).label))&&y(Ke)})}_(x),re(()=>Z(je,(e(a),f(()=>e(a).label=="__ungrouped__"?"Ungrouped":e(a).label)))),C(s,x)}),_(fe),_(de),ft(_e,()=>e(q),s=>u(q,s)),C(n,ce),it()}et(["click","keydown"]);export{aa as component,ta as universal};
